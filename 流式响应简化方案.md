# 流式响应处理简化方案

## 问题分析

当前存在**三层重复检测逻辑**，导致过度过滤：

1. **deepseek.rs (第一层)**：检测重复 content，添加到 `result_chunks`
2. **ai_commands.rs (第二层)**：检测重复 text chunk，处理部分重叠
3. **ChatPanel.tsx (第三层)**：检测重复 chunk，处理部分重叠

## 简化策略

### 原则：单一职责，只在后端处理重复检测

### 新架构：

```
DeepSeek API (SSE Stream)
    ↓
deepseek.rs
    ├─ 解析 SSE 行
    ├─ 累积 content deltas（简单的字符串追加）
    ├─ 每个 content delta 直接发送为独立的 ChatChunk
    └─ 不合并，不检测重复（让后续层处理）
    ↓
ai_commands.rs
    ├─ 接收 ChatChunk::Text
    ├─ 单一去重逻辑：检查与 accumulated_text 的重复
    ├─ 处理部分重叠
    └─ 直接发送到前端（不做复杂处理）
    ↓
ChatPanel.tsx
    └─ 简单追加到消息（不做重复检测）
```

## 具体修改

### 1. 简化 deepseek.rs
- 移除复杂的重复检测
- 每个 content delta 直接作为 ChatChunk::Text 返回
- 不合并多个 content deltas

### 2. 简化 ai_commands.rs
- 保留单一的重复检测逻辑
- 移除部分重叠处理（如果不需要）

### 3. 简化 ChatPanel.tsx
- 移除所有重复检测逻辑
- 直接追加文本到消息

