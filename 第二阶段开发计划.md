# Binderï¼ˆåˆé¡µï¼‰ç¬¬äºŒé˜¶æ®µå¼€å‘è®¡åˆ’

## æ–‡æ¡£ä¿¡æ¯

- **é˜¶æ®µåç§°**ï¼šæ–‡æ¡£ç¼–è¾‘å™¨æ ¸å¿ƒåŠŸèƒ½
- **å¼€å‘å‘¨æœŸ**ï¼š6 å‘¨ï¼ˆWeek 5-10ï¼‰
- **å¼€å‘ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„æ–‡æ¡£ç¼–è¾‘å™¨ï¼Œæ”¯æŒ DOCXã€Markdownã€HTML æ ¼å¼
- **ç‰ˆæœ¬**ï¼šv2.1ï¼ˆæŠ€æœ¯é¡¾é—®ä¼˜åŒ–ç‰ˆï¼‰
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025å¹´
- **æœ€åæ›´æ–°**ï¼š2025å¹´
- **æ›´æ–°è¯´æ˜**ï¼šæ•´åˆæŠ€æœ¯é¡¾é—®å»ºè®®ï¼Œä¿®å¤é«˜å±é—®é¢˜ï¼Œå¢å¼ºåªè¯»æ¨¡å¼ã€å›¾ç‰‡è·¯å¾„å¤„ç†ã€æ–‡ä»¶å†²çªæ£€æµ‹ç­‰å…³é”®åŠŸèƒ½

## æ€»ä½“ç›®æ ‡

å®ç°å®Œæ•´çš„æ–‡æ¡£ç¼–è¾‘å™¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ TipTap ç¼–è¾‘å™¨é›†æˆã€å¤šæ ¼å¼æ”¯æŒï¼ˆDOCXã€Markdownã€HTMLï¼‰ã€å›¾ç‰‡å¤„ç†ã€è‡ªåŠ¨ä¿å­˜ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸º AI åŠŸèƒ½é›†æˆå¥ å®šåŸºç¡€ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼ˆåŸºäºç¬¬ä¸€é˜¶æ®µç»éªŒï¼‰ï¼š
- âœ… **ç¨³å®šæ€§ä¼˜å…ˆ**ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½è¦æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µå¤„ç†
- âœ… **è½åœ°æ€§ä¿è¯**ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½è¦æœ‰å…·ä½“çš„ä»£ç å®ç°è·¯å¾„å’ŒéªŒæ”¶æ ‡å‡†
- âœ… **é›¶ç›²ç‚¹**ï¼šåŠŸèƒ½çš„æ¯ä¸ªç¯èŠ‚ã€æµç¨‹çš„æ¯ä¸ªé€»è¾‘é“¾ã€UIçš„æ¯ä¸ªåƒç´ éƒ½è¦æœ‰æ˜ç¡®çš„è®¾è®¡
- âœ… **API éªŒè¯**ï¼šæå‰éªŒè¯ Tauri 2.x APIï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- âœ… **æƒé™é…ç½®**ï¼šè¯¦ç»†çš„æƒé™é…ç½®è¯´æ˜ï¼Œé¿å…æƒé™é—®é¢˜
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
- âœ… **æµ‹è¯•è¦†ç›–**ï¼šå…³é”®åŠŸèƒ½è¦æœ‰æµ‹è¯•éªŒè¯

---

## ç¬¬ä¸€é˜¶æ®µç»éªŒæ€»ç»“

### âœ… æˆåŠŸç»éªŒ
1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå‰åç«¯åˆ†ç¦»æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
2. **ç±»å‹å®‰å…¨**ï¼šTypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
3. **çŠ¶æ€ç®¡ç†**ï¼šZustand ä½¿ç”¨ç®€å•é«˜æ•ˆ
4. **æ–‡ä»¶ç³»ç»Ÿç›‘å¬**ï¼šä½¿ç”¨ notify crate å®ç°è‡ªåŠ¨åˆ·æ–°

### âš ï¸ éœ€è¦æ”¹è¿›
1. **API å…¼å®¹æ€§**ï¼šTauri 2.x API å˜åŒ–éœ€è¦æå‰éªŒè¯
2. **æƒé™é…ç½®**ï¼šéœ€è¦è¯¦ç»†çš„æƒé™é…ç½®æ–‡æ¡£
3. **é”™è¯¯å¤„ç†**ï¼šéœ€è¦æ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. **æµ‹è¯•è¦†ç›–**ï¼šç¼ºå°‘æµ‹è¯•ï¼Œå¯¼è‡´é—®é¢˜å‘ç°è¾ƒæ™š
5. **å®ç°ç»†èŠ‚**ï¼šéœ€è¦æ›´è¯¦ç»†çš„å®ç°æ­¥éª¤ï¼Œé¿å…ç›²ç‚¹

### ğŸ”§ æ”¹è¿›æªæ–½
1. **æå‰éªŒè¯ API**ï¼šæ¯ä¸ªæ–° API ä½¿ç”¨å‰éƒ½è¦éªŒè¯
2. **è¯¦ç»†æƒé™æ–‡æ¡£**ï¼šåˆ—å‡ºæ‰€æœ‰éœ€è¦çš„æƒé™å’Œé…ç½®æ–¹æ³•
3. **å®Œå–„é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰å…³é”®æ“ä½œéƒ½è¦æœ‰é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. **å¢åŠ æµ‹è¯•**ï¼šå…³é”®åŠŸèƒ½è¦æœ‰å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. **è¯¦ç»†å®ç°æ­¥éª¤**ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½è¦æœ‰è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œä»£ç ç¤ºä¾‹

### âš ï¸ æŠ€æœ¯é¡¾é—®åé¦ˆçš„å…³é”®é—®é¢˜

#### é«˜å±çº§ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
1. **å›¾ç‰‡è·¯å¾„å¤„ç†ä¸ç»Ÿä¸€** âš ï¸âš ï¸âš ï¸
   - é—®é¢˜ï¼šTipTap å’Œ Pandoc ä½¿ç”¨ä¸åŒè·¯å¾„æ ¼å¼ï¼Œå¯¼è‡´å›¾ç‰‡ä¸¢å¤±
   - è§£å†³ï¼šç»Ÿä¸€ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `assets/xxx.png`ï¼ŒPandoc ä½¿ç”¨ `--extract-media=assets`

2. **æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹å†²çª** âš ï¸âš ï¸âš ï¸
   - é—®é¢˜ï¼šç”¨æˆ·åœ¨ Word ä¸­ä¿®æ”¹æ–‡ä»¶ï¼ŒBinder ä¸çŸ¥æƒ…ï¼Œä¿å­˜æ—¶è¦†ç›–
   - è§£å†³ï¼šæ–‡ä»¶ç›‘å¬ + ä¿®æ”¹æ—¶é—´æ£€æŸ¥ï¼Œå‘ç°å†²çªæ—¶å¼¹çª—æç¤º

#### ä¸­å±çº§ï¼ˆé‡è¦ä¼˜åŒ–ï¼‰
3. **è‡ªåŠ¨ä¿å­˜è§¦å‘é¢‘ç‡è¿‡é«˜**
   - é—®é¢˜ï¼šTipTap onUpdate æ¯æ‰“ä¸€ä¸ªå­—éƒ½è§¦å‘ï¼Œå¯¼è‡´å¤§é‡æ— ç”¨ä¿å­˜
   - è§£å†³ï¼šä½¿ç”¨é˜²æŠ– + å†…å®¹å˜åŒ–æ£€æµ‹ï¼Œé¿å…æ— å˜åŒ–æ—¶ä¿å­˜

4. **æ ‡ç­¾é¡µç¼ºå°‘è„æ ‡è®°**
   - é—®é¢˜ï¼šç”¨æˆ·æ— æ³•å¿«é€Ÿè¯†åˆ«å“ªäº›æ–‡ä»¶å·²ä¿®æ”¹
   - è§£å†³ï¼šæ ‡ç­¾é¡µæ ‡é¢˜æ˜¾ç¤ºæ–‡ä»¶å + è„æ ‡è®°ï¼ˆ*ï¼‰

5. **å…³é—­æ ‡ç­¾é¡µå‰æœªæ£€æŸ¥**
   - é—®é¢˜ï¼šç›´æ¥å…³é—­æœªä¿å­˜æ–‡ä»¶ï¼Œæ•°æ®ä¸¢å¤±
   - è§£å†³ï¼šå…³é—­å‰æ£€æŸ¥ isDirtyï¼Œå¼¹çª—ç¡®è®¤

6. **æ–‡ä»¶è¢«åˆ é™¤æœªå¤„ç†**
   - é—®é¢˜ï¼šæ–‡ä»¶æ ‘åˆ é™¤æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ï¼Œç¼–è¾‘å™¨ä»æ˜¾ç¤ºï¼Œä¿å­˜æ—¶å¤±è´¥
   - è§£å†³ï¼šæ–‡ä»¶ç›‘å¬æ£€æµ‹åˆ é™¤ï¼Œè‡ªåŠ¨å…³é—­æ ‡ç­¾é¡µæˆ–æç¤º

7. **ç¼ºå°‘åªè¯»æ¨¡å¼** â­ **ç”¨æˆ·ç‰¹åˆ«å¼ºè°ƒ**
   - é—®é¢˜ï¼šæ‰“å¼€å¤æ‚ DOCX æ—¶å¼ºåˆ¶åˆ›å»ºè‰ç¨¿ï¼Œç”¨æˆ·ä½“éªŒå·®
   - è§£å†³ï¼šé»˜è®¤åªè¯»æ¨¡å¼ï¼Œé¡¶éƒ¨æç¤ºæ  + "ç¼–è¾‘"æŒ‰é’®ï¼Œç‚¹å‡»ååˆ›å»ºè‰ç¨¿

#### ä½å±çº§ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
8. å·¥å…·æ æŠ˜å ï¼ˆå‚è€ƒ Obsidianï¼‰
9. å¿«é€Ÿæœç´¢æ›¿æ¢ï¼ˆCmd+Fï¼‰
10. å­—æ•°ç»Ÿè®¡ï¼ˆå³ä¸‹è§’ï¼‰
11. è‡ªåŠ¨æ¢è¡Œå¼€å…³

---

## Week 5-6ï¼šTipTap ç¼–è¾‘å™¨é›†æˆ

### ç›®æ ‡
é›†æˆ TipTap ç¼–è¾‘å™¨ï¼Œå®ç°åŸºç¡€ç¼–è¾‘åŠŸèƒ½ï¼Œæ”¯æŒæ–‡æœ¬ã€æ ·å¼ã€åˆ—è¡¨ç­‰åŸºæœ¬æ“ä½œã€‚

### 5.1 TipTap å®‰è£…å’Œé…ç½®ï¼ˆDay 1ï¼‰

#### 5.1.1 å®‰è£…ä¾èµ–

**ä»»åŠ¡**ï¼šå®‰è£… TipTap ç›¸å…³ä¾èµ–

**å…·ä½“æ­¥éª¤**ï¼š

1. **å®‰è£… TipTap æ ¸å¿ƒåŒ…**
   ```bash
   npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-image @tiptap/extension-link
   ```

2. **å®‰è£…æ‰©å±•åŒ…**ï¼ˆæŒ‰éœ€ï¼‰
   ```bash
   npm install @tiptap/extension-placeholder @tiptap/extension-character-count
   ```

3. **éªŒè¯å®‰è£…**
   ```bash
   npm list @tiptap/react
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰ä¾èµ–å®‰è£…æˆåŠŸ
- âœ… æ— ç‰ˆæœ¬å†²çª
- âœ… TypeScript ç±»å‹å®šä¹‰å®Œæ•´

#### 5.1.2 åˆ›å»ºç¼–è¾‘å™¨ç»„ä»¶åŸºç¡€ç»“æ„

**ä»»åŠ¡**ï¼šåˆ›å»º TipTap ç¼–è¾‘å™¨ç»„ä»¶

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/TipTapEditor.tsx
import { useEditor, EditorContent } from '@tiptap/react';
import StarterKit from '@tiptap/starter-kit';
import Image from '@tiptap/extension-image';
import Link from '@tiptap/extension-link';
import { useEffect } from 'react';

interface TipTapEditorProps {
  content: string;
  onChange: (content: string) => void;
  onSave?: () => void;
  editable?: boolean;
}

const TipTapEditor: React.FC<TipTapEditorProps> = ({
  content,
  onChange,
  onSave,
  editable = true,
}) => {
  const editor = useEditor({
    extensions: [
      StarterKit.configure({
        // é…ç½®æ‰©å±•
      }),
      Image.configure({
        inline: true,
        allowBase64: false,
        // âš ï¸ å…³é”®ï¼šé…ç½®å›¾ç‰‡è·¯å¾„è§£æï¼Œæ”¯æŒç›¸å¯¹è·¯å¾„
        HTMLAttributes: {
          class: 'editor-image',
        },
      }),
      Link.configure({
        openOnClick: false,
      }),
    ],
    content,
    editable,
    // âš ï¸ å…³é”®ï¼šä¼˜åŒ– onUpdate è§¦å‘é¢‘ç‡ï¼Œé¿å…æ¯æ¬¡è¾“å…¥éƒ½è§¦å‘ä¿å­˜
    onUpdate: ({ editor }) => {
      const html = editor.getHTML();
      // åªæœ‰å†…å®¹çœŸæ­£å˜åŒ–æ—¶æ‰è§¦å‘ onChange
      if (html !== content) {
        onChange(html);
      }
    },
  });

  // å†…å®¹åŒæ­¥
  useEffect(() => {
    if (editor && content !== editor.getHTML()) {
      editor.commands.setContent(content);
    }
  }, [content, editor]);

  // å¿«æ·é”®ï¼šCmd/Ctrl + S ä¿å­˜
  useEffect(() => {
    if (!editor) return;

    const handleKeyDown = (e: KeyboardEvent) => {
      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      const modifier = isMac ? e.metaKey : e.ctrlKey;
      
      if (modifier && e.key === 's') {
        e.preventDefault();
        onSave?.();
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [editor, onSave]);

  if (!editor) {
    return <div>åŠ è½½ç¼–è¾‘å™¨ä¸­...</div>;
  }

  return (
    <div className="h-full flex flex-col">
      <EditorContent editor={editor} className="flex-1 overflow-y-auto p-4" />
    </div>
  );
};

export default TipTapEditor;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ç¼–è¾‘å™¨èƒ½å¤Ÿæ­£å¸¸æ¸²æŸ“
- âœ… å†…å®¹èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºå’Œç¼–è¾‘
- âœ… onChange å›è°ƒæ­£å¸¸å·¥ä½œ
- âœ… å¿«æ·é”®ä¿å­˜åŠŸèƒ½æ­£å¸¸

#### 5.1.3 ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†

**ä»»åŠ¡**ï¼šåˆ›å»ºç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†

**å…·ä½“å®ç°**ï¼š

```typescript
// src/stores/editorStore.ts
import { create } from 'zustand';
import { Editor } from '@tiptap/react';

interface EditorTab {
  id: string;
  filePath: string;
  fileName: string;
  content: string;
  lastSavedContent: string;
  isDirty: boolean;
  isSaving: boolean;
  editor: Editor | null;
}

interface EditorState {
  tabs: EditorTab[];
  activeTabId: string | null;
  addTab: (filePath: string, fileName: string, content: string) => string;
  removeTab: (tabId: string) => void;
  setActiveTab: (tabId: string) => void;
  updateTabContent: (tabId: string, content: string) => void;
  markTabSaved: (tabId: string) => void;
  getActiveTab: () => EditorTab | null;
}

export const useEditorStore = create<EditorState>((set, get) => ({
  tabs: [],
  activeTabId: null,

  addTab: (filePath, fileName, content, isReadOnly = false, isDraft = false) => {
    const tabId = `tab-${Date.now()}`;
    const newTab: EditorTab = {
      id: tabId,
      filePath,
      fileName,
      content,
      lastSavedContent: content,
      isDirty: false,
      isSaving: false,
      isReadOnly, // âš ï¸ æ–°å¢ï¼šåªè¯»æ¨¡å¼
      isDraft, // âš ï¸ æ–°å¢ï¼šè‰ç¨¿æ ‡è®°
      editor: null,
    };
    
    set((state) => ({
      tabs: [...state.tabs, newTab],
      activeTabId: tabId,
    }));
    
    return tabId;
  },

  removeTab: (tabId) => {
    set((state) => {
      const tab = state.tabs.find((t) => t.id === tabId);
      // âš ï¸ å…³é”®ï¼šå…³é—­å‰æ£€æŸ¥æœªä¿å­˜æ›´æ”¹ï¼ˆåœ¨ç»„ä»¶ä¸­å¤„ç†ç¡®è®¤å¯¹è¯æ¡†ï¼‰
      if (tab && tab.isDirty) {
        // è¿”å› false è¡¨ç¤ºéœ€è¦ç”¨æˆ·ç¡®è®¤ï¼Œç»„ä»¶ä¼šæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        return state;
      }
      
      return {
        tabs: state.tabs.filter((t) => t.id !== tabId),
        activeTabId: state.activeTabId === tabId 
          ? (state.tabs.find((t) => t.id !== tabId)?.id || null)
          : state.activeTabId,
      };
    });
  },
  
  // âš ï¸ æ–°å¢ï¼šå¯ç”¨ç¼–è¾‘æ¨¡å¼ï¼ˆä»åªè¯»åˆ‡æ¢åˆ°å¯ç¼–è¾‘ï¼‰
  enableEditMode: (tabId) => {
    set((state) => ({
      tabs: state.tabs.map((tab) =>
        tab.id === tabId
          ? { ...tab, isReadOnly: false }
          : tab
      ),
    }));
  },

  setActiveTab: (tabId) => {
    set({ activeTabId: tabId });
  },

  updateTabContent: (tabId, content) => {
    set((state) => ({
      tabs: state.tabs.map((tab) =>
        tab.id === tabId
          ? {
              ...tab,
              content,
              isDirty: content !== tab.lastSavedContent,
            }
          : tab
      ),
    }));
  },

  markTabSaved: (tabId) => {
    set((state) => ({
      tabs: state.tabs.map((tab) =>
        tab.id === tabId
          ? {
              ...tab,
              lastSavedContent: tab.content,
              isDirty: false,
              isSaving: false,
            }
          : tab
      ),
    }));
  },

  getActiveTab: () => {
    const state = get();
    return state.tabs.find((t) => t.id === state.activeTabId) || null;
  },
}));
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ ‡ç­¾é¡µç®¡ç†æ­£å¸¸å·¥ä½œ
- âœ… å†…å®¹æ›´æ–°å’Œè„çŠ¶æ€æ£€æµ‹æ­£å¸¸
- âœ… æ ‡ç­¾é¡µåˆ‡æ¢æ­£å¸¸

### 5.2 ç¼–è¾‘å™¨å·¥å…·æ ï¼ˆDay 2-3ï¼‰

#### 5.2.1 åŸºç¡€å·¥å…·æ ç»„ä»¶

**ä»»åŠ¡**ï¼šå®ç°ç¼–è¾‘å™¨å·¥å…·æ 

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/EditorToolbar.tsx
import { Editor } from '@tiptap/react';
import {
  Bold, Italic, List, Link, Image, Heading1, Heading2, Heading3,
} from '@heroicons/react/24/outline';

interface EditorToolbarProps {
  editor: Editor | null;
  fileType: 'docx' | 'md' | 'html';
}

const EditorToolbar: React.FC<EditorToolbarProps> = ({ editor, fileType }) => {
  if (!editor) return null;

  // æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒçš„å·¥å…·æ æŒ‰é’®
  const showFullToolbar = fileType === 'docx' || fileType === 'html';
  const showMarkdownToolbar = fileType === 'md';

  return (
    <div className="flex items-center gap-1 p-2 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
      {/* åŸºç¡€æ ¼å¼ */}
      <button
        onClick={() => editor.chain().focus().toggleBold().run()}
        className={`p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${
          editor.isActive('bold') ? 'bg-blue-100 dark:bg-blue-900' : ''
        }`}
        title="ç²—ä½“ (Cmd+B)"
      >
        <Bold className="w-5 h-5" />
      </button>
      
      <button
        onClick={() => editor.chain().focus().toggleItalic().run()}
        className={`p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${
          editor.isActive('italic') ? 'bg-blue-100 dark:bg-blue-900' : ''
        }`}
        title="æ–œä½“ (Cmd+I)"
      >
        <Italic className="w-5 h-5" />
      </button>

      {/* æ ‡é¢˜ */}
      {showFullToolbar && (
        <>
          <div className="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1" />
          <button
            onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}
            className={`p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${
              editor.isActive('heading', { level: 1 }) ? 'bg-blue-100 dark:bg-blue-900' : ''
            }`}
            title="æ ‡é¢˜ 1"
          >
            <Heading1 className="w-5 h-5" />
          </button>
          {/* ... å…¶ä»–æ ‡é¢˜æŒ‰é’® */}
        </>
      )}

      {/* åˆ—è¡¨ */}
      <div className="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1" />
      <button
        onClick={() => editor.chain().focus().toggleBulletList().run()}
        className={`p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 ${
          editor.isActive('bulletList') ? 'bg-blue-100 dark:bg-blue-900' : ''
        }`}
        title="æ— åºåˆ—è¡¨"
      >
        <List className="w-5 h-5" />
      </button>

      {/* é“¾æ¥å’Œå›¾ç‰‡ */}
      {showFullToolbar && (
        <>
          <div className="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1" />
          <button
            onClick={() => {
              const url = window.prompt('è¯·è¾“å…¥é“¾æ¥åœ°å€:');
              if (url) {
                editor.chain().focus().setLink({ href: url }).run();
              }
            }}
            className="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700"
            title="æ’å…¥é“¾æ¥"
          >
            <Link className="w-5 h-5" />
          </button>
          
          <button
            onClick={() => {
              // è°ƒç”¨å›¾ç‰‡æ’å…¥åŠŸèƒ½
            }}
            className="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700"
            title="æ’å…¥å›¾ç‰‡"
          >
            <Image className="w-5 h-5" />
          </button>
        </>
      )}
    </div>
  );
};

export default EditorToolbar;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å·¥å…·æ æŒ‰é’®æ­£å¸¸æ˜¾ç¤º
- âœ… æŒ‰é’®ç‚¹å‡»èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œå‘½ä»¤
- âœ… æŒ‰é’®çŠ¶æ€ï¼ˆæ¿€æ´»/æœªæ¿€æ´»ï¼‰æ­£ç¡®æ˜¾ç¤º
- âœ… æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒçš„å·¥å…·æ 

### 5.3 æ–‡æ¡£æ‰“å¼€åŠŸèƒ½ï¼ˆDay 4-5ï¼‰

#### 5.3.1 æ–‡ä»¶æ‰“å¼€é€»è¾‘

**ä»»åŠ¡**ï¼šå®ç°æ–‡ä»¶æ‰“å¼€åŠŸèƒ½

**å…·ä½“å®ç°**ï¼š

```typescript
// src/services/documentService.ts
import { invoke } from '@tauri-apps/api/core';
import { useEditorStore } from '../stores/editorStore';

export const documentService = {
  async openFile(filePath: string): Promise<void> {
    try {
      // 1. æ£€æŸ¥æ–‡ä»¶ç±»å‹
      const ext = filePath.split('.').pop()?.toLowerCase();
      
      if (ext === 'md' || ext === 'html') {
        // ç›´æ¥è¯»å–æ–‡æœ¬å†…å®¹
        const content = await invoke<string>('read_file_content', { path: filePath });
        useEditorStore.getState().addTab(filePath, filePath.split('/').pop() || 'æœªå‘½å', content, false, false);
      } else if (ext === 'docx') {
        // DOCX æ–‡ä»¶éœ€è¦è½¬æ¢
        const result = await invoke<{ html: string; isDraft: boolean; isComplex: boolean }>('open_docx', { path: filePath });
        const fileName = filePath.split('/').pop() || 'æœªå‘½å';
        // âš ï¸ å…³é”®ï¼šå¤æ‚æ ¼å¼é»˜è®¤åªè¯»æ¨¡å¼ï¼Œç®€å•æ ¼å¼ç›´æ¥å¯ç¼–è¾‘
        const isReadOnly = result.isComplex && !result.isDraft;
        useEditorStore.getState().addTab(
          result.isDraft ? filePath.replace('.docx', '.draft.docx') : filePath,
          fileName,
          result.html,
          isReadOnly, // åªè¯»æ¨¡å¼
          result.isDraft // è‰ç¨¿æ ‡è®°
        );
      } else {
        throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${ext}`);
      }
    } catch (error) {
      console.error('æ‰“å¼€æ–‡ä»¶å¤±è´¥:', error);
      throw error;
    }
  },
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Markdown æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- âœ… HTML æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- âœ… DOCX æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€ï¼ˆéœ€è¦ Pandocï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### 5.4 å›¾ç‰‡å¤„ç†åŠŸèƒ½ï¼ˆDay 6-7ï¼‰

#### 5.4.1 åç«¯å›¾ç‰‡æœåŠ¡

**ä»»åŠ¡**ï¼šå®ç°å›¾ç‰‡æ’å…¥ã€åˆ é™¤ã€æ£€æŸ¥åŠŸèƒ½

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/services/image_service.rs
use std::path::{Path, PathBuf};
use uuid::Uuid;

pub struct ImageService;

impl ImageService {
    pub fn new() -> Self {
        Self
    }

    pub async fn insert_image(
        document_path: &Path,
        image_source: &Path,
    ) -> Result<String, String> {
        // 1. ç¡®å®š assets/ æ–‡ä»¶å¤¹è·¯å¾„
        let assets_dir = document_path.parent()
            .ok_or("æ— æ³•è·å–æ–‡æ¡£çˆ¶ç›®å½•")?
            .join("assets");
        
        // 2. åˆ›å»º assets/ æ–‡ä»¶å¤¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if !assets_dir.exists() {
            std::fs::create_dir_all(&assets_dir)
                .map_err(|e| format!("åˆ›å»º assets æ–‡ä»¶å¤¹å¤±è´¥: {}", e))?;
        }
        
        // 3. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆUUID + åŸæ‰©å±•åï¼‰
        let ext = image_source.extension()
            .and_then(|s| s.to_str())
            .unwrap_or("png");
        let filename = format!("{}.{}", Uuid::new_v4(), ext);
        let dest_path = assets_dir.join(&filename);
        
        // 4. å¤åˆ¶å›¾ç‰‡æ–‡ä»¶
        std::fs::copy(image_source, &dest_path)
            .map_err(|e| format!("å¤åˆ¶å›¾ç‰‡å¤±è´¥: {}", e))?;
        
        // 5. è¿”å›ç›¸å¯¹è·¯å¾„
        Ok(format!("assets/{}", filename))
    }
    
    pub fn check_image_exists(
        document_path: &Path,
        image_path: &str,
    ) -> bool {
        let assets_dir = document_path.parent()
            .unwrap()
            .join("assets");
        let image_file = assets_dir.join(image_path.strip_prefix("assets/").unwrap_or(image_path));
        image_file.exists()
    }
    
    pub async fn delete_image(
        document_path: &Path,
        image_path: &str,
    ) -> Result<(), String> {
        let assets_dir = document_path.parent()
            .ok_or("æ— æ³•è·å–æ–‡æ¡£çˆ¶ç›®å½•")?
            .join("assets");
        let image_file = assets_dir.join(image_path.strip_prefix("assets/").unwrap_or(image_path));
        
        if image_file.exists() {
            std::fs::remove_file(&image_file)
                .map_err(|e| format!("åˆ é™¤å›¾ç‰‡å¤±è´¥: {}", e))?;
        }
        
        Ok(())
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®å¤åˆ¶åˆ° assets/ æ–‡ä»¶å¤¹
- âœ… å›¾ç‰‡è·¯å¾„èƒ½å¤Ÿæ­£ç¡®è¿”å›
- âœ… å›¾ç‰‡å­˜åœ¨æ€§æ£€æŸ¥æ­£å¸¸
- âœ… å›¾ç‰‡åˆ é™¤åŠŸèƒ½æ­£å¸¸

#### 5.4.2 å‰ç«¯å›¾ç‰‡å¤„ç†ç»„ä»¶

**ä»»åŠ¡**ï¼šå®ç°å›¾ç‰‡æ’å…¥ UI å’Œé€»è¾‘

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/ImageHandler.tsx
import { Editor } from '@tiptap/react';
import { open } from '@tauri-apps/plugin-dialog';
import { invoke } from '@tauri-apps/api/core';

interface ImageHandlerProps {
  editor: Editor;
  documentPath: string;
}

const ImageHandler: React.FC<ImageHandlerProps> = ({ editor, documentPath }) => {
  const handleInsertImage = async () => {
    try {
      // 1. é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
      const selected = await open({
        multiple: false,
        filters: [{
          name: 'Images',
          extensions: ['png', 'jpg', 'jpeg', 'gif', 'webp', 'svg'],
        }],
      });
      
      if (!selected || typeof selected !== 'string') {
        return;
      }
      
      // 2. è°ƒç”¨åç«¯æ’å…¥å›¾ç‰‡
      const relativePath = await invoke<string>('insert_image', {
        documentPath,
        imageSource: selected,
      });
      
      // 3. ç»Ÿä¸€ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆassets/xxx.pngï¼‰
      // âš ï¸ å…³é”®ï¼šTipTap å’Œ Pandoc éƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿ä¸€è‡´æ€§
      const imagePath = relativePath; // ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¦‚ "assets/uuid.png"
      
      // 4. åœ¨ç¼–è¾‘å™¨ä¸­æ’å…¥å›¾ç‰‡ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
      editor.chain().focus().setImage({ src: imagePath }).run();
    } catch (error) {
      console.error('æ’å…¥å›¾ç‰‡å¤±è´¥:', error);
      alert(`æ’å…¥å›¾ç‰‡å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);
    }
  };

  return (
    <button
      onClick={handleInsertImage}
      className="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700"
      title="æ’å…¥å›¾ç‰‡"
    >
      <Image className="w-5 h-5" />
    </button>
  );
};

export default ImageHandler;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å›¾ç‰‡é€‰æ‹©å¯¹è¯æ¡†æ­£å¸¸æ˜¾ç¤º
- âœ… å›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®æ’å…¥ç¼–è¾‘å™¨ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ `assets/xxx.png`ï¼‰
- âœ… å›¾ç‰‡åœ¨ç¼–è¾‘å™¨ä¸­æ­£å¸¸æ˜¾ç¤ºï¼ˆTipTap è‡ªåŠ¨è§£æç›¸å¯¹è·¯å¾„ï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„

**âš ï¸ å…³é”®è¦æ±‚**ï¼š
- å›¾ç‰‡è·¯å¾„å¿…é¡»ç»Ÿä¸€ä¸ºç›¸å¯¹è·¯å¾„æ ¼å¼ï¼š`assets/xxx.png`
- TipTap ç¼–è¾‘å™¨é…ç½®éœ€è¦æ”¯æŒç›¸å¯¹è·¯å¾„è§£æ
- ä¿å­˜æ—¶ Pandoc ä½¿ç”¨ `--extract-media=assets` å‚æ•°è‡ªåŠ¨æ‰“åŒ…å›¾ç‰‡

### 5.5 æ ‡ç­¾é¡µæ ‡é¢˜å’Œè„æ ‡è®°ï¼ˆDay 8ï¼‰

#### 5.5.1 æ ‡ç­¾é¡µç»„ä»¶å®ç°

**ä»»åŠ¡**ï¼šå®ç°æ ‡ç­¾é¡µæ ‡é¢˜æ˜¾ç¤ºæ–‡ä»¶å + è„æ ‡è®°

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/EditorTabs.tsx
import { useEditorStore } from '../../stores/editorStore';
import { XMarkIcon } from '@heroicons/react/24/outline';

const EditorTabs: React.FC = () => {
  const { tabs, activeTabId, setActiveTab, removeTab } = useEditorStore();
  
  const handleCloseTab = (tabId: string, e: React.MouseEvent) => {
    e.stopPropagation();
    const tab = tabs.find((t) => t.id === tabId);
    
    // âš ï¸ å…³é”®ï¼šå…³é—­å‰æ£€æŸ¥æœªä¿å­˜æ›´æ”¹
    if (tab && tab.isDirty) {
      const confirmed = window.confirm(
        `æ–‡ä»¶ "${tab.fileName}" æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ\n\né€‰æ‹©ï¼š\n- ç¡®å®šï¼šå…³é—­å¹¶ä¸¢å¼ƒæ›´æ”¹\n- å–æ¶ˆï¼šè¿”å›ç¼–è¾‘`
      );
      if (!confirmed) return;
    }
    
    removeTab(tabId);
  };
  
  return (
    <div className="flex items-center gap-1 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
      {tabs.map((tab) => (
        <div
          key={tab.id}
          onClick={() => setActiveTab(tab.id)}
          className={`
            flex items-center gap-2 px-3 py-2 cursor-pointer border-b-2 transition-colors
            ${activeTabId === tab.id 
              ? 'border-blue-500 bg-white dark:bg-gray-800' 
              : 'border-transparent hover:bg-gray-100 dark:hover:bg-gray-800'
            }
          `}
        >
          <span className="text-sm">
            {tab.fileName}
            {/* âš ï¸ å…³é”®ï¼šè„æ ‡è®° */}
            {tab.isDirty && <span className="text-orange-500 ml-1">*</span>}
            {/* åªè¯»æ ‡è®° */}
            {tab.isReadOnly && <span className="text-gray-400 ml-1 text-xs">[åªè¯»]</span>}
            {/* è‰ç¨¿æ ‡è®° */}
            {tab.isDraft && <span className="text-blue-400 ml-1 text-xs">[è‰ç¨¿]</span>}
          </span>
          <button
            onClick={(e) => handleCloseTab(tab.id, e)}
            className="ml-1 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700"
          >
            <XMarkIcon className="w-4 h-4" />
          </button>
        </div>
      ))}
    </div>
  );
};

export default EditorTabs;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ ‡ç­¾é¡µæ˜¾ç¤ºæ–‡ä»¶å
- âœ… æœªä¿å­˜æ–‡ä»¶æ˜¾ç¤º `*` æ ‡è®°
- âœ… åªè¯»æ–‡ä»¶æ˜¾ç¤º `[åªè¯»]` æ ‡è®°
- âœ… è‰ç¨¿æ–‡ä»¶æ˜¾ç¤º `[è‰ç¨¿]` æ ‡è®°
- âœ… å…³é—­æ ‡ç­¾é¡µå‰æ£€æŸ¥æœªä¿å­˜æ›´æ”¹

### 5.6 åªè¯»æ¨¡å¼å®ç°ï¼ˆDay 9ï¼‰â­ **å…³é”®åŠŸèƒ½**

#### 5.6.1 åªè¯»æ¨¡å¼æç¤ºæ 

**ä»»åŠ¡**ï¼šå®ç°åªè¯»æ¨¡å¼æç¤ºæ å’Œ"ç¼–è¾‘"æŒ‰é’®

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/ReadOnlyBanner.tsx
import { useEditorStore } from '../../stores/editorStore';
import { invoke } from '@tauri-apps/api/core';
import { PencilIcon } from '@heroicons/react/24/outline';

interface ReadOnlyBannerProps {
  tabId: string;
}

const ReadOnlyBanner: React.FC<ReadOnlyBannerProps> = ({ tabId }) => {
  const tab = useEditorStore.getState().tabs.find((t) => t.id === tabId);
  const { enableEditMode } = useEditorStore.getState();
  
  if (!tab || !tab.isReadOnly) return null;
  
  const handleEnableEdit = async () => {
    try {
      // âš ï¸ å…³é”®ï¼šå¦‚æœæ–‡ä»¶æ˜¯å¤æ‚æ ¼å¼ï¼Œåˆ›å»ºè‰ç¨¿å‰¯æœ¬
      if (!tab.isDraft) {
        const draftPath = await invoke<string>('create_draft_copy', { path: tab.filePath });
        // æ›´æ–°æ ‡ç­¾é¡µè·¯å¾„ä¸ºè‰ç¨¿è·¯å¾„
        useEditorStore.getState().updateTabPath(tabId, draftPath);
      }
      
      // å¯ç”¨ç¼–è¾‘æ¨¡å¼
      enableEditMode(tabId);
      
      // æ›´æ–°ç¼–è¾‘å™¨ä¸ºå¯ç¼–è¾‘
      if (tab.editor) {
        tab.editor.setEditable(true);
      }
    } catch (error) {
      console.error('å¯ç”¨ç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
      alert(`å¯ç”¨ç¼–è¾‘æ¨¡å¼å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);
    }
  };
  
  return (
    <div className="bg-yellow-50 dark:bg-yellow-900/20 border-b border-yellow-200 dark:border-yellow-800 px-4 py-2 flex items-center justify-between">
      <div className="flex items-center gap-2">
        <span className="text-sm text-yellow-800 dark:text-yellow-200">
          ğŸ“„ æ­¤æ–‡ä»¶ä»¥åªè¯»æ¨¡å¼æ‰“å¼€ã€‚å¦‚éœ€ç¼–è¾‘ï¼Œè¯·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®åˆ›å»ºè‰ç¨¿å‰¯æœ¬ã€‚
        </span>
      </div>
      <button
        onClick={handleEnableEdit}
        className="flex items-center gap-2 px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm"
      >
        <PencilIcon className="w-4 h-4" />
        ç¼–è¾‘
      </button>
    </div>
  );
};

export default ReadOnlyBanner;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… åªè¯»æ–‡ä»¶æ˜¾ç¤ºæç¤ºæ 
- âœ… ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®åˆ›å»ºè‰ç¨¿å‰¯æœ¬
- âœ… è‰ç¨¿åˆ›å»ºåè‡ªåŠ¨åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
- âœ… ç¼–è¾‘å™¨å˜ä¸ºå¯ç¼–è¾‘çŠ¶æ€

### 5.7 æ–‡æ¡£å¤§çº²ç”Ÿæˆï¼ˆDay 10ï¼‰

#### 5.5.1 å¤§çº²æå–é€»è¾‘

**ä»»åŠ¡**ï¼šä»æ–‡æ¡£å†…å®¹ä¸­æå–æ ‡é¢˜ï¼Œç”Ÿæˆå¤§çº²

**å…·ä½“å®ç°**ï¼š

```typescript
// src/utils/outline.ts
import { Editor } from '@tiptap/react';

export interface OutlineItem {
  level: number;
  text: string;
  id: string;
  position: number;
}

export const extractOutline = (editor: Editor): OutlineItem[] => {
  const items: OutlineItem[] = [];
  const doc = editor.state.doc;
  
  doc.descendants((node, pos) => {
    if (node.type.name === 'heading') {
      const level = node.attrs.level as number;
      const text = node.textContent;
      items.push({
        level,
        text,
        id: `heading-${pos}`,
        position: pos,
      });
    }
  });
  
  return items;
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿæ­£ç¡®æå–æ ‡é¢˜
- âœ… å¤§çº²ç»“æ„æ­£ç¡®
- âœ… ç‚¹å‡»å¤§çº²èƒ½å¤Ÿè·³è½¬åˆ°å¯¹åº”ä½ç½®

---

## Week 7ï¼šMarkdown æ”¯æŒ

### ç›®æ ‡
å®ç° Markdown æ–‡ä»¶çš„å®Œæ•´æ”¯æŒï¼ŒåŒ…æ‹¬å¯¼å…¥/å¯¼å‡ºå’Œé¢„è§ˆåŠŸèƒ½ã€‚

### 7.1 Markdown å¯¼å…¥/å¯¼å‡ºï¼ˆDay 1-3ï¼‰

#### 7.1.1 Markdown è§£æ

**ä»»åŠ¡**ï¼šå®ç° Markdown åˆ° HTML çš„è½¬æ¢

**å…·ä½“å®ç°**ï¼š

```typescript
// src/utils/markdown.ts
import { marked } from 'marked'; // éœ€è¦å®‰è£…: npm install marked

export const markdownToHtml = (markdown: string): string => {
  return marked.parse(markdown) as string;
};

export const htmlToMarkdown = (html: string): string => {
  // ä½¿ç”¨ Turndown æˆ–ç±»ä¼¼åº“
  // npm install turndown
  const TurndownService = require('turndown');
  const turndownService = new TurndownService();
  return turndownService.turndown(html);
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Markdown èƒ½å¤Ÿæ­£ç¡®è½¬æ¢ä¸º HTML
- âœ… HTML èƒ½å¤Ÿæ­£ç¡®è½¬æ¢ä¸º Markdown
- âœ… æ ¼å¼ä¿æŒæ­£ç¡®

### 7.2 Markdown é¢„è§ˆï¼ˆDay 4-5ï¼‰

#### 7.2.1 é¢„è§ˆç»„ä»¶

**ä»»åŠ¡**ï¼šå®ç° Markdown é¢„è§ˆåŠŸèƒ½

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/MarkdownPreview.tsx
import { markdownToHtml } from '../../utils/markdown';

interface MarkdownPreviewProps {
  content: string;
}

const MarkdownPreview: React.FC<MarkdownPreviewProps> = ({ content }) => {
  const html = markdownToHtml(content);
  
  return (
    <div 
      className="prose dark:prose-invert max-w-none p-4"
      dangerouslySetInnerHTML={{ __html: html }}
    />
  );
};

export default MarkdownPreview;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Markdown é¢„è§ˆæ­£å¸¸æ˜¾ç¤º
- âœ… æ ·å¼æ­£ç¡®
- âœ… æ”¯æŒæš—è‰²æ¨¡å¼

---

## Week 8-9ï¼šDOCX æ–‡ä»¶å¤„ç†ï¼ˆPandoc é›†æˆï¼‰

### ç›®æ ‡
å®ç° DOCX æ–‡ä»¶çš„æ‰“å¼€ã€ç¼–è¾‘å’Œä¿å­˜åŠŸèƒ½ï¼Œä½¿ç”¨ Pandoc è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚

### 8.1 Pandoc æœåŠ¡å®Œå–„ï¼ˆDay 1-2ï¼‰

#### 8.1.1 Pandoc äºŒè¿›åˆ¶å‡†å¤‡ âš ï¸ **å…³é”®ä»»åŠ¡**

**ä»»åŠ¡**ï¼šå‡†å¤‡ Pandoc é™æ€äºŒè¿›åˆ¶æ–‡ä»¶

**å…·ä½“æ­¥éª¤**ï¼š

1. **ä¸‹è½½ Pandoc äºŒè¿›åˆ¶**
   - macOS arm64: https://github.com/jgm/pandoc/releases
   - macOS x64: https://github.com/jgm/pandoc/releases
   - é€‰æ‹©é™æ€ç¼–è¯‘ç‰ˆæœ¬ï¼ˆstandaloneï¼‰

2. **æ”¾ç½®åˆ°èµ„æºç›®å½•**
   ```
   src-tauri/resources/bin/
   â”œâ”€â”€ pandoc-macos-arm64
   â”œâ”€â”€ pandoc-macos-x64
   â””â”€â”€ README.mdï¼ˆè¯´æ˜æ–‡ä»¶ï¼‰
   ```

3. **é…ç½®èµ„æºæ‰“åŒ…**
   ```json
   // tauri.conf.json
   {
     "bundle": {
       "resources": ["resources/bin/**"]
     }
   }
   ```

4. **å®ç° Pandoc è·¯å¾„æ£€æµ‹**
   ```rust
   // src-tauri/src/services/pandoc_service.rsï¼ˆæ›´æ–°ï¼‰
   use std::path::PathBuf;
   use tauri::Manager;
   
   impl PandocService {
       fn get_bundled_pandoc_path(app: &tauri::AppHandle) -> Option<PathBuf> {
           // è·å–èµ„æºç›®å½•
           let resource_dir = app.path().resource_dir().ok()?;
           let bin_dir = resource_dir.join("bin");
           
           // æ£€æµ‹å¹³å°
           #[cfg(target_os = "macos")]
           {
               #[cfg(target_arch = "aarch64")]
               {
                   let pandoc = bin_dir.join("pandoc-macos-arm64");
                   if pandoc.exists() {
                       return Some(pandoc);
                   }
               }
               #[cfg(target_arch = "x86_64")]
               {
                   let pandoc = bin_dir.join("pandoc-macos-x64");
                   if pandoc.exists() {
                       return Some(pandoc);
                   }
               }
           }
           
           None
       }
   }
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Pandoc äºŒè¿›åˆ¶æ–‡ä»¶å·²ä¸‹è½½
- âœ… æ–‡ä»¶å·²æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®
- âœ… èµ„æºæ‰“åŒ…é…ç½®æ­£ç¡®
- âœ… è·¯å¾„æ£€æµ‹åŠŸèƒ½æ­£å¸¸

#### 8.1.2 Pandoc è½¬æ¢åŠŸèƒ½

**ä»»åŠ¡**ï¼šå®ç° DOCX â†” HTML è½¬æ¢

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/services/pandoc_service.rsï¼ˆæ›´æ–°ï¼‰
use std::process::Command;
use std::path::Path;

impl PandocService {
    pub async fn convert_docx_to_html(&self, docx_path: &Path) -> Result<String, String> {
        let pandoc_path = self.get_path()
            .ok_or("Pandoc ä¸å¯ç”¨")?;
        
        let output = Command::new(pandoc_path)
            .arg(docx_path.to_string_lossy().as_ref())
            .arg("--to=html")
            .arg("--standalone")
            .arg("--wrap=none")
            .output()
            .map_err(|e| format!("æ‰§è¡Œ Pandoc å¤±è´¥: {}", e))?;
        
        if !output.status.success() {
            let error = String::from_utf8_lossy(&output.stderr);
            return Err(format!("Pandoc è½¬æ¢å¤±è´¥: {}", error));
        }
        
        Ok(String::from_utf8_lossy(&output.stdout).to_string())
    }
    
    pub async fn convert_html_to_docx(
        &self,
        html_content: &str,
        output_path: &Path,
        document_dir: &Path, // æ–‡æ¡£æ‰€åœ¨ç›®å½•ï¼ˆç”¨äºè§£æå›¾ç‰‡è·¯å¾„ï¼‰
    ) -> Result<(), String> {
        let pandoc_path = self.get_path()
            .ok_or("Pandoc ä¸å¯ç”¨")?;
        
        // åˆ›å»ºä¸´æ—¶ HTML æ–‡ä»¶
        let temp_html = std::env::temp_dir().join(format!("binder-{}.html", uuid::Uuid::new_v4()));
        std::fs::write(&temp_html, html_content)
            .map_err(|e| format!("åˆ›å»ºä¸´æ—¶æ–‡ä»¶å¤±è´¥: {}", e))?;
        
        let mut cmd = Command::new(pandoc_path);
        cmd.arg(temp_html.to_string_lossy().as_ref())
            .arg("--to=docx")
            .arg("--output")
            .arg(output_path.to_string_lossy().as_ref())
            .arg("--standalone");
        
        // âš ï¸ å…³é”®ï¼šè®¾ç½®å·¥ä½œç›®å½•ï¼Œè®© Pandoc èƒ½å¤Ÿè§£æç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡
        cmd.current_dir(document_dir);
        
        // âš ï¸âš ï¸âš ï¸ å…³é”®ï¼šä½¿ç”¨ --extract-media=assets å‚æ•°ï¼Œè®© Pandoc è‡ªåŠ¨æå–å¹¶æ‰“åŒ…å›¾ç‰‡
        // å›¾ç‰‡è·¯å¾„ä¸º assets/xxx.png æ—¶ï¼ŒPandoc ä¼šè‡ªåŠ¨ä»æ–‡æ¡£ç›®å½•çš„ assets/ æ–‡ä»¶å¤¹æå–å¹¶æ‰“åŒ…è¿› DOCX
        cmd.arg("--extract-media=assets");
        
        let output = cmd.output()
            .map_err(|e| format!("æ‰§è¡Œ Pandoc å¤±è´¥: {}", e))?;
        
        // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        let _ = std::fs::remove_file(&temp_html);
        
        if !output.status.success() {
            let error = String::from_utf8_lossy(&output.stderr);
            return Err(format!("Pandoc è½¬æ¢å¤±è´¥: {}", error));
        }
        
        Ok(())
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… DOCX â†’ HTML è½¬æ¢æ­£å¸¸
- âœ… HTML â†’ DOCX è½¬æ¢æ­£å¸¸
- âœ… **å›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®æ‰“åŒ…è¿› DOCX**ï¼ˆä½¿ç”¨ `--extract-media=assets` å‚æ•°ï¼‰
- âœ… ç›¸å¯¹è·¯å¾„å›¾ç‰‡ï¼ˆ`assets/xxx.png`ï¼‰èƒ½å¤Ÿæ­£ç¡®è§£æå’Œæ‰“åŒ…
- âœ… é”™è¯¯å¤„ç†å®Œå–„

**âš ï¸âš ï¸âš ï¸ å…³é”®è¦æ±‚**ï¼š
- **å¿…é¡»ä½¿ç”¨ `--extract-media=assets` å‚æ•°**ï¼Œç¡®ä¿ Pandoc èƒ½å¤Ÿä» `assets/` æ–‡ä»¶å¤¹æå–å›¾ç‰‡å¹¶æ‰“åŒ…è¿› DOCX
- å›¾ç‰‡è·¯å¾„å¿…é¡»ç»Ÿä¸€ä¸ºç›¸å¯¹è·¯å¾„æ ¼å¼ï¼š`assets/xxx.png`
- Pandoc å·¥ä½œç›®å½•å¿…é¡»è®¾ç½®ä¸ºæ–‡æ¡£æ‰€åœ¨ç›®å½•ï¼Œæ‰èƒ½æ­£ç¡®è§£æç›¸å¯¹è·¯å¾„

### 8.2 DOCX æ–‡ä»¶æ‰“å¼€ï¼ˆDay 3-4ï¼‰

#### 8.2.1 DOCX æœåŠ¡å®ç°

**ä»»åŠ¡**ï¼šå®ç° DOCX æ–‡ä»¶æ‰“å¼€é€»è¾‘

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/services/docx_service.rs
use std::path::Path;
use crate::services::pandoc_service::PandocService;

pub struct DocxService {
    pandoc: PandocService,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum DocxError {
    PandocNotAvailable,
    FileTooLarge(u64),
    CorruptedFile,
    ConversionFailed(String),
    InvalidPath,
}

impl DocxService {
    pub fn new() -> Self {
        Self {
            pandoc: PandocService::new(),
        }
    }
    
    pub async fn open_docx(&self, path: &Path) -> Result<(String, bool, bool), DocxError> {
        // è¿”å›å€¼ï¼š(HTML å†…å®¹, æ˜¯å¦ä¸ºè‰ç¨¿, æ˜¯å¦ä¸ºå¤æ‚æ ¼å¼)
        
        // 1. æ£€æŸ¥ Pandoc å¯ç”¨æ€§
        if !self.pandoc.is_available() {
            return Err(DocxError::PandocNotAvailable);
        }
        
        // 2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆå¤„ç†æ–‡ä»¶è¢«åˆ é™¤çš„æƒ…å†µï¼‰
        if !path.exists() {
            return Err(DocxError::InvalidPath);
        }
        
        // 3. æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ 100MBï¼‰
        let metadata = std::fs::metadata(path)
            .map_err(|_| DocxError::InvalidPath)?;
        if metadata.len() > 100 * 1024 * 1024 {
            return Err(DocxError::FileTooLarge(metadata.len()));
        }
        
        // 4. æ£€æµ‹æ–‡ä»¶å¤æ‚åº¦
        let is_complex = self.detect_complexity(path).await?;
        
        // 5. å°è¯•è½¬æ¢
        match self.pandoc.convert_docx_to_html(path).await {
            Ok(html) => Ok((html, false, is_complex)), // (HTML, ä¸æ˜¯è‰ç¨¿, æ˜¯å¦å¤æ‚)
            Err(e) => {
                // é™çº§ç­–ç•¥ï¼šæå–çº¯æ–‡æœ¬
                let text = self.extract_text_only(path)?;
                Ok((format!("<p>{}</p>", text), true, true)) // (HTML, æ˜¯è‰ç¨¿, æ˜¯å¤æ‚æ ¼å¼)
            }
        }
    }
    
    // âš ï¸ æ–°å¢ï¼šæ£€æµ‹æ–‡ä»¶å¤æ‚åº¦
    async fn detect_complexity(&self, path: &Path) -> Result<bool, DocxError> {
        // ç®€å•å®ç°ï¼šæ£€æŸ¥æ–‡ä»¶å¤§å°ã€æ ·å¼æ•°é‡ç­‰
        // å¤æ‚æ ¼å¼ï¼šæ–‡ä»¶ > 5MB æˆ–åŒ…å«å¤æ‚æ ·å¼
        let metadata = std::fs::metadata(path)
            .map_err(|_| DocxError::InvalidPath)?;
        Ok(metadata.len() > 5 * 1024 * 1024) // å¤§äº 5MB è§†ä¸ºå¤æ‚æ ¼å¼
    }
    
    fn extract_text_only(&self, path: &Path) -> Result<String, DocxError> {
        // ä½¿ç”¨ç®€å•çš„æ–‡æœ¬æå–ï¼ˆåç»­å¯ä»¥æ”¹è¿›ï¼‰
        // è¿™é‡Œå…ˆè¿”å›é”™è¯¯ï¼Œæç¤ºç”¨æˆ·æ–‡ä»¶æ— æ³•å¤„ç†
        Err(DocxError::ConversionFailed("æ–‡ä»¶æ ¼å¼è¿‡äºå¤æ‚ï¼Œæ— æ³•å¤„ç†".to_string()))
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… DOCX æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- âœ… å¤æ‚æ ¼å¼é»˜è®¤åªè¯»æ¨¡å¼
- âœ… ç®€å•æ ¼å¼ç›´æ¥å¯ç¼–è¾‘
- âœ… æ–‡ä»¶è¢«åˆ é™¤æ—¶èƒ½å¤Ÿæ£€æµ‹å¹¶æç¤º
- âœ… é”™è¯¯æç¤ºæ¸…æ™°

**âš ï¸ å…³é”®è¦æ±‚**ï¼š
- å¤æ‚æ ¼å¼ DOCX é»˜è®¤ä»¥åªè¯»æ¨¡å¼æ‰“å¼€
- ç®€å•æ ¼å¼ DOCX ç›´æ¥å¯ç¼–è¾‘
- æ–‡ä»¶è¢«åˆ é™¤æ—¶ï¼Œè‡ªåŠ¨å…³é—­æ ‡ç­¾é¡µæˆ–æç¤ºç”¨æˆ·

### 8.3 DOCX æ–‡ä»¶ä¿å­˜ï¼ˆDay 5ï¼‰âš ï¸ **å…³é”®ï¼šå›¾ç‰‡è·¯å¾„å¤„ç†**

#### 8.3.1 Pandoc å›¾ç‰‡æ‰“åŒ…å®ç°ï¼ˆDay 5 é‡ç‚¹ï¼‰

**ä»»åŠ¡**ï¼šå®ç° Pandoc `--extract-media=assets` å‚æ•°ï¼Œç¡®ä¿å›¾ç‰‡æ­£ç¡®æ‰“åŒ…

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/services/pandoc_service.rsï¼ˆæ›´æ–° convert_html_to_docxï¼‰
pub async fn convert_html_to_docx(
    &self,
    html_content: &str,
    output_path: &Path,
    document_dir: &Path,
) -> Result<(), String> {
    let pandoc_path = self.get_path()
        .ok_or("Pandoc ä¸å¯ç”¨")?;
    
    // åˆ›å»ºä¸´æ—¶ HTML æ–‡ä»¶
    let temp_html = std::env::temp_dir().join(format!("binder-{}.html", uuid::Uuid::new_v4()));
    std::fs::write(&temp_html, html_content)
        .map_err(|e| format!("åˆ›å»ºä¸´æ—¶æ–‡ä»¶å¤±è´¥: {}", e))?;
    
    let mut cmd = Command::new(pandoc_path);
    cmd.arg(temp_html.to_string_lossy().as_ref())
        .arg("--to=docx")
        .arg("--output")
        .arg(output_path.to_string_lossy().as_ref())
        .arg("--standalone");
    
    // âš ï¸âš ï¸âš ï¸ å…³é”®ï¼šè®¾ç½®å·¥ä½œç›®å½•ä¸ºæ–‡æ¡£ç›®å½•
    cmd.current_dir(document_dir);
    
    // âš ï¸âš ï¸âš ï¸ å…³é”®ï¼šä½¿ç”¨ --extract-media=assets å‚æ•°
    // è¿™ä¸ªå‚æ•°å‘Šè¯‰ Pandocï¼š
    // 1. ä» HTML ä¸­æå–æ‰€æœ‰å›¾ç‰‡å¼•ç”¨ï¼ˆsrc="assets/xxx.png"ï¼‰
    // 2. ä»æ–‡æ¡£ç›®å½•çš„ assets/ æ–‡ä»¶å¤¹è¯»å–å›¾ç‰‡æ–‡ä»¶
    // 3. å°†å›¾ç‰‡æ‰“åŒ…è¿› DOCX æ–‡ä»¶
    cmd.arg("--extract-media=assets");
    
    let output = cmd.output()
        .map_err(|e| format!("æ‰§è¡Œ Pandoc å¤±è´¥: {}", e))?;
    
    // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    let _ = std::fs::remove_file(&temp_html);
    
    if !output.status.success() {
        let error = String::from_utf8_lossy(&output.stderr);
        return Err(format!("Pandoc è½¬æ¢å¤±è´¥: {}", error));
    }
    
    Ok(())
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… Pandoc ä½¿ç”¨ `--extract-media=assets` å‚æ•°
- âœ… ç›¸å¯¹è·¯å¾„å›¾ç‰‡ï¼ˆ`assets/xxx.png`ï¼‰èƒ½å¤Ÿæ­£ç¡®æ‰“åŒ…è¿› DOCX
- âœ… å›¾ç‰‡åœ¨ DOCX ä¸­æ­£å¸¸æ˜¾ç¤ºï¼Œä¸ä¼šå‡ºç°çº¢å‰æˆ–ä¸¢å¤±
- âœ… é”™è¯¯å¤„ç†å®Œå–„

#### 8.3.2 ä¿å­˜é€»è¾‘å®ç°ï¼ˆDay 5 ç»§ç»­ï¼‰

**ä»»åŠ¡**ï¼šå®ç° DOCX æ–‡ä»¶ä¿å­˜åŠŸèƒ½

#### 8.3.1 ä¿å­˜é€»è¾‘å®ç°

**ä»»åŠ¡**ï¼šå®ç° DOCX æ–‡ä»¶ä¿å­˜åŠŸèƒ½

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/commands/docx_commands.rs
#[tauri::command]
pub async fn save_docx(
    path: String,
    html_content: String,
) -> Result<(), String> {
    let docx_path = PathBuf::from(&path);
    let document_dir = docx_path.parent()
        .ok_or("æ— æ³•è·å–æ–‡æ¡£ç›®å½•")?;
    
    let pandoc = PandocService::new();
    
    // ä½¿ç”¨åŸå­å†™å…¥ï¼šå…ˆå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†é‡å‘½å
    let temp_path = docx_path.with_extension("tmp.docx");
    
    pandoc.convert_html_to_docx(&html_content, &temp_path, document_dir).await
        .map_err(|e| format!("è½¬æ¢å¤±è´¥: {}", e))?;
    
    // åŸå­é‡å‘½å
    std::fs::rename(&temp_path, &docx_path)
        .map_err(|e| format!("ä¿å­˜æ–‡ä»¶å¤±è´¥: {}", e))?;
    
    Ok(())
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… DOCX æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸ä¿å­˜
- âœ… å›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®æ‰“åŒ…
- âœ… åŸå­å†™å…¥ç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## Week 10ï¼šä¿å­˜æœºåˆ¶

### ç›®æ ‡
å®ç°å®Œæ•´çš„ä¿å­˜æœºåˆ¶ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ä¿å­˜ã€æ‰‹åŠ¨ä¿å­˜å’Œå¦å­˜ä¸ºåŠŸèƒ½ã€‚

### 10.1 æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹æ£€æµ‹ï¼ˆDay 1ï¼‰âš ï¸âš ï¸âš ï¸ **é«˜å±é—®é¢˜ä¿®å¤**

#### 10.1.1 æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ£€æŸ¥

**ä»»åŠ¡**ï¼šå®ç°æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹æ£€æµ‹å’Œå†²çªå¤„ç†

**å…·ä½“å®ç°**ï¼š

```rust
// src-tauri/src/services/file_watcher.rsï¼ˆæ›´æ–°ï¼‰
use std::path::Path;
use std::time::SystemTime;

impl FileWatcherService {
    // âš ï¸ æ–°å¢ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å¤–éƒ¨ä¿®æ”¹
    pub fn check_external_modification(&self, file_path: &Path) -> Result<bool, String> {
        let metadata = std::fs::metadata(file_path)
            .map_err(|e| format!("æ— æ³•è¯»å–æ–‡ä»¶å…ƒæ•°æ®: {}", e))?;
        
        let modified_time = metadata.modified()
            .map_err(|e| format!("æ— æ³•è·å–ä¿®æ”¹æ—¶é—´: {}", e))?;
        
        // ä¸ä¸Šæ¬¡ä¿å­˜æ—¶é—´æ¯”è¾ƒï¼ˆéœ€è¦å­˜å‚¨ä¸Šæ¬¡ä¿å­˜æ—¶é—´ï¼‰
        // è¿™é‡Œç®€åŒ–å®ç°ï¼Œå®é™…åº”è¯¥ä»çŠ¶æ€ä¸­è·å–
        Ok(true) // è¿”å› true è¡¨ç¤ºæ–‡ä»¶è¢«ä¿®æ”¹
    }
}
```

```typescript
// src/hooks/useFileModificationCheck.ts
import { useEffect, useRef } from 'react';
import { useEditorStore } from '../stores/editorStore';
import { invoke } from '@tauri-apps/api/core';
import { listen } from '@tauri-apps/api/event';

export const useFileModificationCheck = (tabId: string) => {
  const lastSavedTimeRef = useRef<number>(Date.now());
  
  useEffect(() => {
    const tab = useEditorStore.getState().tabs.find((t) => t.id === tabId);
    if (!tab) return;
    
    // ç›‘å¬æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶
    const unlisten = listen('file-tree-changed', async (event) => {
      const payload = event.payload as { path: string; kind: string };
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰æ–‡ä»¶è¢«ä¿®æ”¹
      if (payload.path === tab.filePath && payload.kind === 'modify') {
        const isModified = await invoke<boolean>('check_external_modification', {
          path: tab.filePath,
        });
        
        if (isModified) {
          // âš ï¸ å…³é”®ï¼šå¼¹çª—æç¤ºç”¨æˆ·
          const action = window.confirm(
            `æ–‡ä»¶ "${tab.fileName}" å·²è¢«å¤–éƒ¨ç¨‹åºä¿®æ”¹ã€‚\n\n` +
            `é€‰æ‹©ï¼š\n` +
            `- ç¡®å®šï¼šåŠ è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆå°†ä¸¢å¤±å½“å‰æœªä¿å­˜çš„æ›´æ”¹ï¼‰\n` +
            `- å–æ¶ˆï¼šç»§ç»­ç¼–è¾‘ï¼ˆä¸‹æ¬¡ä¿å­˜æ—¶å°†è¦†ç›–å¤–éƒ¨ä¿®æ”¹ï¼‰`
          );
          
          if (action) {
            // åŠ è½½æœ€æ–°ç‰ˆæœ¬
            await documentService.reloadFile(tab.filePath);
          } else {
            // ç»§ç»­ç¼–è¾‘ï¼Œä½†æ ‡è®°ä¸º"å¯èƒ½å†²çª"
            useEditorStore.getState().markTabConflict(tabId);
          }
        }
      }
    });
    
    return () => {
      unlisten.then(fn => fn());
    };
  }, [tabId]);
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹èƒ½å¤Ÿè¢«æ£€æµ‹
- âœ… æ£€æµ‹åˆ°ä¿®æ”¹æ—¶å¼¹çª—æç¤ºç”¨æˆ·
- âœ… ç”¨æˆ·å¯ä»¥é€‰æ‹©åŠ è½½æœ€æ–°ç‰ˆæœ¬æˆ–ç»§ç»­ç¼–è¾‘
- âœ… å†²çªçŠ¶æ€èƒ½å¤Ÿæ­£ç¡®æ ‡è®°

### 10.2 è‡ªåŠ¨ä¿å­˜ï¼ˆDay 2-3ï¼‰

#### 10.2.1 è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼ˆä¼˜åŒ–è§¦å‘é¢‘ç‡ï¼‰

**ä»»åŠ¡**ï¼šå®ç° 2 ç§’é˜²æŠ–çš„è‡ªåŠ¨ä¿å­˜ï¼Œä¼˜åŒ–è§¦å‘é¢‘ç‡

**å…·ä½“å®ç°**ï¼š

```typescript
// src/hooks/useAutoSave.ts
import { useEffect, useRef } from 'react';
import { useEditorStore } from '../stores/editorStore';
import { documentService } from '../services/documentService';

export const useAutoSave = (tabId: string) => {
  const saveTimerRef = useRef<NodeJS.Timeout | null>(null);
  const retryCountRef = useRef(0);
  const lastContentRef = useRef<string>(''); // âš ï¸ æ–°å¢ï¼šè®°å½•ä¸Šæ¬¡å†…å®¹ï¼Œé¿å…æ— å˜åŒ–æ—¶ä¿å­˜
  const MAX_RETRIES = 3;

  useEffect(() => {
    const tab = useEditorStore.getState().tabs.find((t) => t.id === tabId);
    if (!tab || !tab.isDirty || tab.isReadOnly) return; // âš ï¸ åªè¯»æ¨¡å¼ä¸è‡ªåŠ¨ä¿å­˜
    
    // âš ï¸ å…³é”®ï¼šåªæœ‰å†…å®¹çœŸæ­£å˜åŒ–æ—¶æ‰ä¿å­˜
    if (tab.content === lastContentRef.current) {
      return; // å†…å®¹æœªå˜åŒ–ï¼Œè·³è¿‡ä¿å­˜
    }

    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
    if (saveTimerRef.current) {
      clearTimeout(saveTimerRef.current);
    }

    // 2 ç§’é˜²æŠ–
    saveTimerRef.current = setTimeout(async () => {
      try {
        // æ ‡è®°ä¸ºä¿å­˜ä¸­
        useEditorStore.getState().setTabSaving(tabId, true);
        
        await documentService.saveFile(tab.filePath, tab.content);
        
        // æ ‡è®°ä¸ºå·²ä¿å­˜
        useEditorStore.getState().markTabSaved(tabId);
        lastContentRef.current = tab.content; // âš ï¸ æ›´æ–°ä¸Šæ¬¡å†…å®¹
        retryCountRef.current = 0;
      } catch (error) {
        console.error('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
        
        // é™é»˜é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
        if (retryCountRef.current < MAX_RETRIES) {
          retryCountRef.current++;
          const delay = Math.pow(2, retryCountRef.current) * 1000; // æŒ‡æ•°é€€é¿
          setTimeout(() => {
            // é‡æ–°è§¦å‘ä¿å­˜
            const tab = useEditorStore.getState().tabs.find((t) => t.id === tabId);
            if (tab && tab.isDirty) {
              // é€’å½’è°ƒç”¨
            }
          }, delay);
        } else {
          // é‡è¯• 3 æ¬¡åæ˜¾ç¤ºé”™è¯¯
          alert(`è‡ªåŠ¨ä¿å­˜å¤±è´¥: ${error instanceof Error ? error.message : String(error)}\n\nè¯·æ‰‹åŠ¨ä¿å­˜æ–‡ä»¶ã€‚`);
        }
      } finally {
        useEditorStore.getState().setTabSaving(tabId, false);
      }
    }, 2000);

    return () => {
      if (saveTimerRef.current) {
        clearTimeout(saveTimerRef.current);
      }
    };
  }, [tabId, useEditorStore.getState().tabs.find((t) => t.id === tabId)?.content]);
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æ­£å¸¸
- âœ… é˜²æŠ–æœºåˆ¶æ­£å¸¸
- âœ… é‡è¯•æœºåˆ¶æ­£å¸¸
- âœ… é”™è¯¯æç¤ºå®Œå–„

### 10.3 æ‰‹åŠ¨ä¿å­˜ï¼ˆDay 4ï¼‰

#### 10.2.1 æ‰‹åŠ¨ä¿å­˜å®ç°

**ä»»åŠ¡**ï¼šå®ç° Cmd/Ctrl + S æ‰‹åŠ¨ä¿å­˜

**å…·ä½“å®ç°**ï¼š

```typescript
// src/components/Editor/EditorPanel.tsxï¼ˆæ›´æ–°ï¼‰
useEffect(() => {
  const handleSave = async () => {
    const activeTab = useEditorStore.getState().getActiveTab();
    if (!activeTab) return;
    
    try {
      await documentService.saveFile(activeTab.filePath, activeTab.content);
      useEditorStore.getState().markTabSaved(activeTab.id);
    } catch (error) {
      console.error('ä¿å­˜å¤±è´¥:', error);
      alert(`ä¿å­˜å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);
    }
  };
  
  const handleKeyDown = (e: KeyboardEvent) => {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const modifier = isMac ? e.metaKey : e.ctrlKey;
    
    if (modifier && e.key === 's') {
      e.preventDefault();
      handleSave();
    }
  };
  
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, []);
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å¿«æ·é”®ä¿å­˜æ­£å¸¸
- âœ… ä¿å­˜çŠ¶æ€æç¤ºæ­£å¸¸
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### 10.4 å¦å­˜ä¸ºåŠŸèƒ½ï¼ˆDay 5ï¼‰

#### 10.3.1 å¦å­˜ä¸ºå®ç°

**ä»»åŠ¡**ï¼šå®ç°å¦å­˜ä¸ºåŠŸèƒ½

**å…·ä½“å®ç°**ï¼š

```typescript
// src/services/documentService.tsï¼ˆæ·»åŠ ï¼‰
async saveAs(currentPath: string, content: string): Promise<string | null> {
  try {
    // 1. æ‰“å¼€ä¿å­˜å¯¹è¯æ¡†
    const { save } = await import('@tauri-apps/plugin-dialog');
    const newPath = await save({
      defaultPath: currentPath,
      filters: [{
        name: 'Documents',
        extensions: ['docx', 'md', 'html'],
      }],
    });
    
    if (!newPath) return null;
    
    // 2. ä¿å­˜æ–‡ä»¶
    const ext = newPath.split('.').pop()?.toLowerCase();
    if (ext === 'docx') {
      await invoke('save_docx', { path: newPath, htmlContent: content });
    } else {
      await invoke('write_file', { path: newPath, content });
    }
    
    // 3. å¤„ç†å›¾ç‰‡ï¼ˆå¦‚æœå¦å­˜ä¸ºåˆ°æ–°ä½ç½®ï¼‰
    if (newPath !== currentPath) {
      // å¤åˆ¶ assets/ æ–‡ä»¶å¤¹åˆ°æ–°ä½ç½®
      await this.copyAssetsFolder(currentPath, newPath);
    }
    
    return newPath;
  } catch (error) {
    console.error('å¦å­˜ä¸ºå¤±è´¥:', error);
    throw error;
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å¦å­˜ä¸ºå¯¹è¯æ¡†æ­£å¸¸æ˜¾ç¤º
- âœ… æ–‡ä»¶èƒ½å¤Ÿä¿å­˜åˆ°æ–°ä½ç½®
- âœ… å›¾ç‰‡æ–‡ä»¶å¤¹èƒ½å¤Ÿæ­£ç¡®å¤åˆ¶
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## å…³é”®é£é™©ç‚¹å’Œåº”å¯¹æªæ–½

### âš ï¸ é«˜é£é™©é¡¹

1. **Pandoc äºŒè¿›åˆ¶æ–‡ä»¶å‡†å¤‡** âš ï¸âš ï¸âš ï¸
   - **é£é™©**ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ç¼ºå¤±æˆ–è·¯å¾„é”™è¯¯
   - **åº”å¯¹**ï¼šWeek 8 Day 1-2 å¿…é¡»å®Œæˆï¼Œæå‰éªŒè¯

2. **å›¾ç‰‡è·¯å¾„å¤„ç†** âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸ **é«˜å±**
   - **é£é™©**ï¼šå›¾ç‰‡è·¯å¾„ä¸ç»Ÿä¸€ï¼Œå¯¼è‡´ DOCX ä¸­å›¾ç‰‡ä¸¢å¤±æˆ–æ˜¾ç¤ºçº¢å‰
   - **åº”å¯¹**ï¼š
     - ç»Ÿä¸€ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š`assets/xxx.png`
     - TipTap ç¼–è¾‘å™¨é…ç½®æ”¯æŒç›¸å¯¹è·¯å¾„è§£æ
     - Pandoc ä½¿ç”¨ `--extract-media=assets` å‚æ•°
     - Week 8 Day 5 å¿…é¡»å®ç°å¹¶éªŒè¯

3. **æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹å†²çª** âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸ **é«˜å±**
   - **é£é™©**ï¼šç”¨æˆ·åœ¨ Word ä¸­ä¿®æ”¹æ–‡ä»¶ï¼ŒBinder ä¸çŸ¥æƒ…ï¼Œä¿å­˜æ—¶è¦†ç›–
   - **åº”å¯¹**ï¼š
     - æ–‡ä»¶ç›‘å¬ + ä¿®æ”¹æ—¶é—´æ£€æŸ¥
     - å‘ç°å†²çªæ—¶å¼¹çª—æç¤ºç”¨æˆ·
     - Week 10 Day 1 å¿…é¡»å®ç°

4. **DOCX è½¬æ¢è´¨é‡**
   - **é£é™©**ï¼šå¤æ‚æ ¼å¼è½¬æ¢å¤±è´¥
   - **åº”å¯¹**ï¼šå®ç°é™çº§ç­–ç•¥ï¼Œæå–çº¯æ–‡æœ¬ï¼Œé»˜è®¤åªè¯»æ¨¡å¼

5. **è‡ªåŠ¨ä¿å­˜è§¦å‘é¢‘ç‡** âš ï¸âš ï¸
   - **é£é™©**ï¼šTipTap onUpdate æ¯æ‰“ä¸€ä¸ªå­—éƒ½è§¦å‘ï¼Œå¯¼è‡´å¤§é‡æ— ç”¨ä¿å­˜
   - **åº”å¯¹**ï¼šä½¿ç”¨é˜²æŠ– + å†…å®¹å˜åŒ–æ£€æµ‹ï¼Œé¿å…æ— å˜åŒ–æ—¶ä¿å­˜

6. **è‡ªåŠ¨ä¿å­˜å¹¶å‘æ§åˆ¶**
   - **é£é™©**ï¼šè‡ªåŠ¨ä¿å­˜å’Œæ‰‹åŠ¨ä¿å­˜åŒæ—¶è¿›è¡Œ
   - **åº”å¯¹**ï¼šä½¿ç”¨é”æœºåˆ¶ï¼Œé˜²æ­¢å¹¶å‘ä¿å­˜

### âš ï¸ ä¸­é£é™©é¡¹

1. **TipTap ç¼–è¾‘å™¨æ€§èƒ½**
   - **é£é™©**ï¼šå¤§æ–‡ä»¶ç¼–è¾‘æ€§èƒ½é—®é¢˜
   - **åº”å¯¹**ï¼šå®ç°æµå¼åŠ è½½ï¼Œåˆ†å—å¤„ç†

2. **æ–‡ä»¶è¢«åˆ é™¤å¤„ç†**
   - **é£é™©**ï¼šæ–‡ä»¶æ ‘åˆ é™¤æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ï¼Œç¼–è¾‘å™¨ä»æ˜¾ç¤ºï¼Œä¿å­˜æ—¶å¤±è´¥
   - **åº”å¯¹**ï¼šæ–‡ä»¶ç›‘å¬æ£€æµ‹åˆ é™¤ï¼Œè‡ªåŠ¨å…³é—­æ ‡ç­¾é¡µæˆ–æç¤º

3. **åªè¯»æ¨¡å¼ç”¨æˆ·ä½“éªŒ**
   - **é£é™©**ï¼šåªè¯»æ¨¡å¼æç¤ºä¸å¤Ÿæ˜æ˜¾ï¼Œç”¨æˆ·ä¸çŸ¥é“å¦‚ä½•å¯ç”¨ç¼–è¾‘
   - **åº”å¯¹**ï¼šæ˜æ˜¾çš„æç¤ºæ  + "ç¼–è¾‘"æŒ‰é’®ï¼Œç‚¹å‡»ååˆ›å»ºè‰ç¨¿å‰¯æœ¬

---

## éªŒæ”¶æ ‡å‡†

### Week 5-6 éªŒæ”¶
- âœ… TipTap ç¼–è¾‘å™¨æ­£å¸¸æ¸²æŸ“
- âœ… åŸºç¡€ç¼–è¾‘åŠŸèƒ½æ­£å¸¸ï¼ˆæ–‡æœ¬ã€æ ·å¼ã€åˆ—è¡¨ï¼‰
- âœ… å·¥å…·æ æ­£å¸¸æ˜¾ç¤ºå’Œåˆ‡æ¢
- âœ… **å›¾ç‰‡æ’å…¥åŠŸèƒ½æ­£å¸¸ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ `assets/xxx.png`ï¼‰**
- âœ… **æ ‡ç­¾é¡µæ˜¾ç¤ºæ–‡ä»¶å + è„æ ‡è®°ï¼ˆ*ï¼‰**
- âœ… **åªè¯»æ¨¡å¼æç¤ºæ å’Œ"ç¼–è¾‘"æŒ‰é’®æ­£å¸¸**
- âœ… **å…³é—­æ ‡ç­¾é¡µå‰æ£€æŸ¥æœªä¿å­˜æ›´æ”¹**
- âœ… æ–‡æ¡£å¤§çº²ç”Ÿæˆæ­£å¸¸

### Week 7 éªŒæ”¶
- âœ… Markdown æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€å’Œç¼–è¾‘
- âœ… Markdown é¢„è§ˆåŠŸèƒ½æ­£å¸¸
- âœ… Markdown å¯¼å‡ºåŠŸèƒ½æ­£å¸¸

### Week 8-9 éªŒæ”¶
- âœ… DOCX æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸æ‰“å¼€
- âœ… **å¤æ‚æ ¼å¼ DOCX é»˜è®¤åªè¯»æ¨¡å¼**
- âœ… **ç®€å•æ ¼å¼ DOCX ç›´æ¥å¯ç¼–è¾‘**
- âœ… **åªè¯»æ¨¡å¼æç¤ºæ å’Œ"ç¼–è¾‘"æŒ‰é’®æ­£å¸¸**
- âœ… **ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®åˆ›å»ºè‰ç¨¿å‰¯æœ¬**
- âœ… DOCX æ–‡ä»¶èƒ½å¤Ÿæ­£å¸¸ä¿å­˜
- âœ… **å›¾ç‰‡èƒ½å¤Ÿæ­£ç¡®æ‰“åŒ…è¿› DOCXï¼ˆä½¿ç”¨ `--extract-media=assets`ï¼‰**
- âœ… **å›¾ç‰‡è·¯å¾„ç»Ÿä¸€ä¸ºç›¸å¯¹è·¯å¾„ï¼ˆ`assets/xxx.png`ï¼‰**
- âœ… **æ–‡ä»¶è¢«åˆ é™¤æ—¶èƒ½å¤Ÿæ£€æµ‹å¹¶æç¤º**
- âœ… å¤æ‚æ ¼å¼é™çº§å¤„ç†æ­£å¸¸

### Week 10 éªŒæ”¶
- âœ… **æ–‡ä»¶å¤–éƒ¨ä¿®æ”¹æ£€æµ‹æ­£å¸¸**
- âœ… **æ£€æµ‹åˆ°å¤–éƒ¨ä¿®æ”¹æ—¶å¼¹çª—æç¤ºç”¨æˆ·**
- âœ… **è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æ­£å¸¸ï¼ˆ2 ç§’é˜²æŠ–ï¼Œä¼˜åŒ–è§¦å‘é¢‘ç‡ï¼‰**
- âœ… **è‡ªåŠ¨ä¿å­˜åªåœ¨å†…å®¹çœŸæ­£å˜åŒ–æ—¶è§¦å‘**
- âœ… **åªè¯»æ¨¡å¼æ–‡ä»¶ä¸è‡ªåŠ¨ä¿å­˜**
- âœ… æ‰‹åŠ¨ä¿å­˜åŠŸèƒ½æ­£å¸¸ï¼ˆCmd/Ctrl + Sï¼‰
- âœ… å¦å­˜ä¸ºåŠŸèƒ½æ­£å¸¸
- âœ… ä¿å­˜çŠ¶æ€æç¤ºæ­£å¸¸
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶æ­£å¸¸

---

## å¼€å‘æ—¶é—´è¡¨

| å‘¨æ¬¡ | ä»»åŠ¡ | å¤©æ•° | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| Week 5 | TipTap ç¼–è¾‘å™¨é›†æˆ | 5 å¤© | P0 |
| Week 6 | ç¼–è¾‘å™¨å·¥å…·æ å’Œå›¾ç‰‡å¤„ç† | 5 å¤© | P0 |
| Week 7 | Markdown æ”¯æŒ | 5 å¤© | P1 |
| Week 8 | Pandoc é›†æˆå’Œ DOCX æ‰“å¼€ï¼ˆå«åªè¯»æ¨¡å¼ï¼‰ | 5 å¤© | P0 |
| Week 9 | DOCX ä¿å­˜å’Œå›¾ç‰‡æ‰“åŒ…ï¼ˆ--extract-mediaï¼‰ | 5 å¤© | P0 |
| Week 10 | ä¿å­˜æœºåˆ¶å®Œå–„ï¼ˆå¤–éƒ¨ä¿®æ”¹æ£€æµ‹ã€è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–ï¼‰ | 5 å¤© | P0 |

**æ€»è®¡**ï¼š30 ä¸ªå·¥ä½œæ—¥ï¼ˆ6 å‘¨ï¼‰

---

## ä¾èµ–é¡¹æ£€æŸ¥æ¸…å•

### å‰ç«¯ä¾èµ–
- [ ] `@tiptap/react` - TipTap React é›†æˆ
- [ ] `@tiptap/starter-kit` - TipTap åŸºç¡€æ‰©å±•
- [ ] `@tiptap/extension-image` - å›¾ç‰‡æ‰©å±•
- [ ] `@tiptap/extension-link` - é“¾æ¥æ‰©å±•
- [ ] `marked` - Markdown è§£æ
- [ ] `turndown` - HTML è½¬ Markdown

### åç«¯ä¾èµ–
- [ ] `uuid` - UUID ç”Ÿæˆï¼ˆå·²åœ¨ Cargo.toml ä¸­ï¼‰
- [ ] Pandoc äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆéœ€è¦ä¸‹è½½ï¼‰

### æƒé™é…ç½®
- [ ] `dialog:allow-save` - å¦å­˜ä¸ºåŠŸèƒ½
- [ ] æ–‡ä»¶ç³»ç»Ÿè¯»å†™æƒé™ï¼ˆå·²é…ç½®ï¼‰

---

## æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- [ ] TipTap ç¼–è¾‘å™¨ç»„ä»¶æµ‹è¯•
- [ ] æ–‡æ¡£æœåŠ¡æµ‹è¯•
- [ ] å›¾ç‰‡æœåŠ¡æµ‹è¯•
- [ ] Pandoc æœåŠ¡æµ‹è¯•

### é›†æˆæµ‹è¯•
- [ ] æ–‡ä»¶æ‰“å¼€æµç¨‹æµ‹è¯•
- [ ] æ–‡ä»¶ä¿å­˜æµç¨‹æµ‹è¯•
- [ ] å›¾ç‰‡æ’å…¥å’Œä¿å­˜æµ‹è¯•
- [ ] DOCX è½¬æ¢æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•
- [ ] å„ç§æ–‡ä»¶æ ¼å¼æ‰“å¼€æµ‹è¯•
- [ ] è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æµ‹è¯•
- [ ] æ‰‹åŠ¨ä¿å­˜åŠŸèƒ½æµ‹è¯•
- [ ] å¦å­˜ä¸ºåŠŸèƒ½æµ‹è¯•
- [ ] é”™è¯¯åœºæ™¯æµ‹è¯•

---

## æ–‡æ¡£æ›´æ–°

### éœ€è¦æ›´æ–°çš„æ–‡æ¡£
- [ ] å¼€å‘è¿›åº¦æ–‡æ¡£
- [ ] API æ–‡æ¡£
- [ ] ç”¨æˆ·æ‰‹å†Œï¼ˆç¼–è¾‘å™¨ä½¿ç”¨è¯´æ˜ï¼‰

---

**è®¡åˆ’ç‰ˆæœ¬**ï¼šv2.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025å¹´  
**ä¸‹æ¬¡æ›´æ–°**ï¼šæ ¹æ®å¼€å‘è¿›åº¦è°ƒæ•´

