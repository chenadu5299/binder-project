# DOCX ç¼–è¾‘æ¨¡å¼å¼€å‘æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**ï¼šv2.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01
- **æœ€åæ›´æ–°**ï¼š2024-12-19
- **æ–¹æ¡ˆçŠ¶æ€**ï¼šâœ… **å¯æ‰§è¡Œå¼€å‘æ–¹æ¡ˆ**
- **åŸºäºæ–¹æ¡ˆ**ï¼š`DOCXç¼–è¾‘æ¨¡å¼æ ·å¼å¤„ç†æ–¹æ¡ˆ.md`ï¼ˆPandoc + CSS æ ·å¼è¡¨æ–¹æ¡ˆï¼‰

---

## ä¸€ã€æ ¸å¿ƒåŸåˆ™

### 1.1 ç¬¬ä¸€æ€§åŸåˆ™

**ä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥ï¼Œç¡®ä¿å‡†ç¡®å¤ç°å’Œçµæ´»ç¼–è¾‘**

- âœ… **æå–æ ·å¼å±‚**ï¼šåªæå– Pandoc æœ€æˆç†Ÿçš„éƒ¨åˆ†ï¼ˆæ ‡é¢˜ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ—è¡¨ã€å›¾ç‰‡ã€è¡¨æ ¼ã€æ®µè½å¯¹é½ï¼‰ï¼Œç¡®ä¿ 100% å¤ç°
- âœ… **é¢„è®¾æ ·å¼å±‚**ï¼šä½¿ç”¨å•ä¸€é»˜è®¤é¢„è®¾æ ·å¼ï¼ˆCSS æ ·å¼è¡¨ï¼‰ï¼Œè‡ªåŠ¨å¥—ç”¨å®ç°å±‚æ¬¡åŒ–å±•ç¤ºï¼ˆå­—ä½“ã€å­—å·ï¼‰
- âœ… **å·¥å…·æ ·å¼å±‚**ï¼šå·¥å…·æ å±•ç¤ºå…¨éƒ¨ TipTap æ”¯æŒçš„æ ·å¼ï¼Œç”¨æˆ·å¯è‡ªç”±ç¼–è¾‘
- âŒ **ä¸å¤„ç†å¤æ‚æ ¼å¼**ï¼šé¡µçœ‰é¡µè„šã€å¤æ‚æ–‡æœ¬æ¡†ã€SmartArtã€VBA å®ã€å¤æ‚æ ·å¼ç»§æ‰¿é“¾ã€å¤æ‚è¡¨æ ¼æ ¼å¼ï¼ˆåˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ç­‰ï¼‰

### 1.2 ç¼–è¾‘å™¨èƒ½åŠ›è¾¹ç•Œ

**TipTap ç¼–è¾‘å™¨æ”¯æŒçš„åŠŸèƒ½**ï¼š
- âœ… æ ‡é¢˜ï¼ˆH1-H6ï¼‰
- âœ… æ®µè½å¯¹é½ï¼ˆå·¦ã€ä¸­ã€å³ã€ä¸¤ç«¯å¯¹é½ï¼‰
- âœ… æ–‡æœ¬æ ·å¼ï¼ˆç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ã€ä¸Šä¸‹æ ‡ï¼‰
- âœ… æ–‡æœ¬é¢œè‰²ã€å­—ä½“ã€å­—å·
- âœ… åˆ—è¡¨ï¼ˆæœ‰åºã€æ— åºï¼‰
- âœ… è¡¨æ ¼ï¼ˆåŸºç¡€è¡¨æ ¼ï¼Œæ”¯æŒ TableRowã€TableCellã€TableHeaderï¼‰
- âœ… å›¾ç‰‡ï¼ˆImage æ‰©å±•ï¼‰
- âœ… è¶…é“¾æ¥ï¼ˆLink æ‰©å±•ï¼‰

**TipTap ç¼–è¾‘å™¨ä¸æ”¯æŒçš„åŠŸèƒ½**ï¼ˆæœæ–­æ”¾å¼ƒï¼‰ï¼š
- âŒ å›¾æ ‡ï¼ˆIcon/Shapeï¼‰
- âŒ å¤æ‚æ–‡æœ¬æ¡†å¸ƒå±€
- âŒ é¡µçœ‰é¡µè„š
- âŒ SmartArtã€VBA å®
- âŒ å¤æ‚è¡¨æ ¼æ ¼å¼ï¼ˆåˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ç­‰ï¼‰

---

## äºŒã€æŠ€æœ¯æ¶æ„

### 2.1 æ•´ä½“æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼ˆä»é¢„è§ˆæ¨¡å¼åˆ‡æ¢ï¼‰
  â†“
Pandoc è½¬æ¢ DOCX â†’ HTMLï¼ˆæå–åŸºç¡€æ ·å¼ï¼‰
  â†“
CSS ç±»è½¬æ¢ä¸ºå†…è”æ ·å¼ï¼ˆæ®µè½å¯¹é½ï¼‰
  â†“
æ·»åŠ é¢„è®¾æ ·å¼è¡¨ï¼ˆCSS æ ·å¼è¡¨ï¼Œä¸ä¿®æ”¹ HTMLï¼‰
  â†“
TipTap ç¼–è¾‘å™¨åŠ è½½ HTML
  â†“
ç”¨æˆ·ç¼–è¾‘ï¼ˆAI äº¤äº’ç¼–è¾‘ï¼Œå·¥å…·æ æä¾›å…¨éƒ¨æ ·å¼ï¼‰
  â†“
ä¿å­˜ï¼šTipTap HTML â†’ Pandoc â†’ DOCX
```

### 2.2 æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- Rust + Tauri
- Pandocï¼ˆDOCX â†’ HTMLï¼ŒHTML â†’ DOCXï¼‰
- å­—ç¬¦ä¸²å¤„ç†ï¼ˆCSS ç±»è½¬æ¢ã€æ ·å¼è¡¨æ’å…¥ï¼‰

**å‰ç«¯**ï¼š
- React + TypeScript
- TipTap ç¼–è¾‘å™¨ï¼ˆå·²æ”¯æŒçš„åŠŸèƒ½ï¼‰

---

## ä¸‰ã€ä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥

### 3.1 æå–æ ·å¼å±‚ï¼ˆ100% å¤ç°ï¼‰

**åªæå– Pandoc æœ€æˆç†Ÿã€æœ€ç¨³å®šçš„æ ·å¼**ï¼š

**æ ‡é¢˜å±‚çº§**ï¼š
- H1-H6ï¼ˆPandoc ç›´æ¥è¾“å‡º `<h1>`-`<h6>` æ ‡ç­¾ï¼‰

**æ®µè½å¯¹é½**ï¼š
- å·¦å¯¹é½ã€å±…ä¸­ã€å³å¯¹é½ã€ä¸¤ç«¯å¯¹é½ï¼ˆé€šè¿‡ CSS ç±»è½¬æ¢ä¸ºå†…è”æ ·å¼ï¼‰

**æ–‡æœ¬æ ¼å¼**ï¼š
- ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ï¼ˆPandoc ç›´æ¥è¾“å‡º `<strong>`, `<em>`, `<u>` æ ‡ç­¾ï¼‰

**åˆ—è¡¨ç»“æ„**ï¼š
- æœ‰åºåˆ—è¡¨ã€æ— åºåˆ—è¡¨ï¼ˆPandoc ç›´æ¥è¾“å‡º `<ul>`, `<ol>`, `<li>` æ ‡ç­¾ï¼‰

**è¡¨æ ¼ç»“æ„**ï¼š
- åŸºç¡€è¡¨æ ¼ï¼ˆPandoc ç›´æ¥è¾“å‡º `<table>`, `<tr>`, `<td>` æ ‡ç­¾ï¼‰

**å›¾ç‰‡**ï¼š
- åµŒå…¥å›¾ç‰‡ï¼ˆPandoc ç›´æ¥è¾“å‡º `<img>` æ ‡ç­¾ï¼Œä¿ç•™è·¯å¾„ï¼‰

### 3.2 é¢„è®¾æ ·å¼å±‚ï¼ˆå±‚æ¬¡åŒ–å±•ç¤ºï¼‰

**å•ä¸€é»˜è®¤é¢„è®¾æ ·å¼**ï¼ˆCSS æ ·å¼è¡¨ï¼‰ï¼š
- å­—ä½“ï¼šArialï¼ˆç»Ÿä¸€æ ‡å‡†ï¼‰
- å­—å·ï¼š3 çº§ä½“ç³»ï¼ˆå¤§ 24pxã€ä¸­ 18pxã€å° 14pxï¼‰
- è‡ªåŠ¨å¥—ç”¨ï¼šé€šè¿‡ CSS é€‰æ‹©å™¨è‡ªåŠ¨åº”ç”¨åˆ°æ ‡é¢˜å’Œæ­£æ–‡
- ä¸ä¿®æ”¹ HTMLï¼šåªæ·»åŠ  `<style>` æ ‡ç­¾åˆ° `<head>`

### 3.3 å·¥å…·æ ·å¼å±‚ï¼ˆå®Œæ•´ç¼–è¾‘èƒ½åŠ›ï¼‰

**å·¥å…·æ æä¾›å…¨éƒ¨ TipTap æ”¯æŒçš„æ ·å¼**ï¼š
- æ–‡æœ¬æ ¼å¼ï¼šç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ã€ä¸Šæ ‡ã€ä¸‹æ ‡
- æ ‡é¢˜ï¼šH1-H6
- åˆ—è¡¨ï¼šæœ‰åºã€æ— åº
- å¯¹é½ï¼šå·¦ã€ä¸­ã€å³ã€ä¸¤ç«¯å¯¹é½
- é¢œè‰²ï¼šæ–‡æœ¬é¢œè‰²ã€èƒŒæ™¯é¢œè‰²
- å­—ä½“ï¼šå­—ä½“æ—ã€å­—å·
- å…¶ä»–ï¼šä»£ç å—ã€è¡Œå†…ä»£ç ã€å¼•ç”¨å—ã€æ°´å¹³çº¿
- åª’ä½“ï¼šé“¾æ¥ã€å›¾ç‰‡
- è¡¨æ ¼ï¼šæ’å…¥è¡¨æ ¼ã€è¡¨æ ¼æ“ä½œ
- è¡¨å¤´ï¼ˆ`<table:table-header-rows>`ï¼‰

**å›¾ç‰‡**ï¼š
- åµŒå…¥å›¾ç‰‡ï¼ˆ`<draw:image>` + `xlink:href="Pictures/xxx.png"`ï¼‰

**è¶…é“¾æ¥**ï¼š
- æ–‡æœ¬è¶…é“¾æ¥ï¼ˆ`<text:a>` + `xlink:href="http://..."`ï¼‰

### 3.2 ä¸æ”¯æŒçš„æ ·å¼ï¼ˆæœæ–­æ”¾å¼ƒï¼‰

- âŒ é¡µçœ‰é¡µè„š
- âŒ å¤æ‚æ–‡æœ¬æ¡†å¸ƒå±€
- âŒ SmartArtã€VBA å®
- âŒ å¤æ‚æ ·å¼ç»§æ‰¿é“¾
- âŒ å¤æ‚è¡¨æ ¼æ ¼å¼ï¼ˆåˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ç­‰ï¼‰
- âŒ å›¾æ ‡ï¼ˆIcon/Shapeï¼‰
- âŒ å…¶ä»– TipTap ä¸æ”¯æŒçš„å†…å®¹

---

## å››ã€ç‰¹æ®Šå†…å®¹æå–ç­–ç•¥

### 4.1 å›¾ç‰‡æå–

**ODT å›¾ç‰‡ç»“æ„**ï¼š
```xml
<draw:frame>
  <draw:image xlink:href="Pictures/10000000000001F4000001234567890AB.png"/>
</draw:frame>
```

**æå–ç­–ç•¥**ï¼š
1. ä» ODT ZIP ä¸­æå–å›¾ç‰‡æ–‡ä»¶ï¼ˆ`Pictures/` ç›®å½•ï¼‰
2. è½¬æ¢ä¸º base64 æˆ–ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•
3. åœ¨ HTML ä¸­ä½¿ç”¨ `<img src="data:image/png;base64,...">` æˆ– `file://` è·¯å¾„
4. TipTap Image æ‰©å±•æ”¯æŒ base64 å’Œ `file://` è·¯å¾„

**å®ç°è¦ç‚¹**ï¼š
- æå–å›¾ç‰‡æ—¶ä¿æŒå›¾ç‰‡æ ¼å¼ï¼ˆPNGã€JPEG ç­‰ï¼‰
- å¤§å›¾ç‰‡å¯å‹ç¼©ï¼ˆå¯é€‰ï¼Œä¸å½±å“åŠŸèƒ½ï¼‰
- å›¾ç‰‡è·¯å¾„åœ¨ HTML ä¸­æ­£ç¡®å¼•ç”¨

### 4.2 è¶…é“¾æ¥æå–

**ODT è¶…é“¾æ¥ç»“æ„**ï¼š
```xml
<text:a xlink:href="http://example.com" xlink:type="simple">
  <text:span>é“¾æ¥æ–‡æœ¬</text:span>
</text:a>
```

**æå–ç­–ç•¥**ï¼š
1. æå– `xlink:href` å±æ€§ï¼ˆURLï¼‰
2. æå–é“¾æ¥æ–‡æœ¬ï¼ˆ`<text:span>` å†…å®¹ï¼‰
3. åœ¨ HTML ä¸­ä½¿ç”¨ `<a href="http://...">é“¾æ¥æ–‡æœ¬</a>`
4. TipTap Link æ‰©å±•æ”¯æŒæ ‡å‡† HTML `<a>` æ ‡ç­¾

**å®ç°è¦ç‚¹**ï¼š
- æ”¯æŒç»å¯¹ URLï¼ˆ`http://`ã€`https://`ï¼‰
- æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆ`./file.docx`ã€`../folder/`ï¼‰
- ä¸æ”¯æŒé”šç‚¹é“¾æ¥ï¼ˆ`#section`ï¼‰ï¼Œå¦‚æœé‡åˆ°åˆ™æå–ä¸ºæ™®é€šæ–‡æœ¬

### 4.3 å›¾æ ‡/å½¢çŠ¶å¤„ç†ï¼ˆæœæ–­æ”¾å¼ƒï¼‰

**ODT å›¾æ ‡/å½¢çŠ¶ç»“æ„**ï¼š
```xml
<draw:custom-shape>
  <text:p>å›¾æ ‡å†…å®¹</text:p>
</draw:custom-shape>
```

**å¤„ç†ç­–ç•¥**ï¼š
- âŒ **ä¸æå–**ï¼šTipTap ä¸æ”¯æŒå›¾æ ‡/å½¢çŠ¶
- âŒ **ä¸è½¬æ¢**ï¼šé‡åˆ°å›¾æ ‡/å½¢çŠ¶æ—¶è·³è¿‡ï¼Œä¸ç”Ÿæˆ HTML
- âœ… **ä¿ç•™ä¸Šä¸‹æ–‡**ï¼šè·³è¿‡å›¾æ ‡/å½¢çŠ¶ï¼Œç»§ç»­å¤„ç†åç»­å†…å®¹

**å®ç°è¦ç‚¹**ï¼š
- è§£æ ODT XML æ—¶ï¼Œé‡åˆ° `<draw:custom-shape>` ç­‰ä¸æ”¯æŒçš„å½¢çŠ¶å…ƒç´ ï¼Œç›´æ¥è·³è¿‡
- ä¸ç”Ÿæˆä»»ä½• HTMLï¼Œä¸ä¿ç•™å ä½ç¬¦
- æ—¥å¿—è®°å½•è·³è¿‡çš„å…ƒç´ ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè¯•ï¼‰

### 4.4 å…¶ä»–ç‰¹æ®Šå†…å®¹å¤„ç†

**å¤æ‚æ–‡æœ¬æ¡†**ï¼š
- âŒ ä¸æå–ï¼šTipTap ä¸æ”¯æŒå¤æ‚æ–‡æœ¬æ¡†å¸ƒå±€
- âœ… æå–æ–‡æœ¬å†…å®¹ï¼šä»æ–‡æœ¬æ¡†ä¸­æå–çº¯æ–‡æœ¬ï¼Œä½œä¸ºæ™®é€šæ®µè½å¤„ç†

**é¡µçœ‰é¡µè„š**ï¼š
- âŒ ä¸æå–ï¼šTipTap ä¸æ”¯æŒé¡µçœ‰é¡µè„š
- âœ… è·³è¿‡ï¼šè§£ææ—¶ç›´æ¥è·³è¿‡é¡µçœ‰é¡µè„šå†…å®¹

**SmartArtã€VBA å®**ï¼š
- âŒ ä¸æå–ï¼šTipTap ä¸æ”¯æŒ
- âœ… è·³è¿‡ï¼šè§£ææ—¶ç›´æ¥è·³è¿‡

**å¤æ‚è¡¨æ ¼æ ¼å¼**ï¼š
- âœ… æå–åŸºç¡€è¡¨æ ¼ï¼šæå–è¡¨æ ¼ç»“æ„å’Œæ–‡æœ¬å†…å®¹
- âŒ ä¸ä¿ç•™åˆå¹¶å•å…ƒæ ¼ï¼šåˆå¹¶å•å…ƒæ ¼è½¬æ¢ä¸ºæ™®é€šå•å…ƒæ ¼
- âŒ ä¸ä¿ç•™è¾¹æ¡†æ ·å¼ï¼šè¾¹æ¡†æ ·å¼ä¸æå–
- âŒ ä¸ä¿ç•™è¡¨æ ¼æ ·å¼ï¼šè¡¨æ ¼æ ·å¼ä¸æå–

---

## äº”ã€å®ç°æ–¹æ¡ˆ

### 5.1 åç«¯å®ç°

#### 5.1.1 LibreOffice è½¬æ¢æœåŠ¡ï¼ˆå¤ç”¨é¢„è§ˆæ¨¡å¼ï¼‰

**æœåŠ¡ä½ç½®**ï¼š`src-tauri/src/services/libreoffice_service.rs`

**åŠŸèƒ½**ï¼š
- è½¬æ¢ DOCX â†’ ODTï¼ˆå¸¦ç¼“å­˜ï¼‰
- ç¼“å­˜æœºåˆ¶ï¼šæ–‡ä»¶è·¯å¾„ + ä¿®æ”¹æ—¶é—´ï¼Œ1å°æ—¶è¿‡æœŸ
- **ç¼“å­˜ç›®å½•**ï¼š`cache/odt/`ï¼ˆä¸ PDF ç¼“å­˜ `cache/preview/` åˆ†ç¦»ï¼‰
- **ç¼“å­˜å…±äº«**ï¼šç¼–è¾‘æ¨¡å¼å’Œé¢„è§ˆæ¨¡å¼å…±äº« ODT ç¼“å­˜ï¼ˆé¢„è§ˆæ¨¡å¼ï¼šDOCX â†’ ODT â†’ PDFï¼Œç¼–è¾‘æ¨¡å¼ï¼šDOCX â†’ ODTï¼‰

**å®ç°**ï¼š
```rust
impl LibreOfficeService {
    /// è½¬æ¢ DOCX â†’ ODTï¼ˆå¸¦ç¼“å­˜ï¼‰
    /// 
    /// **ç¼“å­˜ç­–ç•¥**ï¼š
    /// - ç¼“å­˜ç›®å½•ï¼š`cache/odt/`ï¼ˆä¸ PDF ç¼“å­˜åˆ†ç¦»ï¼‰
    /// - ç¼“å­˜é”®ï¼šæ–‡ä»¶è·¯å¾„ + ä¿®æ”¹æ—¶é—´
    /// - ç¼“å­˜è¿‡æœŸï¼š1å°æ—¶
    /// - ç¼“å­˜å…±äº«ï¼šç¼–è¾‘æ¨¡å¼å’Œé¢„è§ˆæ¨¡å¼å…±äº« ODT ç¼“å­˜
    pub fn convert_docx_to_odt(
        &self,
        docx_path: &Path,
    ) -> Result<PathBuf, String> {
        // 1. æ£€æŸ¥ LibreOffice å¯ç”¨æ€§
        let libreoffice_path = self.get_libreoffice_path()?;
        
        // 2. æ£€æŸ¥ ODT ç¼“å­˜ï¼ˆä½¿ç”¨ç‹¬ç«‹çš„ ODT ç¼“å­˜ç›®å½•ï¼‰
        let odt_cache_dir = self.cache_dir.parent()
            .ok_or_else(|| "æ— æ³•è·å–ç¼“å­˜çˆ¶ç›®å½•".to_string())?
            .join("odt");
        fs::create_dir_all(&odt_cache_dir)
            .map_err(|e| format!("åˆ›å»º ODT ç¼“å­˜ç›®å½•å¤±è´¥: {}", e))?;
        
        let cache_key = self.generate_cache_key(docx_path)?;
        let cached_odt_path = odt_cache_dir.join(format!("{}.odt", cache_key));
        
        if cached_odt_path.exists() {
            let metadata = fs::metadata(&cached_odt_path)?;
            let elapsed = metadata.modified()?
                .duration_since(SystemTime::now() - self.cache_duration)
                .unwrap_or(Duration::from_secs(0));
            
            if elapsed < self.cache_duration {
                eprintln!("âœ… ä½¿ç”¨ç¼“å­˜ ODT: {:?}", cached_odt_path);
                return Ok(cached_odt_path);
            } else {
                let _ = fs::remove_file(&cached_odt_path);
            }
        }
        
        // 3. æ‰§è¡Œè½¬æ¢
        eprintln!("ğŸ”„ å¼€å§‹è½¬æ¢ DOCX â†’ ODT: {:?}", docx_path);
        
        // åˆ›å»ºä¸´æ—¶è¾“å‡ºç›®å½•
        let output_dir = odt_cache_dir.join("temp");
        fs::create_dir_all(&output_dir)
            .map_err(|e| format!("åˆ›å»ºä¸´æ—¶è¾“å‡ºç›®å½•å¤±è´¥: {}", e))?;
        
        // 4. é…ç½® LibreOffice è¿è¡Œç¯å¢ƒï¼ˆå‚è€ƒ convert_docx_to_pdf çš„å®ç°ï¼‰
        let mut cmd = Command::new(&libreoffice_path);
        // ... ç¯å¢ƒå˜é‡é…ç½®ï¼ˆä¸ PDF è½¬æ¢ç›¸åŒï¼‰...
        
        // 5. æ‰§è¡Œ LibreOffice è½¬æ¢å‘½ä»¤
        cmd.arg("--headless")
            .arg("--convert-to")
            .arg("odt")
            .arg("--outdir")
            .arg(&output_dir)
            .arg(docx_path);
        
        let output = cmd.output()
            .map_err(|e| format!("æ‰§è¡Œ LibreOffice å‘½ä»¤å¤±è´¥: {}", e))?;
        
        if !output.status.success() {
            let stderr = String::from_utf8_lossy(&output.stderr);
            return Err(format!("LibreOffice è½¬æ¢å¤±è´¥: {}", stderr));
        }
        
        // 6. æŸ¥æ‰¾ç”Ÿæˆçš„ ODT æ–‡ä»¶
        let expected_odt_filename = docx_path.file_stem()
            .and_then(|s| s.to_str())
            .map(|s| s.to_string() + ".odt");
        
        let temp_odt_path = if let Some(ref filename) = expected_odt_filename {
            let expected_path = output_dir.join(filename);
            if expected_path.exists() {
                expected_path
            } else {
                // æ‰«æç›®å½•æŸ¥æ‰¾ ODT æ–‡ä»¶
                // ... æŸ¥æ‰¾é€»è¾‘ ...
                return Err("æœªæ‰¾åˆ°ç”Ÿæˆçš„ ODT æ–‡ä»¶".to_string());
            }
        } else {
            return Err("æ— æ³•ç¡®å®š ODT æ–‡ä»¶å".to_string());
        };
        
        // 7. ä¿å­˜åˆ°ç¼“å­˜
        fs::copy(&temp_odt_path, &cached_odt_path)
            .map_err(|e| format!("ä¿å­˜ ODT ç¼“å­˜å¤±è´¥: {}", e))?;
        
        eprintln!("âœ… ODT è½¬æ¢æˆåŠŸ: {:?}", cached_odt_path);
        Ok(cached_odt_path)
    }
}
```

#### 5.1.2 ODT è§£ææœåŠ¡

**æœåŠ¡ä½ç½®**ï¼š`src-tauri/src/services/odt_parser.rs`

**åŠŸèƒ½**ï¼š
- è§£æ ODT ZIP ç»“æ„
- æå–å†…å®¹å’Œ AI æ ·å¼å­é›†
- ç”Ÿæˆç»“æ„åŒ–æ•°æ®

**æ•°æ®ç»“æ„**ï¼š
```rust
// âš ï¸ å…³é”®ä¿®å¤ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ–‡æ¡£èŠ‚ç‚¹ç±»å‹ï¼ŒæŒ‰æ–‡æ¡£é¡ºåºå­˜å‚¨
#[derive(Debug, Clone)]
pub enum DocumentNode {
    Heading(Heading),
    Paragraph(Paragraph),
    List(List),
    Table(Table),
}

#[derive(Debug, Clone)]
pub struct OdtStructure {
    pub nodes: Vec<DocumentNode>,  // æŒ‰æ–‡æ¡£é¡ºåºå­˜å‚¨ï¼ˆODT XML ä¸­å…ƒç´ æŒ‰æ–‡æ¡£é¡ºåºæ’åˆ—ï¼‰
    pub image_map: HashMap<String, Image>,  // å›¾ç‰‡è·¯å¾„æ˜ å°„è¡¨ï¼ˆè·¯å¾„ -> å›¾ç‰‡æ•°æ®ï¼‰
}

#[derive(Debug, Clone)]
pub struct Heading {
    pub level: u8,                    // 1-6
    pub text: String,
    pub style: TextStyle,            // æ ·å¼ä¿¡æ¯
}

#[derive(Debug, Clone)]
pub struct Paragraph {
    pub text_runs: Vec<TextRun>,      // æ–‡æœ¬è¿è¡Œåˆ—è¡¨ï¼ˆåŒ…å«æ–‡æœ¬ã€å›¾ç‰‡ã€è¶…é“¾æ¥ï¼‰
    pub images: Vec<ImageNode>,        // æ®µè½ä¸­çš„å›¾ç‰‡èŠ‚ç‚¹ï¼ˆæŒ‰ä½ç½®æ’åºï¼‰
    pub align: Option<String>,         // left, center, right, justify
    pub style: TextStyle,
}

#[derive(Debug, Clone)]
pub struct ImageNode {
    pub path: String,                  // ODT ä¸­çš„å›¾ç‰‡è·¯å¾„ï¼ˆPictures/xxx.pngï¼‰
    pub position: ImagePosition,      // å›¾ç‰‡ä½ç½®ï¼ˆæ®µè½å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾ï¼‰
    pub index: usize,                  // åœ¨æ®µè½ä¸­çš„ç´¢å¼•ä½ç½®
}

#[derive(Debug, Clone)]
pub struct TextRun {
    pub text: String,
    pub color: Option<String>,        // #RRGGBB
    pub font_family: Option<String>,
    pub font_size: Option<String>,    // 12pt
    pub bold: bool,
    pub italic: bool,
    pub underline: bool,
    pub link: Option<String>,         // è¶…é“¾æ¥ URLï¼ˆå¦‚æœæœ‰ï¼‰
    pub image_ref: Option<String>,    // å›¾ç‰‡å¼•ç”¨è·¯å¾„ï¼ˆå¦‚æœæœ‰ï¼Œä» image_map æŸ¥æ‰¾ï¼‰
}

#[derive(Debug, Clone)]
pub struct List {
    pub items: Vec<ListItem>,         // åˆ—è¡¨é¡¹åˆ—è¡¨
    pub ordered: bool,                // æœ‰åº/æ— åº
}

#[derive(Debug, Clone)]
pub struct ListItem {
    pub text_runs: Vec<TextRun>,      // æ–‡æœ¬è¿è¡Œåˆ—è¡¨
    pub nested_level: u8,             // åµŒå¥—å±‚çº§ï¼ˆ0 = é¡¶çº§ï¼Œ1 = ä¸€çº§åµŒå¥—ï¼Œä»¥æ­¤ç±»æ¨ï¼‰
    pub children: Vec<ListItem>,      // å­åˆ—è¡¨é¡¹ï¼ˆç”¨äºåµŒå¥—åˆ—è¡¨ï¼‰
}

#[derive(Debug, Clone)]
pub struct Table {
    pub rows: Vec<TableRow>,           // è¡¨æ ¼è¡Œåˆ—è¡¨
    pub header_rows: Vec<TableRow>,    // è¡¨å¤´è¡Œåˆ—è¡¨
}

#[derive(Debug, Clone)]
pub struct TableRow {
    pub cells: Vec<TableCell>,         // å•å…ƒæ ¼åˆ—è¡¨
}

#[derive(Debug, Clone)]
pub struct TableCell {
    pub content: Vec<Paragraph>,      // å•å…ƒæ ¼å†…å®¹ï¼ˆæ®µè½åˆ—è¡¨ï¼ŒåŒ…å«å›¾ç‰‡ï¼‰
    pub is_header: bool,               // æ˜¯å¦ä¸ºè¡¨å¤´
    pub colspan: u32,                  // åˆå¹¶åˆ—æ•°ï¼ˆtable:number-columns-spannedï¼‰
    pub rowspan: u32,                  // åˆå¹¶è¡Œæ•°ï¼ˆtable:number-rows-spannedï¼‰
    pub is_merged: bool,               // æ˜¯å¦ä¸ºåˆå¹¶å•å…ƒæ ¼ï¼ˆéç¬¬ä¸€ä¸ªå•å…ƒæ ¼ï¼‰
}

#[derive(Debug, Clone)]
pub struct Image {
    pub path: String,                  // ODT ä¸­çš„å›¾ç‰‡è·¯å¾„ï¼ˆPictures/xxx.pngï¼‰
    pub data: Vec<u8>,                 // å›¾ç‰‡æ•°æ®ï¼ˆä» ZIP ä¸­æå–ï¼‰
    pub mime_type: String,             // å›¾ç‰‡ MIME ç±»å‹ï¼ˆimage/png, image/jpegï¼‰
}

// âš ï¸ æ³¨æ„ï¼šLink ä¸å†ä½œä¸ºç‹¬ç«‹ç»“æ„ï¼Œè¶…é“¾æ¥ç›´æ¥åµŒå…¥åˆ° TextRun ä¸­

#[derive(Debug, Clone)]
pub struct TextStyle {
    pub color: Option<String>,
    pub font_family: Option<String>,
    pub font_size: Option<String>,
    pub bold: bool,
    pub italic: bool,
    pub underline: bool,
    pub parent_style: Option<String>,  // çˆ¶æ ·å¼åç§°ï¼ˆç”¨äºæ ·å¼ç»§æ‰¿ï¼‰
}

// âš ï¸ æ ·å¼ç»§æ‰¿å¤„ç†ç­–ç•¥ï¼š
// - ç®€å•å¤„ç†ï¼šåªç»§æ‰¿ä¸€å±‚ï¼ˆå¦‚æœå…ƒç´ æœ‰ style:parent-style-nameï¼ŒæŸ¥æ‰¾çˆ¶æ ·å¼ï¼‰
// - åˆå¹¶è§„åˆ™ï¼šåˆå¹¶çˆ¶æ ·å¼å’Œå½“å‰æ ·å¼ï¼ˆå½“å‰æ ·å¼ä¼˜å…ˆçº§æ›´é«˜ï¼‰
// - ä¸å¤„ç†å¤šå±‚ç»§æ‰¿

pub struct OdtParser;

impl OdtParser {
    /// è§£æ ODT æ–‡ä»¶ï¼Œæå–ç»“æ„
    /// 
    /// **å…³é”®å®ç°**ï¼š
    /// - æŒ‰ç…§æ–‡æ¡£é¡ºåºæå–å…ƒç´ ï¼ˆODT XML ä¸­å…ƒç´ æŒ‰æ–‡æ¡£é¡ºåºæ’åˆ—ï¼‰
    /// - ä½¿ç”¨ç»Ÿä¸€çš„ DocumentNode æšä¸¾ç±»å‹
    /// - å»ºç«‹å›¾ç‰‡è·¯å¾„æ˜ å°„è¡¨ï¼ˆimage_mapï¼‰
    /// - å¤„ç†æ ·å¼ç»§æ‰¿ï¼ˆåªç»§æ‰¿ä¸€å±‚ï¼‰
    pub fn parse_odt(odt_path: &Path) -> Result<OdtStructure, String> {
        // 1. æ‰“å¼€ ODTï¼ˆZIPï¼‰
        let file = File::open(odt_path)?;
        let mut zip = ZipArchive::new(file)?;
        
        // 2. æå–å›¾ç‰‡æ•°æ®ï¼ˆä» ZIP ä¸­æå– Pictures/ ç›®å½•ï¼Œå»ºç«‹æ˜ å°„è¡¨ï¼‰
        let image_map = Self::extract_images(&mut zip)?;
        
        // 3. è¯»å– content.xml
        let mut content_xml = String::new();
        zip.by_name("content.xml")?
            .read_to_string(&mut content_xml)?;
        
        // 4. è§£æ XMLï¼ˆquick-xmlï¼Œæ”¯æŒå‘½åç©ºé—´ï¼‰
        // âš ï¸ æ³¨æ„ï¼šquick-xml æ”¯æŒå‘½åç©ºé—´ï¼Œä½¿ç”¨ `@namespace` å±æ€§å¤„ç†
        let mut nodes = Vec::new();
        let mut reader = quick_xml::Reader::from_str(&content_xml);
        reader.trim_text(true);
        
        // 5. æŒ‰ç…§æ–‡æ¡£é¡ºåºæå–å…ƒç´ ï¼ˆæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼ï¼‰
        // 6. æå–æ ·å¼ä¿¡æ¯ï¼ˆæ–‡æœ¬é¢œè‰²ã€å­—ä½“ã€å­—å·ç­‰ï¼Œå¤„ç†æ ·å¼ç»§æ‰¿ï¼‰
        // 7. å…³è”å›¾ç‰‡ï¼ˆé€šè¿‡ image_map æŸ¥æ‰¾å›¾ç‰‡æ•°æ®ï¼‰
        // 8. è¿”å›ç»“æ„åŒ–æ•°æ®
        
        Ok(OdtStructure {
            nodes,
            image_map,
        })
    }
    
    /// æå–å›¾ç‰‡æ•°æ®ï¼ˆä» ODT ZIP ä¸­æå–ï¼Œå»ºç«‹æ˜ å°„è¡¨ï¼‰
    /// 
    /// **è¿”å›**ï¼šå›¾ç‰‡è·¯å¾„ -> å›¾ç‰‡æ•°æ®çš„æ˜ å°„è¡¨
    fn extract_images(odt_zip: &mut ZipArchive<File>) -> Result<HashMap<String, Image>, String> {
        let mut image_map = HashMap::new();
        
        // éå† ODT ZIP ä¸­çš„æ–‡ä»¶
        for i in 0..odt_zip.len() {
            let file = odt_zip.by_index(i)?;
            let name = file.name();
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
            if name.starts_with("Pictures/") {
                let mut data = Vec::new();
                std::io::copy(&mut file, &mut data)?;
                
                // è¯†åˆ« MIME ç±»å‹
                let mime_type = match name {
                    n if n.ends_with(".png") => "image/png",
                    n if n.ends_with(".jpg") || n.ends_with(".jpeg") => "image/jpeg",
                    n if n.ends_with(".gif") => "image/gif",
                    n if n.ends_with(".webp") => "image/webp",
                    _ => "image/png", // é»˜è®¤
                };
                
                // âš ï¸ å›¾ç‰‡å‹ç¼©ï¼šå¤§å›¾ç‰‡éœ€è¦å‹ç¼©ï¼ˆå‡å°‘ HTML ä½“ç§¯ï¼‰
                let compressed_data = if data.len() > 1024 * 1024 {  // > 1MB
                    Self::compress_image(&data, &mime_type)?
                } else {
                    data
                };
                
                image_map.insert(name.to_string(), Image {
                    path: name.to_string(),
                    data: compressed_data,
                    mime_type: mime_type.to_string(),
                });
            }
        }
        
        Ok(image_map)
    }
    
    /// å‹ç¼©å›¾ç‰‡ï¼ˆå¤§å›¾ç‰‡å‹ç¼©ï¼Œå‡å°‘ HTML ä½“ç§¯ï¼‰
    fn compress_image(data: &[u8], mime_type: &str) -> Result<Vec<u8>, String> {
        // ä½¿ç”¨ image crate å‹ç¼©å›¾ç‰‡
        // ä¿æŒå›¾ç‰‡æ ¼å¼ï¼Œé™ä½è´¨é‡æˆ–å°ºå¯¸
        // è¿”å›å‹ç¼©åçš„å›¾ç‰‡æ•°æ®
        // âš ï¸ æ³¨æ„ï¼šå‹ç¼©æ˜¯å¯é€‰çš„ï¼Œä¸å½±å“åŠŸèƒ½
        Ok(data.to_vec())  // å ä½å®ç°
    }
    
    /// è·³è¿‡ä¸æ”¯æŒçš„å½¢çŠ¶å…ƒç´ 
    fn skip_unsupported_shape(&mut self) {
        // é‡åˆ° <draw:custom-shape> ç­‰ä¸æ”¯æŒçš„å½¢çŠ¶å…ƒç´ æ—¶ï¼Œç›´æ¥è·³è¿‡
        // ä¸ç”Ÿæˆä»»ä½• HTMLï¼Œä¸ä¿ç•™å ä½ç¬¦
    }
    
    /// å¤„ç†æ ·å¼ç»§æ‰¿ï¼ˆåªç»§æ‰¿ä¸€å±‚ï¼‰
    fn resolve_style_inheritance(&self, style: &TextStyle, styles_map: &HashMap<String, TextStyle>) -> TextStyle {
        let mut resolved_style = style.clone();
        
        // å¦‚æœæ ·å¼æœ‰çˆ¶æ ·å¼ï¼ŒæŸ¥æ‰¾å¹¶åˆå¹¶
        if let Some(ref parent_name) = style.parent_style {
            if let Some(parent_style) = styles_map.get(parent_name) {
                // åˆå¹¶çˆ¶æ ·å¼å’Œå½“å‰æ ·å¼ï¼ˆå½“å‰æ ·å¼ä¼˜å…ˆçº§æ›´é«˜ï¼‰
                if resolved_style.color.is_none() {
                    resolved_style.color = parent_style.color.clone();
                }
                if resolved_style.font_family.is_none() {
                    resolved_style.font_family = parent_style.font_family.clone();
                }
                if resolved_style.font_size.is_none() {
                    resolved_style.font_size = parent_style.font_size.clone();
                }
                if !resolved_style.bold {
                    resolved_style.bold = parent_style.bold;
                }
                if !resolved_style.italic {
                    resolved_style.italic = parent_style.italic;
                }
                if !resolved_style.underline {
                    resolved_style.underline = parent_style.underline;
                }
            }
        }
        
        resolved_style
    }
}
```

#### 5.1.3 HTML ç”ŸæˆæœåŠ¡

**æœåŠ¡ä½ç½®**ï¼š`src-tauri/src/services/html_generator.rs`

**åŠŸèƒ½**ï¼š
- å°† ODT ç»“æ„è½¬æ¢ä¸ºè¯­ä¹‰åŒ– HTML
- ç”Ÿæˆå†…è”æ ·å¼ï¼ˆTipTap æ”¯æŒï¼‰
- å¤„ç†å›¾ç‰‡ï¼ˆbase64 æˆ– file:// è·¯å¾„ï¼‰
- å¤„ç†è¶…é“¾æ¥ï¼ˆæ ‡å‡† HTML `<a>` æ ‡ç­¾ï¼‰

**å®ç°**ï¼š
```rust
pub struct HtmlGenerator;

impl HtmlGenerator {
    /// å°† ODT ç»“æ„è½¬æ¢ä¸º HTML
    /// 
    /// **å…³é”®å®ç°**ï¼š
    /// - æŒ‰ç…§æ–‡æ¡£é¡ºåºç”Ÿæˆ HTMLï¼ˆä½¿ç”¨ nodes åˆ—è¡¨ï¼‰
    /// - å›¾ç‰‡é€šè¿‡ image_map æŸ¥æ‰¾å¹¶è½¬æ¢ä¸º base64
    /// - å¤„ç†åµŒå¥—åˆ—è¡¨
    /// - å¤„ç†åˆå¹¶å•å…ƒæ ¼
    pub fn odt_structure_to_html(structure: &OdtStructure) -> String {
        let mut html = String::new();
        
        // âš ï¸ å…³é”®ä¿®å¤ï¼šæŒ‰ç…§æ–‡æ¡£é¡ºåºç”Ÿæˆ HTMLï¼ˆä¸æ˜¯æŒ‰ç±»å‹åˆ†ç»„ï¼‰
        for node in &structure.nodes {
            match node {
                DocumentNode::Heading(heading) => {
                    html.push_str(&self.heading_to_html(heading));
                }
                DocumentNode::Paragraph(para) => {
                    html.push_str(&self.paragraph_to_html(para, &structure.image_map));
                }
                DocumentNode::List(list) => {
                    html.push_str(&self.list_to_html(list, &structure.image_map, 0));
                }
                DocumentNode::Table(table) => {
                    html.push_str(&self.table_to_html(table, &structure.image_map));
                }
            }
        }
        
        html
    }
    
    /// ç”Ÿæˆæ ‡é¢˜ HTML
    fn heading_to_html(&self, heading: &Heading) -> String {
        let style = self.text_style_to_css(&heading.style);
        format!("<h{} style=\"{}\">{}</h{}>", 
                heading.level, style, heading.text, heading.level)
    }
    
    /// ç”Ÿæˆæ®µè½ HTML
    /// 
    /// **å›¾ç‰‡å¤„ç†**ï¼š
    /// - å›¾ç‰‡åœ¨æ®µè½ä¸­çš„ä½ç½®ï¼šæ ¹æ® ImageNode çš„ position å’Œ index ç¡®å®š
    /// - æ®µè½å¼€å¤´ï¼šå›¾ç‰‡åœ¨ç¬¬ä¸€ä¸ªæ–‡æœ¬è¿è¡Œä¹‹å‰
    /// - æ®µè½ä¸­é—´ï¼šå›¾ç‰‡åœ¨å¯¹åº”çš„æ–‡æœ¬è¿è¡Œä¹‹å
    /// - æ®µè½ç»“å°¾ï¼šå›¾ç‰‡åœ¨æœ€åä¸€ä¸ªæ–‡æœ¬è¿è¡Œä¹‹å
    fn paragraph_to_html(&self, para: &Paragraph, image_map: &HashMap<String, Image>) -> String {
        let mut html = String::from("<p");
        
        // æ®µè½å¯¹é½
        if let Some(align) = &para.align {
            html.push_str(&format!(" style=\"text-align: {};\"", align));
        }
        
        html.push_str(">");
        
        // âš ï¸ å…³é”®ï¼šåˆå¹¶æ–‡æœ¬è¿è¡Œå’Œå›¾ç‰‡èŠ‚ç‚¹ï¼ŒæŒ‰ä½ç½®æ’åº
        let mut elements: Vec<(usize, ElementType)> = Vec::new();
        
        // æ·»åŠ æ–‡æœ¬è¿è¡Œ
        for (i, run) in para.text_runs.iter().enumerate() {
            elements.push((i, ElementType::TextRun(run.clone())));
        }
        
        // æ·»åŠ å›¾ç‰‡èŠ‚ç‚¹
        for img_node in &para.images {
            let index = match img_node.position {
                ImagePosition::Start => 0,
                ImagePosition::Middle => img_node.index,
                ImagePosition::End => para.text_runs.len(),
            };
            elements.push((index, ElementType::Image(img_node.clone())));
        }
        
        // æŒ‰ä½ç½®æ’åº
        elements.sort_by_key(|(idx, _)| *idx);
        
        // ç”Ÿæˆ HTML
        for (_, element) in elements {
            match element {
                ElementType::TextRun(run) => {
                    html.push_str(&self.text_run_to_html(&run, image_map));
                }
                ElementType::Image(img_node) => {
                    if let Some(image) = image_map.get(&img_node.path) {
                        html.push_str(&self.image_to_html(image));
                    }
                }
            }
        }
        
        html.push_str("</p>");
        html
    }
    
    enum ElementType {
        TextRun(TextRun),
        Image(ImageNode),
    }
    
    /// ç”Ÿæˆæ–‡æœ¬è¿è¡Œ HTML
    /// 
    /// **å›¾ç‰‡å¤„ç†**ï¼š
    /// - å¦‚æœ TextRun æœ‰ image_refï¼Œåœ¨æ–‡æœ¬åæ’å…¥å›¾ç‰‡
    fn text_run_to_html(&self, run: &TextRun, image_map: &HashMap<String, Image>) -> String {
        let mut style = String::new();
        
        // æ–‡æœ¬é¢œè‰²
        if let Some(color) = &run.color {
            style.push_str(&format!("color: {}; ", color));
        }
        
        // å­—ä½“
        if let Some(font) = &run.font_family {
            style.push_str(&format!("font-family: {}; ", font));
        }
        
        // å­—å·
        if let Some(size) = &run.font_size {
            style.push_str(&format!("font-size: {}; ", size));
        }
        
        // ç²—ä½“
        if run.bold {
            style.push_str("font-weight: bold; ");
        }
        
        // æ–œä½“
        if run.italic {
            style.push_str("font-style: italic; ");
        }
        
        // ä¸‹åˆ’çº¿
        if run.underline {
            style.push_str("text-decoration: underline; ");
        }
        
        let text_html = if !style.is_empty() {
            format!("<span style=\"{}\">{}</span>", style.trim(), run.text)
        } else {
            run.text.clone()
        };
        
        // è¶…é“¾æ¥
        if let Some(url) = &run.link {
            let mut result = format!("<a href=\"{}\">{}</a>", url, text_html);
            
            // å¦‚æœæ–‡æœ¬è¿è¡Œä¸­æœ‰å›¾ç‰‡å¼•ç”¨ï¼Œåœ¨é“¾æ¥åæ’å…¥å›¾ç‰‡
            if let Some(ref img_path) = run.image_ref {
                if let Some(image) = image_map.get(img_path) {
                    result.push_str(&self.image_to_html(image));
                }
            }
            
            return result;
        }
        
        // æ™®é€šæ–‡æœ¬
        let mut result = text_html;
        
        // å¦‚æœæ–‡æœ¬è¿è¡Œä¸­æœ‰å›¾ç‰‡å¼•ç”¨ï¼Œåœ¨æ–‡æœ¬åæ’å…¥å›¾ç‰‡
        if let Some(ref img_path) = run.image_ref {
            if let Some(image) = image_map.get(img_path) {
                result.push_str(&self.image_to_html(image));
            }
        }
        
        result
    }
    
    /// ç”Ÿæˆåˆ—è¡¨ HTMLï¼ˆæ”¯æŒåµŒå¥—ï¼‰
    /// 
    /// **åµŒå¥—å¤„ç†**ï¼š
    /// - æ ¹æ® nested_level ç”ŸæˆåµŒå¥—çš„ `<ul>` æˆ– `<ol>` æ ‡ç­¾
    /// - ä½¿ç”¨ children å­—æ®µå¤„ç†åµŒå¥—åˆ—è¡¨é¡¹
    fn list_to_html(&self, list: &List, image_map: &HashMap<String, Image>, current_level: u8) -> String {
        let tag = if list.ordered { "ol" } else { "ul" };
        let mut html = format!("<{}>", tag);
        
        for item in &list.items {
            html.push_str("<li>");
            
            // æ–‡æœ¬è¿è¡Œ
            for run in &item.text_runs {
                html.push_str(&self.text_run_to_html(run, image_map));
            }
            
            // åµŒå¥—åˆ—è¡¨ï¼ˆchildrenï¼‰
            if !item.children.is_empty() {
                // é€’å½’ç”ŸæˆåµŒå¥—åˆ—è¡¨
                let nested_list = List {
                    items: item.children.clone(),
                    ordered: list.ordered,  // åµŒå¥—åˆ—è¡¨ç»§æ‰¿çˆ¶åˆ—è¡¨çš„æœ‰åº/æ— åºå±æ€§
                };
                html.push_str(&self.list_to_html(&nested_list, image_map, current_level + 1));
            }
            
            html.push_str("</li>");
        }
        
        html.push_str(&format!("</{}>", tag));
        html
    }
    
    /// ç”Ÿæˆè¡¨æ ¼ HTML
    /// 
    /// **åˆå¹¶å•å…ƒæ ¼å¤„ç†**ï¼š
    /// - ä¿ç•™ç¬¬ä¸€ä¸ªå•å…ƒæ ¼çš„å†…å®¹ï¼Œå…¶ä»–åˆå¹¶çš„å•å…ƒæ ¼ç”Ÿæˆç©º `<td></td>`
    /// - æ£€æµ‹ `table:number-columns-spanned` å’Œ `table:number-rows-spanned`
    fn table_to_html(&self, table: &Table, image_map: &HashMap<String, Image>) -> String {
        let mut html = String::from("<table>");
        
        // è¡¨å¤´
        if !table.header_rows.is_empty() {
            html.push_str("<thead>");
            for row in &table.header_rows {
                html.push_str(&self.table_row_to_html(row, true, image_map));
            }
            html.push_str("</thead>");
        }
        
        // è¡¨ä½“
        html.push_str("<tbody>");
        for row in &table.rows {
            html.push_str(&self.table_row_to_html(row, false, image_map));
        }
        html.push_str("</tbody>");
        
        html.push_str("</table>");
        html
    }
    
    /// ç”Ÿæˆè¡¨æ ¼è¡Œ HTML
    /// 
    /// **åˆå¹¶å•å…ƒæ ¼å¤„ç†**ï¼š
    /// - ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ï¼šä¿ç•™å†…å®¹ï¼Œå¦‚æœæœ‰ colspan/rowspanï¼Œæ·»åŠ ç›¸åº”å±æ€§
    /// - å…¶ä»–åˆå¹¶çš„å•å…ƒæ ¼ï¼ˆis_merged = trueï¼‰ï¼šç”Ÿæˆç©º `<td></td>`
    fn table_row_to_html(&self, row: &TableRow, is_header: bool, image_map: &HashMap<String, Image>) -> String {
        let mut html = String::from("<tr>");
        
        for cell in &row.cells {
            // âš ï¸ å…³é”®ï¼šè·³è¿‡åˆå¹¶çš„å•å…ƒæ ¼ï¼ˆéç¬¬ä¸€ä¸ªå•å…ƒæ ¼ï¼‰
            if cell.is_merged {
                // ç”Ÿæˆç©ºå•å…ƒæ ¼ï¼ˆå ä½ç¬¦ï¼‰
                let tag = if is_header || cell.is_header { "th" } else { "td" };
                html.push_str(&format!("<{}></{}>", tag, tag));
                continue;
            }
            
            let tag = if is_header || cell.is_header { "th" } else { "td" };
            let mut cell_html = format!("<{}", tag);
            
            // æ·»åŠ åˆå¹¶å±æ€§
            if cell.colspan > 1 {
                cell_html.push_str(&format!(" colspan=\"{}\"", cell.colspan));
            }
            if cell.rowspan > 1 {
                cell_html.push_str(&format!(" rowspan=\"{}\"", cell.rowspan));
            }
            
            cell_html.push_str(">");
            
            // å•å…ƒæ ¼å†…å®¹
            for para in &cell.content {
                cell_html.push_str(&self.paragraph_to_html(para, image_map));
            }
            
            cell_html.push_str(&format!("</{}>", tag));
            html.push_str(&cell_html);
        }
        
        html.push_str("</tr>");
        html
    }
    
    /// æ–‡æœ¬æ ·å¼è½¬ CSS
    fn text_style_to_css(&self, style: &TextStyle) -> String {
        let mut css = String::new();
        
        if let Some(color) = &style.color {
            css.push_str(&format!("color: {}; ", color));
        }
        
        if let Some(font) = &style.font_family {
            css.push_str(&format!("font-family: {}; ", font));
        }
        
        if let Some(size) = &style.font_size {
            css.push_str(&format!("font-size: {}; ", size));
        }
        
        if style.bold {
            css.push_str("font-weight: bold; ");
        }
        
        if style.italic {
            css.push_str("font-style: italic; ");
        }
        
        if style.underline {
            css.push_str("text-decoration: underline; ");
        }
        
        css.trim().to_string()
    }
}
```

#### 5.1.4 å›¾ç‰‡å¤„ç†

**å›¾ç‰‡æå–ç­–ç•¥**ï¼š
1. ä» ODT ZIP ä¸­æå– `Pictures/` ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶
2. è½¬æ¢ä¸º base64 ç¼–ç 
3. åœ¨ HTML ä¸­ä½¿ç”¨ `<img src="data:image/png;base64,...">` æ ¼å¼

**å®ç°è¦ç‚¹**ï¼š
```rust
impl OdtParser {
    fn extract_images(odt_zip: &mut ZipArchive<File>) -> Result<Vec<Image>, String> {
        let mut images = Vec::new();
        
        // éå† ODT ZIP ä¸­çš„æ–‡ä»¶
        for i in 0..odt_zip.len() {
            let file = odt_zip.by_index(i)?;
            let name = file.name();
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
            if name.starts_with("Pictures/") {
                let mut data = Vec::new();
                std::io::copy(&mut file, &mut data)?;
                
                // è¯†åˆ« MIME ç±»å‹
                let mime_type = match name {
                    n if n.ends_with(".png") => "image/png",
                    n if n.ends_with(".jpg") || n.ends_with(".jpeg") => "image/jpeg",
                    n if n.ends_with(".gif") => "image/gif",
                    n if n.ends_with(".webp") => "image/webp",
                    _ => "image/png", // é»˜è®¤
                };
                
                images.push(Image {
                    path: name.to_string(),
                    data,
                    mime_type: mime_type.to_string(),
                });
            }
        }
        
        Ok(images)
    }
}

impl HtmlGenerator {
    fn image_to_html(&self, image: &Image) -> String {
        // è½¬æ¢ä¸º base64ï¼ˆä½¿ç”¨ base64 crateï¼‰
        // âš ï¸ æ³¨æ„ï¼šä½¿ç”¨ base64 = "0.22" ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
        let base64 = base64::engine::general_purpose::STANDARD.encode(&image.data);
        format!("<img src=\"data:{};base64,{}\" class=\"editor-image\" />", 
                image.mime_type, base64)
    }
}
```

#### 5.1.5 åç«¯å‘½ä»¤æ¥å£

**æœåŠ¡ä½ç½®**ï¼š`src-tauri/src/commands/file_commands.rs`

```rust
/// æ‰“å¼€ DOCX æ–‡ä»¶ç”¨äºç¼–è¾‘ï¼ˆç¼–è¾‘æ¨¡å¼ä¸“ç”¨ï¼‰
/// 
/// **åŠŸèƒ½**ï¼šè½¬æ¢ DOCX â†’ ODT â†’ è§£æç»“æ„ â†’ ç”Ÿæˆ HTML
/// 
/// **ä½¿ç”¨åœºæ™¯**ï¼š
/// - ç¼–è¾‘æ¨¡å¼ï¼ˆæ–°å»º/AIç”Ÿæˆ/ç‚¹å‡»ç¼–è¾‘ï¼‰
/// - TipTap ç¼–è¾‘å™¨æ˜¾ç¤º
/// 
/// **å¤„ç†æµç¨‹**ï¼š
/// 1. æ£€æŸ¥ç¼“å­˜ï¼ˆODT æ–‡ä»¶ï¼‰
/// 2. å¦‚æœæ²¡æœ‰ï¼Œè°ƒç”¨ LibreOffice è½¬æ¢ DOCX â†’ ODT
/// 3. è§£æ ODT XMLï¼Œæå–ç»“æ„
/// 4. æå– AI æ ·å¼å­é›†ï¼ˆåŸºç¡€æ ·å¼ï¼‰
/// 5. ç”Ÿæˆè¯­ä¹‰åŒ– HTMLï¼ˆå¸¦å†…è”æ ·å¼ï¼‰
/// 6. è¿”å› HTML å­—ç¬¦ä¸²
/// 
/// **è¿”å›**ï¼šHTML å†…å®¹ï¼ˆå¸¦å†…è”æ ·å¼ï¼Œå¯ç›´æ¥åŠ è½½åˆ° TipTapï¼‰
#[tauri::command]
pub async fn open_docx_for_edit(
    path: String,
    app: tauri::AppHandle,
) -> Result<String, String> {
    let docx_path = PathBuf::from(&path);
    
    // âš ï¸ æ–‡ä»¶å¤§å°æ£€æŸ¥ï¼šé™åˆ¶ 100MB
    let file_size = std::fs::metadata(&docx_path)
        .map_err(|e| format!("æ— æ³•è¯»å–æ–‡ä»¶ä¿¡æ¯: {}", e))?
        .len();
    
    if file_size > 100 * 1024 * 1024 {  // 100MB
        return Err("æ–‡ä»¶è¿‡å¤§ï¼ˆ>100MBï¼‰ï¼Œæ— æ³•æ‰“å¼€ã€‚è¯·ä½¿ç”¨è¾ƒå°çš„æ–‡ä»¶æˆ–åˆ†å‰²æ–‡æ¡£ã€‚".to_string());
    }
    
    // âš ï¸ æœåŠ¡å®ä¾‹å¤ç”¨ï¼šä½¿ç”¨å…¨å±€å•ä¾‹ï¼ˆåœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºï¼‰
    // ä½¿ç”¨ lazy_static æˆ– once_cell åˆ›å»ºå•ä¾‹ï¼Œæ‰€æœ‰å‘½ä»¤å…±äº«åŒä¸€ä¸ªæœåŠ¡å®ä¾‹
    let lo_service = get_global_libreoffice_service()
        .map_err(|e| format!("LibreOffice æœåŠ¡åˆå§‹åŒ–å¤±è´¥: {}", e))?;
    
    // 2. è½¬æ¢ DOCX â†’ ODTï¼ˆLibreOfficeï¼Œå¸¦ç¼“å­˜ï¼‰
    // âš ï¸ æ³¨æ„ï¼šconvert_docx_to_odt æ˜¯åŒæ­¥æ–¹æ³•ï¼Œéœ€è¦åœ¨ spawn_blocking ä¸­æ‰§è¡Œ
    let odt_path = tokio::task::spawn_blocking({
        let docx_path = docx_path.clone();
        let lo_service = lo_service.clone();
        move || lo_service.convert_docx_to_odt(&docx_path)
    }).await
        .map_err(|e| format!("è½¬æ¢ä»»åŠ¡å¤±è´¥: {}", e))??;
    
    // 3. è§£æ ODT XMLï¼Œæå–ç»“æ„ï¼ˆæµå¼å¤„ç†å¤§æ–‡ä»¶ï¼‰
    let structure = tokio::task::spawn_blocking({
        let odt_path = odt_path.clone();
        move || OdtParser::parse_odt(&odt_path)
    }).await
        .map_err(|e| format!("è§£æä»»åŠ¡å¤±è´¥: {}", e))??;
    
    // 4. æå– AI æ ·å¼å­é›†ï¼ˆåŸºç¡€æ ·å¼ï¼Œå·²åœ¨è§£ææ—¶å®Œæˆï¼‰
    
    // 5. ç”Ÿæˆè¯­ä¹‰åŒ– HTMLï¼ˆå¸¦å†…è”æ ·å¼ï¼‰
    let html = tokio::task::spawn_blocking({
        move || HtmlGenerator::odt_structure_to_html(&structure)
    }).await
        .map_err(|e| format!("HTML ç”Ÿæˆä»»åŠ¡å¤±è´¥: {}", e))??;
    
    // 6. è¿”å› HTML å­—ç¬¦ä¸²
    Ok(html)
}

// âš ï¸ å…¨å±€ LibreOffice æœåŠ¡å•ä¾‹ï¼ˆä½¿ç”¨ once_cellï¼‰
use once_cell::sync::Lazy;
use std::sync::Mutex;

static GLOBAL_LO_SERVICE: Lazy<Mutex<Option<LibreOfficeService>>> = Lazy::new(|| {
    Mutex::new(None)
});

fn get_global_libreoffice_service() -> Result<Arc<LibreOfficeService>, String> {
    let mut service = GLOBAL_LO_SERVICE.lock().unwrap();
    
    if service.is_none() {
        *service = Some(LibreOfficeService::new()?);
    }
    
    Ok(Arc::new(service.as_ref().unwrap().clone()))
}

/// åˆ›å»º DOCX æ–‡ä»¶çš„è‰ç¨¿å‰¯æœ¬
/// 
/// **åŠŸèƒ½**ï¼šå¤åˆ¶åŸæ–‡ä»¶ï¼Œåˆ›å»ºè‰ç¨¿å‰¯æœ¬ï¼ˆ`document.draft.docx`ï¼‰
/// 
/// **ä½¿ç”¨åœºæ™¯**ï¼š
/// - ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼ˆä»é¢„è§ˆæ¨¡å¼åˆ‡æ¢ï¼‰
/// - ç¼–è¾‘æ¨¡å¼éœ€è¦å¯ç¼–è¾‘çš„å‰¯æœ¬
/// 
/// **è¿”å›**ï¼šè‰ç¨¿æ–‡ä»¶è·¯å¾„
#[tauri::command]
pub async fn create_draft_docx(original_path: String) -> Result<String, String> {
    let original = PathBuf::from(&original_path);
    
    // 1. æ£€æŸ¥åŸæ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if !original.exists() {
        return Err(format!("åŸæ–‡ä»¶ä¸å­˜åœ¨: {}", original_path));
    }
    
    // 2. ç”Ÿæˆè‰ç¨¿æ–‡ä»¶è·¯å¾„ï¼ˆdocument.draft.docxï¼‰
    let parent = original.parent()
        .ok_or_else(|| "æ— æ³•è·å–æ–‡ä»¶çˆ¶ç›®å½•".to_string())?;
    let stem = original.file_stem()
        .and_then(|s| s.to_str())
        .ok_or_else(|| "æ— æ³•è·å–æ–‡ä»¶å".to_string())?;
    let draft_path = parent.join(format!("{}.draft.docx", stem));
    
    // 3. å¦‚æœè‰ç¨¿æ–‡ä»¶å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
    if draft_path.exists() {
        std::fs::remove_file(&draft_path)
            .map_err(|e| format!("åˆ é™¤æ—§è‰ç¨¿æ–‡ä»¶å¤±è´¥: {}", e))?;
    }
    
    // 4. å¤åˆ¶åŸæ–‡ä»¶åˆ°è‰ç¨¿æ–‡ä»¶
    std::fs::copy(&original, &draft_path)
        .map_err(|e| format!("å¤åˆ¶æ–‡ä»¶å¤±è´¥: {}", e))?;
    
    // 5. è¿”å›è‰ç¨¿æ–‡ä»¶è·¯å¾„
    Ok(draft_path.to_string_lossy().to_string())
}
```

### 5.2 å‰ç«¯å®ç°

#### 5.2.1 ç¼–è¾‘æ¨¡å¼åˆ‡æ¢

**ç»„ä»¶ä½ç½®**ï¼š`src/components/Editor/DocxPdfPreview.tsx`

**åŠŸèƒ½**ï¼š
- ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®æ—¶ï¼Œè°ƒç”¨ `create_draft_docx` åˆ›å»ºè‰ç¨¿å‰¯æœ¬
- è°ƒç”¨ `open_docx_for_edit` è·å– HTML å†…å®¹
- åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼ˆTipTap ç¼–è¾‘å™¨ï¼‰

**å®ç°**ï¼š
```typescript
const handleCreateDraft = async () => {
  try {
    // 1. åˆ›å»ºè‰ç¨¿å‰¯æœ¬
    const draftPath = await invoke<string>('create_draft_docx', {
      originalPath: filePath
    });
    
    // 2. æ‰“å¼€è‰ç¨¿æ–‡ä»¶è¿›è¡Œç¼–è¾‘
    const htmlContent = await invoke<string>('open_docx_for_edit', {
      path: draftPath
    });
    
    // 3. æ‰“å¼€è‰ç¨¿æ–‡ä»¶è¿›è¡Œç¼–è¾‘
    const { useEditorStore } = await import('../../stores/editorStore');
    const { addTab, setActiveTab } = useEditorStore.getState();
    
    // âš ï¸ ä¿®å¤ï¼šä½¿ç”¨å­—ç¬¦ä¸²æ“ä½œæå–æ–‡ä»¶åï¼ˆä¸ä½¿ç”¨ path æ¨¡å—ï¼‰
    const fileName = draftPath.split('/').pop() || draftPath.split('\\').pop() || 'è‰ç¨¿.docx';
    
    const tabId = addTab(
      draftPath,
      fileName,
      htmlContent,
      false, // isReadOnly
      true,  // isDraftï¼ˆè¿™æ˜¯ç”¨æˆ·çš„ä¸»ç¼–è¾‘æ–‡ä»¶ï¼Œè‰ç¨¿åªæ˜¯æˆ‘ä»¬çš„è¯´æ³•ï¼Œåç»­è¿˜è¦æ¢åç§°ï¼‰
      Date.now() // lastModifiedTime
    );
    
    setActiveTab(tabId);
  } catch (error) {
    console.error('åˆ›å»ºè‰ç¨¿å¤±è´¥:', error);
    toast.error(`åˆ›å»ºè‰ç¨¿å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);
  }
};
```

#### 5.2.2 TipTap ç¼–è¾‘å™¨åŠ è½½

**ç»„ä»¶ä½ç½®**ï¼š`src/components/Editor/TipTapEditor.tsx`

**åŠŸèƒ½**ï¼š
- TipTap ç¼–è¾‘å™¨å·²æ”¯æŒæ‰€æœ‰éœ€è¦çš„åŠŸèƒ½
- ç›´æ¥åŠ è½½ HTML å†…å®¹å³å¯

**å®ç°**ï¼š
```typescript
// TipTap ç¼–è¾‘å™¨å·²é…ç½®æ‰€æœ‰éœ€è¦çš„æ‰©å±•
// ç›´æ¥ä½¿ç”¨ editor.commands.setContent(htmlContent) åŠ è½½ HTML
```

---

## å…­ã€å¼€å‘è®¡åˆ’

### é˜¶æ®µ1ï¼šODT è§£ææœåŠ¡å®ç°ï¼ˆ3-5å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç° ODT è§£æå’Œç»“æ„æå–

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç° ODT ZIP è§£æï¼ˆ`zip` crateï¼‰
2. å®ç° ODT XML è§£æï¼ˆ`quick-xml` crateï¼‰
3. å®ç°ç»“æ„æå–ï¼ˆæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼ï¼‰
4. å®ç°æ ·å¼æå–ï¼ˆæ–‡æœ¬é¢œè‰²ã€å­—ä½“ã€å­—å·ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€å¯¹é½ï¼‰
5. å®ç°å›¾ç‰‡æå–ï¼ˆä» ZIP ä¸­æå– Pictures/ ç›®å½•ï¼‰
6. å®ç°è¶…é“¾æ¥æå–ï¼ˆ`<text:a>` æ ‡ç­¾ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ODT æ–‡ä»¶æ­£ç¡®è§£æï¼ˆæ”¯æŒå‘½åç©ºé—´ï¼‰
- âœ… ç»“æ„å’Œæ ·å¼æ­£ç¡®æå–ï¼ˆæŒ‰æ–‡æ¡£é¡ºåºï¼‰
- âœ… æ ·å¼ç»§æ‰¿æ­£ç¡®å¤„ç†ï¼ˆåªç»§æ‰¿ä¸€å±‚ï¼‰
- âœ… å›¾ç‰‡æ­£ç¡®æå–ï¼ˆbase64 ç¼–ç ï¼Œå»ºç«‹æ˜ å°„è¡¨ï¼‰
- âœ… å›¾ç‰‡å‹ç¼©æ­£å¸¸å·¥ä½œï¼ˆå¤§å›¾ç‰‡ > 1MBï¼‰
- âœ… è¶…é“¾æ¥æ­£ç¡®æå–ï¼ˆåµŒå…¥åˆ° TextRun ä¸­ï¼‰
- âœ… å›¾ç‰‡ä½ç½®æ­£ç¡®å¤„ç†ï¼ˆæ®µè½å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾ï¼‰
- âœ… è¡¨æ ¼åˆå¹¶å•å…ƒæ ¼æ­£ç¡®å¤„ç†ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ï¼Œå…¶ä»–ä¸ºç©ºï¼‰
- âœ… åˆ—è¡¨åµŒå¥—æ­£ç¡®å¤„ç†ï¼ˆä½¿ç”¨ children å­—æ®µï¼‰

### é˜¶æ®µ2ï¼šHTML ç”ŸæˆæœåŠ¡å®ç°ï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç° ODT ç»“æ„åˆ° HTML çš„è½¬æ¢

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç°æ ‡é¢˜ HTML ç”Ÿæˆï¼ˆH1-H6ï¼Œå¸¦æ ·å¼ï¼‰
2. å®ç°æ®µè½ HTML ç”Ÿæˆï¼ˆå¸¦å¯¹é½å’Œæ ·å¼ï¼Œåˆå¹¶æ–‡æœ¬è¿è¡Œå’Œå›¾ç‰‡èŠ‚ç‚¹ï¼‰
3. å®ç°æ–‡æœ¬è¿è¡Œ HTML ç”Ÿæˆï¼ˆå¸¦å†…è”æ ·å¼ï¼Œå¤„ç†å›¾ç‰‡å¼•ç”¨å’Œè¶…é“¾æ¥ï¼‰
4. å®ç°åˆ—è¡¨ HTML ç”Ÿæˆï¼ˆæœ‰åº/æ— åºï¼Œæ”¯æŒåµŒå¥—ï¼‰
5. å®ç°è¡¨æ ¼ HTML ç”Ÿæˆï¼ˆåŸºç¡€è¡¨æ ¼ï¼Œå¤„ç†åˆå¹¶å•å…ƒæ ¼ï¼‰
6. å®ç°å›¾ç‰‡ HTML ç”Ÿæˆï¼ˆbase64 data URLï¼Œä½¿ç”¨ base64 = "0.22"ï¼‰
7. å®ç°è¶…é“¾æ¥ HTML ç”Ÿæˆï¼ˆæ ‡å‡† `<a>` æ ‡ç­¾ï¼‰
8. å®ç°æŒ‰æ–‡æ¡£é¡ºåºç”Ÿæˆ HTMLï¼ˆä½¿ç”¨ DocumentNode æšä¸¾ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… HTML æ­£ç¡®ç”Ÿæˆï¼ˆæŒ‰æ–‡æ¡£é¡ºåºï¼‰
- âœ… å†…è”æ ·å¼æ­£ç¡®åº”ç”¨ï¼ˆåŒ…æ‹¬æ ·å¼ç»§æ‰¿ï¼‰
- âœ… å›¾ç‰‡æ­£ç¡®æ˜¾ç¤ºï¼ˆbase64ï¼Œä½ç½®æ­£ç¡®ï¼‰
- âœ… è¶…é“¾æ¥æ­£ç¡®æ˜¾ç¤º
- âœ… åµŒå¥—åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- âœ… åˆå¹¶å•å…ƒæ ¼æ­£ç¡®å¤„ç†

### é˜¶æ®µ3ï¼šåç«¯å‘½ä»¤æ¥å£å®ç°ï¼ˆ1-2å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç°åç«¯å‘½ä»¤æ¥å£

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç° `open_docx_for_edit` å‘½ä»¤
2. å®ç° `create_draft_docx` å‘½ä»¤ï¼ˆå¤ç”¨ç°æœ‰å®ç°ï¼‰
3. é›†æˆ LibreOffice è½¬æ¢æœåŠ¡ï¼ˆå¤ç”¨é¢„è§ˆæ¨¡å¼ï¼‰
4. é›†æˆ ODT è§£ææœåŠ¡
5. é›†æˆ HTML ç”ŸæˆæœåŠ¡

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å‘½ä»¤æ­£å¸¸å·¥ä½œ
- âœ… è‰ç¨¿å‰¯æœ¬æ­£ç¡®åˆ›å»º
- âœ… HTML å†…å®¹æ­£ç¡®è¿”å›

### é˜¶æ®µ4ï¼šå‰ç«¯é›†æˆï¼ˆ1-2å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç°å‰ç«¯ç¼–è¾‘æ¨¡å¼åˆ‡æ¢

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ›´æ–° `DocxPdfPreview` ç»„ä»¶çš„"ç¼–è¾‘"æŒ‰é’®é€»è¾‘
2. è°ƒç”¨ `create_draft_docx` åˆ›å»ºè‰ç¨¿å‰¯æœ¬
3. è°ƒç”¨ `open_docx_for_edit` è·å– HTML å†…å®¹
4. åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼ˆTipTap ç¼–è¾‘å™¨ï¼‰
5. æµ‹è¯•ç¼–è¾‘åŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ç¼–è¾‘æŒ‰é’®æ­£å¸¸å·¥ä½œ
- âœ… è‰ç¨¿å‰¯æœ¬æ­£ç¡®åˆ›å»º
- âœ… HTML å†…å®¹æ­£ç¡®åŠ è½½åˆ° TipTap
- âœ… ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

### 7.1 åŠŸèƒ½å®Œæ•´æ€§

- âœ… æ ‡é¢˜å±‚çº§æ­£ç¡®æå–ï¼ˆH1-H6ï¼‰
- âœ… æ®µè½å¯¹é½æ­£ç¡®æå–ï¼ˆå·¦ã€ä¸­ã€å³ã€ä¸¤ç«¯å¯¹é½ï¼‰
- âœ… æ–‡æœ¬æ ·å¼æ­£ç¡®æå–ï¼ˆé¢œè‰²ã€å­—ä½“ã€å­—å·ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ï¼‰
- âœ… åˆ—è¡¨ç»“æ„æ­£ç¡®æå–ï¼ˆæœ‰åºã€æ— åºï¼‰
- âœ… è¡¨æ ¼ç»“æ„æ­£ç¡®æå–ï¼ˆåŸºç¡€è¡¨æ ¼ï¼‰
- âœ… å›¾ç‰‡æ­£ç¡®æå–å’Œæ˜¾ç¤ºï¼ˆbase64ï¼‰
- âœ… è¶…é“¾æ¥æ­£ç¡®æå–å’Œæ˜¾ç¤º
- âœ… ä¸æ”¯æŒçš„æ ¼å¼æ­£ç¡®è·³è¿‡ï¼ˆä¸ç”Ÿæˆ HTMLï¼‰

### 7.2 ç¼–è¾‘å™¨å…¼å®¹æ€§

- âœ… HTML å†…å®¹æ­£ç¡®åŠ è½½åˆ° TipTap
- âœ… æ‰€æœ‰æ ·å¼æ­£ç¡®æ˜¾ç¤º
- âœ… å›¾ç‰‡æ­£ç¡®æ˜¾ç¤º
- âœ… è¶…é“¾æ¥æ­£ç¡®æ˜¾ç¤º
- âœ… ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### 7.3 æ€§èƒ½æŒ‡æ ‡

- âœ… è½¬æ¢æ—¶é—´ï¼šé¦–æ¬¡ < 10 ç§’ï¼Œç¼“å­˜å < 3 ç§’
- âœ… HTML ç”Ÿæˆæ—¶é—´ï¼š< 1 ç§’
- âœ… ç¼–è¾‘å™¨åŠ è½½æ—¶é—´ï¼š< 1 ç§’

---

## å…«ã€æ³¨æ„äº‹é¡¹

### 8.1 ç‰¹æ®Šå†…å®¹å¤„ç†

- âœ… **å›¾ç‰‡**ï¼šæå–å¹¶è½¬æ¢ä¸º base64ï¼ŒTipTap æ”¯æŒ
- âœ… **è¶…é“¾æ¥**ï¼šæå–å¹¶ç”Ÿæˆæ ‡å‡† HTML `<a>` æ ‡ç­¾ï¼ŒTipTap æ”¯æŒ
- âŒ **å›¾æ ‡/å½¢çŠ¶**ï¼šä¸æå–ï¼ŒTipTap ä¸æ”¯æŒï¼Œæœæ–­æ”¾å¼ƒ
- âŒ **å¤æ‚æ–‡æœ¬æ¡†**ï¼šæå–æ–‡æœ¬å†…å®¹ï¼Œä½œä¸ºæ™®é€šæ®µè½å¤„ç†
- âŒ **é¡µçœ‰é¡µè„š**ï¼šä¸æå–ï¼ŒTipTap ä¸æ”¯æŒ
- âŒ **SmartArtã€VBA å®**ï¼šä¸æå–ï¼ŒTipTap ä¸æ”¯æŒ

### 8.2 æ ·å¼å¤„ç†

- âœ… **AI æ ·å¼å­é›†**ï¼šåªæå–åŸºç¡€æ ·å¼ï¼Œä¸å¤„ç†å¤æ‚æ ·å¼
- âŒ **å¤æ‚æ ·å¼ç»§æ‰¿é“¾**ï¼šä¸å¤„ç†ï¼Œåªæå–ç›´æ¥æ ·å¼
- âŒ **å¤æ‚è¡¨æ ¼æ ¼å¼**ï¼šä¸ä¿ç•™åˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ç­‰

### 8.3 é”™è¯¯å¤„ç†

- âœ… LibreOffice ä¸å¯ç”¨æ—¶ï¼Œæç¤ºå¤±è´¥å¹¶å»ºè®®åˆ›å»ºè‰ç¨¿
- âœ… ODT è§£æå¤±è´¥æ—¶ï¼Œæç¤ºé”™è¯¯ä¿¡æ¯
- âœ… å›¾ç‰‡æå–å¤±è´¥æ—¶ï¼Œè·³è¿‡å›¾ç‰‡ï¼Œç»§ç»­å¤„ç†å…¶ä»–å†…å®¹
- âœ… è¶…é“¾æ¥æå–å¤±è´¥æ—¶ï¼Œæå–ä¸ºæ™®é€šæ–‡æœ¬

---

## ä¹ã€æŠ€æœ¯ä¾èµ–

### 9.1 Rust ä¾èµ–

```toml
[dependencies]
zip = "0.6"           # ODT ZIP è§£æ
quick-xml = "0.31"    # ODT XML è§£æ
base64 = "0.21"       # å›¾ç‰‡ base64 ç¼–ç 
```

### 9.2 å‰ç«¯ä¾èµ–

- TipTap ç¼–è¾‘å™¨ï¼ˆå·²å®‰è£…ï¼‰
- React + TypeScriptï¼ˆå·²å®‰è£…ï¼‰

---

## åã€å½“å‰å®ç°æ›¿æ¢ç­–ç•¥

### 10.1 å½“å‰å®ç°åˆ†æ

**å½“å‰ç¼–è¾‘æ¨¡å¼å®ç°**ï¼š
- åç«¯ï¼š`open_docx` å‘½ä»¤ï¼ˆ`src-tauri/src/commands/file_commands.rs`ï¼‰
  - ä½¿ç”¨ `PandocService::convert_docx_to_html()` è¿›è¡Œ DOCX â†’ HTML è½¬æ¢
  - ä½¿ç”¨ `extract_docx_formatting()` æå–æ ¼å¼ä¿¡æ¯
  - ä½¿ç”¨ `apply_docx_formatting()` åº”ç”¨æ ¼å¼ä¿¡æ¯åˆ° HTML
- å‰ç«¯ï¼š`documentService.ts`
  - ç¼–è¾‘æ¨¡å¼ï¼šè°ƒç”¨ `open_docx` è·å– HTML å†…å®¹
  - é¢„è§ˆæ¨¡å¼ï¼šä½¿ç”¨ `DocxPdfPreview` ç»„ä»¶ï¼ˆå·²åˆ‡æ¢åˆ° LibreOffice + PDF æ–¹æ¡ˆï¼‰
- å…¶ä»–ç»„ä»¶ï¼š
  - `ReadOnlyBanner.tsx`ï¼šç¼–è¾‘æ¨¡å¼åˆ‡æ¢é€»è¾‘ï¼ˆè°ƒç”¨ `open_docx`ï¼‰
  - `DocxPdfPreview.tsx`ï¼šç¼–è¾‘æŒ‰é’®é€»è¾‘ï¼ˆè°ƒç”¨ `open_docx`ï¼‰

**éœ€è¦æ›¿æ¢çš„éƒ¨åˆ†**ï¼š
- âŒ `open_docx` å‘½ä»¤ï¼šä» Pandoc æ–¹æ¡ˆæ”¹ä¸º LibreOffice + ODT æ–¹æ¡ˆ
- âŒ `PandocService::convert_docx_to_html()`ï¼šä¸å†ç”¨äºç¼–è¾‘æ¨¡å¼
- âŒ `extract_docx_formatting()` å’Œ `apply_docx_formatting()`ï¼šä¸å†éœ€è¦ï¼ˆODT è§£æç›´æ¥æå–æ ·å¼ï¼‰

**éœ€è¦ä¿ç•™çš„éƒ¨åˆ†**ï¼š
- âœ… `create_draft_docx` å‘½ä»¤ï¼šå¯ä»¥å¤ç”¨ï¼ˆé€»è¾‘ä¸å˜ï¼‰
- âœ… `save_docx` å‘½ä»¤ï¼šä¿å­˜æ—¶ä»ç„¶ä½¿ç”¨ Pandocï¼ˆHTML â†’ DOCXï¼‰ï¼Œä¿æŒä¸å˜
- âœ… å‰ç«¯ç¼–è¾‘æ¨¡å¼åˆ‡æ¢é€»è¾‘ï¼šéœ€è¦æ›´æ–°è°ƒç”¨ï¼ˆä» `open_docx` æ”¹ä¸º `open_docx_for_edit`ï¼‰

### 10.2 æ›¿æ¢ç­–ç•¥ï¼ˆç¨³å®šä¸”å¹²å‡€ï¼‰

#### é˜¶æ®µ1ï¼šå¹¶è¡Œå®ç°æ–°æ–¹æ¡ˆï¼ˆä¸ç ´åç°æœ‰åŠŸèƒ½ï¼‰

**ç›®æ ‡**ï¼šå®ç°æ–°æ–¹æ¡ˆï¼Œä½†ä¸æ›¿æ¢æ—§æ–¹æ¡ˆï¼Œç¡®ä¿ç°æœ‰åŠŸèƒ½æ­£å¸¸

**ä»»åŠ¡æ¸…å•**ï¼š
1. å®ç° `open_docx_for_edit` å‘½ä»¤ï¼ˆæ–°å‘½ä»¤ï¼Œä¸æ›¿æ¢ `open_docx`ï¼‰
2. å®ç° ODT è§£ææœåŠ¡ï¼ˆ`odt_parser.rs`ï¼‰
3. å®ç° HTML ç”ŸæˆæœåŠ¡ï¼ˆ`html_generator.rs`ï¼‰
4. æ‰©å±• LibreOffice æœåŠ¡ï¼ˆæ·»åŠ  `convert_docx_to_odt` æ–¹æ³•ï¼‰
5. æµ‹è¯•æ–°å‘½ä»¤åŠŸèƒ½ï¼ˆç‹¬ç«‹æµ‹è¯•ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ–°å‘½ä»¤ `open_docx_for_edit` æ­£å¸¸å·¥ä½œ
- âœ… æ—§å‘½ä»¤ `open_docx` ä»ç„¶æ­£å¸¸å·¥ä½œ
- âœ… ç°æœ‰ç¼–è¾‘åŠŸèƒ½ä¸å—å½±å“

#### é˜¶æ®µ2ï¼šå‰ç«¯é€æ­¥åˆ‡æ¢ï¼ˆåŠŸèƒ½å¼€å…³ï¼‰

**ç›®æ ‡**ï¼šå‰ç«¯æ·»åŠ åŠŸèƒ½å¼€å…³ï¼Œé€æ­¥åˆ‡æ¢åˆ°æ–°æ–¹æ¡ˆ

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ·»åŠ åŠŸèƒ½å¼€å…³ï¼ˆç¯å¢ƒå˜é‡æˆ–é…ç½®ï¼‰
   ```typescript
   // src/config/featureFlags.ts
   export const USE_ODT_EDIT_MODE = process.env.VITE_USE_ODT_EDIT_MODE === 'true';
   ```
2. æ›´æ–° `documentService.ts`ï¼šæ ¹æ®å¼€å…³é€‰æ‹©ä½¿ç”¨ `open_docx` æˆ– `open_docx_for_edit`
   ```typescript
   if (USE_ODT_EDIT_MODE) {
     htmlContent = await invoke<string>('open_docx_for_edit', { path: filePath });
   } else {
     htmlContent = await invoke<string>('open_docx', { path: filePath });
   }
   ```
3. æ›´æ–° `ReadOnlyBanner.tsx`ï¼šæ ¹æ®å¼€å…³é€‰æ‹©å‘½ä»¤
4. æ›´æ–° `DocxPdfPreview.tsx`ï¼šæ ¹æ®å¼€å…³é€‰æ‹©å‘½ä»¤
5. æµ‹è¯•åŠŸèƒ½å¼€å…³ï¼ˆé»˜è®¤å…³é—­ï¼Œæ‰‹åŠ¨å¼€å¯æµ‹è¯•ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… åŠŸèƒ½å¼€å…³æ­£å¸¸å·¥ä½œ
- âœ… é»˜è®¤ä½¿ç”¨æ—§æ–¹æ¡ˆï¼ˆ`open_docx`ï¼‰ï¼ŒåŠŸèƒ½æ­£å¸¸
- âœ… å¼€å¯å¼€å…³åä½¿ç”¨æ–°æ–¹æ¡ˆï¼ˆ`open_docx_for_edit`ï¼‰ï¼ŒåŠŸèƒ½æ­£å¸¸

#### é˜¶æ®µ3ï¼šå…¨é¢æµ‹è¯•æ–°æ–¹æ¡ˆï¼ˆç¨³å®šéªŒè¯ï¼‰

**ç›®æ ‡**ï¼šå…¨é¢æµ‹è¯•æ–°æ–¹æ¡ˆï¼Œç¡®ä¿ç¨³å®šæ€§å’Œæ­£ç¡®æ€§

**ä»»åŠ¡æ¸…å•**ï¼š
1. åŠŸèƒ½æµ‹è¯•ï¼šæµ‹è¯•æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½ï¼ˆæ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼ã€å›¾ç‰‡ã€è¶…é“¾æ¥ï¼‰
2. æ ·å¼æµ‹è¯•ï¼šæµ‹è¯•æ‰€æœ‰æ ·å¼æå–ï¼ˆé¢œè‰²ã€å­—ä½“ã€å­—å·ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€å¯¹é½ï¼‰
3. å…¼å®¹æ€§æµ‹è¯•ï¼šæµ‹è¯•ä¸åŒ DOCX æ–‡ä»¶ï¼ˆç®€å•æ ¼å¼ã€å¤æ‚æ ¼å¼ã€åŒ…å«å›¾ç‰‡ã€åŒ…å«è¶…é“¾æ¥ï¼‰
4. æ€§èƒ½æµ‹è¯•ï¼šæµ‹è¯•è½¬æ¢æ—¶é—´ã€HTML ç”Ÿæˆæ—¶é—´ã€ç¼–è¾‘å™¨åŠ è½½æ—¶é—´
5. é”™è¯¯å¤„ç†æµ‹è¯•ï¼šæµ‹è¯• LibreOffice ä¸å¯ç”¨ã€ODT è§£æå¤±è´¥ç­‰é”™è¯¯åœºæ™¯

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… æ‰€æœ‰æ ·å¼æµ‹è¯•é€šè¿‡
- âœ… å…¼å®¹æ€§æµ‹è¯•é€šè¿‡ï¼ˆè‡³å°‘ 90% çš„ DOCX æ–‡ä»¶æ­£ç¡®å¤„ç†ï¼‰
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼ˆè½¬æ¢æ—¶é—´ < 10 ç§’ï¼ŒHTML ç”Ÿæˆ < 1 ç§’ï¼‰
- âœ… é”™è¯¯å¤„ç†æ­£ç¡®

#### é˜¶æ®µ4ï¼šåˆ‡æ¢é»˜è®¤æ–¹æ¡ˆï¼ˆåŠŸèƒ½å¼€å…³é»˜è®¤å¼€å¯ï¼‰

**ç›®æ ‡**ï¼šå°†æ–°æ–¹æ¡ˆè®¾ä¸ºé»˜è®¤ï¼Œä½†ä¿ç•™æ—§æ–¹æ¡ˆä½œä¸ºé™çº§

**ä»»åŠ¡æ¸…å•**ï¼š
1. ä¿®æ”¹åŠŸèƒ½å¼€å…³é»˜è®¤å€¼ï¼š`USE_ODT_EDIT_MODE = true`
2. å…¨é¢æµ‹è¯•ï¼šç¡®ä¿æ–°æ–¹æ¡ˆä½œä¸ºé»˜è®¤æ–¹æ¡ˆæ­£å¸¸å·¥ä½œ
3. ç›‘æ§é”™è¯¯ï¼šæ”¶é›†ç”¨æˆ·åé¦ˆå’Œé”™è¯¯æ—¥å¿—
4. ä¿ç•™æ—§æ–¹æ¡ˆï¼šå¦‚æœæ–°æ–¹æ¡ˆæœ‰é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢å›æ—§æ–¹æ¡ˆ

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ–°æ–¹æ¡ˆä½œä¸ºé»˜è®¤æ–¹æ¡ˆæ­£å¸¸å·¥ä½œ
- âœ… æ—§æ–¹æ¡ˆä»ç„¶å¯ç”¨ï¼ˆä½œä¸ºé™çº§æ–¹æ¡ˆï¼‰
- âœ… é”™è¯¯ç›‘æ§æ­£å¸¸

#### é˜¶æ®µ5ï¼šæ¸…ç†æ—§ä»£ç ï¼ˆç¨³å®šåæ¸…ç†ï¼‰

**ç›®æ ‡**ï¼šæ–°æ–¹æ¡ˆç¨³å®šè¿è¡Œåï¼Œæ¸…ç†æ—§ä»£ç 

**ä»»åŠ¡æ¸…å•**ï¼š
1. ç§»é™¤åŠŸèƒ½å¼€å…³ï¼ˆä¸å†éœ€è¦ï¼‰
2. ç§»é™¤ `open_docx` å‘½ä»¤ï¼ˆç¼–è¾‘æ¨¡å¼ä¸“ç”¨éƒ¨åˆ†ï¼‰
   - âš ï¸ **æ³¨æ„**ï¼š`open_docx` å¯èƒ½è¢«å…¶ä»–åŠŸèƒ½ä½¿ç”¨ï¼Œéœ€è¦æ£€æŸ¥æ‰€æœ‰è°ƒç”¨
   - âš ï¸ **æ³¨æ„**ï¼šå¦‚æœ `open_docx` è¢«é¢„è§ˆæ¨¡å¼ä½¿ç”¨ï¼Œéœ€è¦ä¿ç•™æˆ–é‡æ„
3. ç§»é™¤ `PandocService::convert_docx_to_html()`ï¼ˆç¼–è¾‘æ¨¡å¼ä¸“ç”¨éƒ¨åˆ†ï¼‰
   - âš ï¸ **æ³¨æ„**ï¼šå¦‚æœé¢„è§ˆæ¨¡å¼ä½¿ç”¨ï¼Œéœ€è¦ä¿ç•™æˆ–é‡æ„
4. ç§»é™¤ `extract_docx_formatting()` å’Œ `apply_docx_formatting()`ï¼ˆç¼–è¾‘æ¨¡å¼ä¸“ç”¨éƒ¨åˆ†ï¼‰
   - âš ï¸ **æ³¨æ„**ï¼šå¦‚æœé¢„è§ˆæ¨¡å¼ä½¿ç”¨ï¼Œéœ€è¦ä¿ç•™æˆ–é‡æ„
5. æ›´æ–°æ–‡æ¡£ï¼šæ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼Œç§»é™¤æ—§æ–¹æ¡ˆè¯´æ˜

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ—§ä»£ç å·²æ¸…ç†
- âœ… æ–°æ–¹æ¡ˆæ­£å¸¸å·¥ä½œ
- âœ… æ²¡æœ‰åŠŸèƒ½å›å½’
- âœ… ä»£ç åº“æ›´ç®€æ´

### 10.3 æ›¿æ¢æ³¨æ„äº‹é¡¹

#### 10.3.1 å‘½ä»¤å‘½å

**æ–°å‘½ä»¤**ï¼š`open_docx_for_edit`
- æ˜ç¡®è¡¨ç¤ºç”¨äºç¼–è¾‘æ¨¡å¼
- ä¸é¢„è§ˆæ¨¡å¼å‘½ä»¤ `preview_docx_as_pdf` å‘½åä¸€è‡´

**æ—§å‘½ä»¤**ï¼š`open_docx`
- å¦‚æœè¢«å…¶ä»–åŠŸèƒ½ä½¿ç”¨ï¼Œéœ€è¦æ£€æŸ¥æ‰€æœ‰è°ƒç”¨
- å¦‚æœåªç”¨äºç¼–è¾‘æ¨¡å¼ï¼Œå¯ä»¥ç§»é™¤
- å¦‚æœè¢«é¢„è§ˆæ¨¡å¼ä½¿ç”¨ï¼Œéœ€è¦ä¿ç•™æˆ–é‡æ„

#### 10.3.2 æœåŠ¡å¤ç”¨

**LibreOffice æœåŠ¡**ï¼š
- âœ… é¢„è§ˆæ¨¡å¼å·²ä½¿ç”¨ `LibreOfficeService::convert_docx_to_pdf()`
- âœ… ç¼–è¾‘æ¨¡å¼ä½¿ç”¨ `LibreOfficeService::convert_docx_to_odt()`ï¼ˆæ–°å¢æ–¹æ³•ï¼‰
- âœ… ä¸¤ä¸ªæ–¹æ³•å…±äº«åŒä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œå¤ç”¨è·¯å¾„æ£€æµ‹å’Œç¼“å­˜é€»è¾‘

**Pandoc æœåŠ¡**ï¼š
- âœ… ä¿å­˜æ—¶ä»ç„¶ä½¿ç”¨ `PandocService::convert_html_to_docx()`ï¼ˆä¿æŒä¸å˜ï¼‰
- âŒ ç¼–è¾‘æ¨¡å¼ä¸å†ä½¿ç”¨ `PandocService::convert_docx_to_html()`ï¼ˆç§»é™¤ï¼‰

#### 10.3.3 å‰ç«¯è°ƒç”¨æ›´æ–°

**éœ€è¦æ›´æ–°çš„æ–‡ä»¶**ï¼š
1. `src/services/documentService.ts`
   - ç¼–è¾‘æ¨¡å¼ï¼šä» `open_docx` æ”¹ä¸º `open_docx_for_edit`
2. `src/components/Editor/ReadOnlyBanner.tsx`
   - ç¼–è¾‘æ¨¡å¼åˆ‡æ¢ï¼šä» `open_docx` æ”¹ä¸º `open_docx_for_edit`
3. `src/components/Editor/DocxPdfPreview.tsx`
   - ç¼–è¾‘æŒ‰é’®ï¼šä» `open_docx` æ”¹ä¸º `open_docx_for_edit`

**æ›´æ–°ç­–ç•¥**ï¼š
- ä½¿ç”¨åŠŸèƒ½å¼€å…³ï¼Œé€æ­¥åˆ‡æ¢
- ç¡®ä¿å‘åå…¼å®¹ï¼ˆæ—§æ–¹æ¡ˆä»ç„¶å¯ç”¨ï¼‰

#### 10.3.4 é”™è¯¯å¤„ç†

**LibreOffice ä¸å¯ç”¨**ï¼š
- æç¤ºå¤±è´¥å¹¶å»ºè®®åˆ›å»ºè‰ç¨¿
- ä¸æä¾›é™çº§æ–¹æ¡ˆï¼ˆä¸é™çº§åˆ° Pandocï¼‰

**ODT è§£æå¤±è´¥**ï¼š
- æç¤ºé”™è¯¯ä¿¡æ¯
- ä¸æä¾›é™çº§æ–¹æ¡ˆï¼ˆä¸é™çº§åˆ° Pandocï¼‰

**å›¾ç‰‡æå–å¤±è´¥**ï¼š
- è·³è¿‡å›¾ç‰‡ï¼Œç»§ç»­å¤„ç†å…¶ä»–å†…å®¹
- æ—¥å¿—è®°å½•è·³è¿‡çš„å›¾ç‰‡

**è¶…é“¾æ¥æå–å¤±è´¥**ï¼š
- æå–ä¸ºæ™®é€šæ–‡æœ¬
- æ—¥å¿—è®°å½•å¤±è´¥çš„è¶…é“¾æ¥

### 10.4 æ›¿æ¢æ—¶é—´è¡¨

**é˜¶æ®µ1ï¼šå¹¶è¡Œå®ç°**ï¼ˆ3-5å¤©ï¼‰
- å®ç°æ–°æ–¹æ¡ˆï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½

**é˜¶æ®µ2ï¼šå‰ç«¯åˆ‡æ¢**ï¼ˆ1-2å¤©ï¼‰
- æ·»åŠ åŠŸèƒ½å¼€å…³ï¼Œé€æ­¥åˆ‡æ¢

**é˜¶æ®µ3ï¼šå…¨é¢æµ‹è¯•**ï¼ˆ2-3å¤©ï¼‰
- åŠŸèƒ½æµ‹è¯•ã€æ ·å¼æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•

**é˜¶æ®µ4ï¼šåˆ‡æ¢é»˜è®¤**ï¼ˆ1å¤©ï¼‰
- æ–°æ–¹æ¡ˆè®¾ä¸ºé»˜è®¤ï¼Œä¿ç•™æ—§æ–¹æ¡ˆä½œä¸ºé™çº§

**é˜¶æ®µ5ï¼šæ¸…ç†ä»£ç **ï¼ˆ1-2å¤©ï¼‰
- ç§»é™¤æ—§ä»£ç ï¼Œæ›´æ–°æ–‡æ¡£

**æ€»è®¡**ï¼š8-13 å¤©å®Œæˆæ›¿æ¢

### 10.5 é£é™©æ§åˆ¶

**é£é™©1ï¼šæ–°æ–¹æ¡ˆä¸ç¨³å®š**
- **åº”å¯¹**ï¼šä¿ç•™æ—§æ–¹æ¡ˆä½œä¸ºé™çº§ï¼ŒåŠŸèƒ½å¼€å…³å¯ä»¥å¿«é€Ÿåˆ‡æ¢
- **ç›‘æ§**ï¼šæ”¶é›†é”™è¯¯æ—¥å¿—å’Œç”¨æˆ·åé¦ˆ

**é£é™©2ï¼šæ€§èƒ½é—®é¢˜**
- **åº”å¯¹**ï¼šæ€§èƒ½æµ‹è¯•ï¼Œç¡®ä¿è½¬æ¢æ—¶é—´ < 10 ç§’
- **ä¼˜åŒ–**ï¼šç¼“å­˜æœºåˆ¶ï¼ŒODT æ–‡ä»¶ç¼“å­˜ 1 å°æ—¶

**é£é™©3ï¼šå…¼å®¹æ€§é—®é¢˜**
- **åº”å¯¹**ï¼šå…¼å®¹æ€§æµ‹è¯•ï¼Œç¡®ä¿è‡³å°‘ 90% çš„ DOCX æ–‡ä»¶æ­£ç¡®å¤„ç†
- **å¤„ç†**ï¼šä¸æ”¯æŒçš„æ ¼å¼è·³è¿‡ï¼Œä¸ç”Ÿæˆ HTML

**é£é™©4ï¼šåŠŸèƒ½å›å½’**
- **åº”å¯¹**ï¼šå…¨é¢æµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **éªŒè¯**ï¼šå¯¹æ¯”æµ‹è¯•ï¼Œç¡®ä¿æ–°æ–¹æ¡ˆåŠŸèƒ½ä¸å¼±äºæ—§æ–¹æ¡ˆ

---

## åä¸€ã€å‚è€ƒæ–‡æ¡£

- `DOCXå¤„ç†æŠ€æœ¯æ–¹æ¡ˆ.md`ï¼šæŠ€æœ¯æ–¹æ¡ˆæ¦‚è¿°
- `DOCXé¢„è§ˆæ¨¡å¼å¼€å‘è®¡åˆ’.md`ï¼šé¢„è§ˆæ¨¡å¼å¼€å‘è®¡åˆ’ï¼ˆLibreOffice æœåŠ¡å¤ç”¨ï¼‰
- `Binderäº§å“éœ€æ±‚æ–‡æ¡£.md`ï¼šäº§å“éœ€æ±‚å®šä¹‰
- `æ–‡æ¡£ç¼–è¾‘å™¨å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ.md`ï¼šç¼–è¾‘å™¨æŠ€æœ¯æ–¹æ¡ˆ

