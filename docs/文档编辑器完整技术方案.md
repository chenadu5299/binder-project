# æ–‡æ¡£ç¼–è¾‘å™¨å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**ï¼šv1.0
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-XX
- **çŠ¶æ€**ï¼šğŸ“‹ æŠ€æœ¯æ–¹æ¡ˆ
- **ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„æ–‡æ¡£ç¼–è¾‘å™¨åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼å’Œæ¥æºçš„ç¼–è¾‘/é¢„è§ˆ

---

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

### 1.1 åŠŸèƒ½éœ€æ±‚

#### æ–‡ä»¶ç±»å‹å¤„ç†ç­–ç•¥

| æ–‡ä»¶ç±»å‹ | æ–°å»º | å¤–éƒ¨å¯¼å…¥ | AIç”Ÿæˆ | å¤„ç†æ–¹å¼ |
|---------|------|---------|--------|---------|
| **Markdown (.md)** | âœ… ç›´æ¥ç¼–è¾‘ | âœ… ç›´æ¥ç¼–è¾‘ | âœ… ç›´æ¥ç¼–è¾‘ | æ–‡æœ¬ç¼–è¾‘å™¨ |
| **TXT (.txt)** | âœ… ç›´æ¥ç¼–è¾‘ | âœ… ç›´æ¥ç¼–è¾‘ | âœ… ç›´æ¥ç¼–è¾‘ | æ–‡æœ¬ç¼–è¾‘å™¨ |
| **DOCX (.docx)** | âœ… ç›´æ¥ç¼–è¾‘ | ğŸ” é¢„è§ˆâ†’ç¼–è¾‘ | âœ… ç›´æ¥ç¼–è¾‘ | Pandocè½¬æ¢ + CSSæ ·å¼è¡¨ |
| **PDF (.pdf)** | âŒ ä¸æ”¯æŒ | ğŸ” é¢„è§ˆ | âŒ ä¸æ”¯æŒ | PDFé¢„è§ˆå™¨ |
| **HTML (.html)** | âœ… ç›´æ¥ç¼–è¾‘ | ğŸ” é¢„è§ˆ | âœ… ç›´æ¥ç¼–è¾‘ | HTMLé¢„è§ˆ/ç¼–è¾‘ |
| **å›¾ç‰‡** | âŒ ä¸æ”¯æŒ | ğŸ” é¢„è§ˆ | âŒ ä¸æ”¯æŒ | å›¾ç‰‡é¢„è§ˆå™¨ |

#### å…³é”®åœºæ™¯

1. **DOCX æ–°å»º**ï¼šåˆ›å»ºç©º DOCX æ–‡ä»¶ï¼Œå¯ç›´æ¥ç¼–è¾‘
2. **DOCX AIç”Ÿæˆ**ï¼šAI åˆ›å»º DOCX æ–‡ä»¶ï¼Œå¯ç›´æ¥ç¼–è¾‘ï¼ˆå·²è½¬æ¢ä¸ºå¯ç¼–è¾‘æ ¼å¼ï¼‰
3. **DOCX å¤–éƒ¨å¯¼å…¥**ï¼š
   - é¦–æ¬¡æ‰“å¼€ï¼šé¢„è§ˆæ¨¡å¼ï¼ˆåªè¯»ï¼‰
   - ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼šåˆ›å»ºè‰ç¨¿å‰¯æœ¬ï¼ˆ`document.draft.docx`ï¼‰
   - è‰ç¨¿æ–‡ä»¶ï¼šå¯ç¼–è¾‘æ¨¡å¼

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ–‡æ¡£ç¼–è¾‘å™¨æ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        å‰ç«¯å±‚ (React + TypeScript)                â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ documentServiceâ”‚  â”‚ EditorPanel â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - openFile()  â”‚  â”‚ - æ–‡ä»¶ç±»å‹åˆ¤æ–­â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - saveFile()  â”‚  â”‚ - ç¼–è¾‘/é¢„è§ˆåˆ‡æ¢â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ TipTapEditor â”‚  â”‚ FilePreview  â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - æ–‡æœ¬ç¼–è¾‘    â”‚  â”‚ - PDFé¢„è§ˆ    â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - HTMLç¼–è¾‘   â”‚  â”‚ - å›¾ç‰‡é¢„è§ˆ   â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
â”‚  â”‚  â”‚ ReadOnlyBannerâ”‚                               â”‚   â”‚
â”‚  â”‚  â”‚ - ç¼–è¾‘æŒ‰é’®    â”‚                               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†• IPC                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        åç«¯å±‚ (Rust + Tauri)                      â”‚   â”‚
â”‚  â”‚                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ PandocServiceâ”‚  â”‚ FileCommands â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ - DOCXâ†’HTML  â”‚  â”‚ - open_docx_for_editâ”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - HTMLâ†’DOCX  â”‚  â”‚ - save_docx  â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - create_draftâ”‚            â”‚   â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµè®¾è®¡

#### æ–‡ä»¶æ‰“å¼€æµç¨‹

```
ç”¨æˆ·æ“ä½œï¼ˆåŒå‡»æ–‡ä»¶/æ–°å»ºæ–‡ä»¶/AIç”Ÿæˆï¼‰
  â†“
documentService.openFile(filePath)
  â†“
åˆ¤æ–­æ–‡ä»¶ç±»å‹å’Œæ¥æº
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Markdown/TXT    â”‚ DOCX (æ–°å»º/AI)   â”‚ DOCX (å¤–éƒ¨å¯¼å…¥)  â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ ç›´æ¥è¯»å–æ–‡æœ¬     â”‚ åˆ›å»ºç©ºDOCX/      â”‚ è½¬æ¢ä¸ºHTMLé¢„è§ˆ   â”‚
â”‚ æ‰“å¼€ç¼–è¾‘å™¨       â”‚ è½¬æ¢ä¸ºHTML      â”‚ åªè¯»æ¨¡å¼         â”‚
â”‚                 â”‚ æ‰“å¼€ç¼–è¾‘å™¨       â”‚ æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### DOCX ç¼–è¾‘æµç¨‹ï¼ˆå¤–éƒ¨å¯¼å…¥ï¼‰

```
ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
  â†“
ReadOnlyBanner.handleEnableEdit()
  â†“
è°ƒç”¨ create_draft_docx(originalPath)
  â†“
åç«¯ï¼šå¤åˆ¶åŸæ–‡ä»¶ â†’ document.draft.docx
  â†“
åç«¯ï¼šè½¬æ¢ä¸ºHTMLï¼ˆPandocï¼‰
  â†“
å‰ç«¯ï¼šæ›´æ–°æ ‡ç­¾é¡µè·¯å¾„ä¸ºè‰ç¨¿è·¯å¾„
  â†“
å‰ç«¯ï¼šåŠ è½½HTMLå†…å®¹åˆ°ç¼–è¾‘å™¨
  â†“
å‰ç«¯ï¼šå¯ç”¨ç¼–è¾‘æ¨¡å¼ï¼ˆisReadOnly = falseï¼‰
  â†“
ç”¨æˆ·ç¼–è¾‘ â†’ ä¿å­˜åˆ°è‰ç¨¿æ–‡ä»¶
```

---

## ä¸‰ã€è¯¦ç»†å®ç°æ–¹æ¡ˆ

### 3.1 æ–‡ä»¶ç±»å‹åˆ¤æ–­ä¸å¤„ç†ç­–ç•¥

#### 3.1.1 æ–‡ä»¶ç±»å‹æšä¸¾

```typescript
// src/types/file.ts
export type FileType = 
  | 'markdown'  // .md
  | 'text'      // .txt
  | 'docx'      // .docx
  | 'html'      // .html
  | 'pdf'       // .pdf
  | 'image';    // .png, .jpg, etc.

export type FileSource = 
  | 'new'           // æ–°å»º
  | 'external'      // å¤–éƒ¨å¯¼å…¥
  | 'ai_generated'; // AIç”Ÿæˆ
```

#### 3.1.2 æ–‡ä»¶æ‰“å¼€ç­–ç•¥è¡¨

```typescript
// src/services/documentService.ts

interface FileOpenStrategy {
  fileType: FileType;
  source: FileSource;
  canEdit: boolean;
  previewMode: boolean;
  requiresConversion: boolean;
}

const FILE_OPEN_STRATEGIES: Record<FileType, Record<FileSource, FileOpenStrategy>> = {
  markdown: {
    new: { fileType: 'markdown', source: 'new', canEdit: true, previewMode: false, requiresConversion: false },
    external: { fileType: 'markdown', source: 'external', canEdit: true, previewMode: false, requiresConversion: false },
    ai_generated: { fileType: 'markdown', source: 'ai_generated', canEdit: true, previewMode: false, requiresConversion: false },
  },
  text: {
    new: { fileType: 'text', source: 'new', canEdit: true, previewMode: false, requiresConversion: false },
    external: { fileType: 'text', source: 'external', canEdit: true, previewMode: false, requiresConversion: false },
    ai_generated: { fileType: 'text', source: 'ai_generated', canEdit: true, previewMode: false, requiresConversion: false },
  },
  docx: {
    new: { fileType: 'docx', source: 'new', canEdit: true, previewMode: false, requiresConversion: true },
    external: { fileType: 'docx', source: 'external', canEdit: false, previewMode: true, requiresConversion: true },
    ai_generated: { fileType: 'docx', source: 'ai_generated', canEdit: true, previewMode: false, requiresConversion: true },
  },
  html: {
    new: { fileType: 'html', source: 'new', canEdit: true, previewMode: false, requiresConversion: false },
    external: { fileType: 'html', source: 'external', canEdit: true, previewMode: true, requiresConversion: false },
    ai_generated: { fileType: 'html', source: 'ai_generated', canEdit: true, previewMode: false, requiresConversion: false },
  },
  pdf: {
    new: { fileType: 'pdf', source: 'new', canEdit: false, previewMode: true, requiresConversion: false },
    external: { fileType: 'pdf', source: 'external', canEdit: false, previewMode: true, requiresConversion: false },
    ai_generated: { fileType: 'pdf', source: 'ai_generated', canEdit: false, previewMode: true, requiresConversion: false },
  },
  image: {
    new: { fileType: 'image', source: 'new', canEdit: false, previewMode: true, requiresConversion: false },
    external: { fileType: 'image', source: 'external', canEdit: false, previewMode: true, requiresConversion: false },
    ai_generated: { fileType: 'image', source: 'ai_generated', canEdit: false, previewMode: true, requiresConversion: false },
  },
};
```

### 3.2 æ–‡ä»¶æ¥æºè¯†åˆ«

#### 3.2.1 è¯†åˆ«æ–¹æ³•

```typescript
// src/services/documentService.ts

/**
 * è¯†åˆ«æ–‡ä»¶æ¥æº
 * @param filePath æ–‡ä»¶è·¯å¾„
 * @param context ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
 */
async function detectFileSource(
  filePath: string,
  context?: { isNewFile?: boolean; isAIGenerated?: boolean }
): Promise<FileSource> {
  // 1. æ£€æŸ¥ä¸Šä¸‹æ–‡æ ‡è®°
  if (context?.isNewFile) {
    return 'new';
  }
  
  if (context?.isAIGenerated) {
    return 'ai_generated';
  }
  
  // 2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæ–°åˆ›å»ºï¼ˆé€šè¿‡æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼‰
  // å¦‚æœæ–‡ä»¶åœ¨æœ€è¿‘1åˆ†é’Ÿå†…åˆ›å»ºï¼Œå¯èƒ½æ˜¯æ–°å»ºæˆ–AIç”Ÿæˆ
  try {
    const modifiedTime = await invoke<number>('get_file_modified_time', { path: filePath });
    const now = Date.now();
    const oneMinuteAgo = now - 60 * 1000;
    
    if (modifiedTime > oneMinuteAgo) {
      // æ£€æŸ¥æ˜¯å¦æ˜¯è‰ç¨¿æ–‡ä»¶ï¼ˆAIç”Ÿæˆçš„æ–‡ä»¶é€šå¸¸ä¸æ˜¯è‰ç¨¿ï¼‰
      if (filePath.includes('.draft.')) {
        return 'external'; // è‰ç¨¿æ–‡ä»¶æ¥è‡ªå¤–éƒ¨å¯¼å…¥
      }
      
      // æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦åŒ…å«AIç”Ÿæˆæ ‡è®°ï¼ˆå¯é€‰ï¼‰
      // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„æ£€æµ‹é€»è¾‘
      return 'ai_generated'; // é»˜è®¤è®¤ä¸ºæ˜¯AIç”Ÿæˆ
    }
  } catch (error) {
    console.warn('æ£€æµ‹æ–‡ä»¶æ¥æºå¤±è´¥:', error);
  }
  
  // 3. é»˜è®¤è®¤ä¸ºæ˜¯å¤–éƒ¨å¯¼å…¥
  return 'external';
}
```

#### 3.2.2 æ–‡ä»¶æ‰“å¼€æ¥å£ä¼˜åŒ–

```typescript
// src/services/documentService.ts

export const documentService = {
  /**
   * æ‰“å¼€æ–‡ä»¶
   * @param filePath æ–‡ä»¶è·¯å¾„
   * @param options å¯é€‰å‚æ•°
   */
  async openFile(
    filePath: string,
    options?: {
      source?: FileSource;  // æ˜¾å¼æŒ‡å®šæ¥æº
      forceEdit?: boolean;  // å¼ºåˆ¶ç¼–è¾‘æ¨¡å¼
    }
  ): Promise<void> {
    try {
      // 1. è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´
      let lastModifiedTime: number;
      try {
        lastModifiedTime = await invoke<number>('get_file_modified_time', { path: filePath });
      } catch (error) {
        console.warn('è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´å¤±è´¥ï¼Œä½¿ç”¨å½“å‰æ—¶é—´:', error);
        lastModifiedTime = Date.now();
      }
      
      // 2. è¯†åˆ«æ–‡ä»¶ç±»å‹
      const fileType = getFileType(filePath);
      
      // 3. è¯†åˆ«æ–‡ä»¶æ¥æºï¼ˆå¦‚æœæœªæ˜¾å¼æŒ‡å®šï¼‰
      const source = options?.source || await detectFileSource(filePath);
      
      // 4. è·å–æ‰“å¼€ç­–ç•¥
      const strategy = FILE_OPEN_STRATEGIES[fileType]?.[source];
      if (!strategy) {
        throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹æˆ–æ¥æº: ${fileType} / ${source}`);
      }
      
      // 5. æ ¹æ®ç­–ç•¥æ‰“å¼€æ–‡ä»¶
      await this.openFileWithStrategy(filePath, strategy, lastModifiedTime, options);
      
    } catch (error) {
      console.error('æ‰“å¼€æ–‡ä»¶å¤±è´¥:', error);
      throw error;
    }
  },
  
  /**
   * æ ¹æ®ç­–ç•¥æ‰“å¼€æ–‡ä»¶
   */
  async openFileWithStrategy(
    filePath: string,
    strategy: FileOpenStrategy,
    lastModifiedTime: number,
    options?: { forceEdit?: boolean }
  ): Promise<void> {
    const fileName = filePath.split('/').pop() || 'æœªå‘½å';
    const { fileType, canEdit, previewMode, requiresConversion } = strategy;
    const forceEdit = options?.forceEdit || false;
    
    // åˆ¤æ–­æ˜¯å¦ä¸ºè‰ç¨¿æ–‡ä»¶
    const isDraft = filePath.includes('.draft.');
    
    switch (fileType) {
      case 'markdown':
      case 'text': {
        // Markdown å’Œ TXTï¼šç›´æ¥è¯»å–æ–‡æœ¬
        const content = await invoke<string>('read_file_content', { path: filePath });
        useEditorStore.getState().addTab(
          filePath,
          fileName,
          content,
          false, // isReadOnly
          isDraft,
          lastModifiedTime
        );
        break;
      }
      
      case 'html': {
        // HTMLï¼šè¯»å–å†…å®¹
        const content = await invoke<string>('read_file_content', { path: filePath });
        useEditorStore.getState().addTab(
          filePath,
          fileName,
          content,
          previewMode && !forceEdit, // å¤–éƒ¨å¯¼å…¥çš„HTMLé»˜è®¤é¢„è§ˆ
          isDraft,
          lastModifiedTime
        );
        break;
      }
      
      case 'docx': {
        if (requiresConversion) {
          try {
            // ä½¿ç”¨ Pandoc è½¬æ¢ä¸º HTML
            const htmlContent = await invoke<string>('open_docx_for_edit', { path: filePath });
            
            // åˆ¤æ–­æ˜¯å¦å¯ç¼–è¾‘
            const isReadOnly = previewMode && !forceEdit && !isDraft;
            
            useEditorStore.getState().addTab(
              filePath,
              fileName,
              htmlContent,
              isReadOnly,
              isDraft,
              lastModifiedTime
            );
          } catch (error) {
            // Pandoc è½¬æ¢å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
            const errorMessage = error instanceof Error ? error.message : String(error);
            const placeholder = this.createErrorPlaceholder(fileName, errorMessage);
            useEditorStore.getState().addTab(
              filePath,
              fileName,
              placeholder,
              true, // åªè¯»æ¨¡å¼
              isDraft,
              lastModifiedTime
            );
          }
        }
        break;
      }
      
      case 'pdf':
      case 'image': {
        // PDF å’Œå›¾ç‰‡ï¼šé¢„è§ˆæ¨¡å¼
        useEditorStore.getState().addTab(
          filePath,
          fileName,
          '', // é¢„è§ˆæ–‡ä»¶ä¸éœ€è¦å†…å®¹
          true, // åªè¯»æ¨¡å¼
          isDraft,
          lastModifiedTime
        );
        break;
      }
    }
  },
  
  /**
   * åˆ›å»ºé”™è¯¯å ä½ç¬¦
   */
  createErrorPlaceholder(fileName: string, errorMessage: string): string {
    return `<div style="padding: 20px; text-align: center; color: #666;">
      <h2>æ–‡ä»¶é¢„è§ˆå¤±è´¥</h2>
      <p>æ–‡ä»¶ï¼š${fileName}</p>
      <p style="margin-top: 20px; color: #999;">
        ${errorMessage}<br/>
        è¯·ç¡®ä¿å·²å®‰è£… Pandocï¼Œæˆ–æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€‚
      </p>
    </div>`;
  },
};
```

### 3.3 DOCX æ–‡ä»¶å¤„ç†è¯¦ç»†æµç¨‹

#### 3.3.1 DOCX æ–°å»ºæµç¨‹

```typescript
// æ–‡ä»¶æ ‘æ–°å»ºæŒ‰é’® â†’ create_file('document.docx', 'docx')
// 
// åç«¯å¤„ç†ï¼š
// 1. åˆ›å»ºç©º DOCX æ–‡ä»¶ï¼ˆä½¿ç”¨ Pandoc å°†ç©º HTML è½¬æ¢ä¸º DOCXï¼‰
// 2. è¿”å›æ–‡ä»¶è·¯å¾„
//
// å‰ç«¯å¤„ç†ï¼š
// 1. è°ƒç”¨ documentService.openFile(filePath, { source: 'new' })
// 2. æ£€æµ‹åˆ° source='new'ï¼Œstrategy.canEdit=true
// 3. è°ƒç”¨ open_docx_for_edit è½¬æ¢ä¸º HTMLï¼ˆä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥ï¼‰
// 4. ä»¥å¯ç¼–è¾‘æ¨¡å¼æ‰“å¼€ï¼ˆisReadOnly=falseï¼‰
```

#### 3.3.2 DOCX AIç”Ÿæˆæµç¨‹

```typescript
// AI å·¥å…·è°ƒç”¨ create_file â†’ 
// åç«¯æ£€æµ‹åˆ° .docx æ‰©å±•å â†’
// ä½¿ç”¨ Pandoc å°†å†…å®¹ï¼ˆHTML/Markdownï¼‰è½¬æ¢ä¸º DOCX â†’
// è¿”å›æˆåŠŸ
//
// å‰ç«¯å¤„ç†ï¼š
// 1. æ–‡ä»¶æ ‘åˆ·æ–°ï¼Œæ˜¾ç¤ºæ–°æ–‡ä»¶
// 2. ç”¨æˆ·åŒå‡»æ‰“å¼€
// 3. è°ƒç”¨ documentService.openFile(filePath)
// 4. æ£€æµ‹åˆ°æ–‡ä»¶åœ¨æœ€è¿‘1åˆ†é’Ÿå†…åˆ›å»º â†’ source='ai_generated'
// 5. strategy.canEdit=true
// 6. è°ƒç”¨ open_docx_for_edit è½¬æ¢ä¸º HTMLï¼ˆä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥ï¼‰
// 7. ä»¥å¯ç¼–è¾‘æ¨¡å¼æ‰“å¼€ï¼ˆisReadOnly=falseï¼‰
```

#### 3.3.3 DOCX å¤–éƒ¨å¯¼å…¥æµç¨‹

```typescript
// ç”¨æˆ·ä»æ–‡ä»¶ç³»ç»Ÿæ‹–æ‹½æˆ–å¯¼å…¥ DOCX æ–‡ä»¶ â†’
// æ–‡ä»¶æ ‘æ˜¾ç¤ºæ–‡ä»¶ â†’
// ç”¨æˆ·åŒå‡»æ‰“å¼€
//
// å‰ç«¯å¤„ç†ï¼š
// 1. è°ƒç”¨ documentService.openFile(filePath)
// 2. æ£€æµ‹åˆ°æ–‡ä»¶ä¸æ˜¯æ–°åˆ›å»º â†’ source='external'
// 3. strategy.canEdit=false, previewMode=true
// 4. è°ƒç”¨ open_docx_for_edit è½¬æ¢ä¸º HTMLï¼ˆä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥ï¼‰
// 5. ä»¥åªè¯»æ¨¡å¼æ‰“å¼€ï¼ˆisReadOnly=trueï¼‰
// 6. æ˜¾ç¤º ReadOnlyBannerï¼ˆåŒ…å«"ç¼–è¾‘"æŒ‰é’®ï¼‰
//
// ç”¨æˆ·ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼š
// 1. ReadOnlyBanner.handleEnableEdit()
// 2. è°ƒç”¨ create_draft_docx(originalPath)
// 3. åç«¯ï¼šå¤åˆ¶åŸæ–‡ä»¶ â†’ document.draft.docx
// 4. åç«¯ï¼šè½¬æ¢ä¸º HTMLï¼ˆPandocï¼‰
// 5. å‰ç«¯ï¼šæ›´æ–°æ ‡ç­¾é¡µè·¯å¾„ä¸ºè‰ç¨¿è·¯å¾„
// 6. å‰ç«¯ï¼šåŠ è½½ HTML å†…å®¹åˆ°ç¼–è¾‘å™¨
// 7. å‰ç«¯ï¼šå¯ç”¨ç¼–è¾‘æ¨¡å¼ï¼ˆisReadOnly=falseï¼‰
```

#### 3.3.4 è‰ç¨¿æ–‡ä»¶åˆ›å»ºå®ç°

```rust
// src-tauri/src/commands/file_commands.rs

#[tauri::command]
pub async fn create_draft_docx(original_path: String) -> Result<String, String> {
    let original = PathBuf::from(&original_path);
    
    if !original.exists() {
        return Err(format!("åŸæ–‡ä»¶ä¸å­˜åœ¨: {}", original_path));
    }
    
    // ç”Ÿæˆè‰ç¨¿æ–‡ä»¶è·¯å¾„ï¼šdocument.docx -> document.draft.docx
    let parent = original.parent()
        .ok_or_else(|| "æ— æ³•è·å–æ–‡ä»¶çˆ¶ç›®å½•".to_string())?;
    let stem = original.file_stem()
        .and_then(|s| s.to_str())
        .ok_or_else(|| "æ— æ³•è·å–æ–‡ä»¶å".to_string())?;
    
    let draft_path = parent.join(format!("{}.draft.docx", stem));
    
    // å¦‚æœè‰ç¨¿æ–‡ä»¶å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
    if draft_path.exists() {
        std::fs::remove_file(&draft_path)
            .map_err(|e| format!("åˆ é™¤å·²å­˜åœ¨çš„è‰ç¨¿æ–‡ä»¶å¤±è´¥: {}", e))?;
    }
    
    // å¤åˆ¶åŸæ–‡ä»¶åˆ°è‰ç¨¿æ–‡ä»¶
    std::fs::copy(&original, &draft_path)
        .map_err(|e| format!("åˆ›å»ºè‰ç¨¿æ–‡ä»¶å¤±è´¥: {}", e))?;
    
    // æ³¨æ„ï¼šè‰ç¨¿æ–‡ä»¶ä¿æŒåŸæ ¼å¼ï¼Œä¸éœ€è¦ç«‹å³è½¬æ¢
    // è½¬æ¢åœ¨æ‰“å¼€æ—¶è¿›è¡Œï¼ˆopen_docx_for_editï¼‰
    
    Ok(draft_path.to_string_lossy().to_string())
}
```

### 3.4 ç¼–è¾‘å™¨ç»„ä»¶æ¸²æŸ“é€»è¾‘

#### 3.4.1 EditorPanel æ¸²æŸ“ç­–ç•¥

```typescript
// src/components/Editor/EditorPanel.tsx

const getFileType = (filePath: string): FileType => {
  const ext = filePath.split('.').pop()?.toLowerCase();
  if (ext === 'md') return 'markdown';
  if (ext === 'txt') return 'text';
  if (ext === 'docx') return 'docx';
  if (ext === 'html') return 'html';
  if (ext === 'pdf') return 'pdf';
  if (['png', 'jpg', 'jpeg', 'gif', 'webp', 'svg'].includes(ext || '')) return 'image';
  return 'text';
};

// æ¸²æŸ“é€»è¾‘
{activeTab ? (() => {
  const fileType = getFileType(activeTab.filePath);
  
  // PDF å’Œå›¾ç‰‡ï¼šä½¿ç”¨é¢„è§ˆç»„ä»¶
  if (fileType === 'pdf' || fileType === 'image') {
    return (
      <div className="h-full overflow-hidden">
        <FilePreview filePath={activeTab.filePath} fileType={fileType} />
      </div>
    );
  }
  
  // DOCX å’Œ HTMLï¼ˆåªè¯»æ¨¡å¼ï¼‰ï¼šHTML é¢„è§ˆ
  if ((fileType === 'docx' || fileType === 'html') && activeTab.isReadOnly) {
    return (
      <div className="h-full overflow-y-auto p-4">
        <div 
          className="prose dark:prose-invert max-w-none"
          dangerouslySetInnerHTML={{ __html: activeTab.content }}
        />
      </div>
    );
  }
  
  // å…¶ä»–æ–‡ä»¶ï¼šä½¿ç”¨ç¼–è¾‘å™¨
  return (
    <div className="h-full overflow-hidden relative">
      <TipTapEditor
        content={activeTab.content}
        onChange={handleContentChange}
        onSave={handleSave}
        editable={!activeTab.isReadOnly}
        onEditorReady={handleEditorReady}
        tabId={activeTab.id}
      />
      {/* ... */}
    </div>
  );
})() : null}
```

### 3.5 æ–‡ä»¶ä¿å­˜é€»è¾‘

#### 3.5.1 ä¿å­˜ç­–ç•¥

```typescript
// src/services/documentService.ts

async saveFile(filePath: string, content: string): Promise<void> {
  try {
    const ext = filePath.split('.').pop()?.toLowerCase();
    
    if (ext === 'docx') {
      // DOCX æ–‡ä»¶ï¼šä½¿ç”¨ Pandoc è½¬æ¢ HTML â†’ DOCX
      await invoke('save_docx', { path: filePath, htmlContent: content });
    } else {
      // å…¶ä»–æ–‡ä»¶ï¼šç›´æ¥ä¿å­˜æ–‡æœ¬å†…å®¹
      await invoke('write_file', { path: filePath, content });
    }
  } catch (error) {
    console.error('ä¿å­˜æ–‡ä»¶å¤±è´¥:', error);
    throw error;
  }
}
```

#### 3.5.2 ä¿å­˜è¿›åº¦ç›‘å¬

```typescript
// src/components/Editor/EditorPanel.tsx

useEffect(() => {
  const setupSaveProgressListener = async () => {
    try {
      const unlisten = await listen<SaveProgressEvent>('fs-save-progress', (event) => {
        const { file_path, status, progress, error } = event.payload;
        
        // åªå¤„ç†å½“å‰æ ‡ç­¾é¡µçš„æ–‡ä»¶
        if (activeTab && activeTab.filePath === file_path) {
          if (status === 'started') {
            setTabSaving(activeTab.id, true);
            toast.info('å¼€å§‹ä¿å­˜æ–‡ä»¶...');
          } else if (status === 'converting') {
            toast.info(`æ­£åœ¨è½¬æ¢æ ¼å¼... ${progress}%`);
          } else if (status === 'completed') {
            setTabSaving(activeTab.id, false);
            markTabSaved(activeTab.id);
            toast.success('æ–‡ä»¶ä¿å­˜æˆåŠŸ');
          } else if (status === 'failed') {
            setTabSaving(activeTab.id, false);
            toast.error(`ä¿å­˜å¤±è´¥: ${error || 'æœªçŸ¥é”™è¯¯'}`);
          }
        }
      });
      
      return unlisten;
    } catch (error) {
      console.error('åˆå§‹åŒ–ä¿å­˜è¿›åº¦ç›‘å¬å¤±è´¥:', error);
      return () => {};
    }
  };
  
  let unlistenFn: (() => void) | null = null;
  setupSaveProgressListener().then(unlisten => {
    unlistenFn = unlisten;
  });
  
  return () => {
    if (unlistenFn) {
      unlistenFn();
    }
  };
}, [activeTab, setTabSaving, markTabSaved]);
```

---

## å››ã€å…³é”®æ¥å£å®šä¹‰

### 4.1 åç«¯ Tauri å‘½ä»¤

```rust
// src-tauri/src/commands/file_commands.rs

/// æ‰“å¼€ DOCX æ–‡ä»¶å¹¶è½¬æ¢ä¸º HTMLï¼ˆç”¨äºé¢„è§ˆï¼‰
#[tauri::command]
pub async fn open_docx_for_edit(path: String) -> Result<String, String>;

/// åˆ›å»º DOCX æ–‡ä»¶çš„è‰ç¨¿å‰¯æœ¬
/// è¿”å›è‰ç¨¿æ–‡ä»¶è·¯å¾„
#[tauri::command]
pub async fn create_draft_docx(original_path: String) -> Result<String, String>;

/// ä¿å­˜ DOCX æ–‡ä»¶ï¼ˆå°† HTML å†…å®¹è½¬æ¢ä¸º DOCXï¼‰
#[tauri::command]
pub async fn save_docx(
    path: String,
    html_content: String,
    app: tauri::AppHandle
) -> Result<(), String>;
```

### 4.2 å‰ç«¯æœåŠ¡æ¥å£

```typescript
// src/services/documentService.ts

export const documentService = {
  /**
   * æ‰“å¼€æ–‡ä»¶
   * @param filePath æ–‡ä»¶è·¯å¾„
   * @param options å¯é€‰å‚æ•°
   */
  async openFile(
    filePath: string,
    options?: {
      source?: FileSource;
      forceEdit?: boolean;
    }
  ): Promise<void>;

  /**
   * ä¿å­˜æ–‡ä»¶
   * @param filePath æ–‡ä»¶è·¯å¾„
   * @param content æ–‡ä»¶å†…å®¹ï¼ˆHTML/æ–‡æœ¬ï¼‰
   */
  async saveFile(filePath: string, content: string): Promise<void>;
};
```

### 4.3 ç¼–è¾‘å™¨çŠ¶æ€æ¥å£

```typescript
// src/stores/editorStore.ts

export interface EditorTab {
  id: string;
  filePath: string;
  fileName: string;
  content: string;           // HTML/æ–‡æœ¬æ ¼å¼çš„å†…å®¹
  lastSavedContent: string;
  isDirty: boolean;
  isSaving: boolean;
  isReadOnly: boolean;        // æ˜¯å¦åªè¯»æ¨¡å¼
  isDraft: boolean;           // æ˜¯å¦ä¸ºè‰ç¨¿æ–‡ä»¶
  lastModifiedTime: number;   // æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
  editor: Editor | null;        // TipTap Editor å®ä¾‹
}
```

---

## äº”ã€å®ç°æ£€æŸ¥æ¸…å•

### 5.1 åç«¯å®ç°

- [x] **PandocService æ‰©å±•**
  - [x] `convert_docx_to_html()` - DOCX â†’ HTML
  - [x] `convert_html_to_docx()` - HTML â†’ DOCX
  - [x] Pandoc å¯ç”¨æ€§æ£€æµ‹

- [x] **Tauri å‘½ä»¤å®ç°**
  - [x] `open_docx_for_edit()` - æ‰“å¼€ DOCX æ–‡ä»¶ï¼ˆä¸‰å±‚æ ·å¼å¤„ç†ç­–ç•¥ï¼‰
  - [x] `create_draft_docx()` - åˆ›å»ºè‰ç¨¿å‰¯æœ¬
  - [x] `save_docx()` - ä¿å­˜ DOCX æ–‡ä»¶ï¼ˆå«è¿›åº¦äº‹ä»¶ï¼‰

- [x] **å·¥å…·è°ƒç”¨ä¼˜åŒ–**
  - [x] `create_file` æ£€æµ‹ DOCX æ‰©å±•å
  - [x] DOCX æ–‡ä»¶ä½¿ç”¨ Pandoc è½¬æ¢

### 5.2 å‰ç«¯å®ç°

- [x] **documentService ä¼˜åŒ–**
  - [x] æ–‡ä»¶ç±»å‹åˆ¤æ–­
  - [x] æ–‡ä»¶æ¥æºè¯†åˆ«
  - [x] æ‰“å¼€ç­–ç•¥è¡¨
  - [x] DOCX é¢„è§ˆæ”¯æŒ
  - [x] DOCX ä¿å­˜æ”¯æŒ

- [x] **EditorPanel æ›´æ–°**
  - [x] DOCX é¢„è§ˆæ¨¡å¼æ¸²æŸ“
  - [x] HTML é¢„è§ˆæ¨¡å¼æ¸²æŸ“
  - [x] æ–‡ä»¶ç±»å‹åˆ¤æ–­é€»è¾‘

- [x] **ReadOnlyBanner æ›´æ–°**
  - [x] ç¼–è¾‘æŒ‰é’®åŠŸèƒ½
  - [x] è‰ç¨¿æ–‡ä»¶åˆ›å»º
  - [x] ç¼–è¾‘æ¨¡å¼åˆ‡æ¢

- [ ] **æ–‡ä»¶æ¥æºè¯†åˆ«**ï¼ˆå¾…å®ç°ï¼‰
  - [ ] `detectFileSource()` å‡½æ•°
  - [ ] æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ£€æµ‹
  - [ ] AI ç”Ÿæˆæ ‡è®°æ£€æµ‹

- [ ] **ä¿å­˜è¿›åº¦ç›‘å¬**ï¼ˆå¾…å®ç°ï¼‰
  - [ ] `fs-save-progress` äº‹ä»¶ç›‘å¬
  - [ ] è¿›åº¦æ˜¾ç¤º UI
  - [ ] é”™è¯¯å¤„ç†

### 5.3 æµ‹è¯•åœºæ™¯

- [ ] **Markdown æ–‡ä»¶**
  - [ ] æ–°å»º â†’ ç›´æ¥ç¼–è¾‘
  - [ ] å¤–éƒ¨å¯¼å…¥ â†’ ç›´æ¥ç¼–è¾‘
  - [ ] AI ç”Ÿæˆ â†’ ç›´æ¥ç¼–è¾‘

- [ ] **TXT æ–‡ä»¶**
  - [ ] æ–°å»º â†’ ç›´æ¥ç¼–è¾‘
  - [ ] å¤–éƒ¨å¯¼å…¥ â†’ ç›´æ¥ç¼–è¾‘
  - [ ] AI ç”Ÿæˆ â†’ ç›´æ¥ç¼–è¾‘

- [ ] **DOCX æ–‡ä»¶**
  - [ ] æ–°å»º â†’ ç›´æ¥ç¼–è¾‘
  - [ ] AI ç”Ÿæˆ â†’ ç›´æ¥ç¼–è¾‘
  - [ ] å¤–éƒ¨å¯¼å…¥ â†’ é¢„è§ˆ â†’ ç‚¹å‡»ç¼–è¾‘ â†’ è‰ç¨¿åˆ›å»º â†’ ç¼–è¾‘

- [ ] **PDF æ–‡ä»¶**
  - [ ] å¤–éƒ¨å¯¼å…¥ â†’ é¢„è§ˆï¼ˆåŠŸèƒ½å®Œå¥½ï¼‰

- [ ] **HTML æ–‡ä»¶**
  - [ ] æ–°å»º â†’ ç›´æ¥ç¼–è¾‘
  - [ ] å¤–éƒ¨å¯¼å…¥ â†’ é¢„è§ˆ/ç¼–è¾‘
  - [ ] AI ç”Ÿæˆ â†’ ç›´æ¥ç¼–è¾‘

---

## å…­ã€é”™è¯¯å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ

### 6.1 Pandoc ä¸å¯ç”¨

**åœºæ™¯**ï¼šç³»ç»Ÿæœªå®‰è£… Pandoc

**å¤„ç†æ–¹æ¡ˆ**ï¼š
1. æ£€æµ‹ Pandoc å¯ç”¨æ€§ï¼ˆ`PandocService::is_available()`ï¼‰
2. æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
3. æä¾›å®‰è£…æŒ‡å—é“¾æ¥

**é”™è¯¯æç¤º**ï¼š
```typescript
"Pandoc ä¸å¯ç”¨ï¼Œè¯·å®‰è£… Pandoc ä»¥æ”¯æŒ DOCX æ–‡ä»¶ã€‚\nè®¿é—® https://pandoc.org/installing.html è·å–å®‰è£…æŒ‡å—ã€‚"
```

### 6.2 DOCX æ–‡ä»¶æŸå

**åœºæ™¯**ï¼šDOCX æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–æŸå

**å¤„ç†æ–¹æ¡ˆ**ï¼š
1. Pandoc è½¬æ¢å¤±è´¥æ—¶æ•è·é”™è¯¯
2. æ˜¾ç¤ºé”™è¯¯å ä½ç¬¦
3. æç¤ºç”¨æˆ·æ–‡ä»¶å¯èƒ½æŸå

### 6.3 è‰ç¨¿æ–‡ä»¶å·²å­˜åœ¨

**åœºæ™¯**ï¼šç”¨æˆ·å¤šæ¬¡ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®

**å¤„ç†æ–¹æ¡ˆ**ï¼š
1. æ£€æµ‹è‰ç¨¿æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. å¦‚æœå­˜åœ¨ï¼Œå…ˆåˆ é™¤å†åˆ›å»º
3. æˆ–ç›´æ¥ä½¿ç”¨å·²å­˜åœ¨çš„è‰ç¨¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

### 6.4 å¤§æ–‡ä»¶å¤„ç†

**åœºæ™¯**ï¼šDOCX æ–‡ä»¶è¿‡å¤§ï¼ˆ>10MBï¼‰

**å¤„ç†æ–¹æ¡ˆ**ï¼š
1. è½¬æ¢å‰æ£€æŸ¥æ–‡ä»¶å¤§å°
2. å¤§æ–‡ä»¶æ˜¾ç¤ºè­¦å‘Š
3. æä¾›å–æ¶ˆé€‰é¡¹
4. è½¬æ¢è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¿›åº¦

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 è½¬æ¢ç¼“å­˜

**ä¼˜åŒ–ç‚¹**ï¼šç›¸åŒ DOCX æ–‡ä»¶å¤šæ¬¡æ‰“å¼€æ—¶ï¼Œç¼“å­˜è½¬æ¢ç»“æœ

**å®ç°æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨æ–‡ä»¶è·¯å¾„ + ä¿®æ”¹æ—¶é—´ä½œä¸ºç¼“å­˜é”®
const cacheKey = `${filePath}_${lastModifiedTime}`;
if (conversionCache.has(cacheKey)) {
  return conversionCache.get(cacheKey);
}
```

### 7.2 å¼‚æ­¥è½¬æ¢

**ä¼˜åŒ–ç‚¹**ï¼šDOCX è½¬æ¢æ˜¯è€—æ—¶æ“ä½œï¼Œä½¿ç”¨å¼‚æ­¥å¤„ç†

**å®ç°æ–¹æ¡ˆ**ï¼š
- åç«¯ï¼šä½¿ç”¨ `async/await` å¤„ç†è½¬æ¢
- å‰ç«¯ï¼šæ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œä¸é˜»å¡ UI

### 7.3 è¿›åº¦åé¦ˆ

**ä¼˜åŒ–ç‚¹**ï¼šé•¿è€—æ—¶æ“ä½œæä¾›è¿›åº¦åé¦ˆ

**å®ç°æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `fs-save-progress` äº‹ä»¶
- æ˜¾ç¤ºè¿›åº¦æ¡æˆ– Toast æç¤º

---

## å…«ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 8.1 ç¼–è¾‘æŒ‰é’®ä½ç½®

**ä½ç½®**ï¼šReadOnlyBanner ç»„ä»¶ä¸­ï¼Œæ–‡ä»¶é¢„è§ˆåŒºåŸŸé¡¶éƒ¨

**æ ·å¼**ï¼š
- è“è‰²æŒ‰é’®ï¼Œå¸¦ç¼–è¾‘å›¾æ ‡
- æ‚¬åœæ•ˆæœ
- æ¸…æ™°çš„æ–‡å­—è¯´æ˜

### 8.2 è‰ç¨¿æ–‡ä»¶æ ‡è¯†

**æ ‡è¯†æ–¹å¼**ï¼š
- æ ‡ç­¾é¡µæ ‡é¢˜æ˜¾ç¤º `[è‰ç¨¿]` å‰ç¼€
- æ–‡ä»¶æ ‘ä¸­æ˜¾ç¤º `.draft.docx` åç¼€
- å·¥å…·æ æ˜¾ç¤ºè‰ç¨¿çŠ¶æ€

### 8.3 ä¿å­˜æç¤º

**æç¤ºå†…å®¹**ï¼š
- ä¿å­˜è¿›åº¦ï¼ˆè½¬æ¢ä¸­...ï¼‰
- ä¿å­˜æˆåŠŸ/å¤±è´¥æç¤º
- è‰ç¨¿æ–‡ä»¶ä¿å­˜ä½ç½®æç¤º

---

## ä¹ã€åç»­æ‰©å±•

### 9.1 è‰ç¨¿æ–‡ä»¶ç®¡ç†

**åŠŸèƒ½**ï¼š
- è‰ç¨¿æ–‡ä»¶åˆ—è¡¨
- ä¸€é”®æ¸…ç†æœªä½¿ç”¨çš„è‰ç¨¿
- è‰ç¨¿ä¸åŸæ–‡ä»¶å…³è”æ˜¾ç¤º

### 9.2 æ ¼å¼è½¬æ¢å¢å¼º

**åŠŸèƒ½**ï¼š
- æ”¯æŒæ›´å¤šæ ¼å¼ï¼ˆRTFã€ODT ç­‰ï¼‰
- æ‰¹é‡è½¬æ¢
- è½¬æ¢é€‰é¡¹é…ç½®

### 9.3 åä½œåŠŸèƒ½

**åŠŸèƒ½**ï¼š
- è‰ç¨¿æ–‡ä»¶å…±äº«
- ç‰ˆæœ¬å¯¹æ¯”
- åˆå¹¶æ›´æ”¹

---

## åã€æ€»ç»“

### 10.1 æ ¸å¿ƒè¦ç‚¹

1. **æ–‡ä»¶ç±»å‹ç­–ç•¥**ï¼šä¸åŒæ–‡ä»¶ç±»å‹å’Œæ¥æºé‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥
2. **DOCX ç‰¹æ®Šå¤„ç†**ï¼šå¤–éƒ¨å¯¼å…¥çš„ DOCX éœ€è¦é¢„è§ˆâ†’ç¼–è¾‘æµç¨‹
3. **è‰ç¨¿æœºåˆ¶**ï¼šå¤æ‚æ ¼å¼æ–‡ä»¶ä½¿ç”¨è‰ç¨¿å‰¯æœ¬è¿›è¡Œç¼–è¾‘
4. **Pandoc é›†æˆ**ï¼šæ‰€æœ‰ DOCX è½¬æ¢ä¾èµ– Pandoc

### 10.2 å®ç°çŠ¶æ€

- âœ… **åç«¯æ ¸å¿ƒåŠŸèƒ½**ï¼šå·²å®Œæˆ
- âœ… **å‰ç«¯æ ¸å¿ƒåŠŸèƒ½**ï¼šå·²å®Œæˆ
- âš ï¸ **æ–‡ä»¶æ¥æºè¯†åˆ«**ï¼šå¾…ä¼˜åŒ–
- âš ï¸ **ä¿å­˜è¿›åº¦ç›‘å¬**ï¼šå¾…å®ç°
- âš ï¸ **æµ‹è¯•éªŒè¯**ï¼šå¾…å®Œæˆ

### 10.3 å…³é”®ä¾èµ–

- **Pandoc**ï¼šä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿå®‰è£…ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨å†…ç½®ç‰ˆæœ¬
  - ç³»ç»Ÿ Pandocï¼šé€šè¿‡ `which pandoc` æŸ¥æ‰¾
  - å†…ç½® Pandocï¼šä» `resources/bin/` ç›®å½•åŠ è½½
  - è¯¦è§ï¼š`src-tauri/resources/bin/PANDOC_SETUP.md`
- **Tauri 2.0**ï¼šæ¡Œé¢åº”ç”¨æ¡†æ¶
- **TipTap**ï¼šå¯Œæ–‡æœ¬ç¼–è¾‘å™¨

### 10.4 Pandoc å†…ç½®æ–¹æ¡ˆ

#### 10.4.1 å®ç°åŸç†

1. **ä¼˜å…ˆçº§ç­–ç•¥**ï¼š
   - ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šç³»ç»Ÿå®‰è£…çš„ Pandocï¼ˆé€šè¿‡ `which pandoc` æŸ¥æ‰¾ï¼‰
   - ç¬¬äºŒä¼˜å…ˆçº§ï¼šå†…ç½® Pandocï¼ˆä»èµ„æºç›®å½•åŠ è½½ï¼‰

2. **æŸ¥æ‰¾è·¯å¾„**ï¼š
   - å¼€å‘æ¨¡å¼ï¼š`src-tauri/resources/bin/pandoc`
   - macOS æ‰“åŒ…åï¼š`Binder.app/Contents/Resources/bin/pandoc`
   - Windows/Linux æ‰“åŒ…åï¼š`bin/pandoc`ï¼ˆç›¸å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶ï¼‰

3. **å¹³å°æ”¯æŒ**ï¼š
   - macOSï¼š`pandoc`ï¼ˆéœ€è¦æ‰§è¡Œæƒé™ï¼‰
   - Windowsï¼š`pandoc.exe`
   - Linuxï¼š`pandoc`ï¼ˆéœ€è¦æ‰§è¡Œæƒé™ï¼‰

#### 10.4.2 é…ç½®æ­¥éª¤

1. **è·å– Pandoc äºŒè¿›åˆ¶æ–‡ä»¶**ï¼š
   - ä» [Pandoc å®˜ç½‘](https://github.com/jgm/pandoc/releases) ä¸‹è½½
   - æˆ–ä»ç³»ç»Ÿå®‰è£…ä½ç½®å¤åˆ¶

2. **æ”¾ç½®æ–‡ä»¶**ï¼š
   ```
   src-tauri/resources/bin/
   â”œâ”€â”€ pandoc          # macOS/Linux
   â””â”€â”€ pandoc.exe      # Windows
   ```

3. **è®¾ç½®æƒé™**ï¼ˆLinux/macOSï¼‰ï¼š
   ```bash
   chmod +x src-tauri/resources/bin/pandoc
   ```

4. **é…ç½® tauri.conf.json**ï¼š
   ```json
   {
     "bundle": {
       "resources": [
         "resources/bin/**"
       ]
     }
   }
   ```

#### 10.4.3 ä¼˜åŠ¿

- âœ… **é›¶é…ç½®**ï¼šç”¨æˆ·æ— éœ€æ‰‹åŠ¨å®‰è£… Pandoc
- âœ… **å‘åå…¼å®¹**ï¼šä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿç‰ˆæœ¬ï¼ˆå¯èƒ½æ›´æ–°ï¼‰
- âœ… **è·¨å¹³å°**ï¼šæ”¯æŒ macOSã€Windowsã€Linux
- âœ… **è‡ªåŠ¨é™çº§**ï¼šç³»ç»Ÿç‰ˆæœ¬ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨å†…ç½®ç‰ˆæœ¬

#### 10.4.4 æ³¨æ„äº‹é¡¹

- âš ï¸ **æ–‡ä»¶å¤§å°**ï¼šPandoc äºŒè¿›åˆ¶æ–‡ä»¶è¾ƒå¤§ï¼ˆçº¦ 50-100MBï¼‰ï¼Œä¼šå¢åŠ åº”ç”¨ä½“ç§¯
- âš ï¸ **å¹³å°ç‰¹å®š**ï¼šéœ€è¦ä¸ºæ¯ä¸ªç›®æ ‡å¹³å°å‡†å¤‡å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶
- âš ï¸ **ç‰ˆæœ¬ç®¡ç†**ï¼šå»ºè®®ä½¿ç”¨ Pandoc 2.x æˆ–æ›´é«˜ç‰ˆæœ¬

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1  
**æœ€åæ›´æ–°**ï¼š2025-01-XX  
**ç»´æŠ¤è€…**ï¼šç¼–è¾‘å™¨ç»„