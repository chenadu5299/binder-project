# 日志查看和调试指南

## 问题
- 终端服务器看不到日志（后台运行）
- 浏览器控制台日志有限
- 文档编辑功能无法正常工作

## 解决方案

### 1. 在前台运行开发服务器（推荐）

停止后台进程，在前台运行以查看实时日志：

```bash
cd /Users/chenzhenqiang/Desktop/test/binder-project
npm run tauri:dev
```

这样可以看到：
- ✅ Rust 编译日志
- ✅ 后端 `eprintln!` 输出（包括文档编辑功能的详细日志）
- ✅ Vite 开发服务器日志
- ✅ 错误和警告信息

### 2. 使用日志查看脚本

运行脚本查看日志文件：

```bash
cd /Users/chenzhenqiang/Desktop/test/binder-project
./查看日志.sh
```

### 3. 查看系统日志（macOS）

```bash
# 查看最近5分钟的日志
log show --predicate 'process == "binder"' --last 5m --style compact

# 查看文档编辑相关的日志
log show --predicate 'process == "binder" AND eventMessage CONTAINS "edit_current_editor_document"' --last 10m
```

### 4. 浏览器控制台

打开浏览器开发者工具（F12），查看：
- Console 标签：前端日志
- Network 标签：API 请求和响应
- Sources 标签：调试断点

## 文档编辑功能调试

### 关键日志点

#### 后端日志（Rust）
- `📝 已增强 edit_current_editor_document 参数` - 参数增强成功
- `📝 [edit_current_editor_document] 开始处理文档编辑请求` - 开始处理
- `📝 [edit_current_editor_document] 当前文件: ...` - 文件路径
- `📝 [edit_current_editor_document] 计算完成，共 X 个 diff` - Diff 计算完成
- `✅ [edit_current_editor_document] 文档编辑处理完成` - 处理成功

#### 前端日志（浏览器控制台）
- `📝 [前端] 检测到 edit_current_editor_document 工具调用` - 检测到工具调用
- `📝 [前端] 文档编辑数据:` - 显示编辑数据
- `✅ [前端] 用户确认编辑` - 用户确认
- `❌ [前端] 用户拒绝编辑` - 用户拒绝

### 常见问题排查

#### 1. 工具调用没有触发
- 检查浏览器控制台是否有错误
- 检查后端日志是否收到工具调用
- 确认当前编辑器有打开的文件

#### 2. 参数缺失
- 检查后端日志：`📝 已增强 edit_current_editor_document 参数`
- 如果缺少 `current_file` 或 `current_content`，检查前端是否正确传递

#### 3. Diff 计算失败
- 检查后端日志：`❌ [edit_current_editor_document] 计算 diff 失败`
- 可能是内容过大（>10MB）或格式问题

#### 4. 前端没有显示 Diff 预览
- 检查浏览器控制台：`📝 [前端] 检测到 edit_current_editor_document 工具调用`
- 检查 `toolResult?.data` 是否包含 `diffs`
- 检查 `DocumentDiffView` 组件是否正确渲染

## 快速调试步骤

1. **停止后台进程**：
   ```bash
   pkill -f "tauri|vite"
   ```

2. **在前台运行**：
   ```bash
   cd /Users/chenzhenqiang/Desktop/test/binder-project
   npm run tauri:dev
   ```

3. **测试文档编辑功能**：
   - 打开一个文件
   - 在 AI 聊天中请求编辑文档
   - 观察终端日志和浏览器控制台

4. **查看详细日志**：
   - 终端：后端日志（Rust）
   - 浏览器控制台：前端日志（JavaScript）

## 日志级别

- `📝` - 信息日志（正常流程）
- `✅` - 成功操作
- `❌` - 错误
- `⚠️` - 警告

---

**提示**：如果功能无法正常工作，请在前台运行开发服务器，这样可以看到完整的日志输出。

