# Binder AI åŠŸèƒ½ä¸‰å±‚æ¶æ„è®¾è®¡

## æ–‡æ¡£ç›®çš„

æ˜ç¡® Binder åº”ç”¨ä¸­ä¸‰ç§ AI åŠŸèƒ½çš„è¾¹ç•Œã€å®ç°æ–¹å¼å’Œäº¤äº’é€»è¾‘ï¼Œç¡®ä¿æ¶æ„æ¸…æ™°ã€å®ç°ç‹¬ç«‹ã€‚

**æ³¨æ„**ï¼šæ™ºèƒ½å…³è”ä¿®æ”¹åŠŸèƒ½ï¼ˆåŸå±‚æ¬¡ä¸‰ï¼‰å·²æ”¾å¼ƒï¼Œä¸å†å¼€å‘ã€‚

---

## ä¸€ã€ä¸‰å±‚æ¶æ„æ¦‚è§ˆ

Binder çš„ AI åŠŸèƒ½åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„å±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡æœ‰æ˜ç¡®çš„èŒè´£å’Œè¾¹ç•Œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚æ¬¡ä¸€ï¼šè‡ªåŠ¨è¡¥å…¨ï¼ˆè‡ªåŠ¨ç»­å†™ï¼‰                              â”‚
â”‚  - æ—  UI çª—å£ï¼Œå¹½çµæ–‡å­—æ˜¾ç¤º                                â”‚
â”‚  - è‡ªåŠ¨è§¦å‘ï¼ˆå…‰æ ‡é™æ­¢ï¼‰                                    â”‚
â”‚  - ç±»ä¼¼ä»£ç è¡¥å…¨ä½“éªŒ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚æ¬¡äºŒï¼šInline Assistï¼ˆCmd+K å¿«æ·é”®ï¼‰                    â”‚
â”‚  - ç‹¬ç«‹è¾“å…¥æ¡†ï¼ˆéèŠå¤©çª—å£ï¼‰                                 â”‚
â”‚  - å¿«æ·é”®è°ƒå‡º                                              â”‚
â”‚  - åé¦ˆç›´æ¥ä¿®æ”¹æ–‡æœ¬åŒºåŸŸ                                     â”‚
â”‚  - æ— å¯¹è¯å†å²                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚æ¬¡ä¸‰ï¼šå³ä¾§èŠå¤©çª—å£                                       â”‚
â”‚  - å®Œæ•´èŠå¤©ç•Œé¢                                             â”‚
â”‚  - æ ‡ç­¾æ ã€è®°å¿†åº“ã€æ¨¡å‹é€‰æ‹©                                 â”‚
â”‚  - å¯¹è¯å†å²ã€å·¥å…·è°ƒç”¨                                       â”‚
â”‚  - å¯æ‹–æ‹½ã€å¯å…³é—­                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€å±‚æ¬¡ä¸€ï¼šè‡ªåŠ¨è¡¥å…¨ï¼ˆè‡ªåŠ¨ç»­å†™ï¼‰

### 2.1 åŠŸèƒ½å®šä½

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… **æ—  UI çª—å£**ï¼šä¸å ç”¨ä»»ä½•é¢æ¿ç©ºé—´
- âœ… **è‡ªåŠ¨è§¦å‘**ï¼šç”¨æˆ·æ— éœ€ä¸»åŠ¨è°ƒç”¨
- âœ… **å¹½çµæ–‡å­—**ï¼šåœ¨å…‰æ ‡åæ–¹æ˜¾ç¤ºåŠé€æ˜çš„ç»­å†™å†…å®¹
- âœ… **éä¾µå…¥å¼**ï¼šä¸æ‰“æ–­ç”¨æˆ·å†™ä½œæµç¨‹

**ç±»æ¯”**ï¼š
- ç±»ä¼¼ VS Code çš„ä»£ç è¡¥å…¨
- ç±»ä¼¼ GitHub Copilot çš„ä»£ç å»ºè®®
- ç±»ä¼¼ Gmail çš„æ™ºèƒ½æ’°å†™

### 2.2 è§¦å‘æœºåˆ¶

**è§¦å‘æ¡ä»¶**ï¼š
- å…‰æ ‡åœ¨æ–‡æ¡£ä¸­**é™æ­¢ä¸åŠ¨**ï¼ˆæ— è¾“å…¥ã€æ— ç§»åŠ¨ï¼‰
- é™æ­¢æ—¶é—´è¾¾åˆ°é˜ˆå€¼ï¼š**7 ç§’**ï¼ˆå¯é…ç½®ï¼ŒèŒƒå›´ 5-15 ç§’ï¼‰
- å…‰æ ‡ä½ç½®æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ï¼ˆè‡³å°‘ 100 å­—ç¬¦ï¼‰
- å…‰æ ‡ä½ç½®ä¸æ˜¯æ–‡æ¡£æœ«å°¾ï¼ˆæœ«å°¾ä¸ç»­å†™ï¼‰
- ç”¨æˆ·æœªè¾“å…¥æ–°å†…å®¹
- ç”¨æˆ·æœªç§»åŠ¨å…‰æ ‡

**è§¦å‘é€»è¾‘**ï¼š
```typescript
// src/hooks/useAutoComplete.ts
export const useAutoComplete = (editor: Editor | null) => {
  const [ghostText, setGhostText] = useState<string | null>(null);
  const idleTimerRef = useRef<NodeJS.Timeout | null>(null);
  const IDLE_THRESHOLD = 7000; // 7ç§’ï¼ˆå¯é…ç½®ï¼ŒèŒƒå›´ 5-15 ç§’ï¼‰
  
  useEffect(() => {
    if (!editor) return;
    
    // ç›‘å¬å…‰æ ‡ä½ç½®å˜åŒ–
    const handleSelectionUpdate = () => {
      // é‡ç½®è®¡æ—¶å™¨
      if (idleTimerRef.current) {
        clearTimeout(idleTimerRef.current);
        setGhostText(null); // æ¸…é™¤ä¹‹å‰çš„å¹½çµæ–‡å­—
      }
      
      // å¼€å§‹æ–°çš„è®¡æ—¶
      idleTimerRef.current = setTimeout(async () => {
        const { from } = editor.state.selection;
        
        // è·å–å…‰æ ‡å‰çš„ä¸Šä¸‹æ–‡ï¼ˆå‰ 2000 å­—ç¬¦ï¼‰
        const contextStart = Math.max(0, from - 2000);
        const contextBefore = editor.state.doc.textBetween(contextStart, from);
        
        // è°ƒç”¨ AI ç”Ÿæˆç»­å†™
        const completion = await invoke<string>('ai_autocomplete', {
          context: contextBefore,
          position: from,
          maxLength: 50, // é™åˆ¶é•¿åº¦
        });
        
        if (completion) {
          setGhostText(completion);
        }
      }, IDLE_THRESHOLD);
    };
    
    // ç›‘å¬è¾“å…¥äº‹ä»¶ï¼ˆé‡ç½®è®¡æ—¶å™¨ï¼‰
    const handleUpdate = () => {
      if (idleTimerRef.current) {
        clearTimeout(idleTimerRef.current);
        setGhostText(null);
      }
    };
    
    editor.on('selectionUpdate', handleSelectionUpdate);
    editor.on('update', handleUpdate);
    
    return () => {
      editor.off('selectionUpdate', handleSelectionUpdate);
      editor.off('update', handleUpdate);
      if (idleTimerRef.current) {
        clearTimeout(idleTimerRef.current);
      }
    };
  }, [editor]);
  
  return { ghostText };
};
```

### 2.3 UI å®ç°

**å¹½çµæ–‡å­—æ˜¾ç¤º**ï¼š
- ä½ç½®ï¼šå…‰æ ‡æ­£åæ–¹
- æ ·å¼ï¼šåŠé€æ˜ç°è‰²æ–‡å­—ï¼ˆopacity: 0.4ï¼‰
- å­—ä½“ï¼šä¸ç¼–è¾‘å™¨å­—ä½“ç›¸åŒ
- é•¿åº¦ï¼šå»ºè®® 20-50 å­—ç¬¦ï¼ˆä¸è¶…è¿‡ä¸€è¡Œï¼‰

```typescript
// src/components/Editor/GhostText.tsx
export const GhostText: React.FC<{ text: string; position: number }> = ({ text, position }) => {
  if (!text) return null;
  
  return (
    <span 
      className="ghost-text"
      style={{
        opacity: 0.4,
        color: '#6b7280',
        fontStyle: 'italic',
        pointerEvents: 'none',
      }}
    >
      {text}
    </span>
  );
};
```

**äº¤äº’æ–¹å¼**ï¼š
- **Tab é”®**ï¼šæ¥å—è¡¥å…¨ï¼Œæ’å…¥å¹½çµæ–‡å­—
- **ç»§ç»­è¾“å…¥**ï¼šè‡ªåŠ¨æ¸…é™¤å¹½çµæ–‡å­—
- **Esc é”®**ï¼šæ‰‹åŠ¨æ¸…é™¤å¹½çµæ–‡å­—
- **å…‰æ ‡ç§»åŠ¨**ï¼šè‡ªåŠ¨æ¸…é™¤å¹½çµæ–‡å­—

**æ€§èƒ½è¦æ±‚**ï¼š
- å“åº”æ—¶é—´ï¼š< 2 ç§’ï¼ˆä»è§¦å‘åˆ°æ˜¾ç¤ºç»­å†™å†…å®¹ï¼‰
- ä¸é˜»å¡ç¼–è¾‘å™¨æ“ä½œ
- ä½¿ç”¨å¿«é€Ÿæ¨¡å‹ï¼ˆGPT-3.5ã€Claude Haiku ç­‰ï¼‰
- é™åˆ¶ç”Ÿæˆé•¿åº¦ï¼ˆ20-50 å­—ç¬¦ï¼‰
- é˜²æŠ–æœºåˆ¶ï¼ˆ7 ç§’è§¦å‘ä¸€æ¬¡ï¼‰

### 2.4 åç«¯å®ç°

**Rust åç«¯æ¥å£**ï¼š
```rust
// src-tauri/src/services/ai_service.rs

#[tauri::command]
pub async fn ai_autocomplete(
    context: String,
    position: usize,
    max_length: usize,
) -> Result<Option<String>, String> {
    // æ„å»ºæç¤ºè¯ï¼ˆç®€æ´ï¼Œåªç”¨äºç»­å†™ï¼‰
    let prompt = format!(
        "åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ï¼Œç»­å†™æ¥ä¸‹æ¥çš„å†…å®¹ï¼ˆä¸è¶…è¿‡{}å­—ï¼‰ï¼š\n\n{}",
        max_length,
        context
    );
    
    // è°ƒç”¨ AIï¼ˆä½¿ç”¨å¿«é€Ÿæ¨¡å‹ï¼Œå¦‚ GPT-3.5 æˆ–æœ¬åœ°å°æ¨¡å‹ï¼‰
    let response = ai_service
        .complete_fast(&prompt, max_length)
        .await?;
    
    Ok(Some(response))
}
```

### 2.5 è¾¹ç•Œå’Œé™åˆ¶

**ä¸å…±äº«çš„å†…å®¹**ï¼š
- âŒ ä¸å…±äº«èŠå¤©å†å²
- âŒ ä¸å…±äº«å¯¹è¯ä¸Šä¸‹æ–‡
- âŒ ä¸æ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­

**å…±äº«çš„å†…å®¹**ï¼š
- âœ… å½“å‰æ–‡æ¡£å†…å®¹ï¼ˆä½œä¸ºä¸Šä¸‹æ–‡ï¼‰
- âœ… ç³»ç»Ÿæç¤ºè¯ï¼ˆ"ä½ æ˜¯ä¸€ä¸ªå†™ä½œåŠ©æ‰‹"ï¼‰
- âœ… AI æ¨¡å‹é…ç½®ï¼ˆä½†ä¼˜å…ˆä½¿ç”¨å¿«é€Ÿæ¨¡å‹ï¼‰

**æ€§èƒ½è€ƒè™‘**ï¼š
- ä½¿ç”¨å¿«é€Ÿæ¨¡å‹ï¼ˆGPT-3.5ã€Claude Haiku ç­‰ï¼‰
- é™åˆ¶ç”Ÿæˆé•¿åº¦ï¼ˆ20-50 å­—ç¬¦ï¼‰
- é˜²æŠ–æœºåˆ¶ï¼ˆ7 ç§’è§¦å‘ä¸€æ¬¡ï¼‰

---

## ä¸‰ã€å±‚æ¬¡äºŒï¼šInline Assistï¼ˆCmd+K å¿«æ·é”®ï¼‰

### 3.1 åŠŸèƒ½å®šä½

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… **ç‹¬ç«‹è¾“å…¥æ¡†**ï¼šä¸æ˜¯èŠå¤©çª—å£ï¼Œæ˜¯æµ®åŠ¨çš„è¾“å…¥æ¡†
- âœ… **å¿«æ·é”®è°ƒå‡º**ï¼šåªèƒ½é€šè¿‡ Cmd+Kï¼ˆæˆ– Ctrl+Kï¼‰æ¿€æ´»
- âœ… **ç›´æ¥ä¿®æ”¹æ–‡æœ¬**ï¼šåé¦ˆç›´æ¥åº”ç”¨åˆ°é€‰ä¸­çš„æ–‡æœ¬åŒºåŸŸ
- âœ… **æ— å¯¹è¯å†å²**ï¼šæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¿å­˜å†å²

**ç±»æ¯”**ï¼š
- ç±»ä¼¼ VS Code çš„ Quick Fixï¼ˆCmd+.ï¼‰
- ç±»ä¼¼ Cursor çš„ Cmd+K åŠŸèƒ½
- ç±»ä¼¼ Notion çš„ / å‘½ä»¤

### 3.2 è§¦å‘æœºåˆ¶

**è§¦å‘æ¡ä»¶**ï¼š
- ç”¨æˆ·**é€‰ä¸­æ–‡æœ¬**ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ä¸é€‰ï¼‰
- æŒ‰ä¸‹ **Cmd+K**ï¼ˆmacOSï¼‰æˆ– **Ctrl+K**ï¼ˆWindows/Linuxï¼‰
- åœ¨å…‰æ ‡ä½ç½®æˆ–é€‰ä¸­æ–‡æœ¬ä½ç½®æ˜¾ç¤ºè¾“å…¥æ¡†

**è§¦å‘é€»è¾‘**ï¼š
```typescript
// src/hooks/useInlineAssist.ts
export const useInlineAssist = (editor: Editor | null) => {
  const [isOpen, setIsOpen] = useState(false);
  const [selectedText, setSelectedText] = useState<string>('');
  const [inputValue, setInputValue] = useState('');
  const inputRef = useRef<HTMLInputElement>(null);
  
  useEffect(() => {
    if (!editor) return;
    
    const handleKeyDown = (event: KeyboardEvent) => {
      // Cmd+K æˆ– Ctrl+K
      if (event.key === 'k' && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        
        // è·å–é€‰ä¸­çš„æ–‡æœ¬
        const { from, to } = editor.state.selection;
        const selected = editor.state.doc.textBetween(from, to);
        
        setSelectedText(selected);
        setIsOpen(true);
        
        // èšç„¦è¾“å…¥æ¡†
        setTimeout(() => {
          inputRef.current?.focus();
        }, 0);
      }
    };
    
    window.addEventListener('keydown', handleKeyDown);
    
    return () => {
      window.removeEventListener('keydown', handleKeyDown);
    };
  }, [editor]);
  
  const handleExecute = async () => {
    if (!inputValue.trim()) return;
    
    // è°ƒç”¨ AI å¤„ç†
    const result = await invoke<string>('ai_inline_assist', {
      instruction: inputValue,
      selectedText: selectedText,
      context: getEditorContext(editor),
    });
    
    // ç›´æ¥åº”ç”¨åˆ°æ–‡æœ¬åŒºåŸŸ
    if (selectedText) {
      // æ›¿æ¢é€‰ä¸­çš„æ–‡æœ¬
      editor.chain()
        .focus()
        .deleteSelection()
        .insertContent(result)
        .run();
    } else {
      // åœ¨å…‰æ ‡ä½ç½®æ’å…¥
      editor.chain()
        .focus()
        .insertContent(result)
        .run();
    }
    
    // å…³é—­è¾“å…¥æ¡†
    setIsOpen(false);
    setInputValue('');
  };
  
  return {
    isOpen,
    selectedText,
    inputValue,
    setInputValue,
    inputRef,
    handleExecute,
    setIsOpen,
  };
};
```

### 3.3 UI å®ç°

**è¾“å…¥æ¡†ç»„ä»¶**ï¼š
- ä½ç½®ï¼šåœ¨é€‰ä¸­æ–‡æœ¬ä¸‹æ–¹æˆ–å…‰æ ‡ä½ç½®é™„è¿‘
- æ ·å¼ï¼šæµ®åŠ¨è¾“å…¥æ¡†ï¼Œå¸¦è¾¹æ¡†å’Œé˜´å½±
- å†…å®¹ï¼šå•è¡Œè¾“å…¥æ¡† + æ‰§è¡ŒæŒ‰é’®

```typescript
// src/components/Editor/InlineAssistInput.tsx
export const InlineAssistInput: React.FC<{
  isOpen: boolean;
  selectedText: string;
  inputValue: string;
  setInputValue: (value: string) => void;
  inputRef: React.RefObject<HTMLInputElement>;
  onExecute: () => void;
  onClose: () => void;
}> = ({ isOpen, selectedText, inputValue, setInputValue, inputRef, onExecute, onClose }) => {
  if (!isOpen) return null;
  
  return (
    <div className="inline-assist-input" style={{
      position: 'absolute',
      zIndex: 1000,
      background: 'white',
      border: '1px solid #e5e7eb',
      borderRadius: '8px',
      padding: '12px',
      boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
      minWidth: '400px',
    }}>
      {selectedText && (
        <div className="selected-text-preview" style={{
          marginBottom: '8px',
          padding: '8px',
          background: '#f3f4f6',
          borderRadius: '4px',
          fontSize: '14px',
          color: '#6b7280',
        }}>
          é€‰ä¸­æ–‡æœ¬ï¼š{selectedText.substring(0, 50)}...
        </div>
      )}
      
      <div className="input-group" style={{ display: 'flex', gap: '8px' }}>
        <input
          ref={inputRef}
          type="text"
          value={inputValue}
          onChange={(e) => setInputValue(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === 'Enter') {
              onExecute();
            } else if (e.key === 'Escape') {
              onClose();
            }
          }}
          placeholder="è¾“å…¥æŒ‡ä»¤ï¼Œå¦‚ï¼šæ”¹å¾—æ›´æ­£å¼ã€ç¿»è¯‘æˆè‹±æ–‡ã€æ€»ç»“è¿™æ®µæ–‡å­—..."
          style={{
            flex: 1,
            padding: '8px',
            border: '1px solid #d1d5db',
            borderRadius: '4px',
          }}
        />
        <button
          onClick={onExecute}
          style={{
            padding: '8px 16px',
            background: '#3b82f6',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        >
          æ‰§è¡Œ
        </button>
        <button
          onClick={onClose}
          style={{
            padding: '8px',
            background: 'transparent',
            border: 'none',
            cursor: 'pointer',
          }}
        >
          âœ•
        </button>
      </div>
      
      <div className="hint" style={{
        marginTop: '8px',
        fontSize: '12px',
        color: '#9ca3af',
      }}>
        æŒ‰ Enter æ‰§è¡Œï¼ŒEsc å–æ¶ˆ
      </div>
    </div>
  );
};
```

**Diff è§†å›¾ï¼ˆå¯é€‰ï¼‰**ï¼š
- å¦‚æœæ˜¯æŒ‡ä»¤ä¿®æ”¹æ–‡æœ¬ï¼Œå¯ä»¥æ˜¾ç¤º Diff è§†å›¾
- çº¢åˆ ç»¿å¢ï¼Œå¯¹æ¯”ä¿®æ”¹å‰å
- ç”¨æˆ·ç¡®è®¤ååº”ç”¨

### 3.4 åç«¯å®ç°

**Rust åç«¯æ¥å£**ï¼š
```rust
// src-tauri/src/services/ai_service.rs

#[tauri::command]
pub async fn ai_inline_assist(
    instruction: String,
    selected_text: String,
    context: String,
) -> Result<String, String> {
    // æ„å»ºæç¤ºè¯
    let prompt = if selected_text.is_empty() {
        format!(
            "åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼š{}\n\nä¸Šä¸‹æ–‡ï¼š\n{}",
            instruction,
            context
        )
    } else {
        format!(
            "å¯¹ä»¥ä¸‹æ–‡æœ¬æ‰§è¡ŒæŒ‡ä»¤ï¼š{}\n\næ–‡æœ¬ï¼š\n{}\n\nä¸Šä¸‹æ–‡ï¼š\n{}",
            instruction,
            selected_text,
            context
        )
    };
    
    // è°ƒç”¨ AI
    let response = ai_service
        .complete(&prompt)
        .await?;
    
    Ok(response)
}
```

### 3.5 è¾¹ç•Œå’Œé™åˆ¶

**ä¸å…±äº«çš„å†…å®¹**ï¼š
- âŒ ä¸å…±äº«èŠå¤©å†å²
- âŒ ä¸æ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­
- âŒ ä¸ä¿å­˜å¯¹è¯è®°å½•

**å…±äº«çš„å†…å®¹**ï¼š
- âœ… å½“å‰æ–‡æ¡£å†…å®¹ï¼ˆä½œä¸ºä¸Šä¸‹æ–‡ï¼‰
- âœ… é€‰ä¸­æ–‡æœ¬ï¼ˆä½œä¸ºè¾“å…¥ï¼‰
- âœ… ç³»ç»Ÿæç¤ºè¯
- âœ… AI æ¨¡å‹é…ç½®

**ä¸å±‚æ¬¡ä¸€çš„åŒºåˆ«**ï¼š
- å±‚æ¬¡ä¸€ï¼šè‡ªåŠ¨è§¦å‘ï¼Œç»­å†™
- å±‚æ¬¡äºŒï¼šæ‰‹åŠ¨è§¦å‘ï¼ˆå¿«æ·é”®ï¼‰ï¼Œæ‰§è¡ŒæŒ‡ä»¤

**ä¸å±‚æ¬¡ä¸‰çš„åŒºåˆ«**ï¼š
- å±‚æ¬¡äºŒï¼šå•æ¬¡æ“ä½œï¼Œæ— å†å²
- å±‚æ¬¡ä¸‰ï¼šå¯¹è¯å¼ï¼Œæœ‰å†å²

---

**æ³¨æ„**ï¼šæ™ºèƒ½å…³è”ä¿®æ”¹åŠŸèƒ½ï¼ˆåŸå±‚æ¬¡ä¸‰ï¼‰å·²æ”¾å¼ƒï¼Œä¸å†å¼€å‘ã€‚

---

## å››ã€å±‚æ¬¡ä¸‰ï¼šå³ä¾§èŠå¤©çª—å£

### 4.1 åŠŸèƒ½å®šä½

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… **å®Œæ•´èŠå¤©ç•Œé¢**ï¼šæœ‰æ¶ˆæ¯åˆ—è¡¨ã€è¾“å…¥æ¡†ã€å†å²è®°å½•
- âœ… **å¯¹è¯å¼äº¤äº’**ï¼šå¯ä»¥å¤šè½®å¯¹è¯ï¼Œä¿æŒä¸Šä¸‹æ–‡
- âœ… **å·¥å…·è°ƒç”¨**ï¼šå¯ä»¥æ“ä½œæ–‡æ¡£ã€æ–‡ä»¶ç­‰
- âœ… **æ ‡ç­¾æ **ï¼šæ”¯æŒå¤šä¸ªèŠå¤©ä¼šè¯
- âœ… **è®°å¿†åº“é›†æˆ**ï¼šå¯ä»¥æŸ¥çœ‹è®°å¿†é¡¹
- âœ… **æ¨¡å‹é€‰æ‹©**ï¼šå¯ä»¥åˆ‡æ¢ä¸åŒçš„ AI æ¨¡å‹

**ç±»æ¯”**ï¼š
- ç±»ä¼¼ ChatGPT çš„èŠå¤©ç•Œé¢
- ç±»ä¼¼ Cursor çš„ AI èŠå¤©é¢æ¿
- ç±»ä¼¼ GitHub Copilot Chat

### 4.2 åŠŸèƒ½æ¨¡å—

#### 4.2.1 èŠå¤©æ ‡ç­¾æ 

**åŠŸèƒ½**ï¼š
- æ”¯æŒå¤šä¸ªç‹¬ç«‹çš„èŠå¤©ä¼šè¯
- æ¯ä¸ªæ ‡ç­¾ä»£è¡¨ä¸€ä¸ªèŠå¤©çº¿ç¨‹
- å¯ä»¥åˆ›å»ºã€åˆ‡æ¢ã€å…³é—­æ ‡ç­¾

**å®ç°**ï¼š
```typescript
// src/components/Chat/ChatTabs.tsx
export const ChatTabs: React.FC = () => {
  const [tabs, setTabs] = useState<ChatTab[]>([
    { id: '1', title: 'æ–°èŠå¤©', isActive: true },
  ]);
  const [activeTabId, setActiveTabId] = useState('1');
  
  const createNewTab = () => {
    const newTab: ChatTab = {
      id: Date.now().toString(),
      title: 'æ–°èŠå¤©',
      isActive: false,
    };
    setTabs(prev => [...prev, newTab]);
    setActiveTabId(newTab.id);
  };
  
  const closeTab = (tabId: string) => {
    if (tabs.length === 1) return; // è‡³å°‘ä¿ç•™ä¸€ä¸ªæ ‡ç­¾
    
    setTabs(prev => prev.filter(t => t.id !== tabId));
    if (activeTabId === tabId) {
      const remainingTabs = tabs.filter(t => t.id !== tabId);
      setActiveTabId(remainingTabs[0].id);
    }
  };
  
  return (
    <div className="chat-tabs">
      {tabs.map(tab => (
        <div
          key={tab.id}
          className={`chat-tab ${tab.id === activeTabId ? 'active' : ''}`}
          onClick={() => setActiveTabId(tab.id)}
        >
          <span>{tab.title}</span>
          <button onClick={(e) => { e.stopPropagation(); closeTab(tab.id); }}>
            Ã—
          </button>
        </div>
      ))}
      <button onClick={createNewTab}>+</button>
    </div>
  );
};
```

#### 4.2.2 è®°å¿†åº“æ ‡ç­¾

**åŠŸèƒ½**ï¼š
- åœ¨æ ‡ç­¾æ ä¸­æ·»åŠ è®°å¿†åº“æ ‡ç­¾ï¼ˆå›¾æ ‡ï¼šğŸ§ ï¼‰
- ç‚¹å‡»åˆ‡æ¢åˆ°è®°å¿†åº“é¢æ¿
- æ˜¾ç¤ºè®°å¿†é¡¹åˆ—è¡¨å’Œè¯¦æƒ…

**å®ç°**ï¼š
```typescript
// src/components/Chat/MemoryTab.tsx
export const MemoryTab: React.FC = () => {
  return (
    <div className="chat-tab memory-tab">
      <span>ğŸ§  è®°å¿†åº“</span>
    </div>
  );
};
```

#### 4.2.3 æ¨¡å‹é€‰æ‹©

**åŠŸèƒ½**ï¼š
- åœ¨èŠå¤©çª—å£æ ‡é¢˜æ æ˜¾ç¤ºå½“å‰æ¨¡å‹
- ç‚¹å‡»å¯ä»¥åˆ‡æ¢æ¨¡å‹
- æ¯ä¸ªèŠå¤©æ ‡ç­¾å¯ä»¥ç‹¬ç«‹é€‰æ‹©æ¨¡å‹

**å®ç°**ï¼š
```typescript
// src/components/Chat/ModelSelector.tsx
export const ModelSelector: React.FC<{ chatId: string }> = ({ chatId }) => {
  const [currentModel, setCurrentModel] = useState('gpt-4');
  const [isOpen, setIsOpen] = useState(false);
  
  const models = [
    { id: 'gpt-4', name: 'GPT-4' },
    { id: 'claude-3', name: 'Claude 3' },
    { id: 'gemini', name: 'Gemini' },
  ];
  
  return (
    <div className="model-selector">
      <button onClick={() => setIsOpen(!isOpen)}>
        {models.find(m => m.id === currentModel)?.name}
      </button>
      {isOpen && (
        <div className="model-dropdown">
          {models.map(model => (
            <div
              key={model.id}
              onClick={() => {
                setCurrentModel(model.id);
                setIsOpen(false);
              }}
            >
              {model.name}
            </div>
          ))}
        </div>
      )}
    </div>
  );
};
```

#### 4.2.4 å¼•ç”¨å†…å®¹æ˜¾ç¤º

**åŠŸèƒ½**ï¼š
- å½“ç”¨æˆ·åœ¨èŠå¤©ä¸­å¼•ç”¨æ–‡æœ¬ã€æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€å›¾ç‰‡ã€è¡¨æ ¼ã€èŠå¤©è®°å½•ç­‰æ—¶ï¼Œæ˜¾ç¤ºå¼•ç”¨å†…å®¹çš„ç¼©è§ˆ
- ç‚¹å‡»å¯ä»¥æŸ¥çœ‹å®Œæ•´å†…å®¹
- æ”¯æŒåˆ é™¤å¼•ç”¨

**å®ç°**ï¼š
```typescript
// src/components/Chat/MessageWithReference.tsx
export const MessageWithReference: React.FC<{
  message: ChatMessage;
}> = ({ message }) => {
  return (
    <div className="chat-message">
      {message.references && message.references.length > 0 && (
        <div className="references">
          {message.references.map((ref, idx) => (
            <ReferenceTag key={idx} reference={ref} />
          ))}
        </div>
      )}
      <div className="message-content">{message.content}</div>
    </div>
  );
};
```

#### 4.2.5 èŠå¤©å†…å®¹å¼•ç”¨ï¼ˆé‡ç‚¹åŠŸèƒ½ï¼‰

**åŠŸèƒ½**ï¼š
- æ”¯æŒè·¨æ ‡ç­¾é¡µå¼•ç”¨å…¶ä»–èŠå¤©çš„å†…å®¹
- Agent æ¨¡å¼å’Œ Chat æ¨¡å¼éƒ½å¯ä»¥äº’ç›¸å¼•ç”¨
- å¼•ç”¨æ–¹å¼ï¼šå¤åˆ¶ç²˜è´´å¼•ç”¨ï¼ˆç®€åŒ–æ–¹æ¡ˆï¼‰

**å®ç°**ï¼š
```typescript
// src/components/Chat/InlineChatInput.tsx
// å¤„ç†ç²˜è´´äº‹ä»¶ï¼Œè¯†åˆ«èŠå¤©å†…å®¹å¼•ç”¨
const handlePaste = async (e: React.ClipboardEvent) => {
  const pastedText = e.clipboardData.getText();
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯èŠå¤©å†…å®¹ï¼ˆé€šè¿‡å…¨å±€å˜é‡æˆ–å‰ªè´´æ¿æ•°æ®ï¼‰
  const chatSource = window.__binderClipboardSource;
  const chatTimestamp = window.__binderClipboardTimestamp;
  
  if (chatSource && Date.now() - chatTimestamp < 5000) {
    // 5ç§’å†…ç²˜è´´ï¼Œè¯†åˆ«ä¸ºèŠå¤©å¼•ç”¨
    const chatRef: ChatReference = {
      id: generateId(),
      type: ReferenceType.CHAT,
      createdAt: Date.now(),
      chatTabId: chatSource.tabId,
      chatTabTitle: chatSource.tabTitle,
      messageIds: chatSource.messageIds,
      messageRange: chatSource.messageRange,
    };
    
    // æ’å…¥å¼•ç”¨æ ‡ç­¾
    insertReferenceTag(chatRef);
    e.preventDefault();
  }
};
```

#### 4.2.6 å¿«æ·åº”ç”¨åˆ°æ–‡æ¡£åŠŸèƒ½ï¼ˆChat æ¨¡å¼ï¼‰

**åŠŸèƒ½**ï¼š
- åœ¨ AI æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤º"åº”ç”¨åˆ°æ–‡æ¡£"æŒ‰é’®ï¼ˆä»… Chat æ¨¡å¼ï¼‰
- æ”¯æŒå¤šç§åº”ç”¨æ–¹å¼ï¼šæ’å…¥ã€æ›¿æ¢ã€è¿½åŠ ã€åˆ›å»ºæ–°æ–‡ä»¶
- æ”¯æŒæ™ºèƒ½å†…å®¹è¯†åˆ«å’Œéƒ¨åˆ†åº”ç”¨

**å®ç°**ï¼š
```typescript
// src/components/Chat/QuickApplyButton.tsx
export const QuickApplyButton: React.FC<{
  message: ChatMessage;
  mode: 'chat' | 'agent';
}> = ({ message, mode }) => {
  if (mode !== 'chat') return null;
  
  const handleApply = async () => {
    // è¯†åˆ«å†…å®¹ç±»å‹ï¼ˆä»£ç å—ã€æ®µè½ã€åˆ—è¡¨ç­‰ï¼‰
    const segments = parseMessageContent(message.content);
    
    // æ˜¾ç¤ºåº”ç”¨é€‰é¡¹å¯¹è¯æ¡†
    const option = await showApplyOptionsDialog({
      segments,
      hasEditor: hasOpenEditor(),
      hasSelection: hasSelectedText(),
    });
    
    if (option === 'insert') {
      await applyToEditor('insert', segments);
    } else if (option === 'replace') {
      await applyToEditor('replace', segments);
    } else if (option === 'append') {
      await applyToEditor('append', segments);
    } else if (option === 'create') {
      await createNewFile(segments);
    }
  };
  
  return (
    <button onClick={handleApply} className="quick-apply-button">
      åº”ç”¨åˆ°æ–‡æ¡£
    </button>
  );
};
```

### 4.3 èŠå¤©æ¨¡å¼

**Agent æ¨¡å¼**ï¼š
- AI å¯ä»¥è°ƒç”¨å·¥å…·æ‰§è¡Œæ“ä½œï¼ˆæ–‡ä»¶æ“ä½œã€æœç´¢ç­‰ï¼‰
- é€‚ç”¨äºéœ€è¦ AI æ‰§è¡Œå®é™…æ“ä½œçš„åœºæ™¯ï¼ˆå¦‚åˆ›å»ºæ–‡ä»¶ã€ä¿®æ”¹æ–‡æ¡£ã€æœç´¢å†…å®¹ç­‰ï¼‰
- å·¥å…·è°ƒç”¨è¿‡ç¨‹å¯¹ç”¨æˆ·å¯è§ï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œ
- æ”¯æŒæ–‡æ¡£ä¿®æ”¹çš„å¯è§†åŒ–å±•ç¤ºï¼ˆçº¢ç»¿æ ‡æ³¨ï¼šåˆ é™¤ç”¨çº¢è‰²ï¼Œæ·»åŠ ç”¨ç»¿è‰²ï¼‰
- æ”¯æŒå¤šå±‚ç¡®è®¤æœºåˆ¶ï¼š
  - æ®µè½çº§åˆ«ç¡®è®¤ï¼šæ¯ä¸ªä¿®æ”¹æ®µè½æœ‰ç‹¬ç«‹çš„ç¡®è®¤æŒ‰é’®
  - æ–‡æ¡£çº§åˆ«ç¡®è®¤ï¼šæ¯ä¸ªè¢«ä¿®æ”¹çš„æ–‡æ¡£æœ‰ç¡®è®¤æŒ‰é’®
  - å…¨éƒ¨ç¡®è®¤ï¼šä¸€æ¬¡æ€§ç¡®è®¤æ‰€æœ‰ä¿®æ”¹

**Chat æ¨¡å¼**ï¼š
- AI ä»…è¿›è¡Œå¯¹è¯ï¼Œä¸è°ƒç”¨å·¥å…·
- é€‚ç”¨äºçº¯å¯¹è¯åœºæ™¯ï¼ˆå¦‚å’¨è¯¢é—®é¢˜ã€è·å–å»ºè®®ã€å†…å®¹è®¨è®ºç­‰ï¼‰
- ä¸æ‰§è¡Œä»»ä½•æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- æ”¯æŒå¿«æ·åº”ç”¨åˆ°æ–‡æ¡£åŠŸèƒ½

**æ¨¡å¼åˆ‡æ¢è§„åˆ™**ï¼š
- åˆ›å»ºæ–°å¯¹è¯æ—¶å¯ä»¥é€‰æ‹©æ¨¡å¼ï¼ˆé»˜è®¤ Agent æ¨¡å¼ï¼‰
- èŠå¤©å¼€å§‹åï¼ˆå·²æœ‰æ¶ˆæ¯ï¼‰ä¸èƒ½åˆ‡æ¢æ¨¡å¼ï¼ˆä¿æŒå¯¹è¯ä¸€è‡´æ€§ï¼‰
- æ¯ä¸ªæ ‡ç­¾é¡µç‹¬ç«‹è®¾ç½®æ¨¡å¼

### 4.4 å¼•ç”¨ç³»ç»ŸåŠŸèƒ½

**æ”¯æŒå¼•ç”¨ç±»å‹**ï¼š
- **æ–‡æœ¬å¼•ç”¨**ï¼šå¤åˆ¶æ–‡æ¡£å†…å®¹ï¼Œè‡ªåŠ¨è¯†åˆ«æ¥æºæ–‡ä»¶å’Œè¡Œå·
- **æ–‡ä»¶å¼•ç”¨**ï¼šæ‹–æ‹½æ–‡ä»¶åˆ°èŠå¤©çª—å£ï¼Œæˆ–ä½¿ç”¨ `@æ–‡ä»¶å` è¯­æ³•
- **æ–‡ä»¶å¤¹å¼•ç”¨**ï¼šæ‹–æ‹½æ–‡ä»¶å¤¹åˆ°èŠå¤©çª—å£
- **å›¾ç‰‡å¼•ç”¨**ï¼šæ‹–æ‹½å›¾ç‰‡åˆ°èŠå¤©çª—å£
- **è¡¨æ ¼å¼•ç”¨**ï¼šé€‰ä¸­è¡¨æ ¼å¹¶å¼•ç”¨
- **è®°å¿†åº“å¼•ç”¨**ï¼šä½¿ç”¨ `@è®°å¿†åº“åç§°` è¯­æ³•
- **èŠå¤©è®°å½•å¼•ç”¨**ï¼šå¼•ç”¨å…¶ä»–èŠå¤©æ ‡ç­¾é¡µçš„èŠå¤©å†…å®¹ï¼ˆæ”¯æŒè·¨æ ‡ç­¾é¡µå¼•ç”¨ï¼‰
- **é“¾æ¥å¼•ç”¨**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¾“å…¥æˆ–å¤åˆ¶çš„ URL
- **çŸ¥è¯†åº“å¼•ç”¨**ï¼šå¼•ç”¨çŸ¥è¯†åº“å†…å®¹

**å¼•ç”¨åŠŸèƒ½**ï¼š
- åœ¨èŠå¤©è¾“å…¥ä¸­æ’å…¥å¼•ç”¨æ ‡ç­¾
- å¼•ç”¨ç®¡ç†å™¨å¯è§†åŒ–
- å¼•ç”¨åˆ†ç»„æ˜¾ç¤º
- åˆ é™¤å¼•ç”¨
- å¼•ç”¨å†…å®¹å®Œæ•´ä¼ é€’ç»™ AIï¼ˆä¸æ˜¯è·¯å¾„ï¼Œæ˜¯å®Œæ•´å†…å®¹ï¼‰

**èŠå¤©å†…å®¹å¼•ç”¨ï¼ˆé‡ç‚¹åŠŸèƒ½ï¼‰**ï¼š

1. **è·¨æ ‡ç­¾é¡µå¼•ç”¨**ï¼š
   - Agent æ¨¡å¼å’Œ Chat æ¨¡å¼éƒ½å¯ä»¥å¼•ç”¨å…¶ä»–èŠå¤©æ ‡ç­¾é¡µçš„å†…å®¹
   - æ”¯æŒå¼•ç”¨å•ä¸ªæ¶ˆæ¯æˆ–å¤šä¸ªæ¶ˆæ¯ï¼ˆæ¶ˆæ¯èŒƒå›´ï¼‰
   - å¼•ç”¨æ—¶æ˜¾ç¤ºæ¥æºæ ‡ç­¾é¡µæ ‡é¢˜å’Œæ¶ˆæ¯èŒƒå›´
   - å¼•ç”¨å†…å®¹å®Œæ•´ä¼ é€’ç»™ AIï¼Œä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡

2. **å¼•ç”¨æ–¹å¼**ï¼ˆç®€åŒ–æ–¹æ¡ˆï¼‰ï¼š
   - **å¤åˆ¶ç²˜è´´å¼•ç”¨**ï¼šåœ¨å½“å‰èŠå¤©ä¸­å¤åˆ¶èŠå¤©å†…å®¹ï¼Œç²˜è´´åˆ°å…¶ä»–èŠå¤©è¾“å…¥æ¡†æ—¶ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸ºå¼•ç”¨æ ‡ç­¾
   - **æ‹–æ‹½å¼•ç”¨**ï¼šé€‰ä¸­æ¶ˆæ¯å†…å®¹ï¼Œæ‹–æ‹½åˆ°ç›®æ ‡èŠå¤©è¾“å…¥æ¡†
   - **å¼•ç”¨ç®¡ç†å™¨**ï¼šåœ¨å¼•ç”¨ç®¡ç†å™¨ä¸­æµè§ˆæ‰€æœ‰èŠå¤©æ ‡ç­¾é¡µï¼Œé€‰æ‹©è¦å¼•ç”¨çš„æ¶ˆæ¯
   - **æ³¨æ„**ï¼šä¸å†ä½¿ç”¨å³é”®èœå•å’Œå¿«æ·é”®å¼•ç”¨ï¼ˆé¿å…æ“ä½œå¤æ‚ï¼‰

3. **å¼•ç”¨æ˜¾ç¤º**ï¼š
   - å¼•ç”¨æ ‡ç­¾æ˜¾ç¤ºï¼š`ğŸ’¬ èŠå¤©è®°å½•: [æ ‡ç­¾é¡µåç§°] (æ¶ˆæ¯ 1-3)`
   - ç‚¹å‡»å¼•ç”¨æ ‡ç­¾å¯æŸ¥çœ‹å®Œæ•´å¼•ç”¨å†…å®¹
   - å¼•ç”¨å†…å®¹åœ¨å‘é€ç»™ AI æ—¶è‡ªåŠ¨æ ¼å¼åŒ–

4. **äº’ç›¸å¼•ç”¨åœºæ™¯**ï¼š
   - **Chat â†’ Agent**ï¼šåœ¨ Chat æ¨¡å¼ä¸­è®¨è®ºçš„å†…å®¹ï¼Œå¯ä»¥å¼•ç”¨åˆ° Agent æ¨¡å¼ä¸­æ‰§è¡Œæ“ä½œ
   - **Agent â†’ Chat**ï¼šåœ¨ Agent æ¨¡å¼ä¸­æ‰§è¡Œçš„ç»“æœï¼Œå¯ä»¥å¼•ç”¨åˆ° Chat æ¨¡å¼ä¸­ç»§ç»­è®¨è®º
   - **Chat â†’ Chat**ï¼šä¸åŒ Chat æ ‡ç­¾é¡µä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œä¾¿äºå¯¹æ¯”å’Œå‚è€ƒ
   - **Agent â†’ Agent**ï¼šä¸åŒ Agent æ ‡ç­¾é¡µä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œä¾¿äºå¤ç”¨æ“ä½œç»“æœ

5. **å¼•ç”¨å†…å®¹æ ¼å¼åŒ–**ï¼š
   - å¼•ç”¨æ—¶è‡ªåŠ¨åŒ…å«ï¼šæ ‡ç­¾é¡µæ ‡é¢˜ã€æ¶ˆæ¯è§’è‰²ï¼ˆç”¨æˆ·/AIï¼‰ã€æ¶ˆæ¯å†…å®¹ã€æ—¶é—´æˆ³
   - **æ—¶é—´æˆ³æ ¼å¼**ï¼š`[2025-01-15 14:30] (5 åˆ†é’Ÿå‰)`ï¼ˆåŒæ—¶æ˜¾ç¤ºç»å¯¹æ—¶é—´å’Œç›¸å¯¹æ—¶é—´ï¼‰
   - å¦‚æœæ—¶é—´è¶…è¿‡ 24 å°æ—¶ï¼Œåªæ˜¾ç¤ºç»å¯¹æ—¶é—´

### 4.5 å·¥å…·è°ƒç”¨åŠŸèƒ½ï¼ˆä»… Agent æ¨¡å¼ï¼‰

**æ–‡ä»¶æ“ä½œå·¥å…·**ï¼š
- `read_file`ï¼šè¯»å–æ–‡ä»¶å†…å®¹
- `create_file`ï¼šåˆ›å»ºæ–‡ä»¶
- `update_file`ï¼šæ›´æ–°æ–‡ä»¶
- `delete_file`ï¼šåˆ é™¤æ–‡ä»¶
- `list_files`ï¼šåˆ—å‡ºç›®å½•
- `search_files`ï¼šæœç´¢æ–‡ä»¶
- `move_file`ï¼šç§»åŠ¨æ–‡ä»¶
- `rename_file`ï¼šé‡å‘½å
- `create_folder`ï¼šåˆ›å»ºæ–‡ä»¶å¤¹

**ç¼–è¾‘å™¨æ“ä½œå·¥å…·**ï¼š
- `edit_current_editor_document`ï¼šç¼–è¾‘å½“å‰æ‰“å¼€çš„æ–‡æ¡£ï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
- å·¥å…·è°ƒç”¨ç»“æœè‡ªåŠ¨åº”ç”¨åˆ°ç¼–è¾‘å™¨ï¼ˆé€šè¿‡äº‹ä»¶é€šçŸ¥ï¼‰

**å·¥å…·è°ƒç”¨ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æ‰§è¡Œæ–‡ä»¶æ“ä½œï¼ˆæ— éœ€ç¡®è®¤ï¼‰
- ç¼–è¾‘å™¨æ“ä½œéœ€ç”¨æˆ·ç¡®è®¤
- å®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨çŠ¶æ€ï¼ˆpending/executing/completed/failedï¼‰
- JSON å‚æ•°ä¿®å¤æœºåˆ¶

### 4.6 æ–‡æ¡£ä¿®æ”¹å¯è§†åŒ–åŠŸèƒ½ï¼ˆä»… Agent æ¨¡å¼ï¼‰

**å¯è§†åŒ–å±•ç¤º**ï¼š
- æ”¯æŒæ–‡æ¡£ä¿®æ”¹çš„å¯è§†åŒ–å±•ç¤ºï¼ˆçº¢ç»¿æ ‡æ³¨ï¼šåˆ é™¤ç”¨çº¢è‰²ï¼Œæ·»åŠ ç”¨ç»¿è‰²ï¼‰
- æ”¯æŒè¡Œçº§åˆ«å¯¹æ¯”ã€æ®µè½çº§åˆ«å¯¹æ¯”ã€æ–‡æ¡£çº§åˆ«å¯¹æ¯”
- **åœ¨ç¼–è¾‘åŒºå®ç° diff æ•ˆæœ**ï¼ˆé‡è¦ï¼šDiff è§†å›¾åº”åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯èŠå¤©çª—å£ï¼‰

**å¤šå±‚ç¡®è®¤æœºåˆ¶**ï¼š
- **æ®µè½çº§åˆ«ç¡®è®¤**ï¼šæ¯ä¸ªä¿®æ”¹æ®µè½æœ‰ç‹¬ç«‹çš„ç¡®è®¤æŒ‰é’®
- **æ–‡æ¡£çº§åˆ«ç¡®è®¤**ï¼šæ¯ä¸ªè¢«ä¿®æ”¹çš„æ–‡æ¡£æœ‰ç¡®è®¤æŒ‰é’®
- **å…¨éƒ¨ç¡®è®¤**ï¼šä¸€æ¬¡æ€§ç¡®è®¤æ‰€æœ‰ä¿®æ”¹
- æ”¯æŒè·³è¿‡åŠŸèƒ½ï¼ˆè·³è¿‡æ®µè½ã€è·³è¿‡æ–‡æ¡£ï¼‰

### 4.7 å¿«æ·åº”ç”¨åˆ°æ–‡æ¡£åŠŸèƒ½ï¼ˆChat æ¨¡å¼é‡ç‚¹åŠŸèƒ½ï¼‰

**åŠŸèƒ½å®šä½**ï¼š
- Chat æ¨¡å¼ä¸­ï¼ŒAI å›ç­”çš„å†…å®¹å¯èƒ½åŒ…å«å¯ä»¥ç›´æ¥åº”ç”¨åˆ°æ–‡æ¡£çš„å†…å®¹
- æä¾›å¿«æ·æ–¹å¼ï¼Œè®©ç”¨æˆ·å¿«é€Ÿå°†èŠå¤©å†…å®¹åº”ç”¨åˆ°å½“å‰æ–‡æ¡£
- ç‰¹åˆ«é€‚ç”¨äºï¼šä»£ç ç‰‡æ®µã€æ–‡æœ¬å†…å®¹ã€æ ¼å¼å»ºè®®ç­‰

**å¿«æ·å¤„ç†æ–¹å¼**ï¼š

1. **ä¸€é”®åº”ç”¨åˆ°æ–‡æ¡£æŒ‰é’®**ï¼š
   - åœ¨ AI æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤º"åº”ç”¨åˆ°æ–‡æ¡£"æŒ‰é’®ï¼ˆä»… Chat æ¨¡å¼ï¼‰
   - ç‚¹å‡»åå¼¹å‡ºåº”ç”¨é€‰é¡¹ï¼š
     - **æ’å…¥åˆ°å…‰æ ‡ä½ç½®**ï¼šå°†å†…å®¹æ’å…¥åˆ°ç¼–è¾‘å™¨å…‰æ ‡ä½ç½®ï¼ˆéœ€è¦ç¼–è¾‘å™¨å·²æ‰“å¼€æ–‡æ¡£ï¼‰
     - **æ›¿æ¢é€‰ä¸­æ–‡æœ¬**ï¼šå¦‚æœæœ‰é€‰ä¸­æ–‡æœ¬ï¼Œæ›¿æ¢ä¸ºèŠå¤©å†…å®¹ï¼ˆéœ€è¦ç¼–è¾‘å™¨å·²æ‰“å¼€æ–‡æ¡£ï¼‰
     - **è¿½åŠ åˆ°æ–‡æ¡£æœ«å°¾**ï¼šå°†å†…å®¹è¿½åŠ åˆ°æ–‡æ¡£æœ«å°¾ï¼ˆéœ€è¦ç¼–è¾‘å™¨å·²æ‰“å¼€æ–‡æ¡£ï¼‰
     - **åº”ç”¨åˆ°å·¥ä½œåŒºæ–‡æ¡£**ï¼šå¦‚æœå·¥ä½œåŒºä¸­å­˜åœ¨åŒåæ–‡æ¡£ï¼Œç›´æ¥åº”ç”¨åˆ°è¯¥æ–‡æ¡£ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡æ¡£ï¼ˆä¸å¯é‡å¤åˆ›å»ºï¼‰

2. **æ™ºèƒ½å†…å®¹è¯†åˆ«**ï¼š
   - **ä»£ç å—è¯†åˆ«**ï¼šä½¿ç”¨ Markdown ä»£ç å—è¯­æ³•ï¼ˆ```è¯­è¨€\nä»£ç \n```ï¼‰
   - **æ–‡æœ¬æ®µè½è¯†åˆ«**ï¼šæŒ‰ç©ºè¡Œåˆ†å‰²ï¼Œæ¯ä¸ªæ®µè½ä½œä¸ºä¸€ä¸ªå¯é€‰é¡¹
   - **åˆ—è¡¨è¯†åˆ«**ï¼šè¯†åˆ« Markdown åˆ—è¡¨è¯­æ³•ï¼ˆ-ã€*ã€1. ç­‰ï¼‰
   - **å±•ç¤ºæ–¹å¼**ï¼šåœ¨åº”ç”¨é¢„è§ˆä¸­ï¼Œç”¨å¤é€‰æ¡†æ ‡è®°æ¯ä¸ªå¯åº”ç”¨çš„æ®µè½ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©

3. **åº”ç”¨é¢„è§ˆ**ï¼š
   - åº”ç”¨å‰æ˜¾ç¤ºé¢„è§ˆï¼ˆDiff è§†å›¾ï¼‰
   - ç”¨æˆ·å¯ä»¥ç¡®è®¤æˆ–å–æ¶ˆ
   - æ”¯æŒéƒ¨åˆ†åº”ç”¨ï¼ˆé€‰æ‹©è¦åº”ç”¨çš„æ®µè½ï¼‰
   - **éƒ¨åˆ†åº”ç”¨é€‰æ‹©æ–¹å¼**ï¼š
     - é¢„è§ˆç•Œé¢ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯åº”ç”¨æ®µè½ï¼Œç”¨å¤é€‰æ¡†é€‰æ‹©
     - æ¶ˆæ¯ä¸­ï¼šæ”¯æŒé€‰ä¸­æ–‡æœ¬åå³é”®"åº”ç”¨é€‰ä¸­å†…å®¹"

4. **å¿«æ·é”®æ”¯æŒ**ï¼š
   - `Cmd/Ctrl + Shift + A`ï¼šå¿«é€Ÿåº”ç”¨å½“å‰æ¶ˆæ¯åˆ°æ–‡æ¡£
   - `Cmd/Ctrl + Shift + I`ï¼šå¿«é€Ÿæ’å…¥åˆ°å…‰æ ‡ä½ç½®
   - `Cmd/Ctrl + Shift + T`ï¼šå¿«é€Ÿæ›¿æ¢é€‰ä¸­æ–‡æœ¬ï¼ˆä¿®æ”¹å¿«æ·é”®ï¼Œé¿å…ä¸å¼•ç”¨å†²çªï¼‰

5. **å³é”®èœå•é€‰é¡¹**ï¼š
   - åœ¨æ¶ˆæ¯ä¸Šå³é”®ï¼Œæ˜¾ç¤º"åº”ç”¨åˆ°æ–‡æ¡£"é€‰é¡¹
   - å­èœå•ï¼šæ’å…¥åˆ°å…‰æ ‡ä½ç½®ã€æ›¿æ¢é€‰ä¸­æ–‡æœ¬ã€è¿½åŠ åˆ°æ–‡æ¡£æœ«å°¾ã€åˆ›å»ºæ–°æ–‡ä»¶

6. **æ‹–æ‹½åº”ç”¨**ï¼š
   - é€‰ä¸­èŠå¤©æ¶ˆæ¯å†…å®¹ï¼Œç›´æ¥æ‹–æ‹½åˆ°ç¼–è¾‘å™¨
   - è‡ªåŠ¨æ’å…¥åˆ°æ‹–æ‹½ä½ç½®

7. **æ‰¹é‡åº”ç”¨**ï¼š
   - æ”¯æŒé€‰æ‹©å¤šä¸ªæ¶ˆæ¯ï¼Œæ‰¹é‡åº”ç”¨åˆ°æ–‡æ¡£
   - æ”¯æŒæŒ‰é¡ºåºåº”ç”¨æˆ–åˆå¹¶åº”ç”¨
   - **åˆå¹¶åº”ç”¨è§„åˆ™**ï¼š
     - é»˜è®¤æ–¹å¼ï¼šä¿æŒåŸæœ‰æ ¼å¼ï¼ŒæŒ‰é¡ºåºæ‹¼æ¥
     - æä¾›é€‰é¡¹ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©æ˜¯å¦åˆå¹¶ä¸ºä¸€ä¸ªæ®µè½ï¼ˆç”¨ç©ºè¡Œåˆ†éš”ï¼‰

**ç¼–è¾‘å™¨æœªæ‰“å¼€æ–‡æ¡£æ—¶çš„å¤„ç†**ï¼š
- ç¼–è¾‘å™¨æœªæ‰“å¼€æ–‡æ¡£æ—¶ï¼Œ"åº”ç”¨åˆ°æ–‡æ¡£"æŒ‰é’®ä»ç„¶æ˜¾ç¤º
- **åº”ç”¨é€»è¾‘**ï¼š
  - å¦‚æœå·¥ä½œåŒºä¸­å­˜åœ¨åŒåæ–‡æ¡£ï¼Œç›´æ¥åº”ç”¨åˆ°è¯¥æ–‡æ¡£ï¼ˆä¸å¯é‡å¤åˆ›å»ºï¼‰
  - å¦‚æœå·¥ä½œåŒºä¸­ä¸å­˜åœ¨åŒåæ–‡æ¡£ï¼Œåˆ›å»ºæ–°æ–‡æ¡£
  - å…¶ä»–é€‰é¡¹ï¼ˆæ’å…¥ã€æ›¿æ¢ã€è¿½åŠ ï¼‰éœ€è¦ç¼–è¾‘å™¨å·²æ‰“å¼€æ–‡æ¡£æ‰èƒ½ä½¿ç”¨

### 4.8 èŠå¤©è®°å½•ç®¡ç†

**èŠå¤©è®°å½•ç»‘å®š**ï¼š
- èŠå¤©è®°å½•ç»‘å®šåˆ°å·¥ä½œåŒºï¼ˆæ¯ä¸ªå·¥ä½œåŒºç‹¬ç«‹çš„èŠå¤©è®°å½•ï¼‰
- æ”¯æŒä¿å­˜èŠå¤©è®°å½•åˆ°å·¥ä½œåŒº
- æ”¯æŒåŠ è½½å·¥ä½œåŒºçš„èŠå¤©è®°å½•
- æ”¯æŒä¸´æ—¶èŠå¤©ï¼ˆæœªç»‘å®šå·¥ä½œåŒºçš„èŠå¤©ï¼Œé€€å‡ºæ—¶æç¤ºä¿å­˜ï¼‰
- æ”¯æŒèŠå¤©åˆå¹¶ï¼ˆæ‰“å¼€å·¥ä½œåŒºæ—¶ï¼Œå¯é€‰æ‹©åˆå¹¶ä¸´æ—¶èŠå¤©åˆ°å·¥ä½œåŒºï¼‰

**å®ç°**ï¼š
```typescript
// src/services/chatStorageService.ts
export const saveChatToWorkspace = async (
  workspacePath: string,
  chatTab: ChatTab,
  messages: ChatMessage[]
) => {
  const chatData = {
    tabId: chatTab.id,
    title: chatTab.title,
    mode: chatTab.mode,
    messages,
    createdAt: chatTab.createdAt,
    updatedAt: Date.now(),
  };
  
  await invoke('save_chat_to_workspace', {
    workspacePath,
    chatData,
  });
};

export const loadChatsFromWorkspace = async (
  workspacePath: string
): Promise<ChatTab[]> => {
  return await invoke('load_chats_from_workspace', {
    workspacePath,
  });
};
```

### 4.9 è®°å¿†åº“åŠŸèƒ½

**è®°å¿†åº“æ ‡ç­¾**ï¼š
- åœ¨æ ‡ç­¾æ ä¸­æ·»åŠ è®°å¿†åº“æ ‡ç­¾ï¼ˆå›¾æ ‡ï¼šğŸ§ ï¼‰
- ç‚¹å‡»åˆ‡æ¢åˆ°è®°å¿†åº“é¢æ¿
- æ˜¾ç¤ºè®°å¿†é¡¹åˆ—è¡¨å’Œè¯¦æƒ…

**è®°å¿†åº“åŠŸèƒ½**ï¼š
- æ”¯æŒé•¿æ–‡æ¡£åœºæ™¯çš„ä¸Šä¸‹æ–‡è®°å¿†
- æ”¯æŒè®°å¿†åº“æ ‡ç­¾ï¼ˆç”¨æˆ·å¯æ ‡è®°é‡è¦ä¸Šä¸‹æ–‡ï¼‰
- æ”¯æŒè®°å¿†åº“æ£€ç´¢ï¼ˆAI å¯æ£€ç´¢ç›¸å…³è®°å¿†ï¼‰

**å®ç°**ï¼š
```typescript
// src/components/Chat/MemoryPanel.tsx
export const MemoryPanel: React.FC = () => {
  const [memories, setMemories] = useState<Memory[]>([]);
  
  useEffect(() => {
    loadMemories();
  }, []);
  
  const loadMemories = async () => {
    const loaded = await invoke<Memory[]>('get_memories');
    setMemories(loaded);
  };
  
  return (
    <div className="memory-panel">
      <div className="memory-list">
        {memories.map(memory => (
          <MemoryItem key={memory.id} memory={memory} />
        ))}
      </div>
    </div>
  );
};
```

### 4.10 å¤šå±‚æç¤ºè¯æ¶æ„

**æç¤ºè¯å±‚æ¬¡**ï¼š

1. **åŸºç¡€ç³»ç»Ÿæç¤ºè¯**ï¼ˆç¬¬ä¸€å±‚ï¼‰ï¼š
   - è§’è‰²å®šä¹‰ï¼š"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹å’Œæ–‡æ¡£ç¼–è¾‘åŠ©æ‰‹"
   - åŸºæœ¬è¡Œä¸ºè§„èŒƒ

2. **ä¸Šä¸‹æ–‡æç¤ºè¯**ï¼ˆç¬¬äºŒå±‚ï¼‰ï¼š
   - å½“å‰æ‰“å¼€çš„æ–‡æ¡£ï¼šæ–‡ä»¶è·¯å¾„ã€æ–‡æ¡£å†…å®¹é¢„è§ˆï¼ˆæ™ºèƒ½é€‰æ‹© 1000 å­—ç¬¦ï¼‰
   - **æ–‡æ¡£å†…å®¹é¢„è§ˆé€‰æ‹©è§„åˆ™**ï¼š
     - ä¼˜å…ˆé€‰æ‹©ï¼šå…‰æ ‡ä½ç½®é™„è¿‘çš„å†…å®¹ï¼ˆå‰åå„ 400 å­—ç¬¦ï¼‰
     - å¦‚æœå…‰æ ‡ä½ç½®å†…å®¹ä¸è¶³ï¼Œè¡¥å……æ–‡æ¡£å¼€å¤´å†…å®¹
     - å¦‚æœæ–‡æ¡£æœ‰æ ‡é¢˜ç»“æ„ï¼Œä¼˜å…ˆåŒ…å«å½“å‰æ®µè½æ‰€åœ¨ç« èŠ‚çš„å†…å®¹
   - å½“å‰é€‰ä¸­çš„æ–‡æœ¬ï¼šé€‰ä¸­å†…å®¹
   - å·¥ä½œåŒºè·¯å¾„ï¼šå·¥ä½œåŒºæ ¹ç›®å½•
   - **å½“å‰ç¼–è¾‘å™¨çŠ¶æ€**ï¼šåŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯
     - æ˜¯å¦å¯ç¼–è¾‘ï¼ˆåªè¯»/å¯ç¼–è¾‘ï¼‰
     - æ–‡ä»¶ç±»å‹ï¼ˆ.mdã€.t-docxã€.html ç­‰ï¼‰
     - æ–‡ä»¶å¤§å°ï¼ˆå¦‚æœ > 1MBï¼Œæç¤º"å¤§æ–‡ä»¶"ï¼‰
     - æ˜¯å¦å·²ä¿å­˜ï¼ˆå¦‚æœæœ‰æœªä¿å­˜æ›´æ”¹ï¼Œæç¤º"æœ‰æœªä¿å­˜æ›´æ”¹"ï¼‰

3. **å¼•ç”¨æç¤ºè¯**ï¼ˆç¬¬ä¸‰å±‚ï¼‰ï¼š
   - ç”¨æˆ·å¼•ç”¨çš„å†…å®¹åˆ—è¡¨
   - æ¯ä¸ªå¼•ç”¨çš„ç±»å‹ã€æ¥æºã€å®Œæ•´å†…å®¹
   - æ˜ç¡®è¯´æ˜ï¼š"è¿™äº›å†…å®¹å·²ç»å®Œæ•´åŒ…å«åœ¨æ¶ˆæ¯ä¸­ï¼Œæ— éœ€å†è¯»å–æ–‡ä»¶"

4. **å·¥å…·è°ƒç”¨æç¤ºè¯**ï¼ˆç¬¬å››å±‚ï¼Œä»… Agent æ¨¡å¼ï¼‰ï¼š
   - å·¥å…·è°ƒç”¨è§„èŒƒï¼šJSON æ ¼å¼è¦æ±‚
   - å·¥å…·ä½¿ç”¨è¯´æ˜ï¼šæ¯ä¸ªå·¥å…·çš„åŠŸèƒ½å’Œå‚æ•°
   - å·¥å…·è°ƒç”¨æœ€ä½³å®è·µ

**æç¤ºè¯æ„å»ºé€»è¾‘**ï¼š
- æ ¹æ®èŠå¤©æ¨¡å¼ï¼ˆAgent/Chatï¼‰åŠ¨æ€æ„å»º
- æ ¹æ®æ˜¯å¦æœ‰å¼•ç”¨å†…å®¹åŠ¨æ€æ·»åŠ å¼•ç”¨æç¤ºè¯
- æ ¹æ®å½“å‰æ–‡æ¡£çŠ¶æ€åŠ¨æ€æ·»åŠ ä¸Šä¸‹æ–‡æç¤ºè¯

### 4.11 åç«¯å®ç°

**Rust åç«¯æ¥å£**ï¼š
```rust
// src-tauri/src/commands/ai_commands.rs

#[tauri::command]
pub async fn ai_chat_stream(
    tab_id: String,
    messages: Vec<ChatMessage>,
    model_config: ModelConfig,
    enable_tools: bool,
    context: ChatContext,
) -> Result<(), String> {
    // æ„å»ºå¤šå±‚æç¤ºè¯
    let system_prompt = build_multi_layer_prompt(&context, enable_tools);
    
    // æ ¼å¼åŒ–å¼•ç”¨å†…å®¹
    let formatted_messages = format_messages_with_references(messages);
    
    // è°ƒç”¨ AIï¼ˆæµå¼å“åº”ï¼‰
    let mut stream = ai_service
        .stream_chat(&model_config, &system_prompt, &formatted_messages, enable_tools)
        .await?;
    
    // æµå¼è¿”å›ï¼ˆå‰ç«¯å’Œåç«¯åŒé‡å»é‡ï¼‰
    let mut accumulated_text = String::new();
    while let Some(chunk) = stream.next().await {
        // å»é‡é€»è¾‘
        if !accumulated_text.ends_with(&chunk.text) {
            accumulated_text.push_str(&chunk.text);
            app_handle.emit("ai-chat-stream", chunk)?;
        }
    }
    
    Ok(())
}

fn build_multi_layer_prompt(context: &ChatContext, enable_tools: bool) -> String {
    // ç¬¬ä¸€å±‚ï¼šåŸºç¡€ç³»ç»Ÿæç¤ºè¯
    let mut prompt = String::from("ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹å’Œæ–‡æ¡£ç¼–è¾‘åŠ©æ‰‹ã€‚\n\n");
    
    // ç¬¬äºŒå±‚ï¼šä¸Šä¸‹æ–‡æç¤ºè¯
    prompt.push_str(&format!(
        "å½“å‰æ–‡æ¡£ï¼š{}\n\
         é€‰ä¸­æ–‡æœ¬ï¼š{}\n\
         å·¥ä½œåŒºè·¯å¾„ï¼š{}\n\
         ç¼–è¾‘å™¨çŠ¶æ€ï¼š{}\n\n",
        context.current_file.unwrap_or_default(),
        context.selected_text.unwrap_or_default(),
        context.workspace_path,
        format_editor_state(&context.editor_state)
    ));
    
    // ç¬¬ä¸‰å±‚ï¼šå¼•ç”¨æç¤ºè¯ï¼ˆå¦‚æœæœ‰å¼•ç”¨ï¼‰
    if let Some(refs) = &context.references {
        prompt.push_str("ç”¨æˆ·å¼•ç”¨äº†ä»¥ä¸‹å†…å®¹ï¼ˆè¿™äº›å†…å®¹å·²ç»å®Œæ•´åŒ…å«åœ¨æ¶ˆæ¯ä¸­ï¼Œæ— éœ€å†è¯»å–æ–‡ä»¶ï¼‰ï¼š\n");
        for ref_item in refs {
            prompt.push_str(&format!("- {}: {}\n", ref_item.type_name(), ref_item.preview()));
        }
        prompt.push_str("\n");
    }
    
    // ç¬¬å››å±‚ï¼šå·¥å…·è°ƒç”¨æç¤ºè¯ï¼ˆä»… Agent æ¨¡å¼ï¼‰
    if enable_tools {
        prompt.push_str(&get_tool_calling_prompt());
    }
    
    prompt
}
```

**æµå¼å“åº”å¤„ç†**ï¼š
- å‰ç«¯å’Œåç«¯åŒé‡å»é‡
- ç´¯ç§¯æ–‡æœ¬è·Ÿè¸ª
- ç©º chunk è¿‡æ»¤
- å·¥å…·è°ƒç”¨å®æ—¶å¤„ç†

### 4.12 æ€§èƒ½è¦æ±‚

**å“åº”æ—¶é—´**ï¼š
- é¦–æ¬¡å“åº”ï¼š< 3 ç§’
- æµå¼æ˜¾ç¤ºå»¶è¿Ÿï¼š< 100ms
- å·¥å…·è°ƒç”¨å“åº”ï¼š< 2 ç§’

**èµ„æºå ç”¨**ï¼š
- å†…å­˜å ç”¨ï¼š< 100MBï¼ˆèŠå¤©å†å²ï¼‰
- CPU å ç”¨ï¼š< 50%ï¼ˆAI å¤„ç†ï¼‰

### 4.13 è¾¹ç•Œå’Œé™åˆ¶

**å…±äº«çš„å†…å®¹**ï¼š
- âœ… å½“å‰æ–‡æ¡£å†…å®¹ï¼ˆä½œä¸ºä¸Šä¸‹æ–‡ï¼‰
- âœ… é€‰ä¸­æ–‡æœ¬ï¼ˆå¯ä»¥å¼•ç”¨ï¼‰
- âœ… ç³»ç»Ÿæç¤ºè¯
- âœ… AI æ¨¡å‹é…ç½®
- âœ… è®°å¿†åº“æ•°æ®

**ä¸å…±äº«çš„å†…å®¹**ï¼š
- âŒ ä¸å…±äº«è‡ªåŠ¨è¡¥å…¨çš„è§¦å‘é€»è¾‘
- âŒ ä¸å…±äº« Inline Assist çš„è¾“å…¥æ¡†

**ä¸å±‚æ¬¡ä¸€ã€äºŒçš„åŒºåˆ«**ï¼š
- å±‚æ¬¡ä¸€ã€äºŒï¼šå•æ¬¡æ“ä½œï¼Œæ— å†å²
- å±‚æ¬¡ä¸‰ï¼šå¯¹è¯å¼ï¼Œæœ‰å®Œæ•´å†å²è®°å½•

---

## äº”ã€ä¸‰å±‚æ¶æ„çš„å…±äº«å†…å®¹

### 6.1 å…±äº«çš„ä¸Šä¸‹æ–‡æ•°æ®

è™½ç„¶ä¸‰ç§åŠŸèƒ½ç‹¬ç«‹å®ç°ï¼Œä½†å¯ä»¥å…±äº«ä»¥ä¸‹å†…å®¹ï¼š

1. **å½“å‰æ–‡æ¡£å†…å®¹**ï¼š
   - è‡ªåŠ¨è¡¥å…¨ï¼šä½œä¸ºç»­å†™ä¸Šä¸‹æ–‡
   - Inline Assistï¼šä½œä¸ºæŒ‡ä»¤æ‰§è¡Œçš„ä¸Šä¸‹æ–‡
   - èŠå¤©çª—å£ï¼šä½œä¸ºå¯¹è¯çš„ä¸Šä¸‹æ–‡

2. **é€‰ä¸­æ–‡æœ¬**ï¼š
   - Inline Assistï¼šä½œä¸ºè¦å¤„ç†çš„æ–‡æœ¬
   - èŠå¤©çª—å£ï¼šå¯ä»¥ä½œä¸ºå¼•ç”¨å†…å®¹

3. **ç³»ç»Ÿæç¤ºè¯**ï¼š
   - æ‰€æœ‰å±‚æ¬¡éƒ½ä½¿ç”¨ç›¸åŒçš„ç³»ç»Ÿæç¤ºè¯åŸºç¡€
   - ä½†å¯ä»¥æ ¹æ®å±‚æ¬¡è°ƒæ•´ï¼ˆè‡ªåŠ¨è¡¥å…¨æ›´ç®€æ´ï¼ŒèŠå¤©æ›´è¯¦ç»†ï¼‰

4. **AI æ¨¡å‹é…ç½®**ï¼š
   - æ‰€æœ‰å±‚æ¬¡éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹é…ç½®
   - ä½†è‡ªåŠ¨è¡¥å…¨ä¼˜å…ˆä½¿ç”¨å¿«é€Ÿæ¨¡å‹

5. **å·¥ä½œåŒºä¿¡æ¯**ï¼š
   - èŠå¤©çª—å£ï¼šç”¨äºå·¥å…·è°ƒç”¨

### 6.2 å…±äº«çš„æœåŠ¡æ¥å£

**Rust åç«¯ç»Ÿä¸€æ¥å£**ï¼š
```rust
// src-tauri/src/services/ai_service.rs

pub struct AIService {
    // ç»Ÿä¸€çš„æ¨¡å‹ç®¡ç†
    model_manager: ModelManager,
    // ç»Ÿä¸€çš„ä¸Šä¸‹æ–‡æ„å»º
    context_builder: ContextBuilder,
}

impl AIService {
    // å±‚æ¬¡ä¸€ï¼šè‡ªåŠ¨è¡¥å…¨
    pub async fn autocomplete(&self, context: &str) -> Result<String, Error> {
        // ä½¿ç”¨å¿«é€Ÿæ¨¡å‹
        self.model_manager.get_fast_model()
            .complete(context, max_length: 50)
            .await
    }
    
    // å±‚æ¬¡äºŒï¼šInline Assist
    pub async fn inline_assist(&self, instruction: &str, text: &str, context: &str) -> Result<String, Error> {
        // ä½¿ç”¨æ ‡å‡†æ¨¡å‹
        self.model_manager.get_current_model()
            .complete_with_instruction(instruction, text, context)
            .await
    }
    
    // å±‚æ¬¡ä¸‰ï¼šèŠå¤©
    pub async fn chat_stream(
        &self,
        messages: &[Message],
        context: &ChatContext,
        enable_tools: bool,
    ) -> Result<Stream, Error> {
        // ä½¿ç”¨æ ‡å‡†æ¨¡å‹ï¼Œæµå¼å“åº”
        self.model_manager.get_current_model()
            .stream_chat(messages, context, enable_tools)
            .await
    }
}
```

### 6.3 ä¸å…±äº«çš„å†…å®¹

**ä¸¥æ ¼éš”ç¦»**ï¼š
- âŒ è‡ªåŠ¨è¡¥å…¨çš„è§¦å‘é€»è¾‘ä¸å…±äº«
- âŒ Inline Assist çš„è¾“å…¥æ¡†ä¸å…±äº«
- âŒ èŠå¤©çª—å£çš„ UI ç»„ä»¶ä¸å…±äº«
- âŒ èŠå¤©å†å²ä¸å…±äº«ç»™å…¶ä»–å±‚æ¬¡

---

## ä¸ƒã€å®ç°åŸåˆ™

### 7.1 ç‹¬ç«‹æ€§åŸåˆ™

1. **ä»£ç éš”ç¦»**ï¼š
   - æ¯ä¸ªå±‚æ¬¡æœ‰ç‹¬ç«‹çš„ç»„ä»¶ç›®å½•
   - æ¯ä¸ªå±‚æ¬¡æœ‰ç‹¬ç«‹çš„ Hook
   - æ¯ä¸ªå±‚æ¬¡æœ‰ç‹¬ç«‹çš„åç«¯æ¥å£

2. **çŠ¶æ€éš”ç¦»**ï¼š
   - è‡ªåŠ¨è¡¥å…¨ï¼šä½¿ç”¨ç‹¬ç«‹çš„ stateï¼ˆghostTextï¼‰
   - Inline Assistï¼šä½¿ç”¨ç‹¬ç«‹çš„ stateï¼ˆisOpen, inputValueï¼‰
   - èŠå¤©çª—å£ï¼šä½¿ç”¨ç‹¬ç«‹çš„ stateï¼ˆmessages, tabsï¼‰

3. **äº‹ä»¶éš”ç¦»**ï¼š
   - è‡ªåŠ¨è¡¥å…¨ï¼šç›‘å¬ selectionUpdateã€update äº‹ä»¶
   - Inline Assistï¼šç›‘å¬ Cmd+K å¿«æ·é”®
   - èŠå¤©çª—å£ï¼šç›‘å¬ç”¨æˆ·è¾“å…¥å’Œå‘é€äº‹ä»¶

### 7.2 å…±äº«åŸåˆ™

1. **æ•°æ®å…±äº«**ï¼š
   - é€šè¿‡ç»Ÿä¸€çš„ Context API è·å–æ–‡æ¡£å†…å®¹
   - é€šè¿‡ç»Ÿä¸€çš„ ModelManager ç®¡ç†æ¨¡å‹
   - é€šè¿‡ç»Ÿä¸€çš„ AIService è°ƒç”¨ AI

2. **é…ç½®å…±äº«**ï¼š
   - ç³»ç»Ÿæç¤ºè¯é…ç½®
   - æ¨¡å‹é…ç½®
   - ç”¨æˆ·åå¥½è®¾ç½®

### 7.3 æ€§èƒ½åŸåˆ™

1. **è‡ªåŠ¨è¡¥å…¨**ï¼š
   - ä½¿ç”¨å¿«é€Ÿæ¨¡å‹
   - é™åˆ¶ç”Ÿæˆé•¿åº¦
   - é˜²æŠ–æœºåˆ¶

2. **Inline Assist**ï¼š
   - ä½¿ç”¨æ ‡å‡†æ¨¡å‹
   - å•æ¬¡è¯·æ±‚ï¼Œä¸æµå¼

3. **èŠå¤©çª—å£**ï¼š
   - ä½¿ç”¨æ ‡å‡†æ¨¡å‹
   - æµå¼å“åº”
   - æ”¯æŒå·¥å…·è°ƒç”¨

---

## å…«ã€ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Editor/
â”‚   â”‚   â”œâ”€â”€ GhostText.tsx              # å±‚æ¬¡ä¸€ï¼šå¹½çµæ–‡å­—ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ InlineAssistInput.tsx      # å±‚æ¬¡äºŒï¼šè¾“å…¥æ¡†ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TipTapEditor.tsx           # ç¼–è¾‘å™¨ä¸»ç»„ä»¶
â”‚   â””â”€â”€ Chat/
â”‚       â”œâ”€â”€ ChatWindow.tsx              # å±‚æ¬¡ä¸‰ï¼šèŠå¤©çª—å£
â”‚       â”œâ”€â”€ ChatTabs.tsx                # æ ‡ç­¾æ 
â”‚       â”œâ”€â”€ ChatMessageList.tsx         # æ¶ˆæ¯åˆ—è¡¨
â”‚       â”œâ”€â”€ InlineChatInput.tsx         # è¾“å…¥æ¡†ï¼ˆæ”¯æŒå¼•ç”¨ï¼‰
â”‚       â”œâ”€â”€ ReferenceManagerButton.tsx  # å¼•ç”¨ç®¡ç†å™¨
â”‚       â”œâ”€â”€ ReferenceTags.tsx            # å¼•ç”¨æ ‡ç­¾æ˜¾ç¤º
â”‚       â”œâ”€â”€ QuickApplyButton.tsx        # å¿«æ·åº”ç”¨åˆ°æ–‡æ¡£æŒ‰é’®
â”‚       â”œâ”€â”€ ToolCallCard.tsx            # å·¥å…·è°ƒç”¨å¡ç‰‡
â”‚       â”œâ”€â”€ DocumentDiffView.tsx        # æ–‡æ¡£ä¿®æ”¹ Diff è§†å›¾
â”‚       â”œâ”€â”€ ModelSelector.tsx           # æ¨¡å‹é€‰æ‹©
â”‚       â”œâ”€â”€ MemoryTab.tsx               # è®°å¿†åº“æ ‡ç­¾
â”‚       â””â”€â”€ MessageWithReference.tsx    # å¼•ç”¨å†…å®¹æ˜¾ç¤º
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAutoComplete.ts              # å±‚æ¬¡ä¸€ï¼šè‡ªåŠ¨è¡¥å…¨ Hook
â”‚   â”œâ”€â”€ useInlineAssist.ts              # å±‚æ¬¡äºŒï¼šInline Assist Hook
â”‚   â””â”€â”€ useChat.ts                      # å±‚æ¬¡ä¸‰ï¼šèŠå¤© Hook
â””â”€â”€ services/
    â”œâ”€â”€ aiService.ts                    # ç»Ÿä¸€çš„ AI æœåŠ¡æ¥å£
    â””â”€â”€ contextService.ts               # ä¸Šä¸‹æ–‡æ„å»ºæœåŠ¡
```

---

## ä¹ã€å¼€å‘è®¡åˆ’

### 9.1 é˜¶æ®µä¸€ï¼šå±‚æ¬¡ä¸€ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰
- Week 13-14ï¼šå®ç°è‡ªåŠ¨è¡¥å…¨
  - å®ç°è§¦å‘é€»è¾‘ï¼ˆå…‰æ ‡æ‚¬åœæ£€æµ‹ï¼‰
  - å®ç°å¹½çµæ–‡å­—æ˜¾ç¤º
  - å®ç° Tab/Esc äº¤äº’
  - é›†æˆå¿«é€Ÿæ¨¡å‹

### 9.2 é˜¶æ®µäºŒï¼šå±‚æ¬¡äºŒï¼ˆInline Assistï¼‰
- Week 15ï¼šå®ç° Inline Assist
  - å®ç° Cmd+K å¿«æ·é”®
  - å®ç°è¾“å…¥æ¡†ç»„ä»¶
  - å®ç°ç›´æ¥ä¿®æ”¹æ–‡æœ¬é€»è¾‘
  - å¯é€‰ï¼šå®ç° Diff è§†å›¾

### 9.3 é˜¶æ®µä¸‰ï¼šå±‚æ¬¡ä¸‰ï¼ˆèŠå¤©çª—å£ï¼‰
- Week 18-20ï¼šå®ç°èŠå¤©çª—å£
  - å®ç°èŠå¤©ç•Œé¢
  - å®ç°æ ‡ç­¾æ 
  - å®ç°æ¨¡å‹é€‰æ‹©
  - å®ç°è®°å¿†åº“é›†æˆ
  - å®ç°å¼•ç”¨ç³»ç»Ÿï¼ˆåŒ…æ‹¬èŠå¤©å†…å®¹å¼•ç”¨ï¼‰
  - å®ç°å·¥å…·è°ƒç”¨
  - å®ç°æ–‡æ¡£ä¿®æ”¹å¯è§†åŒ–ï¼ˆåœ¨ç¼–è¾‘åŒºæ˜¾ç¤º Diffï¼‰
  - å®ç°å¿«æ·åº”ç”¨åˆ°æ–‡æ¡£åŠŸèƒ½ï¼ˆChat æ¨¡å¼ï¼‰
  - å®ç°å¤šå±‚æç¤ºè¯æ¶æ„

---

## åã€æ€»ç»“

### 10.1 ä¸‰å±‚æ¶æ„çš„æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | å±‚æ¬¡ä¸€ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰ | å±‚æ¬¡äºŒï¼ˆInline Assistï¼‰ | å±‚æ¬¡ä¸‰ï¼ˆèŠå¤©çª—å£ï¼‰ |
|------|-------------------|------------------------|-------------------|
| **è§¦å‘æ–¹å¼** | è‡ªåŠ¨ï¼ˆå…‰æ ‡é™æ­¢ï¼‰ | å¿«æ·é”®ï¼ˆCmd+Kï¼‰ | æ‰‹åŠ¨æ‰“å¼€çª—å£ |
| **UI å½¢å¼** | å¹½çµæ–‡å­— | æµ®åŠ¨è¾“å…¥æ¡† | å®Œæ•´èŠå¤©ç•Œé¢ |
| **äº¤äº’æ–¹å¼** | Tab æ¥å— | Enter æ‰§è¡Œ | å¯¹è¯å¼äº¤äº’ |
| **å†å²è®°å½•** | æ—  | æ—  | æœ‰ |
| **å·¥å…·è°ƒç”¨** | æ—  | æ—  | æœ‰ï¼ˆä»… Agent æ¨¡å¼ï¼‰ |
| **æ¨¡å‹é€‰æ‹©** | å¿«é€Ÿæ¨¡å‹ | æ ‡å‡†æ¨¡å‹ | æ ‡å‡†æ¨¡å‹ï¼ˆå¯åˆ‡æ¢ï¼‰ |
| **æ“ä½œç±»å‹** | å•æ¬¡ç»­å†™ | å•æ¬¡æ“ä½œ | å¯¹è¯å¼æ“ä½œ |

### 10.2 å®ç°åŸåˆ™

1. âœ… **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªå±‚æ¬¡ç‹¬ç«‹å®ç°ï¼Œä¸ç›¸äº’ä¾èµ–
2. âœ… **æ¸…æ™°æ€§**ï¼šæ¯ä¸ªå±‚æ¬¡æœ‰æ˜ç¡®çš„èŒè´£å’Œè¾¹ç•Œ
3. âœ… **å…±äº«æ€§**ï¼šå…±äº«ä¸Šä¸‹æ–‡æ•°æ®å’Œé…ç½®ï¼Œä½†ä¸å…±äº«å®ç°é€»è¾‘
4. âœ… **æ€§èƒ½**ï¼šæ ¹æ®å±‚æ¬¡é€‰æ‹©åˆé€‚çš„æ¨¡å‹å’Œå“åº”æ–¹å¼

### 10.3 å…³é”®ç‚¹

- **å±‚æ¬¡ä¸€**ï¼šå®Œå…¨è‡ªåŠ¨ï¼Œæ—  UI çª—å£ï¼Œç±»ä¼¼ä»£ç è¡¥å…¨
- **å±‚æ¬¡äºŒ**ï¼šå¿«æ·é”®è°ƒå‡ºï¼Œå•æ¬¡æ“ä½œï¼Œç›´æ¥ä¿®æ”¹æ–‡æœ¬
- **å±‚æ¬¡ä¸‰**ï¼šå®Œæ•´å¯¹è¯ï¼Œæœ‰å†å²ï¼Œæœ‰å·¥å…·è°ƒç”¨ï¼Œæœ‰æ ‡ç­¾æ ï¼Œæ”¯æŒå¼•ç”¨å’Œå¿«æ·åº”ç”¨

### 10.4 æˆæœ¬æ§åˆ¶è¯´æ˜

**åŠŸèƒ½å±‚é¢**ï¼š
- ä¸é™åˆ¶ç”¨æˆ·è°ƒç”¨æ¬¡æ•°ï¼Œä»¥å®ç°åŠŸèƒ½ä¸ºä¸»

**æˆæœ¬æ§åˆ¶ä½ç½®**ï¼š
- åº”åœ¨ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå±‚é¢ç»Ÿä¸€å¤„ç†
  - Token é™é¢ç®¡ç†
  - ä½¿ç”¨é‡ç»Ÿè®¡å’Œç›‘æ§
  - è®¢é˜…ç®¡ç†å’Œé…é¢æ§åˆ¶
  - ç”¨æˆ·çº§åˆ«çš„ä½¿ç”¨é™åˆ¶

**ç°é˜¶æ®µ**ï¼š
- ä¸“æ³¨äºåŠŸèƒ½å®ç°ï¼Œæˆæœ¬æ§åˆ¶ç”±ç”¨æˆ·ç®¡ç†ç³»ç»Ÿç»Ÿä¸€å¤„ç†

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025å¹´  
**æœ€åæ›´æ–°**ï¼š2025å¹´ï¼ˆæ ¹æ® AIåŠŸèƒ½éœ€æ±‚æ–‡æ¡£.md æ›´æ–°ä¸ºä¸‰å±‚æ¶æ„ï¼‰  
**åŸºäº**ï¼šAIåŠŸèƒ½éœ€æ±‚æ–‡æ¡£.md + Binderäº§å“å¼€å‘æ–¹æ¡ˆ.md

