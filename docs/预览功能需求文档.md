# DOCX、Excel 和演示文稿预览功能需求文档

## 文档信息

- **文档版本**：v1.0
- **创建日期**：2025年
- **文档性质**：功能需求文档
- **适用范围**：Binder DOCX、Excel 和演示文稿预览功能 MVP 1.0
- **功能定位**：只读预览模式，不支持编辑

---

## 一、产品定位与核心价值

### 1.1 产品定位

Binder 的 DOCX、Excel 和演示文稿预览功能是面向专业用户的 **统一文档预览平台**，提供高质量、交互友好的文档预览体验，支持文本选中、复制、引用等基础交互功能。

### 1.2 核心价值主张

1. **统一体验**：DOCX、Excel 和演示文稿使用相同的预览交互模式
2. **高质量预览**：准确还原文档格式和布局
3. **基础交互**：支持文本选中、复制、引用等常用操作
4. **快速加载**：优化预览加载速度，提升用户体验

### 1.3 目标用户

- 财务分析师：查看财务报表、预算分析
- 项目经理：查看项目计划、进度报告
- 商务人员：查看合同、报价单、演示文稿
- 所有用户：快速预览文档内容，无需打开专业软件

---

## 二、功能需求

### 2.1 DOCX 预览功能

#### 2.1.1 核心功能

**功能描述：**
- 支持 DOCX 文件的只读预览模式
- 用户可查看文档内容，但不能编辑
- 支持多种文档格式（DOCX, DOC, ODT, RTF）

**支持的文件格式：**
- DOCX（Word 2007 及以上）- 最常用的 Word 格式
- DOC（Word 97-2003）- 兼容旧版 Word 文件
- ODT（LibreOffice Writer）- 开源文档格式
- RTF（富文本格式）- 跨平台文档格式

**格式说明：**
- DOCX 是 Microsoft Word 的标准格式，广泛使用
- 通过 LibreOffice 转换为 PDF 进行预览
- 预览时保持原始文档的格式和布局

#### 2.1.2 预览显示

**显示要求：**
- 模拟 Word 页面效果（页面布局、页边距、分页）
- 支持打印预览模式（显示分页、页码、页面跳转）
- 支持暗色模式适配
- 支持缩放功能（50%-200%，步进 10%）

**页面管理：**
- 显示当前页/总页数
- 支持页面跳转（输入页码跳转）
- 支持上一页/下一页按钮
- 支持滚动条导航

#### 2.1.3 交互功能

**文本操作：**
- 支持文本选中（鼠标拖拽选择）
- 支持文本复制（Ctrl/Cmd + C）
- 支持文本复制到剪贴板
- 支持选中文本高亮显示

**搜索功能：**
- 支持文本搜索（Ctrl/Cmd + F）- **浏览器原生支持**
- 支持搜索结果高亮显示 - **浏览器原生支持**
- 支持搜索结果导航（上一个/下一个）- **浏览器原生支持**
- ⚠️ 搜索范围选择（当前页/所有页）- **浏览器原生不支持，需要自定义实现（P2）**

**打印功能：**
- 支持打印预览（显示分页和页码）
- 支持打印功能（Ctrl/Cmd + P）
- 支持页面设置（纸张大小、方向、边距）

**导航功能：**
- 支持页面跳转（输入页码跳转）
- 支持上一页/下一页按钮
- 支持显示当前页/总页数
- 支持滚动条导航

#### 2.1.4 引用功能

**引用支持：**
- 支持选中文本后引用
- 支持引用格式：`@文件名.docx!第1页` 或 `@文件名.docx!段落1`
- 支持引用到聊天窗口
- 支持引用到其他文档

**引用交互：**
- 选中文本后显示"引用"按钮
- 点击"引用"按钮复制引用格式到剪贴板
- 支持引用预览（显示引用内容）

#### 2.1.5 性能要求

**加载性能：**
- 预览加载时间：首次 < 15 秒，缓存后 < 3 秒
- 大文件（> 10MB）加载时间：< 30 秒
- 页面切换响应时间：< 1 秒

**预览准确率：**
- 格式还原准确率：≥ 95%
- 数据准确性：100%（数据不丢失）
- 布局还原准确率：≥ 90%

**资源占用：**
- 内存占用：< 200MB（单个文件）
- CPU 占用：加载时 < 50%，预览时 < 10%

**状态说明：**
- ✅ **已实现**：DOCX 预览功能已在当前版本实现
- ✅ **技术方案**：使用 LibreOffice 转换为 PDF，通过 iframe + data URL 显示
- ✅ **交互功能**：浏览器原生 PDF 查看器支持文本选择、复制、搜索、打印

### 2.2 Excel 预览功能

#### 2.2.1 核心功能

**功能描述：**
- 支持 Excel 文件的只读预览模式
- 用户可查看文档内容，但不能编辑
- 支持多种 Excel 格式（XLSX, XLS, CSV, ODS）

**支持的文件格式：**
- XLSX（Excel 2007 及以上）- 最常用的 Excel 格式
- XLS（Excel 97-2003）- 兼容旧版 Excel 文件
- CSV（逗号分隔值文件，纯文本格式）- 数据交换标准格式，广泛使用
- ODS（LibreOffice Calc）- 开源办公软件格式

**格式说明：**
- CSV 格式是数据交换的标准格式，常用于数据导入导出、系统间数据传输
- **MVP 1.0 方案**：CSV 文件直接解析为 HTML 表格（独立方案，预览效果更好，支持虚拟滚动）

#### 2.2.2 CSV 预览显示（独立方案）

**显示要求：**
- 直接解析 CSV 为 HTML 表格，不使用 PDF 转换
- 支持虚拟滚动（大文件性能优化）
- 支持流式解析（大文件进度反馈）
- 支持暗色模式适配

**表格布局要求（核心要求）：**
- **列宽固定原则**：每列的宽度必须固定，根据列内容自动计算合适的宽度
  - 列宽计算：根据该列所有单元格内容的最大宽度确定
  - 列宽不随窗口大小变化：窗口改变时，列宽保持固定
  - 列宽适配内容：确保单元格内容完整显示，不被截断或重叠
- **行高固定原则**：每行的高度固定，确保内容完整显示
  - 行高计算：根据单元格内容（考虑换行）确定合适的高度
  - 行高不随窗口大小变化：窗口改变时，行高保持固定
- **内容完整性优先**：
  - 单元格内容必须完整显示，不允许截断或重叠
  - 单元格宽度必须大于等于内容宽度
  - 单元格高度必须大于等于内容高度
- **滚动机制**：
  - 表格总宽度可能超过窗口宽度，此时显示水平滚动条
  - 表格总高度可能超过窗口高度，此时显示垂直滚动条（虚拟滚动）
  - 窗口大小改变时，表格尺寸不变，通过滚动查看超出部分
- **样式清晰**：
  - 单元格边框清晰可见（网格线）
  - 单元格内边距合适，确保内容不贴边
  - 文本对齐方式合理（左对齐或根据数据类型对齐）
  - 单元格背景色和文本颜色对比度足够（支持暗色模式）

**表格结构要求：**
- 表头固定（sticky top）：滚动时表头始终可见
- 行号列固定（sticky left）：滚动时行号始终可见
- 表格主体可滚动：水平和垂直方向都可滚动

#### 2.2.3 Excel（XLSX/XLS/ODS）预览显示

**显示要求：**
- 模拟 Excel 页面效果（网格线、列宽、行高）
- 支持多工作表预览（工作表切换）
- 支持打印预览模式（显示分页、页码、页面跳转）
- 支持暗色模式适配
- 支持缩放功能（50%-200%，步进 10%）

**工作表管理：**
- ⚠️ 显示所有工作表标签 - **PDF 预览方式需要额外开发（P1）**
- ⚠️ 支持工作表切换（点击标签页切换）- **PDF 预览方式需要额外开发（P1）**
- ⚠️ 显示当前工作表名称 - **PDF 预览方式需要额外开发（P1）**
- ⚠️ 支持工作表标签滚动（工作表较多时）- **PDF 预览方式需要额外开发（P1）**
- ✅ **MVP 1.0 基础方案**：通过 PDF 页码映射工作表（每个工作表对应 PDF 的连续页面）

#### 2.2.4 CSV 交互功能

**文本操作：**
- 支持单元格点击选中
- 支持单元格内容复制（Ctrl/Cmd + C）
- 支持单元格内容复制到剪贴板
- 支持选中单元格高亮显示

**搜索功能：**
- 支持文本搜索（Ctrl/Cmd + F）- **浏览器原生支持**
- 支持搜索结果高亮显示 - **浏览器原生支持**
- 支持搜索结果导航（上一个/下一个）- **浏览器原生支持**

**导航功能：**
- 支持虚拟滚动（大文件性能优化）
- 支持滚动条导航（水平和垂直）
- 支持键盘导航（方向键、Page Up/Down）

#### 2.2.5 Excel（XLSX/XLS/ODS）交互功能

**文本操作：**
- 支持文本选中（鼠标拖拽选择）
- 支持文本复制（Ctrl/Cmd + C）
- 支持文本复制到剪贴板
- 支持选中文本高亮显示

**搜索功能：**
- 支持文本搜索（Ctrl/Cmd + F）- **浏览器原生支持**
- 支持搜索结果高亮显示 - **浏览器原生支持**
- 支持搜索结果导航（上一个/下一个）- **浏览器原生支持**
- ⚠️ 支持搜索范围选择（当前工作表/所有工作表）- **浏览器原生不支持，需要自定义实现（P2）**

**打印功能：**
- 支持打印预览（显示分页和页码）
- 支持打印功能（Ctrl/Cmd + P）
- 支持页面设置（纸张大小、方向、边距）

**导航功能：**
- 支持页面跳转（输入页码跳转）
- 支持上一页/下一页按钮
- 支持显示当前页/总页数
- 支持滚动条导航

#### 2.2.6 引用功能

**引用支持：**
- CSV：支持点击单元格后引用，引用格式：`@文件名.csv!A1`
- Excel（XLSX/XLS/ODS）：支持选中文本后引用，引用格式：`@文件名.xlsx!Sheet1!A1` 或 `@文件名.xlsx!A1`
- 支持引用到聊天窗口
- 支持引用到其他文档

**引用交互：**
- CSV：点击单元格后显示"引用"按钮
- Excel/演示文稿：选中文本后显示"引用"按钮
- 点击"引用"按钮复制引用格式到剪贴板
- 支持引用预览（显示引用内容）

#### 2.2.7 CSV 性能要求

**加载性能：**
- 预览加载时间：小文件（< 1MB）< 2 秒，大文件（> 10MB）< 3 秒
- 流式解析进度反馈：大文件显示解析进度
- 虚拟滚动性能：10万+ 行数据滚动流畅（60fps）

**预览准确率：**
- 数据准确性：100%（数据不丢失）
- 格式兼容性：支持多种分隔符（逗号、分号、制表符）和编码（UTF-8、GBK）
- 单元格内容完整性：100%（内容完整显示，不截断）

**资源占用：**
- 内存占用：< 100MB（使用虚拟滚动，只渲染可见行）
- CPU 占用：加载时 < 50%，预览时 < 10%

#### 2.2.8 Excel（XLSX/XLS/ODS）性能要求

**加载性能：**
- 预览加载时间：首次 < 15 秒，缓存后 < 3 秒
- 大文件（> 10MB）加载时间：< 30 秒
- 工作表切换响应时间：< 1 秒

**预览准确率：**
- 格式还原准确率：≥ 95%
- 数据准确性：100%（数据不丢失）
- 公式显示：显示计算结果（不显示公式）

**资源占用：**
- 内存占用：< 200MB（单个文件）
- CPU 占用：加载时 < 50%，预览时 < 10%

### 2.2 演示文稿预览功能

#### 2.2.1 核心功能

**功能描述：**
- 支持演示文稿文件的只读预览模式
- 用户可查看文档内容，但不能编辑
- 支持多种演示文稿格式（PPTX, PPT, PPSX, PPS, ODP）

**支持的文件格式：**
- PPTX（PowerPoint 2007 及以上）- 最常用的演示文稿格式
- PPT（PowerPoint 97-2003）- 兼容旧版 PowerPoint 文件
- PPSX（PowerPoint 幻灯片放映 2007 及以上）- 幻灯片放映格式，打开后直接播放
- PPS（PowerPoint 幻灯片放映 97-2003）- 旧版幻灯片放映格式
- ODP（LibreOffice Impress）- 开源演示文稿格式

**格式说明：**
- PPS/PPSX 格式是 PowerPoint 的幻灯片放映格式，常用于演示和分享
- PPS/PPSX 文件打开后直接进入播放模式，适合快速预览演示内容
- 预览时按幻灯片形式显示，支持幻灯片切换和导航

#### 2.2.2 预览显示

**显示要求：**
- 模拟 PowerPoint 幻灯片效果
- 支持幻灯片缩略图导航
- 支持全屏预览模式
- 支持暗色模式适配
- 支持缩放功能（50%-200%，步进 10%）

**幻灯片管理：**
- ⚠️ 显示幻灯片缩略图列表（侧边栏）- **PDF 预览方式需要额外开发（P1）**
- ⚠️ 支持幻灯片切换（点击缩略图或导航按钮）- **PDF 预览方式需要额外开发（P1）**
- ⚠️ 显示当前幻灯片编号/总幻灯片数 - **PDF 预览方式需要额外开发（P1）**
- ⚠️ 支持幻灯片跳转（输入幻灯片编号）- **PDF 预览方式需要额外开发（P1）**
- ✅ **MVP 1.0 基础方案**：通过 PDF 页码映射幻灯片（每张幻灯片对应 PDF 的一页）

#### 2.2.3 交互功能

**文本操作：**
- 支持文本选中（鼠标拖拽选择）
- 支持文本复制（Ctrl/Cmd + C）
- 支持文本复制到剪贴板
- 支持选中文本高亮显示
- 支持文本框内容选中

**搜索功能：**
- 支持文本搜索（Ctrl/Cmd + F）- **浏览器原生支持**
- 支持搜索结果高亮显示 - **浏览器原生支持**
- 支持搜索结果导航（上一个/下一个）- **浏览器原生支持**
- ⚠️ 支持搜索范围选择（当前幻灯片/所有幻灯片）- **浏览器原生不支持，需要自定义实现（P2）**

**导航功能：**
- 支持上一张/下一张幻灯片按钮（浏览器原生，通过 PDF 页码）
- 支持键盘导航（方向键、Page Up/Down）- **浏览器原生支持**
- ⚠️ 支持幻灯片跳转（输入幻灯片编号）- **浏览器原生不支持，需要自定义实现（P2）**
- 支持显示当前幻灯片/总幻灯片数（浏览器原生，通过 PDF 页码）

**播放功能：**
- ⚠️ 支持幻灯片播放模式（自动播放）- **PDF 预览不支持动画，暂不支持（P2）**
- ⚠️ 支持播放控制（播放/暂停、上一张/下一张）- **PDF 预览不支持动画，暂不支持（P2）**
- ⚠️ 支持播放速度设置（慢速/正常/快速）- **PDF 预览不支持动画，暂不支持（P2）**
- ⚠️ 支持全屏播放 - **需要自定义实现（P1）**

#### 2.2.4 引用功能

**引用支持：**
- 支持选中文本后引用
- 支持引用格式：`@文件名.pptx!幻灯片1` 或 `@文件名.pptx!第1页`
- 支持引用到聊天窗口
- 支持引用到其他文档

**引用交互：**
- 选中文本后显示"引用"按钮
- 点击"引用"按钮复制引用格式到剪贴板
- 支持引用预览（显示引用内容）

#### 2.2.5 性能要求

**加载性能：**
- 预览加载时间：首次 < 15 秒，缓存后 < 3 秒
- 大文件（> 50MB）加载时间：< 60 秒
- 幻灯片切换响应时间：< 0.5 秒

**预览准确率：**
- 格式还原准确率：≥ 95%
- 布局还原准确率：≥ 90%
- 动画效果：不显示（静态预览）

**资源占用：**
- 内存占用：< 300MB（单个文件）
- CPU 占用：加载时 < 50%，预览时 < 10%

### 2.3 共同交互功能

#### 2.3.1 文本选中和复制

**选中功能：**
- 支持鼠标拖拽选择文本
- 支持双击选中单词
- 支持三击选中段落
- 支持选中文本高亮显示
- 支持跨单元格/文本框选中（Excel/演示文稿）

**复制功能：**
- 支持快捷键复制（Ctrl/Cmd + C）- **浏览器原生支持**
- 支持右键菜单复制 - **浏览器原生支持**
- 支持复制到剪贴板 - **浏览器原生支持**
- 支持复制纯文本 - **浏览器原生支持**
- ⚠️ 支持复制格式（带格式）- **浏览器原生不支持，需要自定义实现（P2）**
- ⚠️ 支持复制后提示（"已复制到剪贴板"）- **需要自定义实现（P1）**

#### 2.3.2 引用功能

**引用格式：**
- DOCX：`@文件名.docx!第1页` 或 `@文件名.docx!段落1`
- CSV：`@文件名.csv!A1`（精确单元格引用）
- Excel（XLSX/XLS/ODS）：`@文件名.xlsx!Sheet1!A1` 或 `@文件名.xlsx!A1`（PDF 预览简化引用）
- 演示文稿：`@文件名.pptx!幻灯片1` 或 `@文件名.pptx!第1页`
- 支持引用到聊天窗口
- 支持引用到其他文档（Markdown、DOCX）

**引用交互：**
- 选中文本后显示"引用"按钮（悬浮或工具栏）
- 点击"引用"按钮复制引用格式
- 支持引用预览（鼠标悬停显示引用内容）
- 支持引用跳转（点击引用跳转到对应位置）

**引用显示：**
- 引用格式在聊天窗口显示为可点击链接
- 点击链接打开对应文档并定位到引用位置
- 支持引用内容预览（悬浮显示）

#### 2.3.3 搜索功能

**搜索界面：**
- 支持快捷键打开搜索（Ctrl/Cmd + F）
- 搜索框显示在预览区域顶部或侧边
- 支持搜索框自动聚焦
- 支持搜索历史记录

**搜索功能：**
- 支持文本搜索（区分大小写选项）
- 支持搜索结果高亮显示
- 支持搜索结果计数（显示"1/10"）
- 支持搜索结果导航（上一个/下一个按钮）
- 支持搜索范围选择（当前页/所有页）

**搜索交互：**
- 输入搜索词后自动高亮结果
- 支持实时搜索（输入即搜索）
- 支持搜索词高亮（在搜索结果中）
- 支持搜索框关闭（ESC 键）

#### 2.3.4 缩放功能

**缩放控制：**
- 支持缩放范围：50%-200% - **浏览器原生支持**
- 支持缩放步进：10% - **浏览器原生支持**
- 支持快捷键缩放（Ctrl/Cmd + +/-）- **浏览器原生支持**
- 支持鼠标滚轮缩放（Ctrl/Cmd + 滚轮）- **浏览器原生支持**
- 支持缩放重置（100%）- **浏览器原生支持**

**缩放显示：**
- ⚠️ 显示当前缩放比例（如"100%"）- **浏览器原生不支持，需要自定义实现（P2）**
- ⚠️ 支持缩放按钮（放大/缩小/重置）- **浏览器原生不支持，需要自定义实现（P2）**
- ⚠️ 支持缩放滑块（拖拽调整）- **浏览器原生不支持，需要自定义实现（P2）**
- ⚠️ 支持自适应缩放（适应窗口大小）- **浏览器原生不支持，需要自定义实现（P2）**

#### 2.3.5 打印功能

**打印预览：**
- 支持打印预览模式（显示分页）
- 支持页码显示（当前页/总页数）
- 支持页面设置（纸张大小、方向、边距）
- 支持打印范围选择（全部/当前页/指定页）

**打印功能：**
- 支持快捷键打印（Ctrl/Cmd + P）
- 支持打印对话框
- 支持打印设置（份数、双面打印等）
- 支持打印到 PDF

### 2.4 界面设计要求

#### 2.4.1 预览区域

**布局：**
- 预览区域占据主要内容区域
- 支持全屏预览模式
- 支持响应式布局（适配不同屏幕尺寸）
- 支持暗色模式适配

**工具栏：**
- 显示在预览区域顶部或侧边
- 包含：搜索、缩放、打印、引用等按钮
- 支持工具栏折叠/展开
- 支持工具栏自定义（显示/隐藏按钮）

**状态栏：**
- 显示当前页/总页数（DOCX/Excel/演示文稿）
- 显示当前工作表/幻灯片名称（Excel/演示文稿）
- 显示加载状态（加载中/已加载）
- 显示错误信息（如有）

#### 2.4.2 导航区域

**CSV 导航：**
- 行号列（左侧固定列）
- 支持虚拟滚动（大文件性能优化）
- 支持水平滚动（列数较多时）
- 支持垂直滚动（行数较多时）

**Excel 导航：**
- 工作表标签栏（底部）
- 支持标签滚动（工作表较多时）
- 支持标签右键菜单（重命名等，仅显示，不编辑）

**演示文稿导航：**
- 幻灯片缩略图列表（侧边栏）
- 支持缩略图滚动
- 支持缩略图大小调整
- 支持缩略图显示/隐藏

#### 2.4.3 交互反馈

**视觉反馈：**
- 选中文本高亮显示
- 搜索结果高亮显示
- 引用按钮悬浮效果
- 加载状态显示（进度条或加载动画）

**操作反馈：**
- 复制成功提示（"已复制到剪贴板"）
- 引用成功提示（"已复制引用"）
- 错误提示（清晰的错误信息）
- 操作确认（重要操作需要确认）

---

## 三、非功能需求

### 3.1 性能需求

**响应性能：**
- 预览加载时间：首次 < 15 秒，缓存后 < 3 秒
- 文件打开时间：小文件（< 1MB）< 2 秒，大文件（> 10MB）< 30 秒
- 页面切换响应时间：< 1 秒
- 搜索响应时间：< 0.5 秒

**资源占用：**
- 基础应用内存占用：< 150MB
- 单个预览文件内存占用：< 300MB
- CPU 占用：加载时 < 50%，预览时 < 10%

### 3.2 兼容性需求

**文件格式兼容：**
- DOCX：DOCX（Word 2007+）、DOC（Word 97-2003）、ODT、RTF
- Excel：XLSX（Excel 2007+）、XLS（Excel 97-2003）、CSV、ODS
- 演示文稿：PPTX（PowerPoint 2007+）、PPT（PowerPoint 97-2003）、PPSX（PowerPoint 幻灯片放映 2007+）、PPS（PowerPoint 幻灯片放映 97-2003）、ODP
- 与 Microsoft Office 兼容性：≥ 95%
- 与 LibreOffice 兼容性：≥ 95%

**系统兼容：**
- macOS（当前系统）
- Windows（后续支持）
- Linux（后续支持）

### 3.3 用户体验需求

**操作简单：**
- 界面直观，符合用户使用习惯
- 操作流程符合预期
- 提供操作提示和帮助信息
- 支持快捷键操作

**错误处理：**
- 操作失败时显示清晰的错误信息
- 提供错误原因和解决建议
- 支持错误重试
- 文件损坏时提供友好提示

**功能提示：**
- 首次使用时提供功能引导
- 关键功能提供使用提示
- 提供快捷键列表
- 支持帮助文档

### 3.4 数据准确性需求

**预览准确性：**
- 格式还原准确率：≥ 95%
- 数据准确性：100%（数据不丢失）
- 布局还原准确率：≥ 90%（演示文稿）
- 公式显示：显示计算结果（Excel）

**兼容性要求：**
- 与原始文件兼容性：≥ 95%
- 与专业软件预览效果一致性：≥ 90%

---

## 四、功能优先级

### 4.1 MVP 1.0 范围

**必须实现（P0）：**

**DOCX 预览：**
- ✅ DOCX 文件预览（PDF 转换）- **已实现**
- ✅ 文本选中和复制 - **已实现**（浏览器原生）
- ✅ 搜索功能 - **已实现**（浏览器原生 Cmd+F）
- ✅ 缩放功能 - **已实现**（浏览器原生）
- ✅ 打印预览和打印 - **已实现**（浏览器原生 Cmd+P）
- ⚠️ 引用功能 - **待开发**

**Excel 预览：**
- ✅ Excel 文件预览（XLSX/XLS/ODS 使用 PDF 转换，CSV 使用直接解析）
- ✅ CSV 表格预览（HTML 表格 + 虚拟滚动）
- ✅ 多工作表切换（XLSX/XLS/ODS，通过 PDF 页码）
- ✅ 文本选中和复制
- ✅ 搜索功能
- ✅ 缩放功能（XLSX/XLS/ODS，浏览器原生）
- ✅ 打印预览和打印（XLSX/XLS/ODS，浏览器原生）
- ✅ 引用功能（CSV 精确单元格引用，Excel PDF 简化引用）

**演示文稿预览：**
- ✅ 演示文稿文件预览（PDF 转换）
- ✅ 幻灯片切换和导航
- ✅ 文本选中和复制
- ✅ 搜索功能
- ✅ 缩放功能
- ✅ 打印预览和打印
- ✅ 引用功能

**共同功能：**
- ✅ 统一的预览界面
- ✅ 统一的交互模式
- ✅ 暗色模式适配
- ✅ 性能优化（缓存机制）

**尽量实现（P1）：**
- ⚠️ 幻灯片播放模式（演示文稿）
- ⚠️ 全屏预览模式
- ⚠️ 高级搜索选项（区分大小写、正则表达式）

**暂不实现（P2）：**
- ❌ 编辑功能（后续版本）
- ❌ 批注和评论（后续版本）
- ❌ 协作功能（后续版本）

### 4.2 明确不支持的功能

**以下功能明确不支持（告知用户）：**
- ❌ 编辑功能（只读预览）
- ❌ 公式编辑（Excel）
- ❌ 动画播放（演示文稿，仅静态预览）
- ❌ 批注和评论
- ❌ 协作功能
- ❌ 版本历史

---

## 五、业务规则

### 5.1 文件操作规则

**文件格式支持：**
- DOCX：DOCX、DOC、ODT、RTF
- Excel：XLSX、XLS、CSV、ODS
- 演示文稿：PPTX、PPT、PPSX、PPS、ODP

**文件大小限制：**
- 单个文件大小限制：≤ 100MB（推荐 < 50MB）
- Excel 工作表数量限制：≤ 100 个工作表（推荐 < 20 个）
- 演示文稿幻灯片数量限制：≤ 500 张（推荐 < 100 张）

### 5.2 预览模式规则

**预览模式：**
- 外部导入的文件默认预览模式（只读）
- 预览模式不支持编辑
- 预览模式支持所有交互功能（选中、复制、引用等）

**缓存规则：**
- 预览结果缓存 1 小时
- 文件修改后自动清除缓存
- 支持手动清除缓存

### 5.3 引用规则

**引用格式：**
- DOCX：`@文件名.docx!第1页` 或 `@文件名.docx!段落1`
- Excel：`@文件名.xlsx!Sheet1!A1` 或 `@文件名.xlsx!A1`
- 演示文稿：`@文件名.pptx!幻灯片1` 或 `@文件名.pptx!第1页`

**引用范围：**
- 支持引用到聊天窗口
- 支持引用到其他文档（Markdown、DOCX）
- 支持引用跳转（点击引用打开文档并定位）

---

## 六、用户体验需求

### 6.1 界面设计

**预览界面：**
- 模拟原始软件界面效果（Excel/PowerPoint）
- 支持工具栏（搜索、缩放、打印等）
- 支持状态栏（显示当前页/总页数）
- 支持导航栏（工作表标签/幻灯片缩略图）

**交互界面：**
- 选中文本后显示操作按钮（复制、引用）
- 搜索框显示在预览区域顶部
- 缩放控制显示在工具栏
- 引用按钮显示在选中文本附近

### 6.2 交互设计

**操作习惯：**
- 符合用户使用习惯（Excel/PowerPoint 快捷键）
- 支持标准快捷键（Ctrl/Cmd + C 复制、Ctrl/Cmd + F 搜索等）
- 支持鼠标和键盘操作

**反馈机制：**
- 所有操作都有明确的反馈
- 长时间操作显示进度提示
- 操作完成时显示成功提示
- 错误时显示清晰的错误信息

### 6.3 帮助和引导

**功能提示：**
- 首次使用时提供功能引导
- 关键功能提供使用提示
- 提供快捷键列表
- 支持帮助文档

**错误提示：**
- 文件无法打开时显示清晰的错误信息
- 提供错误原因和解决建议
- 支持错误重试

---

## 七、需求验证标准

### 7.1 功能需求验证

**验证标准：**
- 所有 P0 功能必须完整实现
- 功能符合用户场景
- 功能交互符合设计要求
- 功能性能符合性能需求

### 7.2 预览准确性验证

**验证标准：**
- 格式还原准确率：≥ 95%
- 数据准确性：100%
- 布局还原准确率：≥ 90%（演示文稿）
- 与原始文件兼容性：≥ 95%

### 7.3 性能验证

**验证标准：**
- 预览加载时间：首次 < 15 秒，缓存后 < 3 秒
- 页面切换响应时间：< 1 秒
- 搜索响应时间：< 0.5 秒
- 内存占用：< 300MB（单个文件）

---

## 八、术语表

### 8.1 产品术语

**预览模式（Preview Mode）：**
- 文档的只读查看模式
- 不可编辑，支持基础交互（选中、复制、引用等）

**工作表（Sheet）：**
- Excel 文件中的一个表格页面
- 一个 Excel 文件可以包含多个工作表

**幻灯片（Slide）：**
- 演示文稿中的一页内容
- 一个演示文稿可以包含多张幻灯片

**引用（Reference）：**
- 在文档中引用其他文档的内容
- 格式：`@文件名!位置`

### 8.2 功能术语

**文本选中（Text Selection）：**
- 用户通过鼠标拖拽选择文本
- 选中的文本可以复制或引用

**引用格式（Reference Format）：**
- 引用的标准格式
- DOCX：`@文件名.docx!第1页`
- Excel：`@文件名.xlsx!Sheet1!A1`
- 演示文稿：`@文件名.pptx!幻灯片1`

**打印预览（Print Preview）：**
- 显示文档打印效果的预览模式
- 显示分页、页码等信息

---

## 九、附录

### 9.1 相关文档

**产品文档：**
- `Binder产品需求文档.md`：产品整体需求
- `DOCX、Excel和演示文稿预览功能需求文档.md`：预览功能需求（本文档）
- `Excel功能需求文档.md`：Excel 完整功能需求（包含编辑功能，后续版本）
- `Excel开发方案.md`：Excel 开发技术方案（编辑功能）
- `预览功能开发计划.md`：预览功能开发计划

**开发文档：**
- `Excel和演示文稿预览功能开发方案.md`：预览功能技术方案
- `Excel和演示文稿预览功能代码检查.md`：代码检查文档
- 各功能模块的开发计划文档
- API 设计文档

### 9.2 需求来源

**需求来源：**
- 产品定位和核心价值主张
- 目标用户的使用场景
- 技术可行性分析
- 用户反馈和需求

### 9.3 需求文档维护

**维护责任：**
- 产品经理负责需求文档的维护和更新
- 开发团队、测试团队、设计团队参与需求评审

**更新频率：**
- 重大需求变更时更新
- 版本发布前检查需求覆盖度
- 定期回顾和优化需求

---

## 文档结束

**文档版本**：v1.0

**创建日期**：2025年

**最后更新**：2025年

**维护者**：Binder 产品团队

**文档性质**：功能需求文档（只记录"做什么"和"为什么"，不记录"怎么做"）

**重要说明：**

1. **本文档是预览功能需求文档**，包含 DOCX、Excel 和演示文稿预览功能，不包含编辑功能
2. **DOCX 预览功能已实现**，引用功能已实现（MVP 版本）
3. **Excel 和演示文稿预览功能已实现**，引用功能已实现（MVP 版本）
4. **CSV 预览使用独立方案**（直接解析 HTML 表格 + 虚拟滚动），已实现
5. **编辑功能安排在后续版本**，不在当前版本实现
6. **三个预览功能使用统一的交互模式**，提供一致的用户体验
7. **所有功能需求都应该可验证**，有明确的验证标准
8. **预览准确性是核心要求**，格式和数据必须准确还原

**CSV 预览显示要求（核心原则）：**
- **列宽固定**：每列宽度固定，根据内容自动计算，不随窗口大小变化
- **行高固定**：每行高度固定，确保内容完整显示，不随窗口大小变化
- **内容完整性优先**：单元格内容必须完整显示，不允许截断或重叠
- **滚动机制**：窗口大小改变时，表格尺寸不变，通过滚动查看超出部分
- **样式清晰**：单元格边框清晰，内边距合适，文本对齐合理

