# 层次一（自动补全）提示词详细分析文档

## 文档信息

- **文档版本**：v1.0
- **创建日期**：2025年
- **文档性质**：提示词工程分析文档
- **适用范围**：Binder 层次一（自动补全）功能提示词优化

## 格式说明

**重要**：本文档中提到的文档格式说明：
- **原生 DOCX**：Word 原生的 .docx 文件，Binder 只能预览，不能编辑
- **t-docx**：Binder 可编辑的文档格式（TipTap 模拟的 DOCX），包括：
  - Binder 生成的文档
  - 从预览模式切换到编辑模式时创建的草稿文件（如 `document.draft.docx`）
  - 所有在 Binder 编辑器中可编辑的文档

本文档中所有涉及"可编辑"、"格式匹配"、"样式继承"等场景下的 DOCX，均指 **t-docx** 格式。

---

## 一、当前提示词设计回顾

### 1.1 当前提示词结构

```
[系统提示词]
你是一个写作助手，帮助用户续写内容。

[文档格式信息]
当前文档格式：[格式类型]
格式要求：[格式要求说明]

[上下文内容]
[光标前 300 字符的文档内容，优先在段落边界截断]

[续写要求]
基于以上上下文，续写接下来的内容（50-100 字，以完整句子结尾）：
- 保持与上下文风格一致（语气、专业度、叙述方式）
- 匹配当前文档格式和样式
- 续写内容应为普通段落文本，不使用 Markdown 标记、列表符号或代码块
```

### 1.2 当前设计的优点

- **简洁明确**：角色定位清晰，任务目标明确
- **格式适配**：根据文档格式动态调整格式要求
- **长度控制**：50-100 字限制避免过长续写
- **风格保持**：强调与上下文风格一致

### 1.3 当前设计的不足

- **上下文不足**：300 字符可能无法覆盖完整场景
- **单向感知**：只考虑上文，无法感知下文
- **结构缺失**：无法感知文档整体结构
- **场景单一**：未针对不同创作场景优化
- **风格抽象**：风格描述过于抽象，缺乏具体维度

---

## 二、文学写作场景详细分析

### 2.1 剧情维度

#### 2.1.1 情节推进场景

**典型场景**：
- **转折点**：故事从平静转向冲突，需要识别当前情节阶段
- **冲突升级**：矛盾逐步加深，需要感知冲突的递进逻辑
- **悬念设置**：埋下伏笔，需要理解伏笔的埋设方式
- **高潮铺垫**：为高潮做准备，需要识别铺垫的节奏

**当前提示词问题**：
- ❌ 300 字符可能无法覆盖完整情节单元（一个情节单元通常 500-1000 字）
- ❌ 无法识别当前情节阶段（开端、发展、高潮、结局）
- ❌ 可能忽略已埋下的伏笔，续写时破坏伏笔逻辑
- ❌ 无法感知情节节奏，可能破坏紧张-舒缓的节奏控制

**示例问题**：
```
上文：他推开门，发现房间里空无一人。桌子上放着一封信，信封上写着"紧急"。
当前续写：他拿起信，准备拆开。
问题：如果下文是"突然，门被推开了"，续写应该设置悬念，而不是直接拆信。
```

#### 2.1.2 时间线场景

**典型场景**：
- **倒叙**：从当前时间点回溯，需要识别时间跳跃
- **插叙**：插入过去事件，需要保持时间线清晰
- **时间压缩**：快速推进时间，需要识别时间跨度
- **时间跳跃**：跨越长时间，需要识别时间标记

**当前提示词问题**：
- ❌ 无法识别时间标记（"三年前"、"第二天"等）
- ❌ 可能破坏时间线逻辑
- ❌ 无法感知时间跨度，可能误用时间标记

#### 2.1.3 场景切换场景

**典型场景**：
- **地点转换**：从一个地点到另一个地点，需要过渡
- **视角切换**：从一个人物视角到另一个人物视角
- **场景过渡**：从一个场景到另一个场景，需要自然过渡

**当前提示词问题**：
- ❌ 无法识别场景边界
- ❌ 可能破坏场景过渡的自然性
- ❌ 无法感知视角切换的需求

### 2.2 人物维度

#### 2.2.1 人物性格一致性

**典型场景**：
- **性格特征**：人物有固定的性格特征（内向、外向、谨慎、冲动等）
- **行为模式**：人物有固定的行为模式（习惯、偏好、反应方式）
- **语言风格**：人物有独特的语言风格（用词、句式、语气）

**当前提示词问题**：
- ❌ 无法识别当前视角人物
- ❌ 可能破坏人物语言风格一致性
- ❌ 无法感知人物性格特征，续写可能不符合人物性格

**示例问题**：
```
上文：张三是一个内向谨慎的人，他犹豫了很久才开口："我觉得..."
当前续写：他大声喊道："我不同意！"
问题：续写不符合人物性格（内向谨慎的人不会大声喊叫）
```

#### 2.2.2 对话风格

**典型场景**：
- **个性化语言**：每个人物有独特的说话方式
- **方言口音**：人物使用方言或带有口音
- **语气变化**：人物在不同情绪下的语气变化
- **对话节奏**：对话的节奏和停顿

**当前提示词问题**：
- ❌ 无法识别说话人物
- ❌ 可能破坏人物语言风格
- ❌ 无法感知对话节奏

#### 2.2.3 人物关系

**典型场景**：
- **情感变化**：人物关系的情感变化（从陌生到熟悉、从友好到敌对）
- **冲突模式**：人物之间的冲突模式（竞争、误解、对立）
- **互动方式**：人物之间的互动方式（合作、对抗、依赖）

**当前提示词问题**：
- ❌ 无法感知人物关系
- ❌ 可能破坏人物关系的逻辑
- ❌ 无法识别人物关系的动态变化

#### 2.2.4 视角一致性

**典型场景**：
- **第一人称**：以"我"的视角叙述
- **第三人称**：以"他/她"的视角叙述
- **多视角切换**：在不同人物视角间切换
- **视角限制**：只能描述视角人物知道的信息

**当前提示词问题**：
- ❌ 无法识别当前视角
- ❌ 可能破坏视角一致性
- ❌ 可能描述视角人物不知道的信息

### 2.3 情感维度

#### 2.3.1 情感基调

**典型场景**：
- **情感类型**：悲伤、喜悦、紧张、平静、愤怒等
- **情感强度**：情感的强烈程度
- **情感混合**：多种情感的混合（如"既紧张又兴奋"）

**当前提示词问题**：
- ❌ 无法识别当前情感基调
- ❌ 可能破坏情感连贯性
- ❌ 无法感知情感递进逻辑

**示例问题**：
```
上文：他感到一阵悲伤，眼泪夺眶而出。
当前续写：他开心地笑了起来。
问题：续写破坏了情感连贯性（从悲伤直接跳到开心）
```

#### 2.3.2 情感递进

**典型场景**：
- **从平静到高潮**：情感逐步升级
- **情感转折**：情感发生转折（从悲伤到希望）
- **情感波动**：情感的起伏变化

**当前提示词问题**：
- ❌ 无法感知情感递进逻辑
- ❌ 可能破坏情感转折的自然性
- ❌ 无法识别情感波动的节奏

#### 2.3.3 氛围营造

**典型场景**：
- **环境描写**：通过环境描写营造氛围
- **情感呼应**：环境与情感相互呼应
- **氛围转换**：从一个氛围转换到另一个氛围

**当前提示词问题**：
- ❌ 无法感知氛围营造的需求
- ❌ 可能破坏氛围的连贯性
- ❌ 无法识别环境与情感的呼应关系

### 2.4 文体风格维度

#### 2.4.1 文学类型

**典型场景**：
- **小说**：叙事性强，注重情节和人物
- **散文**：抒情性强，注重意境和感受
- **诗歌**：语言精炼，注重韵律和意象
- **剧本**：对话为主，注重动作和场景

**当前提示词问题**：
- ❌ 无法识别文学类型
- ❌ 可能混用不同文体的表达方式
- ❌ 无法感知文体的特殊要求

#### 2.4.2 时代背景

**典型场景**：
- **古代**：使用古代语言和表达方式
- **现代**：使用现代语言和表达方式
- **未来**：使用未来设定和表达方式

**当前提示词问题**：
- ❌ 无法识别时代背景
- ❌ 可能混用不同时代的表达方式
- ❌ 无法感知时代背景对语言的影响

#### 2.4.3 语言风格

**典型场景**：
- **文言文**：使用文言文表达
- **白话文**：使用现代白话文
- **口语化**：使用口语化表达
- **书面语**：使用正式书面语

**当前提示词问题**：
- ❌ 无法识别语言风格
- ❌ 可能混用不同语言风格
- ❌ 无法感知语言风格的一致性要求

#### 2.4.4 修辞手法

**典型场景**：
- **比喻**：使用比喻增强表达
- **拟人**：使用拟人增强生动性
- **排比**：使用排比增强气势
- **对偶**：使用对偶增强韵律

**当前提示词问题**：
- ❌ 无法识别修辞手法的使用模式
- ❌ 可能破坏修辞手法的一致性
- ❌ 无法感知修辞手法的适用场景

---

## 三、办公文档创作场景详细分析

### 3.1 结构化文档场景

#### 3.1.1 分节层级

**典型场景**：
- **一级标题**：章节标题，通常用于主要部分
- **二级标题**：小节标题，用于细分章节
- **三级标题**：更细的标题层级
- **章节关系**：章节之间的逻辑关系（并列、递进、因果）

**当前提示词问题**：
- ❌ 无法识别当前所在章节层级
- ❌ 可能破坏章节层级结构
- ❌ 无法感知章节之间的逻辑关系
- ❌ 可能误生成标题格式

**示例问题**：
```
上文：## 第一章 项目背景
      项目启动于2023年，旨在...
当前续写：## 第二章 项目目标
问题：如果用户还在写第一章内容，续写不应该生成新章节标题
```

#### 3.1.2 列表结构

**典型场景**：
- **有序列表**：使用数字或字母编号
- **无序列表**：使用符号标记
- **嵌套列表**：列表中的列表
- **编号体系**：列表的编号方式（1, 2, 3 或 a, b, c）

**当前提示词问题**：
- ❌ 无法识别当前是否在列表中
- ❌ 可能破坏列表结构
- ❌ 无法感知列表的编号体系
- ❌ 当前提示词明确禁止列表，但在列表场景中不合理

**示例问题**：
```
上文：项目的主要目标包括：
      - 提高效率
      - 降低成本
当前续写：- 提升质量
问题：如果提示词禁止列表，续写可能生成普通段落，破坏列表结构
```

#### 3.1.3 表格数据

**典型场景**：
- **表格行**：表格中的一行数据
- **表格列**：表格中的一列数据
- **数据关联**：表格数据之间的关联关系
- **表格格式**：表格的格式和样式

**当前提示词问题**：
- ❌ 无法识别当前是否在表格中
- ❌ 可能破坏表格结构
- ❌ 无法感知表格数据的关联关系
- ❌ 无法生成表格格式

#### 3.1.4 引用关系

**典型场景**：
- **交叉引用**：引用文档中的其他部分
- **图表引用**：引用文档中的图表
- **脚注**：文档底部的注释
- **参考文献**：文档末尾的参考文献

**当前提示词问题**：
- ❌ 无法识别引用关系
- ❌ 可能破坏引用的准确性
- ❌ 无法感知引用格式要求

### 3.2 专业领域场景

#### 3.2.1 术语一致性

**典型场景**：
- **专业词汇**：特定领域的专业术语
- **缩写规范**：术语的缩写方式（如"人工智能"缩写为"AI"）
- **术语定义**：术语的准确定义
- **术语变体**：同一概念的不同表达方式

**当前提示词问题**：
- ❌ 无法识别文档中的术语
- ❌ 可能误用或混用术语
- ❌ 无法保证术语的一致性
- ❌ 可能破坏术语的准确性

**示例问题**：
```
上文：本项目采用人工智能（AI）技术...
当前续写：使用机器学习算法...
问题：如果文档中统一使用"人工智能"或"AI"，续写不应该使用"机器学习"（虽然相关，但术语不一致）
```

#### 3.2.2 概念体系

**典型场景**：
- **核心概念**：文档的核心概念
- **派生概念**：从核心概念派生的概念
- **概念关系**：概念之间的逻辑关系
- **概念层次**：概念的层次结构

**当前提示词问题**：
- ❌ 无法识别概念体系
- ❌ 可能破坏概念之间的逻辑关系
- ❌ 无法感知概念的层次结构
- ❌ 可能混用不同层次的概念

#### 3.2.3 知识结构

**典型场景**：
- **理论框架**：文档的理论基础
- **方法论**：文档使用的方法论
- **分类体系**：文档的分类方式
- **逻辑结构**：文档的逻辑组织方式

**当前提示词问题**：
- ❌ 无法识别知识结构
- ❌ 可能破坏知识结构的逻辑
- ❌ 无法感知理论框架的要求
- ❌ 可能混用不同的方法论

#### 3.2.4 引用规范

**典型场景**：
- **学术引用**：学术文档的引用格式（APA、MLA、Chicago）
- **标准引用**：行业标准的引用方式
- **法律条文**：法律文档的条文引用
- **政策文件**：政策文件的引用方式

**当前提示词问题**：
- ❌ 无法识别引用格式要求
- ❌ 可能破坏引用规范
- ❌ 无法感知引用格式的一致性

### 3.3 文档类型场景

#### 3.3.1 报告类文档

**典型场景**：
- **执行摘要**：报告开头的摘要部分
- **正文部分**：报告的主要内容
- **结论部分**：报告的结论和建议
- **附录部分**：报告的补充材料

**当前提示词问题**：
- ❌ 无法识别文档当前所在部分
- ❌ 可能破坏报告的结构
- ❌ 无法感知各部分的内容要求

**示例问题**：
```
上文：[执行摘要部分]
      本报告分析了...
当前续写：[详细的数据分析]
问题：执行摘要应该简洁，不应该包含详细分析
```

#### 3.3.2 方案类文档

**典型场景**：
- **背景分析**：方案的背景和现状
- **目标设定**：方案的目标和预期
- **方法设计**：方案的实施方法
- **预期效果**：方案的预期效果

**当前提示词问题**：
- ❌ 无法识别方案的不同阶段
- ❌ 可能破坏方案的逻辑结构
- ❌ 无法感知各阶段的内容要求

#### 3.3.3 合同类文档

**典型场景**：
- **条款定义**：合同中的定义条款
- **权利义务**：合同中的权利和义务
- **违约责任**：合同中的违约责任
- **法律效力**：合同的法律效力

**当前提示词问题**：
- ❌ 无法识别合同条款的类型
- ❌ 可能破坏合同的法律严谨性
- ❌ 无法感知合同条款的格式要求

#### 3.3.4 邮件类文档

**典型场景**：
- **称呼**：邮件的开头称呼
- **正文**：邮件的主要内容
- **结尾**：邮件的结尾部分
- **签名**：邮件的签名信息

**当前提示词问题**：
- ❌ 无法识别邮件的不同部分
- ❌ 可能破坏邮件的格式规范
- ❌ 无法感知邮件的正式程度

### 3.4 数据与事实场景

#### 3.4.1 数据引用

**典型场景**：
- **数字数据**：具体的数字（如"2023年"、"50%"）
- **百分比**：百分比数据
- **日期时间**：日期和时间信息
- **统计数据**：统计数据和分析

**当前提示词问题**：
- ❌ 无法识别数据的准确性要求
- ❌ 可能生成不准确的数据
- ❌ 无法感知数据的来源和依据
- ❌ 可能破坏数据的逻辑关系

**示例问题**：
```
上文：2023年销售额为1000万元，同比增长20%。
当前续写：2024年销售额预计达到1500万元。
问题：如果文档要求数据准确，续写不应该生成预测数据（除非上下文明确说明）
```

#### 3.4.2 事实陈述

**典型场景**：
- **客观事实**：可验证的客观事实
- **主观判断**：基于事实的主观判断
- **推测假设**：基于现有信息的推测
- **事实准确性**：事实的准确性和可靠性

**当前提示词问题**：
- ❌ 无法区分客观事实和主观判断
- ❌ 可能生成不准确的事实
- ❌ 无法感知事实的准确性要求
- ❌ 可能破坏事实的逻辑关系

#### 3.4.3 逻辑关系

**典型场景**：
- **因果关系**：原因和结果的关系
- **并列关系**：多个要素的并列
- **递进关系**：逻辑的递进发展
- **转折关系**：逻辑的转折和对比

**当前提示词问题**：
- ❌ 无法识别逻辑关系类型
- ❌ 可能破坏逻辑关系的连贯性
- ❌ 无法感知逻辑关系的递进要求
- ❌ 可能误用逻辑连接词

**示例问题**：
```
上文：项目面临的主要挑战包括：技术难度大、资源有限、时间紧迫。
当前续写：因此，我们需要制定详细的实施计划。
问题：如果上文是并列关系（"包括"），续写不应该使用"因此"（因果关系）
```

#### 3.4.4 论证结构

**典型场景**：
- **论点**：论证的核心观点
- **论据**：支持论点的证据
- **论证**：论证的过程和方法
- **结论**：论证的结论

**当前提示词问题**：
- ❌ 无法识别论证结构
- ❌ 可能破坏论证的逻辑
- ❌ 无法感知论证的完整性要求
- ❌ 可能混用不同的论证方法

---

## 四、其他创作场景详细分析

### 4.1 技术文档场景

#### 4.1.1 代码示例

**典型场景**：
- **代码块**：代码示例的格式和语法
- **代码注释**：代码注释的格式和内容
- **代码说明**：代码的功能和使用说明
- **代码风格**：代码的编码风格和规范

**当前提示词问题**：
- ❌ 无法识别代码格式要求
- ❌ 可能破坏代码的语法正确性
- ❌ 无法感知代码风格的一致性
- ❌ 当前提示词明确禁止代码块，但在技术文档中不合理

**示例问题**：
```
上文：以下是示例代码：
      function calculateSum(a, b) {
          return a + b;
      }
当前续写：这个函数接受两个参数...
问题：如果提示词禁止代码，续写可能无法正确生成代码说明
```

#### 4.1.2 API 文档

**典型场景**：
- **参数说明**：API 参数的格式和说明
- **返回值**：API 返回值的格式和说明
- **示例调用**：API 的调用示例
- **错误处理**：API 的错误处理说明

**当前提示词问题**：
- ❌ 无法识别 API 文档的结构
- ❌ 可能破坏 API 文档的格式规范
- ❌ 无法感知 API 文档的完整性要求

#### 4.1.3 教程文档

**典型场景**：
- **步骤说明**：教程的步骤和顺序
- **截图说明**：教程中的截图和说明
- **注意事项**：教程中的注意事项和提示
- **练习任务**：教程中的练习和任务

**当前提示词问题**：
- ❌ 无法识别教程的结构
- ❌ 可能破坏教程的逻辑顺序
- ❌ 无法感知教程的完整性要求

#### 4.1.4 配置文档

**典型场景**：
- **配置项**：配置项的格式和说明
- **配置值**：配置值的格式和范围
- **配置说明**：配置的功能和使用说明
- **配置示例**：配置的示例和最佳实践

**当前提示词问题**：
- ❌ 无法识别配置文档的结构
- ❌ 可能破坏配置文档的格式规范
- ❌ 无法感知配置文档的准确性要求

### 4.2 创意写作场景

#### 4.2.1 广告文案

**典型场景**：
- **标题**：广告的标题和吸引点
- **正文**：广告的主要内容和卖点
- **口号**：广告的口号和品牌定位
- **行动引导**：广告的行动引导（CTA）

**当前提示词问题**：
- ❌ 无法识别广告文案的结构
- ❌ 可能破坏广告文案的创意要求
- ❌ 无法感知广告文案的营销目标

#### 4.2.2 营销内容

**典型场景**：
- **卖点**：产品的核心卖点和优势
- **情感诉求**：营销内容的情感诉求
- **行动引导**：营销内容的行动引导
- **品牌调性**：营销内容的品牌调性

**当前提示词问题**：
- ❌ 无法识别营销内容的目标
- ❌ 可能破坏营销内容的调性
- ❌ 无法感知营销内容的策略要求

#### 4.2.3 社交媒体

**典型场景**：
- **话题标签**：社交媒体的话题和标签
- **互动元素**：社交媒体的互动元素
- **内容格式**：社交媒体的内容格式
- **平台特性**：不同平台的特性要求

**当前提示词问题**：
- ❌ 无法识别社交媒体平台
- ❌ 可能破坏社交媒体内容的格式
- ❌ 无法感知社交媒体内容的互动要求

#### 4.2.4 剧本创作

**典型场景**：
- **场景描述**：剧本的场景和环境
- **对话内容**：剧本的对话和台词
- **动作说明**：剧本的动作和表演
- **旁白说明**：剧本的旁白和说明

**当前提示词问题**：
- ❌ 无法识别剧本的格式要求
- ❌ 可能破坏剧本的结构规范
- ❌ 无法感知剧本的表演要求

### 4.3 学术写作场景

#### 4.3.1 论文结构

**典型场景**：
- **摘要**：论文的摘要和概述
- **引言**：论文的引言和背景
- **方法**：论文的方法和研究设计
- **结果**：论文的结果和分析
- **讨论**：论文的讨论和结论

**当前提示词问题**：
- ❌ 无法识别论文的不同部分
- ❌ 可能破坏论文的结构规范
- ❌ 无法感知各部分的学术要求

**示例问题**：
```
上文：[摘要部分]
      本研究分析了...
当前续写：[详细的研究方法]
问题：摘要应该简洁，不应该包含详细方法
```

#### 4.3.2 引用格式

**典型场景**：
- **APA 格式**：美国心理学会的引用格式
- **MLA 格式**：现代语言协会的引用格式
- **Chicago 格式**：芝加哥手册的引用格式
- **引用一致性**：引用格式的一致性要求

**当前提示词问题**：
- ❌ 无法识别引用格式要求
- ❌ 可能破坏引用格式的规范性
- ❌ 无法感知引用格式的一致性

#### 4.3.3 学术语言

**典型场景**：
- **客观性**：学术语言的客观和严谨
- **准确性**：学术语言的准确和精确
- **规范性**：学术语言的规范和标准
- **专业性**：学术语言的专业和深入

**当前提示词问题**：
- ❌ 无法识别学术语言的要求
- ❌ 可能破坏学术语言的严谨性
- ❌ 无法感知学术语言的规范性

#### 4.3.4 图表说明

**典型场景**：
- **图表标题**：图表的标题和说明
- **图表描述**：图表的描述和分析
- **图表引用**：图表的引用和标注
- **图表格式**：图表的格式和规范

**当前提示词问题**：
- ❌ 无法识别图表的格式要求
- ❌ 可能破坏图表的说明规范
- ❌ 无法感知图表的引用要求

### 4.4 多语言场景

#### 4.4.1 语言切换

**典型场景**：
- **中英混写**：中英文混合的文档
- **多语言文档**：包含多种语言的文档
- **语言标记**：语言的标记和识别
- **语言一致性**：语言的一致性要求

**当前提示词问题**：
- ❌ 无法识别当前使用的语言
- ❌ 可能破坏语言的一致性
- ❌ 无法感知语言切换的需求

**示例问题**：
```
上文：This is a test document. 这是一个测试文档。
当前续写：This is another test.
问题：如果用户希望保持中英混写，续写应该包含中文
```

#### 4.4.2 翻译场景

**典型场景**：
- **术语翻译**：专业术语的翻译
- **翻译一致性**：翻译的一致性要求
- **文化适应**：翻译的文化适应性
- **表达习惯**：不同语言的表达习惯

**当前提示词问题**：
- ❌ 无法识别翻译的要求
- ❌ 可能破坏翻译的准确性
- ❌ 无法感知翻译的文化要求

#### 4.4.3 本地化

**典型场景**：
- **文化适应**：内容的文化适应性
- **表达习惯**：不同地区的表达习惯
- **格式规范**：不同地区的格式规范
- **语言变体**：不同地区的语言变体

**当前提示词问题**：
- ❌ 无法识别本地化的要求
- ❌ 可能破坏本地化的适应性
- ❌ 无法感知本地化的文化要求

---

## 五、上下文兼容性问题详细分析

### 5.1 当前问题分析

#### 5.1.1 单向感知问题

**问题描述**：
- 当前提示词只考虑上文（光标前 300 字符）
- 无法感知下文（光标后的内容）
- 可能导致续写与下文不连贯

**影响场景**：
- **段落中间续写**：如果用户在段落中间续写，下文已有内容，续写可能与之冲突
- **章节过渡**：如果用户在章节过渡处续写，下文可能是新章节，续写需要自然过渡
- **列表续写**：如果用户在列表中续写，下文可能是列表项，续写需要保持列表格式

**示例问题**：
```
上文：他推开门，发现房间里空无一人。
当前续写：他感到一阵紧张。
下文：突然，门被推开了，一个熟悉的身影出现在门口。
问题：续写"他感到一阵紧张"与下文"突然，门被推开了"冲突（如果他已经推开门，下文不应该再推开门）
```

#### 5.1.2 结构感知缺失

**问题描述**：
- 无法感知文档的整体结构（章节、段落、列表）
- 无法识别当前所在的结构位置
- 可能导致续写破坏文档结构

**影响场景**：
- **章节边界**：如果用户在章节边界续写，可能误生成新章节标题
- **段落边界**：如果用户在段落边界续写，可能破坏段落结构
- **列表边界**：如果用户在列表边界续写，可能破坏列表格式

#### 5.1.3 语义连贯缺失

**问题描述**：
- 无法理解上下文的语义关系
- 无法保持语义的连贯性
- 可能导致续写语义不连贯

**影响场景**：
- **主题一致性**：如果文档有明确的主题，续写可能偏离主题
- **逻辑连贯**：如果文档有逻辑关系，续写可能破坏逻辑
- **情感连贯**：如果文档有情感基调，续写可能破坏情感

### 5.2 需要解决的核心问题

#### 5.2.1 双向上下文感知

**解决方案**：
- **读取下文**：读取光标后 100-200 字符（如有）
- **段落边界识别**：识别段落边界，避免破坏段落结构
- **语义连贯分析**：分析上下文的语义关系，保持连贯性

**技术实现**：
- 前端提取光标后内容（如有）
- 后端识别段落边界和结构
- 在提示词中传递下文信息

#### 5.2.2 文档结构感知

**解决方案**：
- **结构提取**：提取文档的大纲结构（标题层级）
- **位置识别**：识别当前所在的结构位置（章节、段落、列表）
- **结构信息传递**：在提示词中传递结构信息

**技术实现**：
- 前端分析文档结构（Markdown 解析、t-docx 解析）
- 识别当前光标所在的结构位置
- 在提示词中传递结构信息（如"当前在第一章第二节的段落中"）

#### 5.2.3 语义连贯保证

**解决方案**：
- **关键信息提取**：提取上下文的关键信息（主题、实体、情感）
- **语义分析**：分析上下文的语义关系
- **连贯性要求**：在提示词中强调语义连贯性

**技术实现**：
- 使用 NLP 技术提取关键实体和主题
- 分析上下文的情感基调
- 在提示词中传递语义信息

### 5.3 上下文兼容性优化建议

#### 5.3.1 提示词层面优化

**增加下文感知**：
```
[上下文内容]
上文：[光标前 300-500 字符]
下文：[光标后 100-200 字符]（如有）

[结构信息]
当前位置：[章节/段落/列表位置]
文档结构：[简要结构信息]

[语义信息]
主题：[文档主题]
关键实体：[人物、地点、概念等]
情感基调：[当前情感基调]
```

**增加连贯性要求**：
```
续写要求：
- 保持与上文的语义连贯
- 如果下文有内容，确保续写与下文自然衔接
- 保持文档结构的完整性
- 保持主题和情感的一致性
```

#### 5.3.2 技术实现层面优化

**前端实现**：
- 提取光标前后内容（上文 300-500 字符，下文 100-200 字符）
- 分析文档结构（Markdown/t-docx 解析）
- 提取关键信息（实体、主题、情感）

**后端实现**：
- 接收上下文和结构信息
- 构建增强的提示词
- 调用 AI 生成续写内容

---

## 六、其他提示词问题详细分析

### 6.1 长度限制问题

#### 6.1.1 续写长度限制

**当前限制**：50-100 字

**问题分析**：
- **过短场景**：复杂表达需要更多字数（如描述复杂场景、解释复杂概念）
- **截断问题**：可能截断句子，影响完整性
- **语义单元**：50-100 字可能无法完成一个完整的语义单元

**优化建议**：
- **动态调整**：根据场景动态调整长度（简单场景 50-100 字，复杂场景 100-200 字）
- **语义单元**：以完整句子或完整语义单元结尾，而不是固定字数
- **提示词优化**：改为"50-150 字，以完整句子或完整语义单元结尾"

#### 6.1.2 上下文长度限制

**当前限制**：300 字符（动态调整 300-500 字符）

**问题分析**：
- **复杂场景不足**：复杂场景（如文学创作、专业文档）需要更多上下文
- **段落边界**：段落边界截断可能丢失关键信息
- **结构信息缺失**：仅字符数无法包含结构信息

**优化建议**：
- **场景识别**：根据场景类型动态调整上下文长度
  - 简单场景（邮件、便签）：300 字符
  - 中等场景（报告、方案）：500 字符
  - 复杂场景（小说、学术论文）：800-1000 字符
- **智能截断**：优先在段落边界、句子边界截断，保持语义完整性
- **结构信息补充**：在字符限制外，补充结构信息（章节、段落位置）

### 6.2 格式限制问题

#### 6.2.1 格式限制过于严格

**当前限制**："续写内容应为普通段落文本，不使用 Markdown 标记、列表符号或代码块"

**问题分析**：
- **Markdown 文档不合理**：在 Markdown 文档中，应该允许 Markdown 格式
- **列表场景不合理**：在列表场景中，应该允许列表格式
- **技术文档不合理**：在技术文档中，可能需要代码块

**优化建议**：
- **格式适配**：根据文档格式动态调整格式要求
  - TXT 格式：纯文本，无格式标记
  - Markdown 格式：允许 Markdown 语法（粗体、斜体、列表等），但需与上下文风格一致
  - t-docx 格式：匹配 t-docx 样式（标题、粗体、斜体、列表等）
  - HTML 格式：允许 HTML 标签，但需与上下文风格一致
- **场景适配**：根据场景类型调整格式要求
  - 列表场景：允许列表格式
  - 代码场景：允许代码格式（技术文档）
  - 表格场景：允许表格格式

#### 6.2.2 格式一致性要求

**当前要求**："匹配当前文档格式和样式"

**问题分析**：
- **过于抽象**：没有具体的格式匹配规则
- **无法执行**：AI 无法准确理解"匹配格式"的含义

**优化建议**：
- **具体规则**：提供具体的格式匹配规则
  - 如果上下文使用粗体，续写可以使用粗体
  - 如果上下文在列表中，续写应该保持列表格式
  - 如果上下文有标题层级，续写应该匹配层级
- **样式继承**：明确样式继承规则
  - 继承段落的样式（字体、大小、颜色）
  - 继承列表的样式（编号、符号）
  - 继承标题的样式（层级、格式）

### 6.3 风格识别问题

#### 6.3.1 风格描述过于抽象

**当前描述**："保持与上下文风格一致（语气、专业度、叙述方式）"

**问题分析**：
- **维度不足**：仅"语气、专业度、叙述方式"三个维度，无法覆盖所有风格特征
- **无法量化**：无法量化风格特征，AI 难以准确理解
- **场景差异**：不同场景的风格要求不同，需要更具体的描述

**优化建议**：
- **增加风格维度**：
  - **文体类型**：小说、散文、诗歌、剧本、报告、方案等
  - **时代背景**：古代、现代、未来
  - **语言风格**：文言、白话、口语、书面语
  - **修辞手法**：比喻、拟人、排比、对偶等
  - **情感基调**：悲伤、喜悦、紧张、平静等
  - **专业程度**：通俗、专业、学术
- **风格识别**：自动识别文档的风格特征，在提示词中传递
- **风格要求**：根据识别的风格特征，在提示词中明确风格要求

#### 6.3.2 风格一致性保证

**当前要求**："保持与上下文风格一致"

**问题分析**：
- **无法保证**：仅靠提示词无法保证风格一致性
- **需要技术支撑**：需要风格识别和分析技术

**优化建议**：
- **风格分析**：使用 NLP 技术分析文档的风格特征
- **风格传递**：在提示词中传递风格特征
- **风格约束**：在提示词中明确风格约束

### 6.4 续写方向问题

#### 6.4.1 续写方向不明确

**当前问题**：无法识别续写方向（推进、补充、转折）

**影响场景**：
- **情节推进**：需要推进情节，但可能误生成补充内容
- **信息补充**：需要补充信息，但可能误生成推进内容
- **逻辑转折**：需要逻辑转折，但可能误生成推进内容

**优化建议**：
- **方向识别**：根据上下文和用户意图识别续写方向
- **方向提示**：在提示词中明确续写方向
  - "自然推进情节"
  - "补充相关信息"
  - "进行逻辑转折"

#### 6.4.2 续写意图理解

**当前问题**：无法理解用户的续写意图

**优化建议**：
- **意图分析**：分析上下文的语义，推断续写意图
- **意图传递**：在提示词中传递续写意图
- **意图约束**：在提示词中明确意图约束

---

## 七、超出提示词功能的技术问题

### 7.1 文档结构感知技术

#### 7.1.1 问题描述

**核心问题**：无法感知文档的整体结构（章节、段落、列表）

**技术挑战**：
- **格式多样性**：不同格式（TXT、t-docx、Markdown、HTML）的结构解析方式不同
- **结构复杂性**：文档结构可能很复杂（多级标题、嵌套列表、表格等）
- **实时性要求**：需要在用户输入时实时分析结构

#### 7.1.2 技术方案

**方案一：前端结构解析**
- **Markdown 解析**：使用 Markdown 解析器（如 `marked`、`markdown-it`）解析文档结构
- **t-docx 解析**：使用 t-docx 解析库（如 `mammoth`、`docx`）解析文档结构
- **HTML 解析**：使用 DOM 解析器解析 HTML 结构
- **结构提取**：提取标题层级、段落边界、列表结构等

**方案二：后端结构分析**
- **文档解析**：后端接收文档内容，解析结构
- **结构识别**：识别章节、段落、列表等结构元素
- **位置定位**：定位当前光标所在的结构位置

**方案三：混合方案**
- **前端实时解析**：前端实时解析文档结构
- **后端深度分析**：后端进行深度结构分析
- **结构信息传递**：将结构信息传递给 AI

#### 7.1.3 实现难点

- **性能问题**：实时解析可能影响性能，需要优化
- **准确性**：结构解析的准确性需要保证
- **兼容性**：不同格式的兼容性需要处理

### 7.2 语义理解技术

#### 7.2.1 问题描述

**核心问题**：无法理解上下文的语义关系

**技术挑战**：
- **语义复杂性**：语义关系可能很复杂（因果关系、并列关系、递进关系等）
- **上下文依赖**：语义理解需要依赖大量上下文
- **实时性要求**：需要在用户输入时实时分析语义

#### 7.2.2 技术方案

**方案一：NLP 技术**
- **实体识别**：使用 NER（命名实体识别）技术识别关键实体（人物、地点、概念等）
- **主题提取**：使用主题模型（如 LDA）提取文档主题
- **情感分析**：使用情感分析技术分析文档情感基调
- **关系抽取**：使用关系抽取技术提取实体之间的关系

**方案二：大语言模型**
- **语义理解**：使用大语言模型理解上下文语义
- **关键信息提取**：使用大语言模型提取关键信息
- **语义连贯分析**：使用大语言模型分析语义连贯性

**方案三：混合方案**
- **NLP 预处理**：使用 NLP 技术预处理文档
- **大模型分析**：使用大语言模型进行深度语义分析
- **信息传递**：将语义信息传递给续写 AI

#### 7.2.3 实现难点

- **计算成本**：语义分析的计算成本较高
- **准确性**：语义理解的准确性需要保证
- **实时性**：实时语义分析可能影响响应速度

### 7.3 下文感知技术

#### 7.3.1 问题描述

**核心问题**：无法读取下文，可能导致续写与下文不连贯

**技术挑战**：
- **内容获取**：需要获取光标后的内容
- **边界识别**：需要识别段落边界、句子边界
- **语义分析**：需要分析下文的语义，确保续写连贯

#### 7.3.2 技术方案

**方案一：前端读取**
- **内容提取**：前端提取光标后 100-200 字符
- **边界识别**：识别段落边界、句子边界
- **信息传递**：将下文信息传递给后端

**方案二：后端分析**
- **内容接收**：后端接收光标前后内容
- **语义分析**：分析上下文的语义关系
- **连贯性检查**：检查续写与下文的连贯性

**方案三：混合方案**
- **前端提取**：前端提取下文内容
- **后端分析**：后端分析语义连贯性
- **提示词增强**：在提示词中传递下文信息

#### 7.3.3 实现难点

- **性能影响**：读取下文可能影响性能
- **边界识别**：段落边界、句子边界的识别准确性
- **语义连贯**：语义连贯性的判断准确性

### 7.4 风格识别技术

#### 7.4.1 问题描述

**核心问题**：无法自动识别文档风格

**技术挑战**：
- **风格多样性**：文档风格可能很多样（文学、学术、技术、创意等）
- **风格特征**：风格特征可能很复杂（语言、结构、情感等）
- **实时性要求**：需要在用户输入时实时识别风格

#### 7.4.2 技术方案

**方案一：特征提取**
- **语言特征**：提取语言特征（词汇、句式、语法等）
- **结构特征**：提取结构特征（段落长度、标题层级等）
- **情感特征**：提取情感特征（情感基调、情感强度等）
- **风格分类**：使用分类模型识别风格类型

**方案二：大语言模型**
- **风格分析**：使用大语言模型分析文档风格
- **风格描述**：生成风格描述（文体类型、语言风格、情感基调等）
- **风格传递**：将风格信息传递给续写 AI

**方案三：混合方案**
- **特征提取**：使用特征提取技术提取风格特征
- **大模型分析**：使用大语言模型进行深度风格分析
- **风格传递**：将风格信息传递给续写 AI

#### 7.4.3 实现难点

- **准确性**：风格识别的准确性需要保证
- **实时性**：实时风格识别可能影响响应速度
- **多样性**：不同风格类型的识别需要不同的模型

### 7.5 术语一致性技术

#### 7.5.1 问题描述

**核心问题**：无法保证术语一致性

**技术挑战**：
- **术语多样性**：文档中可能有很多术语
- **术语变体**：同一概念可能有不同的表达方式
- **实时性要求**：需要在用户输入时实时检查术语一致性

#### 7.5.2 技术方案

**方案一：术语提取**
- **术语识别**：使用术语识别技术识别文档中的术语
- **术语库构建**：构建文档的术语库
- **术语检查**：检查续写中的术语是否与术语库一致

**方案二：大语言模型**
- **术语分析**：使用大语言模型分析文档中的术语
- **术语一致性**：检查术语的一致性
- **术语建议**：建议使用一致的术语

**方案三：混合方案**
- **术语提取**：使用术语提取技术提取术语
- **术语库构建**：构建术语库
- **提示词增强**：在提示词中传递术语库信息

#### 7.5.3 实现难点

- **术语识别**：术语识别的准确性需要保证
- **术语库维护**：术语库的维护和更新
- **实时性**：实时术语检查可能影响响应速度

### 7.6 用户偏好学习技术

#### 7.6.1 问题描述

**核心问题**：无法学习用户的续写偏好

**技术挑战**：
- **偏好多样性**：不同用户有不同的续写偏好
- **偏好变化**：用户偏好可能随时间变化
- **数据收集**：需要收集用户的续写选择数据

#### 7.6.2 技术方案

**方案一：数据收集**
- **选择记录**：记录用户接受/拒绝的续写内容
- **偏好分析**：分析用户的续写偏好（风格、长度、方向等）
- **偏好模型**：构建用户偏好模型

**方案二：个性化调整**
- **提示词调整**：根据用户偏好调整提示词
- **续写策略**：根据用户偏好调整续写策略
- **实时学习**：实时学习用户的续写偏好

**方案三：混合方案**
- **数据收集**：收集用户的续写选择数据
- **偏好分析**：分析用户偏好
- **个性化提示词**：根据用户偏好生成个性化提示词

#### 7.6.3 实现难点

- **数据隐私**：用户数据的隐私保护
- **实时学习**：实时学习的计算成本
- **偏好准确性**：用户偏好分析的准确性

---

## 八、优化建议总结

### 8.1 提示词层面优化建议

#### 8.1.1 上下文增强

**建议**：
```
[上下文内容]
上文：[光标前 300-500 字符，优先在段落边界截断]
下文：[光标后 100-200 字符]（如有）

[结构信息]
当前位置：[章节/段落/列表位置]
文档结构：[简要结构信息]

[语义信息]
主题：[文档主题]
关键实体：[人物、地点、概念等]
情感基调：[当前情感基调]
```

#### 8.1.2 风格识别增强

**建议**：
```
[风格信息]
文体类型：[小说/散文/诗歌/剧本/报告/方案等]
时代背景：[古代/现代/未来]
语言风格：[文言/白话/口语/书面语]
修辞手法：[比喻/拟人/排比/对偶等]（如有）
情感基调：[悲伤/喜悦/紧张/平静等]
专业程度：[通俗/专业/学术]

[风格要求]
- 保持与上下文风格一致
- 匹配识别的风格特征
- 保持风格的一致性
```

#### 8.1.3 格式适配增强

**建议**：
```
[格式信息]
当前文档格式：[TXT/t-docx/Markdown/HTML]
当前位置格式：[段落/列表/表格/代码块等]
格式要求：
- TXT 格式：纯文本，无格式标记
- Markdown 格式：允许 Markdown 语法（粗体、斜体、列表等），但需与上下文风格一致
- DOCX 格式：匹配 DOCX 样式（标题、粗体、斜体、列表等）
- HTML 格式：允许 HTML 标签，但需与上下文风格一致

[格式约束]
- 如果上下文在列表中，续写应保持列表格式
- 如果上下文在代码块中，续写应保持代码格式（技术文档）
- 如果上下文有标题层级，续写应匹配层级
- 继承段落的样式（字体、大小、颜色等）
```

#### 8.1.4 续写方向明确

**建议**：
```
[续写方向]
根据上下文分析，续写方向应为：[推进/补充/转折]

[续写要求]
- 如果方向为"推进"：自然推进情节/逻辑/内容
- 如果方向为"补充"：补充相关信息/细节/说明
- 如果方向为"转折"：进行逻辑转折/情感转折/情节转折

[长度要求]
- 简单场景：50-100 字
- 中等场景：100-150 字
- 复杂场景：150-200 字
- 以完整句子或完整语义单元结尾
```

#### 8.1.5 连贯性要求增强

**建议**：
```
[连贯性要求]
- 保持与上文的语义连贯
- 如果下文有内容，确保续写与下文自然衔接
- 保持文档结构的完整性
- 保持主题和情感的一致性
- 保持人物性格和语言风格的一致性（文学创作）
- 保持术语和概念的一致性（专业文档）
```

### 8.2 技术实现层面优化建议

#### 8.2.1 前端实现优化

**上下文提取**：
- 提取光标前 300-500 字符（根据场景动态调整）
- 提取光标后 100-200 字符（如有）
- 优先在段落边界、句子边界截断，保持语义完整性

**结构分析**：
- 使用 Markdown 解析器（如 `marked`、`markdown-it`）解析文档结构
- 使用 t-docx 解析库（如 `mammoth`、`docx`）解析文档结构
- 识别标题层级、段落边界、列表结构等
- 定位当前光标所在的结构位置

**语义分析**：
- 使用 NLP 技术提取关键实体（人物、地点、概念等）
- 使用主题模型提取文档主题
- 使用情感分析技术分析文档情感基调
- 分析上下文的语义关系

**风格识别**：
- 提取语言特征（词汇、句式、语法等）
- 提取结构特征（段落长度、标题层级等）
- 提取情感特征（情感基调、情感强度等）
- 使用分类模型或大语言模型识别风格类型

**术语提取**：
- 使用术语识别技术识别文档中的术语
- 构建文档的术语库
- 检查续写中的术语是否与术语库一致

#### 8.2.2 后端实现优化

**提示词构建**：
- 接收前端传递的上下文、结构、语义、风格、术语等信息
- 根据文档格式和场景类型动态构建提示词
- 整合所有信息，构建增强的提示词

**AI 调用优化**：
- 根据场景类型选择合适的 AI 模型
- 优化提示词长度，避免超出模型限制
- 处理 AI 返回的续写内容，进行后处理（格式检查、连贯性检查等）

**缓存机制**：
- 缓存文档结构分析结果
- 缓存语义分析结果
- 缓存风格识别结果
- 减少重复计算，提高响应速度

#### 8.2.3 用户偏好学习

**数据收集**：
- 记录用户接受/拒绝的续写内容
- 记录用户的编辑行为（修改、删除等）
- 分析用户的续写偏好（风格、长度、方向等）

**偏好模型**：
- 构建用户偏好模型
- 根据用户偏好调整提示词
- 根据用户偏好调整续写策略

**个性化**：
- 为不同用户生成个性化提示词
- 根据用户偏好优化续写内容
- 实时学习用户的续写偏好

### 8.3 实施优先级建议

#### 8.3.1 P0 优先级（高优先级，必须实现）

**上下文增强**：
- ✅ 增加下文感知（读取光标后 100-200 字符）
- ✅ 动态调整上下文长度（根据场景 300-500 字符）
- ✅ 优先在段落边界截断

**格式适配优化**：
- ✅ 根据文档格式动态调整格式要求
- ✅ 允许列表格式（在列表场景中）
- ✅ 允许代码格式（在技术文档中）

**长度限制优化**：
- ✅ 动态调整续写长度（50-150 字）
- ✅ 以完整句子或完整语义单元结尾

#### 8.3.2 P1 优先级（中优先级，建议实现）

**结构感知**：
- ⚠️ 提取文档结构（标题层级、段落边界、列表结构）
- ⚠️ 识别当前所在的结构位置
- ⚠️ 在提示词中传递结构信息

**语义分析**：
- ⚠️ 提取关键实体（人物、地点、概念等）
- ⚠️ 提取文档主题
- ⚠️ 分析情感基调
- ⚠️ 在提示词中传递语义信息

**风格识别**：
- ⚠️ 识别文体类型、语言风格、情感基调
- ⚠️ 在提示词中传递风格信息

#### 8.3.3 P2 优先级（低优先级，可选实现）

**术语一致性**：
- 📋 提取文档中的术语
- 📋 构建术语库
- 📋 在提示词中传递术语信息

**用户偏好学习**：
- 📋 收集用户的续写选择数据
- 📋 分析用户偏好
- 📋 根据用户偏好调整提示词

**高级语义分析**：
- 📋 使用大语言模型进行深度语义分析
- 📋 分析语义连贯性
- 📋 优化语义连贯性检查

### 8.4 优化后的提示词示例

#### 8.4.1 文学创作场景

```
[系统提示词]
你是一个专业的写作助手，帮助用户续写文学作品。

[文档格式信息]
当前文档格式：Markdown
格式要求：允许 Markdown 语法（粗体、斜体等），但需与上下文风格一致

[上下文内容]
上文：[光标前 500 字符，优先在段落边界截断]
下文：[光标后 150 字符]（如有）

[结构信息]
当前位置：第一章第二节的段落中
文档结构：第一章（项目背景）→ 第二节（现状分析）→ 当前段落

[语义信息]
主题：现代都市小说，讲述职场故事
关键实体：张三（主角，内向谨慎）、李四（同事，外向冲动）、公司（背景）
情感基调：紧张、焦虑
情节阶段：发展（冲突升级）

[风格信息]
文体类型：小说
时代背景：现代
语言风格：白话文，书面语
情感基调：紧张、焦虑
专业程度：通俗

[续写方向]
根据上下文分析，续写方向应为：推进（自然推进情节）

[续写要求]
基于以上上下文，续写接下来的内容（100-150 字，以完整句子结尾）：
- 保持与上文的语义连贯
- 如果下文有内容，确保续写与下文自然衔接
- 保持人物性格一致性（张三内向谨慎，不会大声喊叫）
- 保持情感基调（紧张、焦虑）
- 自然推进情节，不要突然转折
- 保持现代白话文的语言风格
```

#### 8.4.2 办公文档场景

```
[系统提示词]
你是一个专业的文档编辑助手，帮助用户续写办公文档。

[文档格式信息]
当前文档格式：t-docx
格式要求：匹配 t-docx 样式（标题、粗体、斜体、列表等），保持与上下文一致的格式

[上下文内容]
上文：[光标前 500 字符，优先在段落边界截断]
下文：[光标后 150 字符]（如有）

[结构信息]
当前位置：第一章第二节的段落中
文档结构：第一章（项目背景）→ 第二节（现状分析）→ 当前段落

[语义信息]
主题：项目可行性分析报告
关键实体：人工智能（AI）、机器学习、深度学习、项目、技术
情感基调：客观、专业
逻辑关系：并列（列举项目挑战）

[风格信息]
文体类型：报告
时代背景：现代
语言风格：书面语，正式
专业程度：专业
术语规范：统一使用"人工智能（AI）"，不使用"机器学习"

[续写方向]
根据上下文分析，续写方向应为：补充（补充项目挑战的相关信息）

[续写要求]
基于以上上下文，续写接下来的内容（100-150 字，以完整句子结尾）：
- 保持与上文的语义连贯
- 如果下文有内容，确保续写与下文自然衔接
- 保持逻辑关系（并列关系，使用"此外"、"另外"等连接词）
- 保持术语一致性（使用"人工智能（AI）"，不使用"机器学习"）
- 保持专业、客观的语言风格
- 匹配 t-docx 格式（段落样式、文本样式）
```

#### 8.4.3 技术文档场景

```
[系统提示词]
你是一个专业的技术文档编辑助手，帮助用户续写技术文档。

[文档格式信息]
当前文档格式：Markdown
格式要求：允许 Markdown 语法（代码块、列表、粗体等），但需与上下文风格一致

[上下文内容]
上文：[光标前 500 字符，优先在段落边界截断]
下文：[光标后 150 字符]（如有）

[结构信息]
当前位置：API 文档的"参数说明"部分
文档结构：API 文档 → 函数说明 → 参数说明 → 当前内容

[语义信息]
主题：JavaScript API 文档
关键实体：calculateSum（函数名）、a（参数1）、b（参数2）、返回值
情感基调：客观、技术性
逻辑关系：说明（参数说明）

[风格信息]
文体类型：技术文档
时代背景：现代
语言风格：书面语，技术性
专业程度：专业
术语规范：使用技术术语（参数、返回值、类型等）

[续写方向]
根据上下文分析，续写方向应为：补充（补充参数说明的相关信息）

[续写要求]
基于以上上下文，续写接下来的内容（100-150 字，以完整句子结尾）：
- 保持与上文的语义连贯
- 如果下文有内容，确保续写与下文自然衔接
- 保持技术文档的格式（可以使用代码块、列表等）
- 保持术语一致性（使用技术术语）
- 保持客观、技术性的语言风格
- 允许 Markdown 格式（代码块、列表等）
```

### 8.5 测试和验证建议

#### 8.5.1 功能测试

**场景覆盖**：
- 文学创作场景（小说、散文、诗歌等）
- 办公文档场景（报告、方案、合同等）
- 技术文档场景（API 文档、教程、配置文档等）
- 创意写作场景（广告、营销、社交媒体等）
- 学术写作场景（论文、研究报告等）

**边界测试**：
- 文档开头续写（无上文）
- 文档结尾续写（无下文）
- 段落中间续写（有上文和下文）
- 章节边界续写（结构边界）
- 列表中间续写（列表格式）
- 代码块中间续写（代码格式）

#### 8.5.2 质量测试

**连贯性测试**：
- 语义连贯性（续写与上文的语义关系）
- 结构连贯性（续写与文档结构的关系）
- 风格连贯性（续写与文档风格的一致性）
- 术语一致性（续写中的术语与文档术语的一致性）

**准确性测试**：
- 格式准确性（续写的格式是否符合要求）
- 长度准确性（续写的长度是否符合要求）
- 方向准确性（续写的方向是否符合预期）

#### 8.5.3 性能测试

**响应时间**：
- 上下文提取时间
- 结构分析时间
- 语义分析时间
- AI 调用时间
- 总响应时间（目标：< 2 秒）

**资源消耗**：
- CPU 使用率
- 内存使用率
- 网络带宽使用率

### 8.6 总结

#### 8.6.1 核心问题总结

**当前提示词的主要问题**：
1. **上下文不足**：300 字符可能无法覆盖完整场景，且只考虑上文，无法感知下文
2. **结构缺失**：无法感知文档整体结构，可能导致续写破坏文档结构
3. **语义理解不足**：无法理解上下文的语义关系，可能导致续写语义不连贯
4. **风格识别不足**：风格描述过于抽象，无法准确识别和保持风格一致性
5. **格式限制过严**：格式限制过于严格，在不同场景中不合理
6. **长度限制过严**：50-100 字可能过短，无法完成复杂表达

#### 8.6.2 优化方向总结

**提示词层面优化**：
1. **上下文增强**：增加下文感知、动态调整上下文长度、优先在段落边界截断
2. **结构信息传递**：提取文档结构、识别当前位置、传递结构信息
3. **语义信息传递**：提取关键实体、主题、情感基调，传递语义信息
4. **风格识别增强**：识别文体类型、语言风格、情感基调，传递风格信息
5. **格式适配优化**：根据文档格式和场景类型动态调整格式要求
6. **长度限制优化**：动态调整续写长度，以完整句子或完整语义单元结尾
7. **续写方向明确**：识别续写方向（推进/补充/转折），在提示词中明确

**技术实现层面优化**：
1. **前端实现**：上下文提取、结构分析、语义分析、风格识别、术语提取
2. **后端实现**：提示词构建、AI 调用优化、缓存机制
3. **用户偏好学习**：数据收集、偏好模型、个性化

#### 8.6.3 实施建议

**分阶段实施**：
1. **第一阶段（P0）**：实现上下文增强、格式适配优化、长度限制优化
2. **第二阶段（P1）**：实现结构感知、语义分析、风格识别
3. **第三阶段（P2）**：实现术语一致性、用户偏好学习、高级语义分析

**持续优化**：
1. **数据收集**：收集用户的续写选择数据，分析用户偏好
2. **A/B 测试**：测试不同提示词版本的效果
3. **用户反馈**：收集用户反馈，持续优化提示词
4. **性能监控**：监控响应时间、资源消耗，优化性能

#### 8.6.4 预期效果

**优化后的预期效果**：
1. **连贯性提升**：续写与上下文的连贯性显著提升
2. **准确性提升**：续写的格式、长度、方向准确性提升
3. **风格一致性提升**：续写与文档风格的一致性显著提升
4. **用户体验提升**：用户对续写内容的满意度提升
5. **适用场景扩展**：能够更好地支持各种创作场景

---

**文档版本**：v1.0  
**创建日期**：2025年  
**最后更新**：2025年  
**维护者**：Binder 开发团队