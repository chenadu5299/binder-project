# Excel 功能开发方案

## 文档信息

- **文档版本**：v1.0
- **创建日期**：2025年
- **文档性质**：技术架构方案
- **适用范围**：Binder Excel 编辑功能 MVP 1.0 及后续版本
- **对应需求文档**：`Excel功能需求文档.md`

---

## 一、整体技术架构

### 1.1 架构分层

```
┌─────────────────────────────────────────┐
│         前端层（React + TypeScript）      │
│  - Excel 预览组件                        │
│  - Excel 编辑组件                        │
│  - 工具栏组件                            │
│  - 工作表管理组件                        │
│  - AI 交互组件                           │
└─────────────────────────────────────────┘
                    ↕
┌─────────────────────────────────────────┐
│        Tauri 命令层（Rust）              │
│  - 文件操作命令                          │
│  - 转换命令                              │
│  - AI 服务命令                           │
└─────────────────────────────────────────┘
                    ↕
┌─────────────────────────────────────────┐
│        服务层（Rust Services）            │
│  - LibreOffice 服务                      │
│  - ODS 解析服务                          │
│  - 公式计算服务                          │
│  - AI 服务                               │
└─────────────────────────────────────────┘
                    ↕
┌─────────────────────────────────────────┐
│        数据层                            │
│  - ODS 数据模型                          │
│  - HTML 表格模型                         │
│  - 缓存系统                              │
└─────────────────────────────────────────┘
```

### 1.2 核心数据流

**预览模式：**
```
XLSX → LibreOffice → PDF → 前端 iframe 显示
```

**编辑模式：**
```
XLSX → LibreOffice → ODS → ODS 解析 → HTML 表格 → TipTap 编辑器
                                                          ↕
XLSX ← LibreOffice ← ODS ← ODS 生成 ← HTML 表格 ← 用户编辑
```

---

## 二、P0 功能技术架构（必须实现，MVP 1.0）

### 2.1 预览模式架构

#### 2.1.1 功能需求覆盖

**需求：支持 Excel 文件的只读预览模式**

**技术架构：**

**后端服务：**
- **LibreOffice 服务扩展**
  - 新增 `convert_excel_to_pdf` 方法
  - 复用现有 DOCX → PDF 转换逻辑
  - 支持缓存机制（1 小时缓存）

**前端组件：**
- **ExcelPreview 组件**
  - 复用 `DocxPdfPreview` 组件架构
  - 调用 `preview_excel_as_pdf` Tauri 命令
  - 使用 iframe + data URL 显示 PDF

**Tauri 命令：**
- `preview_excel_as_pdf(path: String) -> Result<String, String>`
  - 调用 LibreOffice 服务转换 Excel 为 PDF
  - 返回 PDF 文件路径

#### 2.1.2 功能需求覆盖

**需求：支持文本选中和复制、打印功能、缩放功能、搜索功能**

**技术架构：**

**前端实现：**
- **PDF 显示层**
  - 使用浏览器原生 PDF 查看器（iframe）
  - 原生支持文本选择、复制、打印、缩放、搜索
  - 无需额外实现

#### 2.1.3 功能需求覆盖

**需求：支持打印预览模式（显示分页、页码、页面跳转）**

**技术架构：**

**前端实现：**
- **打印预览工具栏**
  - 页码显示组件（当前页/总页数）
  - 页面跳转输入框
  - 上一页/下一页按钮
  - 通过 PDF.js 或浏览器原生 API 获取页数信息

#### 2.1.4 功能需求覆盖

**需求：模拟 Excel 页面效果、支持暗色模式适配、支持多工作表预览**

**技术架构：**

**前端实现：**
- **PDF 样式层**
  - CSS 样式覆盖，模拟 Excel 网格线效果
  - 暗色模式 CSS 变量适配
  - 工作表切换工具栏（显示所有工作表标签）

**后端支持：**
- **多工作表 PDF 生成**
  - LibreOffice 转换时包含所有工作表
  - 每个工作表一页 PDF
  - 前端通过页码映射工作表

### 2.2 编辑模式 - 基础编辑架构

#### 2.2.1 功能需求覆盖

**需求：单元格文本编辑、复制粘贴剪切、查找替换、撤销重做**

**技术架构：**

**前端组件：**
- **TipTap 表格编辑器**
  - 使用 TipTap Table 扩展
  - 单元格编辑：TipTap 原生支持
  - 复制粘贴：浏览器原生 Clipboard API
  - 查找替换：TipTap 搜索插件
  - 撤销重做：TipTap 历史插件（50 步）

**数据模型：**
- **HTML 表格模型**
  - 每个单元格对应一个 `<td>` 元素
  - 单元格内容存储在 `<td>` 文本节点中

#### 2.2.2 功能需求覆盖

**需求：插入/删除行和列、调整行高列宽**

**技术架构：**

**前端组件：**
- **TipTap 表格操作**
  - 插入行：`editor.chain().focus().addRowBefore().run()`
  - 删除行：`editor.chain().focus().deleteRow().run()`
  - 插入列：`editor.chain().focus().addColumnBefore().run()`
  - 删除列：`editor.chain().focus().deleteColumn().run()`

**工具栏组件：**
- **表格操作按钮组**
  - 插入行/列按钮
  - 删除行/列按钮
  - 行高/列宽调整拖拽手柄

**数据同步：**
- **ODS 数据模型更新**
  - 前端操作触发 ODS 数据模型更新
  - 行高列宽信息存储在 ODS 样式定义中

#### 2.2.3 功能需求覆盖

**需求：合并/拆分单元格、合并单元格内容对齐**

**技术架构：**

**前端组件：**
- **TipTap 合并单元格**
  - 合并：`editor.chain().focus().mergeCells().run()`
  - 拆分：`editor.chain().focus().splitCell().run()`
  - 使用 `rowspan` 和 `colspan` 属性

**数据模型：**
- **HTML 表格模型**
  - 合并单元格通过 `rowspan`/`colspan` 表示
  - 对齐信息通过 `style` 属性存储

**ODS 同步：**
- **ODS 解析服务**
  - 解析 ODS 中的合并单元格信息
  - 转换为 HTML `rowspan`/`colspan`
  - 保存时反向转换

### 2.3 编辑模式 - 基础格式架构

#### 2.3.1 功能需求覆盖

**需求：文本格式（字体、字号、颜色、背景色、粗体斜体等）**

**技术架构：**

**前端组件：**
- **TipTap 格式扩展**
  - 字体：`FontFamily` 扩展
  - 字号：`FontSize` 扩展（已实现）
  - 颜色：`Color` 扩展
  - 背景色：`Highlight` 扩展
  - 粗体斜体：TipTap 原生 `Bold`、`Italic` 扩展

**数据模型：**
- **内联样式存储**
  - 所有格式信息通过 `style` 属性存储
  - 格式：`style="font-family: Arial; font-size: 12px; color: #000; background-color: #fff"`

**ODS 同步：**
- **ODS 样式解析**
  - 解析 ODS 中的字体、字号、颜色信息
  - 转换为 HTML 内联样式
  - 保存时反向转换

#### 2.3.2 功能需求覆盖

**需求：对齐方式（水平对齐、垂直对齐、文本换行）**

**技术架构：**

**前端组件：**
- **TipTap 对齐扩展**
  - 水平对齐：`TextAlign` 扩展（已实现）
  - 垂直对齐：自定义扩展或 CSS 样式
  - 文本换行：CSS `white-space` 属性

**数据模型：**
- **样式属性**
  - 水平对齐：`style="text-align: center"`
  - 垂直对齐：`style="vertical-align: middle"`
  - 文本换行：`style="white-space: normal"`

#### 2.3.3 功能需求覆盖

**需求：边框样式（边框设置、样式、颜色、粗细）**

**技术架构：**

**前端组件：**
- **TipTap 表格样式**
  - 边框通过 CSS 样式实现
  - 工具栏提供边框设置面板
  - 支持上、下、左、右、全部边框

**数据模型：**
- **边框样式存储**
  - 格式：`style="border: 1px solid #000; border-top: 2px dashed #f00"`

**ODS 同步：**
- **ODS 边框解析**
  - 解析 ODS 中的边框样式信息
  - 转换为 CSS 边框样式
  - 保存时反向转换

#### 2.3.4 功能需求覆盖

**需求：数字格式（常规、数值、货币、百分比、日期、时间）**

**技术架构：**

**前端组件：**
- **数字格式选择器**
  - 工具栏提供数字格式下拉菜单
  - 支持格式预览

**数据模型：**
- **数字格式存储**
  - 使用 `data-number-format` 属性存储格式类型
  - 显示值存储在单元格文本中
  - 格式：`<td data-number-format="currency" data-currency-symbol="$">100.00</td>`

**ODS 同步：**
- **ODS 数字格式解析**
  - 解析 ODS 中的数字格式信息
  - 转换为 `data-number-format` 属性
  - 保存时反向转换

### 2.4 编辑模式 - 公式支持架构

#### 2.4.1 功能需求覆盖

**需求：基础公式（SUM, AVERAGE, COUNT, IF, MAX/MIN）、基本数学运算**

**技术架构：**

**数据模型：**
- **公式存储**
  - 使用 `data-formula` 属性存储公式
  - 使用 `data-value` 属性存储计算结果
  - 格式：`<td data-formula="=SUM(A1:A10)" data-value="100">100</td>`

**ODS 解析服务：**
- **公式提取**
  - 解析 ODS XML 中的 `table:formula` 属性
  - 提取公式字符串（如 `=SUM(A1:A10)`）
  - 提取计算结果
  - 转换为 HTML `data-formula` 属性

**ODS 生成服务：**
- **公式恢复**
  - 解析 HTML `data-formula` 属性
  - 写入 ODS XML 的 `table:formula` 属性
  - 确保公式语法正确

#### 2.4.2 功能需求覆盖

**需求：公式编辑（输入编辑、单元格引用、范围引用、自动补全、错误提示）**

**技术架构：**

**前端组件：**
- **公式编辑器**
  - 双击单元格进入公式编辑模式
  - 公式输入框（支持单元格引用高亮）
  - 公式自动补全（函数名提示）
  - 公式语法检查（实时验证）

**公式解析器：**
- **单元格引用解析**
  - 解析相对引用（A1）、绝对引用（$A$1）、混合引用（$A1）
  - 解析范围引用（A1:A10, A1:B10）
  - 支持跨工作表引用（Sheet2!A1）

**错误处理：**
- **公式验证**
  - 语法检查（括号匹配、函数名验证）
  - 引用检查（单元格是否存在）
  - 循环引用检测
  - 错误提示显示

#### 2.4.3 功能需求覆盖

**需求：公式计算（实时计算、依赖关系识别、循环引用检测）**

**技术架构：**

**公式计算引擎（可选，Phase 2）：**
- **JavaScript 计算引擎**
  - 实现基础函数（SUM, AVERAGE, COUNT, IF, MAX/MIN）
  - 公式依赖关系图（构建单元格依赖关系）
  - 循环引用检测（图遍历检测环）
  - 实时计算（依赖变化时重新计算）

**备选方案：**
- **不实现计算引擎**
  - 显示公式文本，不计算
  - 保存后由 Excel 计算
  - 降低开发复杂度

#### 2.4.4 功能需求覆盖

**需求：公式保留（编辑后保存时公式完整保留）**

**技术架构：**

**ODS 生成服务：**
- **公式写入**
  - 解析 HTML `data-formula` 属性
  - 验证公式语法
  - 写入 ODS XML `table:formula` 属性
  - 确保公式不丢失

**验证机制：**
- **公式完整性检查**
  - 保存前验证所有公式是否完整
  - 公式语法验证
  - 公式引用验证

### 2.5 编辑模式 - 多工作表支持架构

#### 2.5.1 功能需求覆盖

**需求：工作表管理（显示、切换、重命名、添加、删除、复制、移动）**

**技术架构：**

**前端组件：**
- **工作表标签栏**
  - 显示所有工作表标签
  - 支持标签切换（点击切换）
  - 支持标签重命名（双击编辑）
  - 支持标签右键菜单（删除、复制、移动）

**数据模型：**
- **多工作表数据模型**
  - 每个工作表对应一个 HTML 表格
  - 工作表信息存储在独立的数据结构中
  - 格式：`{ sheetId: string, name: string, html: string }`

**ODS 解析服务：**
- **多工作表解析**
  - 解析 ODS 中的所有工作表
  - 提取工作表名称
  - 为每个工作表生成独立的 HTML 表格
  - 维护工作表顺序

**ODS 生成服务：**
- **多工作表生成**
  - 合并多个 HTML 表格为 ODS
  - 保持工作表顺序
  - 保持工作表名称

#### 2.5.2 功能需求覆盖

**需求：工作表数据隔离、跨工作表引用**

**技术架构：**

**前端实现：**
- **工作表切换**
  - 切换时加载对应工作表的 HTML 表格
  - 每个工作表独立编辑状态
  - 工作表之间数据互不干扰

**公式解析器扩展：**
- **跨工作表引用解析**
  - 解析 `Sheet2!A1` 格式的引用
  - 验证工作表是否存在
  - 在公式编辑器中支持跨表引用输入

**ODS 同步：**
- **跨表引用保留**
  - ODS 解析时保留跨表引用
  - HTML 转换时保留跨表引用格式
  - 保存时恢复跨表引用

### 2.6 保存功能架构

#### 2.6.1 功能需求覆盖

**需求：自动保存、手动保存、另存为、数据完整性保障**

**技术架构：**

**前端实现：**
- **保存状态管理**
  - 防抖机制（停止编辑 2 秒后触发）
  - 保存状态显示（"已保存"/"保存中"）
  - 快捷键保存（Cmd/Ctrl + S）

**后端服务：**
- **保存流程**
  1. HTML 表格 → ODS 生成
  2. ODS → XLSX 转换（LibreOffice）
  3. 原子写入（临时文件 + 重命名）
  4. 错误重试（最多 3 次，指数退避）

**数据完整性保障：**
- **验证机制**
  - 保存前验证公式完整性
  - 保存前验证格式完整性
  - 保存前验证多工作表完整性
  - 保存失败时恢复原文件

---

## 三、P1 功能技术架构（重要功能，尽量实现）

### 3.1 AI 报表结构识别架构

#### 3.1.1 功能需求覆盖

**需求：AI 自动识别 Excel 文件类型和业务含义**

**技术架构：**

**AI 服务：**
- **报表识别模块**
  - 读取 Excel 文件内容（HTML 表格）
  - 构建提示词（包含表格结构、数据样本）
  - 调用 AI 模型识别报表类型
  - 返回识别结果（类型标签、关键字段）

**前端组件：**
- **报表识别显示**
  - 识别结果标签显示
  - 关键字段高亮
  - 报表结构说明面板

**数据模型：**
- **报表元数据**
  - 存储报表类型信息
  - 存储关键字段映射
  - 用于后续 AI 功能

### 3.2 AI 自然语言公式生成架构

#### 3.2.1 功能需求覆盖

**需求：用户通过自然语言描述公式需求，AI 自动生成公式**

**技术架构：**

**AI 服务：**
- **公式生成模块**
  - 接收用户自然语言描述
  - 接收表格上下文（当前工作表、单元格位置）
  - 构建提示词（包含表格结构、可用函数列表）
  - 调用 AI 模型生成公式
  - 验证公式语法
  - 返回公式和解释

**前端组件：**
- **公式生成界面**
  - 自然语言输入框
  - 公式预览和解释
  - 一键应用按钮

**工具调用集成：**
- **AI 工具调用**
  - `edit_current_editor_document` 工具
  - AI 生成公式后自动应用到编辑器
  - 支持用户确认机制

### 3.3 AI 格式一键优化架构

#### 3.3.1 功能需求覆盖

**需求：AI 根据报表类型自动应用专业格式**

**技术架构：**

**格式模板系统：**
- **格式模板库**
  - 财务报表模板（科目行加粗、负数红色）
  - 项目计划模板（里程碑高亮）
  - 数据统计模板（表头样式）
  - 模板可扩展

**AI 服务：**
- **格式优化模块**
  - 识别报表类型（复用报表识别）
  - 选择对应格式模板
  - 应用格式到表格
  - 支持格式预览和撤销

**前端组件：**
- **格式优化界面**
  - 一键应用按钮
  - 格式预览面板
  - 撤销按钮

### 3.4 高级公式支持架构

#### 3.4.1 功能需求覆盖

**需求：查找函数（VLOOKUP, HLOOKUP, INDEX, MATCH）、文本函数、日期函数、嵌套公式**

**技术架构：**

**公式解析器扩展：**
- **高级函数支持**
  - 扩展公式解析器支持查找函数
  - 支持文本函数语法
  - 支持日期函数语法
  - 支持嵌套公式解析（3-5 层）

**ODS 同步：**
- **高级公式保留**
  - ODS 解析时保留所有公式类型
  - HTML 转换时保留公式语法
  - 保存时恢复所有公式

**前端组件：**
- **公式编辑器扩展**
  - 支持高级函数自动补全
  - 支持嵌套公式编辑
  - 支持公式语法高亮

---

## 四、P2 功能技术架构（增强功能，后续版本）

### 4.1 跨文档数据引用架构

#### 4.1.1 功能需求覆盖

**需求：在 Excel 单元格中引用其他 Binder 文档的数据**

**技术架构：**

**引用系统：**
- **跨文档引用解析器**
  - 解析引用路径（如 `@文档名.xlsx!A1`）
  - 解析引用内容（读取被引用文档）
  - 缓存引用数据
  - 支持引用自动更新

**数据同步：**
- **引用数据管理**
  - 引用数据缓存机制
  - 引用数据更新通知
  - 引用错误处理

### 4.2 表格快照与版本管理架构

#### 4.2.1 功能需求覆盖

**需求：每次编辑后自动保留表格快照、版本历史查看和恢复**

**技术架构：**

**版本管理系统：**
- **快照生成**
  - 每次保存时生成快照
  - 快照存储（本地或云端）
  - 快照元数据（时间、用户、注释）

**版本对比：**
- **差异计算**
  - 对比两个版本的差异
  - 显示单元格级别差异
  - 显示公式差异

### 4.3 嵌入式表格架构

#### 4.3.1 功能需求覆盖

**需求：在 DOCX 或 Markdown 中嵌入 Excel 表格、双向同步编辑**

**技术架构：**

**嵌入系统：**
- **表格嵌入组件**
  - 在文档中显示表格预览
  - 支持嵌入表格编辑
  - 数据同步机制

**数据同步：**
- **双向同步**
  - 嵌入表格编辑时同步到源文件
  - 源文件编辑时同步到嵌入表格
  - 冲突解决机制

### 4.4 AI 财务分析与建议架构

#### 4.4.1 功能需求覆盖

**需求：AI 阅读财务报表数据，提供专业的财务分析和建议**

**技术架构：**

**AI 分析服务：**
- **财务分析模块**
  - 读取财务报表数据
  - 计算财务指标（净利润率、毛利率等）
  - 识别异常数据
  - 生成专业建议

**前端组件：**
- **分析结果展示**
  - 财务指标面板
  - 异常数据高亮
  - 建议列表显示

---

## 五、核心技术组件

### 5.1 ODS 解析服务

**职责：**
- 解析 ODS 文件（ZIP + XML）
- 提取工作表数据
- 提取公式信息
- 提取格式信息
- 转换为 HTML 表格模型

**技术栈：**
- Rust `zip` 库（解压 ODS）
- Rust `quick-xml` 库（解析 XML）
- 自定义 ODS 数据模型

### 5.2 ODS 生成服务

**职责：**
- 接收 HTML 表格模型
- 生成 ODS XML 结构
- 写入公式信息
- 写入格式信息
- 打包为 ODS 文件

**技术栈：**
- Rust `zip` 库（打包 ODS）
- Rust XML 生成库
- 自定义 ODS 数据模型

### 5.3 LibreOffice 服务扩展

**职责：**
- Excel → PDF 转换（预览模式）
- Excel → ODS 转换（编辑模式）
- ODS → Excel 转换（保存模式）
- 缓存管理

**技术栈：**
- 复用现有 LibreOffice 服务
- 扩展支持 Excel 格式

### 5.4 公式计算引擎（可选）

**职责：**
- 解析公式语法
- 计算基础函数（SUM, AVERAGE 等）
- 构建依赖关系图
- 检测循环引用

**技术栈：**
- JavaScript 公式解析器
- 依赖关系图算法
- 循环检测算法

### 5.5 AI 服务集成

**职责：**
- 报表结构识别
- 自然语言公式生成
- 格式优化建议
- 财务分析

**技术栈：**
- 复用现有 AI 服务
- 扩展工具调用支持
- 构建专业提示词模板

---

## 六、数据模型设计

### 6.1 ODS 数据模型

**结构：**
```
ODS File (ZIP)
├── content.xml (工作表数据、公式、格式)
├── styles.xml (样式定义)
├── meta.xml (元数据)
└── META-INF/manifest.xml (文件清单)
```

**关键字段：**
- 工作表列表（名称、顺序）
- 单元格数据（值、公式、格式）
- 样式定义（字体、颜色、边框）
- 合并单元格信息

### 6.2 HTML 表格模型

**结构：**
```html
<table>
  <thead>
    <tr><th>...</th></tr>
  </thead>
  <tbody>
    <tr>
      <td data-formula="=SUM(A1:A10)" 
          data-value="100"
          data-number-format="currency"
          style="font-family: Arial; font-size: 12px; color: #000; border: 1px solid #000;">
        100
      </td>
    </tr>
  </tbody>
</table>
```

**关键属性：**
- `data-formula`：公式字符串
- `data-value`：计算结果
- `data-number-format`：数字格式
- `style`：内联样式（格式信息）
- `rowspan`/`colspan`：合并单元格

### 6.3 前端数据模型

**结构：**
```typescript
interface ExcelFile {
  filePath: string;
  sheets: Sheet[];
  isReadOnly: boolean;
  isDraft: boolean;
}

interface Sheet {
  id: string;
  name: string;
  html: string;  // HTML 表格内容
  order: number;
}
```

---

## 七、技术实现优先级

### 7.1 Phase 1：核心功能（MVP 1.0）

**必须实现：**
1. LibreOffice 服务扩展（Excel → PDF, Excel → ODS, ODS → Excel）
2. ODS 解析服务（提取数据、公式、格式）
3. ODS 生成服务（写入数据、公式、格式）
4. TipTap 表格编辑器集成
5. 基础格式支持（字体、颜色、对齐、边框）
6. 基础公式支持（SUM, AVERAGE, COUNT, IF）
7. 多工作表支持（解析、生成、切换）
8. 保存功能（自动保存、数据完整性）

### 7.2 Phase 2：AI 功能

**尽量实现：**
1. AI 报表结构识别
2. AI 自然语言公式生成
3. AI 格式一键优化
4. 高级公式支持

### 7.3 Phase 3：增强功能

**后续版本：**
1. 跨文档数据引用
2. 表格快照与版本管理
3. 嵌入式表格
4. AI 财务分析与建议

---

## 八、技术风险与应对

### 8.1 高风险项

**ODS 解析复杂度：**
- 风险：ODS 格式复杂，解析工作量大
- 应对：使用成熟的 Rust XML 解析库，分阶段实现

**公式保留准确性：**
- 风险：公式可能在转换过程中丢失
- 应对：严格测试公式保留率，建立验证机制

**多工作表性能：**
- 风险：多工作表可能导致性能问题
- 应对：懒加载机制，只加载当前工作表

### 8.2 中风险项

**LibreOffice 转换稳定性：**
- 风险：转换可能失败或不准确
- 应对：完善的错误处理，降级方案

**格式保真度：**
- 风险：格式可能在转换中丢失
- 应对：建立格式映射表，严格测试

---

## 九、开发工作量估算

### 9.1 Phase 1（MVP 1.0）

| 模块 | 工作量 | 技术风险 |
|------|--------|---------|
| LibreOffice 服务扩展 | 2-3 天 | 中 |
| ODS 解析服务 | 5-7 天 | 高 |
| ODS 生成服务 | 5-7 天 | 高 |
| TipTap 表格编辑器 | 3-4 天 | 低 |
| 基础格式支持 | 2-3 天 | 低 |
| 基础公式支持 | 3-4 天 | 中 |
| 多工作表支持 | 3-4 天 | 中 |
| 保存功能 | 2-3 天 | 中 |
| 测试和优化 | 3-5 天 | - |

**总计：28-40 天（约 6-8 周）**

### 9.2 Phase 2（AI 功能）

| 模块 | 工作量 | 技术风险 |
|------|--------|---------|
| AI 报表识别 | 2-3 天 | 中 |
| AI 公式生成 | 3-4 天 | 中 |
| AI 格式优化 | 2-3 天 | 低 |
| 高级公式支持 | 2-3 天 | 中 |

**总计：9-13 天（约 2-2.5 周）**

---

## 十、总结

### 10.1 核心技术路线

**数据流：**
```
XLSX ↔ ODS ↔ HTML 表格 ↔ TipTap 编辑器
```

**关键服务：**
1. ODS 解析服务（核心）
2. ODS 生成服务（核心）
3. LibreOffice 服务（转换）
4. 公式计算引擎（可选）

### 10.2 架构优势

1. **数据准确性**：ODS 作为中间格式，保证数据完整性
2. **AI 原生**：HTML 表格模型便于 AI 操作
3. **可扩展性**：模块化设计，易于扩展
4. **稳定性**：复用现有技术栈，降低风险

### 10.3 实施建议

1. **先实现核心功能**：ODS 解析和生成是基础
2. **逐步验证**：每个功能模块都要严格测试
3. **AI 功能后置**：核心功能稳定后再实现 AI 功能
4. **持续优化**：根据用户反馈优化体验

---

**文档版本**：v1.0  
**创建日期**：2025年  
**对应需求文档**：`Excel功能需求文档.md`  
**状态**：技术架构方案，待评审

