# 流式响应只有两个字问题分析

## 问题现象

用户报告：AI 回复只有两个字（"你好"）就结束了，明显是有问题的。

从日志看：
```
[Log] 📨 收到聊天流式响应: – {tab_id: "chat-1764349912718-ivhq321y2", chunk_length: 2, done: false, …}
[Warning] ⚠️ 前端检测到重复 chunk，跳过: – "你好" – "累积长度:" – 2
```

## 可能的原因

### 1. 后端只收到了两个字的响应

可能 AI 模型确实只返回了"你好"，但这不太可能。

### 2. 流提前结束

可能流式响应在处理完"你好"后提前结束，没有收到后续内容。

### 3. 后续内容被错误过滤

可能后续的内容被重复检测逻辑错误地过滤掉了。

### 4. 合并逻辑问题

当前的合并逻辑是：在同一个 bytes chunk 中合并所有文本 chunks。但如果：
- 第一个 bytes chunk 包含 "你"
- 第二个 bytes chunk 包含 "好"
- 然后流就结束了

那么可能只发送了这两个字。

## 需要检查的点

1. **后端日志**：查看是否有更多内容被处理但未发送
2. **流式响应完整性**：检查流是否正常结束（收到 `[DONE]`）
3. **重复检测逻辑**：检查是否过度过滤了内容

## 建议的修复

1. 添加更详细的后端日志，记录：
   - 收到的每个 bytes chunk 的大小
   - 处理的每个 SSE 行
   - 合并后的文本内容
   - 流式响应何时结束

2. 检查重复检测逻辑是否过于严格

3. 确保流式响应正常完成，没有提前终止

